$(function(){var t=function(){var n=$(".open>.dropdown-menu"),t;n.length!==0&&n.hasClass("dropdown-menu-right")&&(t=n.offset().left,t<0?n.css({right:t-3}):n.css({right:0}))},n;$(document).on("shown.bs.dropdown",function(){t();$(window).on("resize.bs.dropdown",function(){t()})});$(document).on("hide.bs.dropdown",function(){$(window).off("resize.bs.dropdown")});$.fn.startSelect2Spinner=function(){return this.select2("container").find(".select2-arrow b").addClass("fa fa-spinner fa-spin"),this};$.fn.stopSelect2Spinner=function(){return this.select2("container").find(".select2-arrow b").removeClass("fa fa-spinner fa-spin"),this};$.log=function(){if(window.console&&window.console.log){if(arguments.length===0)return;if(arguments.length===1)return console.log(arguments[0]),arguments[0];console.log(arguments)}};$.fn.tableRowRemove=function(n){var t=$(this);return Scheduler.Accessibility?t.remove():t.is("tr")?t.children().animate({padding:0}).wrapInner("<div />").children().slideUp(function(){t.remove();n&&n()}):t.slideUp(function(){t.remove();n&&n()})};$.fn.findFormElements=function(){return $(this).find("input,select,textarea")};$.fn.serializeElements=function(){return $(this).findFormElements().serializeObject()};n=/\r?\n/g;rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i;rsubmittable=/^(?:input|select|textarea|keygen)/i;manipulation_rcheckableType=/^(?:checkbox|radio)$/i;$.fn.serializeArrayWithTargetNames=function(){return this.map(function(){var n;return n=jQuery.prop(this,"elements"),n?jQuery.makeArray(n):this}).filter(function(){var n;return n=this.type,this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(n)&&(this.checked||!manipulation_rcheckableType.test(n))}).map(function(t,i){var r;return(r=jQuery(this).val(),r===null)?null:jQuery.isArray(r)?jQuery.map(r,function(t){return{name:$(i).data("targetName")||i.name,value:t.replace(n,"\r\n")}}):{name:$(i).data("targetName")||i.name,value:r.replace(n,"\r\n")}}).get()};$.fn.serializeObject=function(){var t,n;return n={},t=this.serializeArrayWithTargetNames(),$.each(t,function(){n[this.name]!==void 0?(n[this.name].push||(n[this.name]=[n[this.name]]),n[this.name].push(this.value||"")):n[this.name]=this.value||""}),n};$.fn.populate=function(n,t){var i;return i=this,t&&(n=_.pick(n,t)),$.each(n,function(n,t){var r,u;if(r=$('[name="'+n+'"]',i),r.length||(r=$('[name="'+n+'[]"]',i)),r.length)if(u=r[0].tagName,u==="INPUT")switch(r.attr("type")){case"radio":case"checkbox":return r.each(function(){return _.isArray(t)&&_.contains(t,$(this).attr("value"))&&$(this).prop("checked",t),$(this).attr("value")===t&&$(this).prop("checked",!0),_.isBoolean(t)?$(this).prop("checked",t):void 0});default:return r.val(t)}else return u==="SELECT"||u==="TEXTAREA"?r.val(t):r.html($.text2html(t))})}});_.mixin({capitalize:function(n){return n.charAt(0).toUpperCase()+n.substring(1).toLowerCase()},capitalizeFirst:function(n){return n.charAt(0).toUpperCase()+n.substring(1)},lowerFirst:function(n){return n.charAt(0).toLowerCase()+n.substring(1)},clear:function(n){n.length=0}});String.prototype.replaceAll=function(n,t,i){var r=i===!0?"gi":"g",u=new RegExp(n,r);return this.replace(u,t)};String.prototype.toTitleCase=function(){var n=/^(a|an|and|as|are|at|but|by|en|for|if|in|nor|of|on|or|per|the|to|vs?\.?|via)$/i;return this.replace(/[A-Za-z0-9\u00C0-\u00FF]+[^\s-]*/g,function(t,i,r){return i>0&&i+t.length!==r.length&&t.search(n)>-1&&r.charAt(i-2)!==":"&&(r.charAt(i+t.length)!=="-"||r.charAt(i-1)==="-")&&r.charAt(i-1).search(/[^\s-]/)<0?t.toLowerCase():t.substr(1).search(/[A-Z]|\../)>-1?t:t.charAt(0).toUpperCase()+t.substr(1)})};$(function(){var n=$("input[name='__RequestVerificationToken']").val(),t=Backbone.sync,i=function(n){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(n)};Backbone.sync=function(r,u,f){return f.beforeSend=function(t,r){i(r.type)||r.crossDomain||t.setRequestHeader("X-XSRF-Token",n)},t(r,u,f)}});$(function(){if(Modernizr.touch)$("body").on("focus","input[type=text], select, textarea",function(){$("#header .navbar-fixed-top").addClass("fixfixed")}).on("blur","input[type=text], select, textarea",function(){$("#header .navbar-fixed-top").removeClass("fixfixed")});var n=window.navigator.languages;n&&n.length||(window.navigator.language?n=[window.navigator.language]:window.navigator.userLanguage&&(n=[window.navigator.userLanguage]));n=n&&n.length?n:["en"];moment.locale(n)});jQuery(function(n){n(document).on("click","table tr td.row-label",function(t){var i=n(t.target),u=i.closest("label,input,button,a"),r=i.closest("tr").find("input[type=checkbox]");u.length===0&&r.length===1&&r.trigger("click")})});SchedulerHelpers={createAlert:function(n,t,i){t=t||{hash:{}};var r='<div class="alert alert-'+n,u="",e=i||this,f="alert-msg";return t.hash.text?u=t.hash.text:t.fn&&(u=t.fn(e)),t.hash["class"]&&(r+=" "+t.hash["class"]),t.hash.dismissible&&(r+=" alert-dismissible"),r+='">',t.hash.icon&&(t.hash.icon==="info"?r+='<div class="pull-left"><i class="glyphicons circle_info icon-info"><\/i><\/div>':t.hash.icon==="success"?r+='<div class="pull-left"><i class="fa fa-check"><\/i><\/div>':t.hash.icon==="warning"?r+='<div class="pull-left"><i class="fa fa-warning"><\/i><\/div>':(t.hash.icon==="error"||t.hash.icon==="danger")&&(r+='<div class="pull-left"><i class="glyphicons circle_exclamation_mark"><\/i><\/div>')),t.hash.dismissible&&(r+='<button type="button" class="close" data-dismiss="alert" aria-label="close"><span aria-hidden="true">Ã—<\/span><\/button>'),t.hash.list&&(f+=" list"),t.hash.nested&&(f+=" nested"),r+='<div class="'+f+'">'+u+"<\/div><\/div>",new Handlebars.SafeString(r)},createButton:function(n,t){var i,r,u,f;return i='<button role="button" class="btn '+n,t.hash["class"]&&(i+=" "+t.hash["class"]),i+='"',f=_.chain(t.hash).keys().filter(function(n){return n.indexOf("data-")===0}).value(),_.each(f,function(n){i+=" "+n+'="'+t.hash[n]+'"'}),t.hash.title&&(i+=' title="'+t.hash.title+'"'),t.hash.text&&(i+=' aria-label="'+t.hash.text+'"'),i+=">",r=t.hash.text,t.hash.icon&&(i+='<i class="'+t.hash.icon+'"><\/i> '),r?i+="<span>"+r+"<\/span>":t.fn&&(i+=t.fn(this)),u=t.hash.accText,u&&(i+='<span class="visible-acc">'+u+"<\/span>"),i+="<\/button>",new Handlebars.SafeString(i)},fromMilitaryTime:function(n){var t=("0000"+n).slice(-4),i=parseInt(t.substring(0,2),10),r=(i+11)%12+1,u=i>11?"pm":"am",f=t.substring(2);return r+":"+f+u},toDateString:function(n){return moment(n).utc().format("L")},safeUrlSegment:function(n){if(/[\/&():<>*%.+\\]/.test(n)){var t=btoa(n).replace(/\//,"_").replace(/\+/,"-");return"b64-"+t}return n},safeUrl:function(){var n=_.map(arguments,SchedulerHelpers.safeUrlSegment);return"/"+n.join("/")},getConfigValue:function(n,t){var r=n.split("."),i=Scheduler.Config;return _.each(r,function(n){i=_.isObject(i)&&n in i?i[n]:undefined}),_.isUndefined(i)?t:i},confirmBox:function(n,t){var i=bootbox.confirm({message:n,show:!1,callback:t}),r=_.uniqueId("bootbox-body-");return i.find(".bootbox-body").attr("id",r),i.attr("role","alertdialog"),i.attr("aria-describedby",r),$("body").append(i),i.modal("show"),i},alertBox:function(n){var t=bootbox.alert({message:n,closeButton:!1,show:!1}),i=_.uniqueId("bootbox-body-");return t.find(".bootbox-body").attr("id",i),t.attr("role","alertdialog"),t.attr("aria-describedby",i),$("body").append(t),t.modal("show"),t},makeUniversallyUniqueId:function(){return(_.now()&8388607)<<8|_.random(255)},formatLocation:function(n){return n.location?Scheduler.Config.sectionSettings.showMap&&n.mapURL?'<a class="map-link" href="'+n.mapURL+'" target="_blank">'+n.location+"<\/a>":n.location:""},flattenObject:function(n,t){var i=t?_.pick(n,t):_.values(n);return _.flatten(_.map(i,function(n){return _.isArray(n)||_.isObject(n)?SchedulerHelpers.flattenObject(n):n}))}};SchedulerLib={AttributeModes:{Single:"single",Combined:"combined",Dual:"dual"},LearningCommunityModes:{Single:"single",Dual:"dual"}};Handlebars.registerHelper("alert",function(n,t){return SchedulerHelpers.createAlert(n,t,this)});Handlebars.registerHelper("btn-primary",function(n){return SchedulerHelpers.createButton("btn-primary",n)});Handlebars.registerHelper("btn-danger",function(n){return SchedulerHelpers.createButton("btn-danger",n)});Handlebars.registerHelper("btn-warning",function(n){return SchedulerHelpers.createButton("btn-warning",n)});Handlebars.registerHelper("btn-info",function(n){return SchedulerHelpers.createButton("btn-info",n)});Handlebars.registerHelper("btn-success",function(n){return SchedulerHelpers.createButton("btn-success",n)});Handlebars.registerHelper("btn-default",function(n){return SchedulerHelpers.createButton("btn-default",n)});Handlebars.registerHelper("btn-icon",function(n){return SchedulerHelpers.createButton("btn-icon",n)});Handlebars.registerHelper("btn-save",function(n){return n=n||{hash:{"class":""}},n.hash.text=n.hash.text||"Save",n.hash.icon="fa fa-check",n.hash["class"]+=" btn-save",SchedulerHelpers.createButton("btn-primary",n)});Handlebars.registerHelper("btn-cancel",function(n){return n=n||{hash:{"class":""}},n.hash.text=n.hash.text||"Back",n.hash.icon="glyphicons chevron-left",n.hash["class"]+=" btn-muted btn-cancel",SchedulerHelpers.createButton("btn-default",n)});Handlebars.registerHelper("link-btn",function(n){var t,i;return t='<a role="button" class="btn btn-default btn-muted',n.hash["class"]&&(t+=" "+n.hash["class"]),t+='"',t+=' href="'+n.hash.href+'"',t+=">",i=n.hash.label||"Back",t+='<i class="glyphicons chevron-left"><\/i> <span>'+i+"<\/span>",t+="<\/a>",new Handlebars.SafeString(t)});Handlebars.registerHelper("hour-selector",function(n,t){t=t||{hash:{}};for(var u=t.hash.id||n,r='<select name="'+u+'-hour" id="'+u+'-hour-selector" class="form-control hour-selector">',i=1;i<13;i++)r+='<option value="'+i+'"',(n==="start"&&i===8||n==="end"&&i===11)&&(r+=" selected "),r+=">"+i+"<\/option>";return r+="<\/select>",new Handlebars.SafeString(r)});Handlebars.registerHelper("minute-selector",function(n){var t='<label for="'+n+'-minute-selector" class="sr-only">'+n+" minute<\/label>";return t+='<select name="'+n+'-minute" id="'+n+'-minute-selector" class="form-control minute-selector">',_.each(["00","05","10","15","20","25","30","35","40","45","50","55"],function(n){t+='<option value="'+n+'">'+n+"<\/option>"}),t+="<\/select>",new Handlebars.SafeString(t)});Handlebars.registerHelper("toggle",function(n,t,i,r,u){u=u||{hash:{}};var e=u.hash.smallIcon?"fa-stack-1x":"fa-stack-2x",f='<li class="tgl-chk text-center '+r;return i&&(f+=" selected"),f+='" tabindex="0">',f+='<span class="fa-stack'+(u.hash.smallIcon?" chk-sm":"")+'">',f+='<i class="fa fa-circle '+e+'"><\/i>',f+='<i class="fa fa-stack-1x'+(u.hash.smallIcon?" fa-check-circle":" fa-check")+'"><\/i>',f+='<i class="fa fa-circle-thin '+e+'"><\/i>',f+="<\/span>",f+='<input name="days" type="checkbox" id="chk-'+n+'" class="sr-only" tabindex="-1"',f+='"',i&&(f+=" checked"),f+=">",f+="<div",u.hash.inline&&(f+=' class="inline"'),f+=">",f+='<label for="chk-'+n+'">',f+=u.hash.nonbold?'<span class="nonbold">'+t+"<\/span>":t,f+="<\/label>",f+="<\/div>",f+="<\/li>",new Handlebars.SafeString(f)});Handlebars.registerHelper("meridiem-toggle",function(n,t){t=t||"am";var r=["am","pm"],i='<span class="tgl-meridiem" data-type="'+n+'" tabindex="0">';return _.each(r,function(n){i+='<span class="meridiem';n===t&&(i+=" selected");i+=n==="am"?" am":" pm";i+='" data-value="'+n+'">'+n+"<\/span>"}),i+='<label for="'+n+'-meridiem-selector" class="sr-only">'+n+" AM or PM<\/label>",i+='<select name="'+n+'-meridiem" id="'+n+'-meridiem-selector" class="form-control sr-only" tabindex="-1">',_.each(r,function(n){i+="<option";n===t&&(i+=" selected");i+=' value="'+n+'">'+n+"<\/option>"}),i+="<\/select>",i+="<\/span>",new Handlebars.SafeString(i)});Handlebars.registerHelper("section-field",function(n,t){if(_.isArray(n.val)&&!n.val.length)return new Handlebars.SafeString("");var i='<li class="',r,u;return t.hash["show-all"]||(n.detailPersist?i+="persist":(n.noteBelow||n.showDetailMobile)&&(i+="visible-xs")),n.highlight&&(i+=" alert alert-warning"),i+='">',n.key==="enrollmentRequirements"?_.each(n.val,function(t){i+="<div><strong>"+n.text["enrollmentRequirement"+t.type]+": <\/strong>"+t.description+"<\/div>"}):n.key==="reserveCaps"?(i+="<div><strong>"+n.text+":<\/strong><\/div>",_.each(n.val,function(n){i+="<div><strong>"+n.enrollmentTotal+" of "+n.enrollmentCap+"<\/strong>";i+=" reserved seats filled for requirement: "+n.descriptionLong+"<\/div>"})):n.key==="exams"?_.each(n.val,function(n){i+="<div><strong>Final Exam:<\/strong> "+n.date+" "+n.startTime+" to "+n.endTime}):n.key==="instructor"?(i+="<strong>"+n.text+": <\/strong>",r=[],_.each(n.val,function(n){u=n.email&&Scheduler.Config.sectionSettings.showInstructorEmail?' <span class="mail-pop"><a href="mailto:'+n.email+'" target="_blank" data-content="'+n.email+'">'+n.name+"<\/a><\/span>":n.name;r.push(u)}),i+=r.join(", ")):n.key==="sectionAttributes"?(i+="<strong>"+n.text+": <\/strong>",r=[],_.each(n.val,function(n){u=n.attrTitle?n.attrTitle+"-"+n.valueTitle:n.valueTitle;r.push(u)}),i+=r.join(", ")):i+="<strong>"+n.text+": <\/strong>"+n.val,i+="<\/li>",new Handlebars.SafeString(i)});Handlebars.registerHelper("attributes-list",function(n){var i=[],t;return _.each(n,function(n){t=n.attrTitle?n.attrTitle+"-"+n.valueTitle:n.valueTitle;i.push(t)}),new Handlebars.SafeString(i.join(", "))});Handlebars.registerHelper("format_schedule_result",function(n,t){switch(n){case"SectionNumber":return t.sectionNumber;case"RegistrationNumber":return t.registrationNumber;case"SectionAndRegistrationNumber":return t.sectionNumber+"-"+t.registrationNumber}return t.sectionNumber});Handlebars.registerHelper("format_a11y_schedule_result",function(n,t){var i=Scheduler.Config.sectionFieldText.sectionNumber,r=Scheduler.Config.sectionFieldText.registrationNumber.replace("#","");switch(n){case"SectionNumber":return i+" number(s) "+t.sectionNumber;case"RegistrationNumber":return r+" number(s) "+t.registrationNumber;case"SectionAndRegistrationNumber":return i+" number(s) "+t.sectionNumber+" "+r+" number(s) "+t.registrationNumber}return i+" number(s) "+t.sectionNumber});Handlebars.registerHelper("section-week-color",function(n,t,i){var s=(t-1)*7,r=i.clone(),u,h=n.sections[0].bgColor,e=!1,o,f;return r.add(s,"d"),u=r.clone(),u.add(7,"d"),_.each(n.sections,function(n){_.each(n.meetings,function(n){n.startDate&&n.endDate&&(o=moment(n.startDate),f=moment(n.endDate),o.isBefore(u)&&(r.isBefore(f)||r.isSame(f))&&(e=!0))})}),e?"bg-"+h:""});Handlebars.registerHelper("section_registration_instr",function(n){var t,i=Scheduler.Config.cartSettings.registrationInstrPartial;return t=Scheduler.Config.cartSettings.hideRegistrationNumber?i:"<strong>Use "+Scheduler.Config.sectionFieldText.registrationNumber+" "+n.registrationNumber+"<\/strong> "+i.toLowerCase(),t+=" "+n.subject+" "+n.course+" - "+n.sectionNumber+".",new Handlebars.SafeString(t)});Handlebars.registerHelper("chip-title",function(n){switch(Scheduler.Config.scheduleSettings.chipTitleFormat){case"subjectAndCourseAndRegNumber":return n.subject+"-"+n.course+"-"+n.registrationNumber;case"subjectAndCourseAndSectionNumber":return n.subject+"-"+n.course+"-"+n.sectionNumber;case"courseTitleAndSectionNumber":return n.title+"-"+n.sectionNumber;default:return n.subject+"-"+n.course}});Handlebars.registerHelper("site-logo",function(){var i=window.location.pathname.split("/"),t,n,r;return i.length===3&&(t="?theme="+i[2]),r=t?"/content/site-logo"+t:Scheduler.Config.styleSettings.logoFileName?"//collegescheduler.cachefly.net/SchoolLogos/"+Scheduler.Config.styleSettings.logoFileName:"/content/site-logo",n='<div class="school-logo">',n+='<img src="'+r+'" class="img-responsive hidden-acc" alt="School Logo">',n+="<\/div>",new Handlebars.SafeString(n)});Handlebars.registerHelper("site-tagline",function(){if(Scheduler.Config.text.tagline){var n='<h4 class="text-center">'+Scheduler.Config.text.tagline+"<\/h4>";return new Handlebars.SafeString(n)}return""});Handlebars.registerHelper("url",function(n){return Scheduler.Data.Terms.length>1&&(n===""&&(n="options"),n=n==="terms"?"terms/"+encodeURIComponent(Scheduler.Data.CurrentTerm.id):"terms/"+encodeURIComponent(Scheduler.Data.CurrentTerm.id)+"/"+n),n});Handlebars.registerHelper("if_even",function(n,t){return n%2==0?t.fn(this):t.inverse(this)});Handlebars.registerHelper("if_odd",function(n,t){return n%2!=0?t.fn(this):t.inverse(this)});Handlebars.registerHelper("gt",function(n,t,i){return n>t?i.fn(this):i.inverse(this)});Handlebars.registerHelper("is",function(n,t,i){return n===t?i.fn(this):i.inverse(this)});Handlebars.registerHelper("incr",function(n){return parseInt(n,10)+1});Handlebars.registerHelper("decr",function(n){return parseInt(n,10)-1});Handlebars.registerHelper("set_index",function(n){this.index=Number(n)});Handlebars.registerHelper("set_var",function(n,t){this[t]=n});Handlebars.registerHelper("get_and_set_val",function(n,t,i){n&&(this[i]=n[t])});Handlebars.registerHelper("get_val",function(n,t){return n?n[t]:""});Handlebars.registerHelper("log",function(n){console.log(n)});Handlebars.registerHelper("clip",function(n,t){return n&&n.length>t&&(n=n.substring(0,t)),n});Handlebars.registerHelper("if_config",function(){var r=_.initial(arguments,1),t=_.last(arguments),n,i=function(t){return(n=SchedulerHelpers.getConfigValue(t),n&&_.isArray(n))?n.length:n},u=_.every(r,function(n){return n[0]==="^"?!i(n.substring(1)):i(n)});return u?t.fn(this):t.inverse(this)});Handlebars.registerHelper("unless_config",function(){var t=_.initial(arguments,1),n=_.last(arguments),i=_.every(t,function(n){return n[0]==="^"?!SchedulerHelpers.getConfigValue(n.substring(1)):SchedulerHelpers.getConfigValue(n)});return i?n.inverse(this):n.fn(this)});Handlebars.registerHelper("config_val",function(n,t){return _.isObject(t)&&(t=""),SchedulerHelpers.getConfigValue(n,t)});Handlebars.registerHelper("config_section_text",function(n,t){return SchedulerHelpers.getConfigValue("sectionFieldText."+n,t||"")});Handlebars.registerHelper("config_section_text_plural",function(n,t){var i=n+"Plural";return n==="hasCorequisites"?SchedulerHelpers.getConfigValue("sectionFieldText.corequisitesPlural"):SchedulerHelpers.getConfigValue("sectionFieldText."+i,t||"")});Handlebars.registerHelper("each_config",function(n,t,i){i?_.isObject(t)&&(t=[]):(i=t,t=[]);var f=SchedulerHelpers.getConfigValue(n,t),r,u="";return i.data&&(r=Handlebars.createFrame(i.data)),_.each(f,function(n,t){r&&(r.index=t,r.first=t===0,r.last=t===f.length-1);u=u+i.fn(n,{data:r})}),u});Handlebars.registerHelper("config_val_lcase",function(n,t){return _.isObject(t)&&(t=""),""+SchedulerHelpers.getConfigValue(n,t).toLowerCase()});Handlebars.registerHelper("config_text",function(n,t){return _.isObject(t)&&(t=""),SchedulerHelpers.getConfigValue("text."+n,t)});Handlebars.registerHelper("config_text_lcase",function(n,t){return _.isObject(t)&&(t=""),""+SchedulerHelpers.getConfigValue("text."+n,t).toLowerCase()});Handlebars.registerHelper("get_cal_col",function(n){return n.length===7?"col-week-1":n.length===5?"col-weekdays-1":"col-xs-2"});Handlebars.registerHelper("from_mil_time",function(n){return SchedulerHelpers.fromMilitaryTime(n)});Handlebars.registerHelper("to_date_string",function(n){return SchedulerHelpers.toDateString(n)});Handlebars.registerHelper("to_lower",function(n){return n?n.toLowerCase():""});Handlebars.registerHelper("to_lower_first",function(n){return n?_.lowerFirst(n):""});Handlebars.registerHelper("dyn_partial",function(n,t){var i=Handlebars.partials[n];return i?new Handlebars.SafeString(i(t)):"Partial not loaded"});Handlebars.registerHelper("include",function(n){var t={},i=function(n){for(var i in n)t[i]=n[i]};return i(this),i(n.hash),n.fn(t)});Handlebars.registerHelper("if_lt",function(n,t,i){return n<t?i.fn(this):i.inverse(this)});Handlebars.registerHelper("unless_blank",function(n,t){return n&&n.replace(/\s/g,"").length?t.fn(this):t.inverse(this)});Handlebars.registerHelper("meeting_field",function(n,t){var i='<li class="',r=n.val;return t.hash["show-all"]||(n.detailPersist?i+="persist":(n.noteBelow||n.showDetailMobile)&&(i+="visible-xs")),n.highlight&&(i+=" alert alert-warning"),i+='">',i+="<strong>"+n.text+": <\/strong>",_.each(r,function(n){i+='<div class="meetings-all">';var u=n.startTime&&n.endTime&&n.startTime!==n.endTime,r=SchedulerHelpers.formatLocation(n),t="";(n.days||u||r)&&(n.days&&(t+=n.days),u&&(t+=t.length?" ":"",t+=SchedulerHelpers.fromMilitaryTime(n.startTime)+" - "+SchedulerHelpers.fromMilitaryTime(n.endTime)),r&&(t+=t.length?" - ":"",t+=r),i+="<div>"+t+"<\/div>");n.startDate&&n.endDate&&(i+='<div class="dates">',i+="Dates: "+SchedulerHelpers.toDateString(n.startDate)+" - "+SchedulerHelpers.toDateString(n.endDate),i+="<\/div>");i+="<\/div>"}),i+="<\/li>",new Handlebars.SafeString(i)});Handlebars.registerHelper("meeting_display",function(n){var r=n.startTime&&n.endTime&&n.startTime!==n.endTime,i=SchedulerHelpers.formatLocation(n),t="";return n.days&&(t+=n.days),r&&(t+=t.length?" ":"",t+=SchedulerHelpers.fromMilitaryTime(n.startTime)+" - "+SchedulerHelpers.fromMilitaryTime(n.endTime)),Scheduler.Config.sectionSettings.showDatesInMeetingsColumn&&n.startDate&&n.endDate&&(t+=t.length?" ":"",t+=SchedulerHelpers.toDateString(n.startDate)+" - "+SchedulerHelpers.toDateString(n.endDate)),i&&(t+=t.length?" - ":"",t+=i),new Handlebars.SafeString(t)});Handlebars.registerHelper("dates_display",function(n){return SchedulerHelpers.toDateString(n.startDate)+" - "+SchedulerHelpers.toDateString(n.endDate)});var hasFlag=function(n,t){var i=_.capitalizeFirst(t);return n["has"+i]||n["is"+i]||n.flags&&_.contains(n.flags,i)};Handlebars.registerHelper("has_flags",function(n,t,i){var r=_.map(n,function(n){return n.key}),u=_.some(r,function(n){return n==="credits"&&t[n]?!i.hash.ignoreCredits:hasFlag(t,n)});return u?i.fn(this):i.inverse(this)});Handlebars.registerHelper("has_flag",function(n,t,i){return n.key==="credits"&&t[n.key]&&!i.hash.ignoreCredits?i.fn(this):hasFlag(t,n.key)?i.fn(this):i.inverse(this)});Handlebars.registerHelper("each_flag",function(n,t,i){var f="",r,u;return n=_.filter(n,function(n){return n.key==="credits"&&t[n.key]?!i.hash.ignoreCredits:(u=_.capitalizeFirst(n.key),t["has"+u]||t["is"+u]||t.flags&&_.contains(t.flags,u))}),i.data&&(r=Handlebars.createFrame(i.data)),_.each(n,function(t,u){r&&(r.index=u,r.first=u===0,r.last=u===n.length-1);f=f+i.fn(t,{data:r})}),f});Handlebars.registerHelper("to_lower_dashed",function(n){return n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()});Handlebars.registerHelper("if_acc",function(n){return Scheduler.Accessibility?n.fn(this):n.inverse(this)});Handlebars.registerHelper("concat",function(){var n=_.initial(arguments,1),t=_.last(arguments);return n.length?n.join(""):""});Handlebars.partials=JST;SchedulerUrlHelper={getAttrRoute:function(n){n.attributeValues=n.attributeValues||[];var t=SchedulerHelpers.safeUrlSegment,s=n.attribute||n.attributeValues[0],u=s instanceof Scheduler.Models.SectionAttribute?"/sectionattribute":"/courseattribute",f=u+"s/",r=u+"values/",i="/api/terms/"+t(n.term.id),e=function(){i+="/subjects";n.subject&&(i+="/"+t(n.subject.id)+"/courses");n.course&&(i+="/"+t(n.course.get("number"))+"/topics")},o=function(){n.groupId&&(i+="/"+t(n.groupId))};return n.attributeValues.length>1?(r=r.slice(0,-1),e(),i+=r,o(),i+="?values="+_.invoke(n.attributeValues,"get","value").join(",")):(i+=n.attribute&&n.attributeValues.length?f+t(n.attribute.get("attr"))+"/value/"+t(n.attributeValues[0].get("value")):n.attribute?f+t(n.attribute.get("attr")):r+t(n.attributeValues[0].get("value")),e(),o()),i}};window.Scheduler={Models:{},Collections:{},Views:{Accessibility:{}},Routers:{},Data:{},Constants:{nonTopicSectionApiLabel:"NONTOPIC",nonTopicSectionDesignator:"****",MAX_WEEKS:52,learningCommunityLabel:"LRNCOM"},FilterMap:{},Accessibility:!1,initialize:function(n){if(this.Config=new Scheduler.Models.Config(n.configData||""),this.Data={AcademicCareers:new Scheduler.Collections.AcademicCareers(n.academicCareersData||""),AcademicGroups:new Scheduler.Collections.AcademicGroups(n.academicGroupsData||""),Breaks:new Scheduler.Collections.Breaks(n.breakData||"",{parse:!0}),Locations:new Scheduler.Collections.Locations(n.locationData||""),Campuses:new Scheduler.Collections.Campuses(n.campusData||""),Messages:new Scheduler.Collections.BaseCollection(n.messages||""),InstructionModes:new Scheduler.Collections.InstructionModes(n.instructionModesData||""),CourseStatuses:new Scheduler.Collections.CourseStatuses(n.courseStatus||""),PartsOfTerm:new Scheduler.Collections.PartsOfTerm(n.partsOfTermData||""),RegistrationWarnings:new Scheduler.Collections.RegistrationWarnings(n.registrationWarningsData||""),Sessions:new Scheduler.Collections.Sessions(n.sessionData||""),Terms:new Scheduler.Collections.Terms(n.termData||""),UserId:n.userId,StudentName:n.studentName,UserSettings:new Scheduler.Models.UserSettings(n.userSettings||""),SelectedTermId:n.selectedTermId},this.Data.CurrentTerm=this.getInitiallySelectedTerm(),this.Data.Courses=new Scheduler.Collections.DesiredCourses(n.courseData||"",{term:this.Data.CurrentTerm,parse:!0}),this.Data.CartSections=new Scheduler.Collections.CartSections(n.cartSectionData||"",{term:this.Data.CurrentTerm}),this.Data.CurrentSections=new Scheduler.Collections.CurrentSections(n.currentSectionData||"",{term:this.Data.CurrentTerm}),this.Data.FavoriteSchedules=new Scheduler.Collections.ScheduleFavorites(n.scheduleFavoritesData||[],{term:this.Data.CurrentTerm}),n.updatedAt){var t=moment(n.updatedAt);t.isValid()&&(this.Data.UpdatedAt=new Backbone.Model({title:t.format("L")+", "+t.format("h:mm:ss A")}))}else this.Data.UpdatedAt=new Backbone.Model;this.Data.Degreeplanner={DegreePlan:new Scheduler.Models.DegreeplannerDegreePlan};this.Config=new Scheduler.Models.Config(n.configData||"");this.AppRouter=new Scheduler.Routers.AppRouter({entryFilterData:this.Config.entryFilters});n.renderMode==="accessibility"&&this.applyAccessibilitySettings();this.Config.sisSettings.language&&moment.locale(this.Config.sisSettings.language);this.AppView=new Scheduler.Views.AppView({academicCareers:this.Data.AcademicCareers,academicGroups:this.Data.AcademicGroups,breaks:this.Data.Breaks,campuses:this.Data.Campuses,cartSections:this.Data.CartSections,courses:this.Data.Courses,currentSections:this.Data.CurrentSections,instructionModes:this.Data.InstructionModes,locations:this.Data.Locations,courseStatuses:this.Data.CourseStatuses,partsOfTerm:this.Data.PartsOfTerm,terms:this.Data.Terms,registrationWarnings:this.Data.RegistrationWarnings,sessions:this.Data.Sessions,degreeplannerDegreePlan:this.Data.Degreeplanner.DegreePlan,favoriteSchedules:this.Data.FavoriteSchedules});this.AppRouter.registerHashChangeListener();this.AppRouter.registerBeforeUnloadListener();Backbone.History.started||Backbone.history.start()},applyAccessibilitySettings:function(){var n=[],t=[];_.each(Scheduler.Views,function(t,i){t.prototype&&t.prototype.a11yTemplate&&(t.prototype.originalTemplate=t.prototype.template,t.prototype.template=t.prototype.a11yTemplate,n.push(i))});Scheduler.OriginalViews=_.clone(Scheduler.Views);_.each(Scheduler.Views.Accessibility,function(n,i){Scheduler.Views[i]=n;t.push(i)});Scheduler.Accessibility=!0;bootbox.setDefaults({closeButton:!1,animate:!1});jQuery.fx.off=!0;console.log("A11Y - Overridden templates: "+n.join(", "));console.log("AllY - Overridden views: "+t.join(", "))},getInitiallySelectedTerm:function(){if(Scheduler.Data.SelectedTermId){var n=Scheduler.Data.Terms.findWhere({code:Scheduler.Data.SelectedTermId});if(n)return n}return Scheduler.Data.Terms.first()}};Scheduler.Models.BaseModel=Backbone.Model.extend({toTemplate:function(){return this.toJSON()}});Backbone.Relational.store.addModelScope(Scheduler.Models);Scheduler.Models.BaseRelationalModel=Backbone.RelationalModel.extend({toTemplate:function(n){var t=this.toJSON(n);return t.id=t[this.idAttribute],t}});Scheduler.Models.DeepModel=Backbone.DeepModel.extend({toTemplate:function(){return this.toJSON()}});Scheduler.Models.AcademicCareer=Scheduler.Models.BaseModel.extend({urlRoot:"/api/academiccareers"});Scheduler.Models.AcademicGroup=Scheduler.Models.BaseModel.extend({urlRoot:"/api/academicgroups"});Scheduler.Models.AppData=Scheduler.Models.BaseModel.extend({url:function(){return"/api/data/"+SchedulerHelpers.safeUrlSegment(this.id)}});Scheduler.Models.Book=Scheduler.Models.BaseModel.extend({idAttribute:"isbn",defaults:{required:!1,recommended:!1}});Scheduler.Models.Break=Scheduler.Models.DeepModel.extend({initialize:function(){var n=new Backbone.Memento(this);_.extend(this,n);Modernizr.sessionstorage&&this.listenTo(this,"change:selected",function(){this.get("selected")?window.sessionStorage.setItem("selected.break-"+this.id,1):window.sessionStorage.removeItem("selected.break-"+this.id)})},defaults:function(){var n=Scheduler.Config.breakSettings.startHour||8,t=Scheduler.Config.breakSettings.startMinute||0,i=Scheduler.Config.breakSettings.startMeridiem||"am",r=Scheduler.Config.breakSettings.endHour||11,u=Scheduler.Config.breakSettings.endMinute||0,f=Scheduler.Config.breakSettings.endMeridiem||"am";return{startTime:{hours:n,minutes:t,amOrPm:i},endTime:{hours:r,minutes:u,amOrPm:f}}},urlRoot:"/api/breaks",timeRange:function(){return this.get("days")+" - "+this.convertTimeToString(this.get("startTime"))+" to "+this.convertTimeToString(this.get("endTime"))},fullTimeRange:function(){var r={M:"Monday",T:"Tuesday",W:"Wednesday",R:"Thursday",F:"Friday",S:"Saturday",U:"Sunday"},n=_.reduce(this.get("daysRaw"),function(n,t){return n.push(r[t]),n},[]),t,i;return n.length<=2?t=n.join(" and "):(i=n.pop(),t=n.join(", ")+" and "+i),t+" from "+this.convertTimeToString(this.get("startTime"))+" to "+this.convertTimeToString(this.get("endTime"))},convertTimeToString:function(n){return n?this.getDisplayHours(n.hours)+":"+this.getDisplayMinutes(n.minutes)+n.amOrPm:""},getDisplayHours:function(n){var t=parseInt(n,10);return this.get("startTime.amOrPm")==="am"&&t===0?12:t>12?t-12:t},getDisplayMinutes:function(n){return("0"+n).slice(-2)},validate:function(n){var t=[],i=n.selectedDays,r=this.getStartTimeMilitary(),u=this.getEndTimeMilitary();return n.title&&n.title!==""||t.push("The break must have a name."),/^[a-zA-Z0-9\s'.]{1,40}$/.test(n.title)||t.push("Break name can only be letters & numbers."),r===u&&t.push("Start Time And End Time cannot be equal."),r>u&&t.push("Start Time is after end time."),i.monday||i.tuesday||i.wednesday||i.thursday||i.friday||i.saturday||i.sunday||t.push("Please select at least one day for the break."),_.isEmpty(t)?void 0:t},toTemplate:function(){var n=this.toJSON();return n.timeRange=this.timeRange(),n.fullTimeRange=this.fullTimeRange(),n.weekends=this.getWeekends(),n.weekdays=this.getWeekdays(),n.displayStartTime=this.getDisplayStartTime(),n.displayEndTime=this.getDisplayEndTime(),n},getWeekdays:function(){var n="",t=this.get("daysRaw");if(t)return t.indexOf("M")!==-1&&(n+="M"),t.indexOf("T")!==-1&&(n+="T"),t.indexOf("W")!==-1&&(n+="W"),t.indexOf("R")!==-1&&(n+="R"),t.indexOf("F")!==-1&&(n+="F"),n},getWeekends:function(){var n="",t=this.get("daysRaw");if(t)return t.indexOf("S")!==-1&&(n+="S"),t.indexOf("U")!==-1&&(n+="U"),n},getStartTimeMilitary:function(){var n=this.get("startTime");return parseInt(n.hours.toString()+("00"+n.minutes).slice(-2),10)},getEndTimeMilitary:function(){var n=this.get("endTime");return parseInt(n.hours.toString()+("00"+n.minutes).slice(-2),10)},getDisplayStartTime:function(){var n=this.get("startTime");return this.getDisplayHours(n.hours)+":"+this.getDisplayMinutes(n.minutes)+n.amOrPm.toLowerCase()},getDisplayEndTime:function(){var n=this.get("endTime");return this.getDisplayHours(n.hours)+":"+this.getDisplayMinutes(n.minutes)+n.amOrPm.toLowerCase()},getDaysLine:function(){var t=this.get("selectedDays"),n="";return t.monday&&(n+="M"),t.tuesday&&(n+="T"),t.wednesday&&(n+="W"),t.thursday&&(n+="R"),t.friday&&(n+="F"),t.saturday&&(n+="S"),t.sunday&&(n+="U"),n},getEvents:function(){var t=this.getDaysLine(),i=[],n=0,u=t.length,r;for(n;n<u;n++)r=new Scheduler.Models.Event({id:"BK"+this.get("id")+t[n],title:this.get("title"),day:t[n],startTime:this.getStartTimeMilitary(),endTime:this.getEndTimeMilitary(),bgColor:24,type:"Break",partial:"break/chip"}),i.push(r);return i}},{convertToMilitaryHour:function(n,t){var i=parseInt(n,10);return i===12?t==="pm"?12:0:t==="pm"?parseInt(i,10)+12:i}});Scheduler.Models.Campus=Scheduler.Models.BaseModel.extend({urlRoot:"/api/campuses"});Scheduler.Models.Config=Scheduler.Models.DeepModel.extend({defaults:{text:{},breakSettings:{},cartSettings:{},courseSettings:{flags:[],text:{},advancedFilterOptions:[],additionalAttributes:[]},courseAddViews:[],emailSettings:{},filterSettings:{items:[]},entryFilters:[],homeFilters:[],homeSettings:{},sectionFieldText:{},scheduleSettings:{customUserSettings:{}},sectionSettings:{},sisSettings:{},styleSettings:{}},initialize:function(){this.text=this.get("text");this.cartSettings=this.get("cartSettings");this.courseAddOptions=this.get("courseAddOptions")||[];this.courseSettings=this.get("courseSettings");this.breakSettings=this.get("breakSettings");this.homeFilters=this.get("homeFilters")||[];this.homeSettings=this.get("homeSettings")||[];this.entryFilters=this.get("entryFilters")||[];this.filterSettings=this.get("filterSettings");this.scheduleSettings=this.get("scheduleSettings");this.sectionFieldText=this.get("sectionFieldText");this.sectionSettings=this.get("sectionSettings");this.sisSettings=this.get("sisSettings");this.styleSettings=this.get("styleSettings");this.attributeSectionFieldSettings=this.get("attributeSectionFieldSettings");this.cartSectionFieldSettings=this.get("cartSectionFieldSettings");this.courseSectionFieldSettings=this.get("courseSectionFieldSettings");this.currentSectionFieldSettings=this.get("currentSectionFieldSettings");this.learningCommunitySectionFieldSettings=this.get("learningCommunitySectionFieldSettings");this.modalSectionFieldSettings=this.get("modalSectionFieldSettings");this.scheduleSectionFieldSettings=this.get("scheduleSectionFieldSettings");this.degreePlannerSettings=this.get("degreePlannerSettings")||[]},getSectionNotesBelowFieldKeysForCourse:function(){var n=this,t=_.filter(n.scheduleSectionGridFieldSettings,function(n){return n.noteBelow});return _.map(t,function(n){return n.key})}});Scheduler.Models.CourseAttribute=Scheduler.Models.BaseModel.extend({urlRoot:function(){return this.collection&&this.collection.term?"/api/terms/"+SchedulerHelpers.safeUrlSegment(this.collection.term.id)+"/courseattributes":"/api/courseattributes"}});Scheduler.Models.CourseStatus=Scheduler.Models.BaseModel.extend({urlRoot:"/api/coursestatuses",url:function(){var n=this.urlRoot+"/";return this.id&&(n=n+SchedulerHelpers.safeUrlSegment(this.id)+"/"),n+"selected"}});Scheduler.Models.Course=Scheduler.Models.BaseModel.extend({defaults:{topic:null},url:function(){var n=this.get("subjectId"),t=this.get("term");return t?SchedulerHelpers.safeUrl("api","terms",this.get("term"),"subjects",n,"courses",this.get("number")):SchedulerHelpers.safeUrl("api","subjects",n,"courses",this.get("number"))},parse:function(n){return _.omit(n,function(n){return _.isNull(n)})},isLearningCommunity:function(){return this.get("subjectId")==="LRNCOM"},isPlaceholder:function(){return this.get("type")==="placeholder"},hasTopics:function(){return Scheduler.Config.courseSettings.topicsEnabled&&this.get("hasTopics")},toTemplate:function(){var n=this.toJSON();return n.isLearningCommunity=this.isLearningCommunity(),n.isPlaceholder=this.isPlaceholder(),n.hasTopics=this.hasTopics(),n.cid=this.cid,n}});Scheduler.Models.DegreeWorksCourse=Scheduler.Models.BaseModel.extend({url:"/api/degreeworks",hasTopics:function(){return Scheduler.Config.courseSettings.topicsEnabled&&this.get("hasTopics")},toTemplate:function(){var n=this.toJSON();return n.cid=this.cid,n.hasTopics=this.hasTopics(),n}});Scheduler.Models.DegreeWorksPlan=Scheduler.Models.DeepModel.extend({url:"/api/degreeworks"});Scheduler.Models.DegreePlanCourse=Scheduler.Models.BaseRelationalModel.extend({toTemplate:function(){var n=Scheduler.Models.BaseRelationalModel.prototype.toTemplate.apply(this);return n.cid=this.cid,n}});Scheduler.Models.DegreePlanTerm=Scheduler.Models.BaseRelationalModel.extend({idAttribute:"termCode",relations:[{type:Backbone.HasMany,key:"courses",relatedModel:"DegreePlanCourse",collectionType:"DegreePlanCourses"}]});Scheduler.Models.DegreePlan=Scheduler.Models.BaseRelationalModel.extend({idAttribute:"planId",relations:[{type:Backbone.HasMany,key:"terms",relatedModel:"DegreePlanTerm",collectionType:"DegreePlanTerms"}]});Scheduler.Models.DegreeplannerCourse=Scheduler.Models.BaseRelationalModel.extend({defaults:{topic:null},urlRoot:function(){return null},fullSubject:function(){return this.isPlaceholder()||this.isLearningCommunity()?this.get("title"):this.get("subjectShort")+" "+this.get("number")},title:function(){return this.isPlaceholder()?this.get("description"):this.get("title")},isPlaceholder:function(){return this.get("type")==="placeholder"},isLearningCommunity:function(){return this.get("isLearningCommunity")},displayName:function(){var n;return this.isPlaceholder()?n="Placeholder - "+this.title():(n=this.fullSubject(),n=n+" - "+this.title(),this.get("topicTitle")&&(n=n+" - Topic: "+this.get("topicTitle"))),n.replace(/[-\s]+$/,"").replace("^[-s]+","")},toTemplate:function(){var n=this.toJSON();return n.id=this.id,n.fullSubject=this.fullSubject(),n.title=this.title(),n.isLearningCommunity=this.isLearningCommunity(),n}});Scheduler.Models.DegreeplannerDegreePlan=Scheduler.Models.BaseRelationalModel.extend({idAttribute:"planId",urlRoot:"/api/degreeplanner/degree-plan",defaults:function(){return{settings:{}}},relations:[{type:Backbone.HasMany,key:"courses",relatedModel:"DegreeplannerCourse",collectionType:"DegreeplannerCourses",reverseRelation:{key:"degreePlan",keyDestination:"degreePlanId",includeInJSON:!1}},{type:Backbone.HasOne,key:"settings",relatedModel:"DegreeplannerSettings"}],initialize:function(){this.on("change add:courses remove:courses change:courses change:settings",function(){this._dirty=!0});this.listenTo(this.get("courses"),"change",function(){this._dirty=!0});this.on("sync",function(){this._dirty=!1;this.get("courses").resetCollection()})},isDirty:function(){return!!this._dirty},markAsClean:function(){this._dirty=!1},markAsDirty:function(){this._dirty=!0},setLastViewedYear:function(n){this.lastViewedYear=n},getLastViewedYear:function(){return this.lastViewedYear}});Scheduler.Models.DegreeplannerSettings=Scheduler.Models.BaseRelationalModel.extend({defaults:function(){return{startYear:2014,numYears:Scheduler.Config.degreePlannerSettings.defaultPlanYears,showOptionalTerms:!0}}});Scheduler.Models.DesiredCourse=Scheduler.Models.DeepModel.extend({defaults:{topic:null},initialize:function(){Modernizr.sessionstorage&&this.listenTo(this,"change:selected",function(){this.get("selected")?window.sessionStorage.setItem("selected.course-"+this.id,1):window.sessionStorage.removeItem("selected.course-"+this.id)})},urlRoot:function(){var n;return(this.collection&&this.collection.term?n=this.collection.term.id:this.get("term")&&(n=this.get("term")),n)?"/api/terms/"+SchedulerHelpers.safeUrlSegment(n)+"/desiredcourses":"/api/desiredcourses"},fullSubject:function(){if(this.isLearningCommunity())return this.get("title");var n;switch(Scheduler.Config.sectionSettings.subjectFormat){case"short":n=this.get("subjectShort");break;case"long":n=this.get("subjectLong");break;case"id":n=this.get("subjectId");break;default:n=this.get("subjectShort")}return n+" "+this.get("number")},isLearningCommunity:function(){return this.get("isLearningCommunity")},toTemplate:function(){var n=this.toJSON();return n.fullSubject=this.fullSubject(),n.isLearningCommunity=this.isLearningCommunity(),n},saveSelectedSections:function(n,t){var i=this,u=i.url()+"/selectedsections",r={url:u};return _.extend(r,t),i.save(n,r)},addBySubject:function(n,t){this.set(n);var r=n.subjectId||n.subjectShort,u=this.url()+"/subjects/"+SchedulerHelpers.safeUrlSegment(r),i={url:u};return _.extend(i,t),this.save(n,i)},displayName:function(){var n=this.fullSubject(),t=this.get("title");return n!==t&&(n=n+" - "+this.get("title")),this.get("topicTitle")&&(n=n+" - Topic: "+this.get("topicTitle")),n},unlock:function(n){n=n||{};var i=this.url()+"/unlock",t={url:i};return _.extend(t,n),this.save("isLocked",!1,t)},findFilterByType:function(n){var t=this.get("filterRules")||[],i=_.findWhere(t,{type:n});return i||{type:n}},setFilter:function(n){var i=this.get("filterRules")||[],t;_.isArray(n)||(n=[n]);_.each(n,function(n){t=_.findWhere(i,{type:n.type});t?(t.values=n.values||[],t.value=n.value,t.excluded=n.excluded):i.push(n)});this.set("filterRules",i)}});Scheduler.Models.EnrollmentGroup=Scheduler.Models.BaseModel.extend({});Scheduler.Models.Event=Scheduler.Models.BaseModel.extend({toTemplate:function(){var n=this.toJSON();return n.startHourOffset=this.getStartHourOffset(),n.startMinuteOffset=this.getStartMinuteOffset(),n.hourLength=this.getHourLength(),n.minuteLength=this.getMinuteLength(),n},getStartHourOffset:function(){var n=this.collection?this.collection.getMinStartTime():800,t=this.get("startTime");return Math.floor((t-n)/100)},getStartMinuteOffset:function(){var n=this.get("startTime");return Math.floor(n%100)/5},getHourLength:function(){var n=this.get("startTime"),t=this.get("endTime");return Math.floor((t-n)/100)},getMinuteLength:function(){var u=this.getHourLength()*100,f=("0000"+this.get("startTime")).slice(-4),e=("0000"+this.get("endTime")).slice(-4),i=parseInt(f.slice(2),10),r=parseInt(e.slice(2),10),t=r-i,n;return(i>r&&(t=t+60),n=t/5,n<0)?0:Math.floor(u===0&&n<3?3:n)}});Scheduler.Models.EwsValue=Scheduler.Models.BaseModel.extend({});Scheduler.Models.InstructionMode=Scheduler.Models.BaseModel.extend({urlRoot:"api/terms/instructionmodes"});Scheduler.Models.LearningCommunity=Scheduler.Models.BaseModel.extend({urlRoot:function(){var n;return this.collection&&this.collection.term?n=this.collection.term.id:this.get("term")&&(n=this.get("term")),"/api/terms/"+SchedulerHelpers.safeUrlSegment(n)+"/learningcommunities"}});Scheduler.Models.Location=Scheduler.Models.BaseModel.extend({urlRoot:"/api/locations"});Scheduler.Models.Message=Scheduler.Models.DeepModel.extend({initialize:function(){var n=new Backbone.Memento(this);_.extend(this,n)},urlRoot:"/api/messages",validate:function(n){var t=[];return n.to?/^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(n.to)||t.push("Please use a valid email in the TO field."):t.push("Please input an email in the TO field."),n.from&&!/^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(n.from)&&t.push("Please use a valid email in the FROM field."),n.cc&&!/^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(n.cc)&&t.push("Please use a valid email in the CC field."),t.length?t:void 0}});Scheduler.Models.MyPlannerCourse=Scheduler.Models.BaseModel.extend({url:"/api/myplanner",hasTopics:function(){return Scheduler.Config.courseSettings.topicsEnabled&&this.get("hasTopics")},toTemplate:function(){var n=this.toJSON();return n.cid=this.cid,n.hasTopics=this.hasTopics(),n}});Scheduler.Models.MyPlannerPlan=Scheduler.Models.BaseModel.extend({initialize:function(n,t){t=t||{};t.term&&(this.term=t.term)},urlRoot:function(){return"/api/terms/"+SchedulerHelpers.safeUrlSegment(this.term)+"/myplanner"}});Scheduler.Models.PartOfTerm=Scheduler.Models.BaseModel.extend({urlRoot:"/api/partsofterm"});Scheduler.Models.RegistrationBlock=Scheduler.Models.BaseModel.extend({urlRoot:function(){var n;return(this.collection&&this.collection.term?n=this.collection.term:this.get("term")&&(n=this.get("term")),n)?"/api/terms/"+SchedulerHelpers.safeUrlSegment(n)+"/registrationblocks/":"/api/registrationblocks/"},url:function(){var n=_.result(this,"urlRoot")||_.result(this.collection,"url"),t;return this.isNew()?n:(t=SchedulerHelpers.safeUrlSegment(this.get(this.idAttribute)),n.replace(/[^\/]$/,"$&/")+encodeURIComponent(t))},toTemplate:function(){var n=this.toJSON();return this.sections&&(n.sections=this.sections.toTemplate()),n}});Scheduler.Models.RegistrationWarning=Scheduler.Models.BaseModel.extend({urlRoot:"/api/registrationwarnings"});Scheduler.Models.RegistrationWorkSheet=Scheduler.Models.BaseModel.extend({url:function(){return SchedulerHelpers.safeUrl("api","terms",this.get("term"),"worksheet")}});Scheduler.Models.ScheduleFavorite=Scheduler.Models.BaseModel.extend({idAttribute:"favoriteId",toTemplate:function(){var n=this.toJSON();return n.registrationBlocks=this.getRegistrationBlocks().toTemplate(),n.linkUrl=this.getLinkUrl(),n.name=this.getName(),n.index=this.collection?this.collection.indexOf(this)+1:1,n.id=this.id,n},getName:function(){return this.get("name")||"Favorite "+Scheduler.Config.text.schedule},setRegistrationBlocks:function(n){this.registrationBlocks=n},getRegistrationBlocks:function(){return this.registrationBlocks||new Scheduler.Collections.RegistrationBlocks},getSections:function(){return this.registrationBlocks.getSectionsForCalendar()},urlRoot:function(){return"/api/terms/"+SchedulerHelpers.safeUrlSegment(this.get("term"))+"/schedule-favorites"},getLinkUrl:function(){return"schedules/favorites/"+this.id},setGeneration:function(n){this.generation=n},getGeneration:function(){return this.generation},getSchedule:function(){var n=this.getGeneration();return n?n.schedules.first():null}});Scheduler.Models.ScheduleGeneration=Scheduler.Models.BaseModel.extend({defaults:function(){return{currentSections:[]}},urlRoot:function(){return"/api/terms/"+SchedulerHelpers.safeUrlSegment(this.get("term"))+"/schedules/generate"},prepareModel:function(){this.registrationBlocks||(this.registrationBlocks=new Scheduler.Collections.RegistrationBlocks(null,{sections:this.sections}));this.schedules||(this.schedules=new Scheduler.Collections.Schedules)},initialize:function(){this.prepareModel()},parse:function(n){this.prepareModel();var t=this.get("term")||n.term||"";return this.registrationBlocks.reset(n.registrationBlocks),this.registrationBlocks.term=t,this.registrationBlocks.sections.reset(n.sections),this.schedules.reset(n.schedules),this.warnings=n.warnings,this.courseCoReqs=n.courseCoReqs,this.otherData=n.otherData||{},{term:t}},getSections:function(){return this.registrationBlocks.sections},getSchedule:function(n){var i=this.schedules,t=i.get(n);return t?t:new Scheduler.Models.Schedule},setRegBlocksForSchedule:function(n){if(!n.registrationBlocks||!n.registrationBlocks.length){var i=n.get("combination"),t=new Scheduler.Collections.RegistrationBlocks,r=this.registrationBlocks,u=this.registrationBlocks.sections;_.each(i,function(n){var i=r.get(n),e=i.get("sectionIds"),f=new Scheduler.Collections.Sections;t.add(i);_.each(e,function(n){var t=u.get(n);f.add(t)});i.sections=f});n.setRegistrationBlocks(t)}},getBreaks:function(){var n=this.get("breaks"),t=_.select(Scheduler.Data.Breaks.models,function(t){return _.indexOf(n,t.id)>-1});return new Scheduler.Collections.Breaks(t)},getCoreqs:function(){if(!this.courseCoReqs||!this.courseCoReqs.length)return[];var n=[];return _.each(this.courseCoReqs,function(t){t.coReqCourses.length?n.push("<strong>"+t.course+"<\/strong> has the following co-requisites <strong>"+t.coReqCourses.join(", ")+"<\/strong>"):n.push("<strong>"+t.course+"<\/strong> has a co-requisite of <strong>"+t.coReqCourses[0]+"<\/strong>")}),n}});Scheduler.Models.Schedule=Scheduler.Models.BaseModel.extend({toTemplate:function(){var n=this.toJSON();return n.registrationBlocks=this.getRegistrationBlocks().toTemplate(),n.linkUrl=this.getLinkUrl(),n.index=this.id,n},setRegistrationBlocks:function(n){this.registrationBlocks=n},getRegistrationBlocks:function(){return this.registrationBlocks||new Scheduler.Collections.RegistrationBlocks},getSections:function(){return this.registrationBlocks.getSectionsForCalendar()},urlRoot:function(){return"/api/terms/"+SchedulerHelpers.safeUrlSegment(this.get("term"))+"/schedules"},getLinkUrl:function(){return"schedules/"+this.id},sendToCart:function(n,t,i){i=i||{};var e=this.url()+"/send",u={url:e},o=this.registrationBlocks.getSections(),f=[],r=new Scheduler.Collections.Sections;return r.add(n.models),r.add(t.models),r.length&&(f=o.filter(function(n){return r.every(function(t){return t.id!==n.id})})),i.attrs=_.map(f,function(n){return n.toJSON()}),_.extend(u,i),Backbone.sync("create",this,u)}});Scheduler.Models.SectionAttribute=Scheduler.Models.BaseModel.extend({urlRoot:function(){return this.collection&&this.collection.term?"/api/terms/"+SchedulerHelpers.safeUrlSegment(this.collection.term.id)+"/sectionattributes":"/api/sectionattributes"}});Scheduler.Models.Section=Scheduler.Models.DeepModel.extend({toTemplate:function(){var n=this.toJSON(),t=Scheduler.Config.scheduleSettings.collapseMeetings?this.getCollapsedMeetings():this.get("meetings")||[],i=_.filter(t,function(n){return n.days||n.location}),r=_.filter(t,function(n){return n.startDate||n.endDate}),u=_.first(i,2),f=_.rest(i,2),e=_.first(r,2),o=_.rest(r,2),s=n.clientDisabledReasons||[];return _.each(s,function(t){n.disabledReasons.push(t)}),n.isLinked=this.isLinked(),n.isOptional=this.get("optional"),n.hasHints=this.hasHints(),n.meetings=t,n.topMeetings=u,n.otherMeetings=f,n.topDates=e,n.otherDates=o,n},isLinked:function(){return this.collection&&this.collection.length>1},hasHints:function(){return this.hasNotesBelow()},hasNotesBelow:function(){var n=Scheduler.Config.getSectionNotesBelowFieldKeysForCourse(),t=this;return _.some(n,function(n){return t.attributes[n]})},getEvents:function(n){var i=this.get("meetings"),t=[];return _.each(i,_.bind(function(i){this.addEvents(i,t,n)},this)),t},getEventsForWeek:function(n,t,i){var e=this.get("meetings"),r=[],f,u;return _.each(e,_.bind(function(e){e.startDate&&e.endDate||this.addEvents(e,r);f=moment(e.startDate);u=moment(e.endDate);f.isBefore(t)&&(n.isBefore(u)||n.isSame(u))&&this.addEvents(e,r,i,n,e.endDate)},this)),r},addEvents:function(n,t,i,r,u){var e=n.daysRaw,f=0,c=e.length,s,h,l=Scheduler.Config.sectionSettings.noInstructorValue,a=Scheduler.Config.scheduleSettings.placeholderInstructor,o=this.get("instructor");if(e.length&&n.startTime&&n.endTime&&n.startTime!==n.endTime&&!(n.startTime>n.endTime))for(o&&o.length&&o[0]===l&&Scheduler.Config.scheduleSettings.showPlaceholderInstructor&&(o=[{name:a}]),f;f<c;f++){if(r&&r.isValid()&&u&&(h=this.getDateForDay(e[f],r),h.isAfter(u)))return;s=new Scheduler.Models.Event({id:this.get("id")+e[f]+"_"+_.uniqueId("meeting"),subject:this.get("subject"),subjectId:this.get("subjectId"),course:this.get("course"),topicId:this.get("topicId"),registrationNumber:this.get("registrationNumber"),location:this.getLocation(n),component:n.meetingType,instructors:o,day:e[f],startTime:n.startTime,endTime:n.endTime,locked:i&&i.get("locked"),showLock:i&&i.get("showLock"),bgColor:this.get("bgColor"),type:"Section",registrationBlockId:this.get("registrationBlockId"),sectionId:this.get("id"),sectionNumber:this.get("sectionNumber"),partial:"section/chip",title:this.get("title")});t.push(s)}},getLocation:function(n){var t=[];return n.meetingType&&t.push(n.meetingType),n.location&&t.push(n.location),t.join(" - ")},getDateForDay:function(n,t){var r=this.getDayIndex(n),i=t.clone();return i.add(r,"days"),i},getDayIndex:function(n){switch(n){case"M":return 0;case"T":return 1;case"W":return 2;case"R":return 3;case"F":return 4;case"S":return 5;case"U":return 6}},getCollapsedMeetings:function(){var f=this.get("meetings")||[],e=_.filter(f,function(n){return n.daysRaw&&n.startTime&&n.endTime}),o=_.groupBy(e,function(n){return n.location+'"'+n.daysRaw+n.startTime+'"'+n.endTime+'"'+n.meetingType}),t=this,i,r,u=[],n;return _.each(o,function(f){i=t.getMinDate(f);r=t.getMaxDate(f);n=f[0];u.push({startDate:i,endDate:r,location:n.location,days:n.days,daysRaw:n.daysRaw,startTime:n.startTime,endTime:n.endTime,meetingType:n.meetingType,mapUrl:n.mapUrl})}),_.sortBy(u,function(n){return t.getDayIndex(n.daysRaw[0])})},getMinDate:function(n){var t=this.getSortedDates(n,"startDate");return t.length?_.first(t):null},getMaxDate:function(n){var t=this.getSortedDates(n,"endDate");return t.length?_.last(t):null},getSortedDates:function(n,t){var i=[],r=function(n,t){return n.isAfter(t)?1:n.isBefore(t)?-1:0};return _.each(n,function(n){if(n[t]){var r=moment.utc(n[t]).startOf("day");i.push(r)}}),i.sort(r)}});Scheduler.Models.SendToCart=Scheduler.Models.BaseModel.extend({urlRoot:function(){var n="/api/terms/"+SchedulerHelpers.safeUrlSegment(this.get("term"))+"/schedules";return this.get("confirmed")&&(n+="/confirmed"),n}});Scheduler.Models.Session=Scheduler.Models.BaseModel.extend({urlRoot:"/api/sessions"});Scheduler.Models.Subject=Scheduler.Models.BaseModel.extend({urlRoot:function(){return this.collection&&this.collection.term?"/api/terms/"+SchedulerHelpers.safeUrlSegment(this.collection.term.id)+"/subjects":"/api/subjects"}});Scheduler.Models.Term=Scheduler.Models.BaseModel.extend({urlRoot:"/api/terms"});Scheduler.Models.Topic=Scheduler.Models.BaseModel.extend({url:"api/topics"});Scheduler.Models.UserSettings=Scheduler.Models.DeepModel.extend({defaults:{padding:0},url:function(){return"api/user_settings"},sync:function(n,t,i){return n="update",Backbone.sync(n,t,i)}});Backbone.Relational.store.addModelScope(Scheduler.Collections);Scheduler.Collections.BaseCollection=Backbone.Collection.extend({url:function(n){return this.model.prototype.urlRoot+"/"+(n?n.join(";"):"")},parse:function(n){return _.isArray(n)?n:[n]},toTemplate:function(){return this.map(function(n){return _.isFunction(n.toTemplate)?n.toTemplate():n.toJSON()})}});Scheduler.Collections.SelectionCollection=Scheduler.Collections.BaseCollection.extend({selected:function(){return this.filter(function(n){return n.get("selected")})},setSelected:function(n){this.forEach(function(t){t.set("selected",t===n)})}});Scheduler.Collections.FilterCollection=Scheduler.Collections.SelectionCollection.extend({update:function(n){n.url=this.url()+"/update";Backbone.sync("update",this,n)}});Scheduler.Collections.AcademicCareers=Scheduler.Collections.FilterCollection.extend({model:Scheduler.Models.AcademicCareer,url:function(){var n=Scheduler.Data.CurrentTerm;return"/api/terms/"+SchedulerHelpers.safeUrlSegment(n.id)+"/academiccareers"}});Scheduler.Collections.AcademicGroups=Scheduler.Collections.FilterCollection.extend({model:Scheduler.Models.AcademicGroup,url:function(){var n=Scheduler.Data.CurrentTerm;return"/api/terms/"+SchedulerHelpers.safeUrlSegment(n.id)+"/academicgroups"}});Scheduler.Collections.Books=Scheduler.Collections.BaseCollection.extend({model:Scheduler.Models.Book,url:function(){var t=Scheduler.Config.sectionSettings.sectionBookSettings.urlTemplate,n=Scheduler.Data.CurrentTerm.get("code");return n=n.replace(/\//g,""),t.replace("{subjectCode}",this.section.subject).replace("{courseNumber}",this.section.course).replace("{term}",n).replace("{section}",this.section.sectionNumber)},initialize:function(n,t){this.mapping=Scheduler.Config.sectionSettings.sectionBookSettings.mapping;this.section=t.section.toTemplate()},parse:function(n){var i=[],t;return i=this.mapping.collectionProp?n[this.mapping.collectionProp]:n,t=[],_.each(i,function(n){if(this.book=n,n.isbn){var i=new Scheduler.Models.Book;_.each(this.mapping.mappingRules,function(mappingRule){mappingRule.value?i.set(mappingRule.key,n[mappingRule.value]):i.set(mappingRule.key,eval("this.book."+mappingRule.expression))},this)}t.push(i)},this),t}});Scheduler.Collections.Breaks=Scheduler.Collections.BaseCollection.extend({model:Scheduler.Models.Break,url:"/api/breaks",comparator:function(n){return n.get("title")?n.get("title").toLowerCase():""},getEvents:function(){var n=[];return this.forEach(function(t){_.forEach(t.getEvents(),function(t){n.push(t)})}),n},parse:function(n){return Modernizr.sessionstorage&&_.each(n,function(n){window.sessionStorage.getItem("selected.break-"+n.id)&&(n.selected=!0)}),n},destroy:function(n){n.url=this.url+"/removeall";Backbone.sync("delete",this,n)}});Scheduler.Collections.Campuses=Scheduler.Collections.FilterCollection.extend({model:Scheduler.Models.Campus,url:function(){var n=Scheduler.Data.CurrentTerm;return"/api/terms/"+SchedulerHelpers.safeUrlSegment(n.id)+"/campuses"}});Scheduler.Collections.CartSections=Scheduler.Collections.BaseCollection.extend({model:Scheduler.Models.Section,initialize:function(n){n=n||{};this.term=n.term},url:function(){return"/api/terms/"+SchedulerHelpers.safeUrlSegment(this.term.id)+"/shoppingcart"}});Scheduler.Collections.CourseAttributes=Scheduler.Collections.BaseCollection.extend({model:Scheduler.Models.CourseAttribute,initialize:function(n,t){t=t||{};t.term&&(this.term=t.term);t.groupId&&(this.groupId=t.groupId)},url:function(){return this.term&&this.groupId?"/api/terms/"+SchedulerHelpers.safeUrlSegment(this.term.id)+"/courseattributes/"+SchedulerHelpers.safeUrlSegment(this.groupId):this.term?"/api/terms/"+SchedulerHelpers.safeUrlSegment(this.term.id)+"/courseattributes":"/api/courseattributes"}});Scheduler.Collections.CourseStatuses=Scheduler.Collections.SelectionCollection.extend({model:Scheduler.Models.CourseStatus,url:"/api/coursestatuses"});Scheduler.Collections.Courses=Scheduler.Collections.BaseCollection.extend({model:Scheduler.Models.Course,initialize:function(n,t){t=t||{};t.term&&(this.term=t.term);t.subject&&(this.subject=t.subject);t.groupId&&(this.groupId=t.groupId);t.degreePlanTerm&&(this.degreePlanTerm=t.degreePlanTerm)},setSubject:function(n){this.subject=n},setFilterType:function(n){this.filterType=n},setCourseNoSearch:function(n){this.courseNoSearch=n},url:function(){var n=SchedulerHelpers.safeUrlSegment,t=this.attributeValues||[];return this.term&&this.subject&&(this.attribute||t.length)?SchedulerUrlHelper.getAttrRoute({term:this.term,attribute:this.attribute,attributeValues:t,subject:this.subject,groupId:this.groupId}):this.term&&this.subject?"/api/terms/"+n(this.term.id)+"/subjects/"+n(this.subject.id)+"/courses":this.term&&this.filterType&&this.courseNoSearch?"/api/terms/"+n(this.term.id)+"/filtertype/"+n(this.filterType)+"/courses/"+n(this.courseNoSearch):this.subject?"/api/subjects/"+n(this.subject.id)+"/courses":this.term&&this.degreePlanTerm?"/api/terms/"+n(this.term.id)+"/degree-plan/courses/by-plan-term/"+n(this.degreePlanTerm):"/api/courses"},getAttrRoute:function(){var n=SchedulerHelpers.safeUrlSegment,t=this.attribute instanceof Scheduler.Models.SectionAttribute?"/sectionattribute":"/courseattribute",i="/api/terms/"+n(this.term.id);return i+=this.attributeValue?t+"s/"+n(this.attribute.get("attr"))+"/value/"+n(this.attributeValue.get("value")):Scheduler.Config.courseSettings.attributeMode===SchedulerLib.AttributeModes.Combined?t+"s/"+n(this.attribute.get("attr"))+"/value/"+n(this.attribute.get("value")):Scheduler.Config.courseSettings.attributeMode===SchedulerLib.AttributeModes.Single?t+"values/"+n(this.attribute.get("value")):t+"s/"+n(this.attribute.get("attr")),i+="/subjects/"+n(this.subject.id)+"/courses",this.groupId&&(i+="/"+n(this.groupId)),i}});Scheduler.Collections.CurrentSections=Scheduler.Collections.BaseCollection.extend({model:Scheduler.Models.Section,initialize:function(n){n=n||{};this.term=n.term},url:function(){return"/api/terms/"+SchedulerHelpers.safeUrlSegment(this.term.id)+"/currentschedule"}});Scheduler.Collections.DegreeWorksCourses=Scheduler.Collections.BaseCollection.extend({model:Scheduler.Models.DegreeWorksCourse,url:"/api/degreeworks"});Scheduler.Collections.DegreeWorksPlans=Scheduler.Collections.BaseCollection.extend({model:Scheduler.Models.DegreeWorksPlan,initialize:function(n,t){t=t||{};t.term&&(this.term=t.term)},url:function(){return this.term?"/api/terms/"+SchedulerHelpers.safeUrlSegment(this.term.id)+"/degreeworks":"/api/degreeworks"}});Scheduler.Collections.DegreePlanCourses=Scheduler.Collections.BaseCollection.extend({model:Scheduler.Models.DegreePlanCourse});Scheduler.Collections.DegreePlanTerms=Scheduler.Collections.BaseCollection.extend({model:Scheduler.Models.DegreePlanTerm});Scheduler.Collections.DegreeplannerCourses=Scheduler.Collections.BaseCollection.extend({model:Scheduler.Models.DegreeplannerCourse,initialize:function(n,t){t=t||{};t.term&&(this.term=t.term);this.parentCollection=t.parentCollection;this.collectionsByTerm={};this.on("add",this.onAddCourse);this.on("remove",this.onRemoveCourse)},comparator:function(n){var t=n.get("subjectId")||n.get("title")||"",i=n.get("number")||"";return[t.toLowerCase(),i.toLowerCase()]},selected:function(){return this.filter(function(n){return n.get("selected")})},url:function(){return null},getAllCoursesCollection:function(){return this.parentCollection||this},toTemplate:function(){return this.map(function(n){return n.toTemplate()})},resetCollection:function(){_.each(this.collectionsByTerm,function(n,t){n.reset(n.parentCollection.where({term:t}))})},getCollectionForTerm:function(n,t){if(t||!this.collectionsByTerm[n.id]){var i=new Scheduler.Collections.DegreeplannerCourses(this.where({term:n.id}),{term:n,parentCollection:this});return this.listenTo(i,"add",function(n){this.add(n)}),this.listenTo(i,"remove",function(n){this.remove(n)}),this.listenTo(i,"sdp:transfer",this.transferModelToNewTerm),this.listenTo(i,"sdp:request_move",function(n,t){this.trigger("sdp:request_move",n,t)}),this.listenTo(i,"all",function(){var n=_.first(arguments);/^degreeplan\:/.test(n)?this.trigger.apply(this,arguments):/^change\:?/.test(n)&&this.trigger.apply(this,arguments)}),t||(this.collectionsByTerm[n.id]=i),i}return this.collectionsByTerm[n.id]},transferModelToNewTerm:function(n,t){var i=this.get(n),r;i&&(r=this.collectionsByTerm[i.get("term")],r!=t&&(i.set("term",t.term.id),r.remove(i),t.add(i),t.trigger("sdp:transfer_complete")))},paginate:function(n,t){var i=(n-1)*t;return new this.constructor(this.models.slice(i,i+t))},onAddCourse:function(n){var i=n.get("term"),t=this.collectionsByTerm[i];t&&t.add(n)},onRemoveCourse:function(n){var i=n.get("term"),t=this.collectionsByTerm[i];t&&t.remove(n)}});Scheduler.Collections.DegreePlans=Scheduler.Collections.BaseCollection.extend({model:Scheduler.Models.DegreePlan,initialize:function(n,t){t=t||{};t.term&&(this.term=t.term)},url:function(){return"/api/terms/"+SchedulerHelpers.safeUrlSegment(this.term.id)+"/degreeplans"}});Scheduler.Collections.DesiredCourses=Scheduler.Collections.SelectionCollection.extend({model:Scheduler.Models.DesiredCourse,initialize:function(n,t){t=t||{};t.term&&(this.term=t.term)},comparator:function(n){var t=n.get("subjectShort")||"",i=n.get("number")||"";return[t.toLowerCase(),i.toLowerCase()]},url:function(){return this.term?"/api/terms/"+SchedulerHelpers.safeUrlSegment(this.term.id)+"/desiredcourses":"/api/desiredcourses"},parse:function(n){return Modernizr.sessionstorage&&_.each(n,function(n){window.sessionStorage.getItem("selected.course-"+n.id)&&(n.selected=!0)}),n},doesCourseExist:function(n,t,i){return this.find(function(r){var u=r.get("topic")||"",f=i||"",e=u===f;return r.get("courseKey")===n+" "+t&&e})},destroy:function(n){n.url=this.url();Backbone.sync("delete",this,n)}});Scheduler.Collections.EnrollmentGroups=Scheduler.Collections.BaseCollection.extend({model:Scheduler.Models.EnrollmentGroup,initialize:function(n,t){t=t||{};t.term&&(this.term=t.term)},url:function(){return this.term?"/api/terms/"+SchedulerHelpers.safeUrlSegment(this.term)+"/enrollmentgroups":null}});Scheduler.Collections.Events=Scheduler.Collections.BaseCollection.extend({model:Scheduler.Models.Event,initialize:function(n,t){t=t||{};this.startTime=t.startTime;this.endTime=t.endTime},getMinStartTime:function(){if(this.startTime)return this.startTime;var n=this.min(function(n){return n.get("startTime")}),t=n===Infinity||n===-Infinity?800:Math.floor(n.get("startTime")/100)*100;return t>800?800:t},getMaxEndTime:function(){if(this.endTime)return this.endTime;var n=this.max(function(n){return n.get("endTime")}),t=n===Infinity||n===-Infinity?2e3:n.get("endTime");return t<2e3?2e3:t}});Scheduler.Collections.EwsValues=Scheduler.Collections.BaseCollection.extend({model:Scheduler.Models.EwsValue});Scheduler.Collections.InstructionModes=Scheduler.Collections.FilterCollection.extend({model:Scheduler.Models.InstructionMode,url:function(){var n=Scheduler.Data.CurrentTerm;return"/api/terms/"+SchedulerHelpers.safeUrlSegment(n.id)+"/instructionmodes"}});Scheduler.Collections.LearningCommunities=Scheduler.Collections.BaseCollection.extend({model:Scheduler.Models.LearningCommunity,initialize:function(n,t){t=t||{};t.term&&(this.term=t.term)},url:function(){return this.term?"/api/terms/"+SchedulerHelpers.safeUrlSegment(this.term.id)+"/learningcommunities":"/api/learningcommunities"}});Scheduler.Collections.Locations=Scheduler.Collections.FilterCollection.extend({model:Scheduler.Models.Location,url:function(){var n=Scheduler.Data.CurrentTerm;return"/api/terms/"+SchedulerHelpers.safeUrlSegment(n.id)+"/locations"}});Scheduler.Collections.MyPlannerCourses=Scheduler.Collections.BaseCollection.extend({model:Scheduler.Models.MyPlannerCourse,url:function(){var n=Scheduler.Data.CurrentTerm;return"/api/terms/"+SchedulerHelpers.safeUrlSegment(n.id)+"/myplanner"}});Scheduler.Collections.PartsOfTerm=Scheduler.Collections.FilterCollection.extend({model:Scheduler.Models.PartOfTerm,url:function(){var n=Scheduler.Data.CurrentTerm;return"/api/terms/"+SchedulerHelpers.safeUrlSegment(n.id)+"/partsofterm"}});Scheduler.Collections.RegistrationBlocks=Scheduler.Collections.BaseCollection.extend({model:Scheduler.Models.RegistrationBlock,initialize:function(n,t){t=t||{};this.sections=new Scheduler.Collections.Sections;t.term&&(this.term=t.term);t.subjectId&&(this.subjectId=t.subjectId);t.course&&(this.course=t.course);t.sections&&(this.sections=t.sections)},url:function(){var n="/api",t=SchedulerHelpers.safeUrlSegment,i;return this.term&&(n+="/terms/"+t(this.term.id)),this.subjectId&&(n+="/subjects/"+t(this.subjectId)),this.course&&(n+="/courses/"+t(this.course.get("number")),this.course.get("topic")&&(i=this.course.get("topic"),i===Scheduler.Constants.nonTopicSectionDesignator&&(i=Scheduler.Constants.nonTopicSectionApiLabel),n+="/"+t(i))),n+"/regblocks"},parse:function(n){return this.sections.add(n.sections),n.registrationBlocks},getRegBlocksForTemplate:function(){var n=this.sections||new Scheduler.Collections.Sections,t=[];return this.each(function(i){var e=i.get("sectionIds"),o=i.get("optionalSectionIds"),u=new Scheduler.Collections.Sections,r=i.toTemplate(),f=function(n){return n.map(function(n){var t=n.toTemplate();return _.contains(o,n.get("registrationNumber"))&&(t.selected=!0),t})};n.length?(_.each(e,function(t){var i=n.get(t);u.add(i)}),r.sections=f(u)):i.sections.length&&(r.sections=f(i.sections));t.push(r)}),t},getSectionsForCalendar:function(){var n=new Scheduler.Collections.Sections,t=0;return this.each(function(i){i.sections.invoke("set",{bgColor:i.bgColor||++t,registrationBlockId:i.id});n.add(i.sections.models)}),this.sections=n,n},getSections:function(){var n=new Scheduler.Collections.Sections;return this.each(function(t){n.add(t.sections.models)}),this.sections=n,n},getSelectedSections:function(n,t){n=n||[];t=t||[];var r=this.getSections(),u,i=new Scheduler.Collections.Sections,f=new Scheduler.Collections.Sections(n),e=new Scheduler.Collections.Sections(t);return i.add(f.models),i.add(e.models),u=i.length?r.filter(function(n){return i.every(function(t){return t.id!==n.id})}):r.models,u||[]},filterRegBlocksByRules:function(n){var r=this.where({enabled:!0}),i=!1,t,u=_.filter(r,_.bind(function(r){return t=this.detectMatches(r,n),t.anyMatch?r.set("disabledByRule",!1):this.assignDisabledByRuleReason(r),t.nonMatchingIncluded&&(i=t.nonMatchingIncluded),t.anyMatch},this));return i?this.trigger("filter:non-matching-included"):this.trigger("filter:only-matching-included"),u},detectMatches:function(n,t){for(var u,e,i,o,r=!0,f=0;f<t.length;f++){if(!r)return{anyMatch:!1,nonMatchingIncluded:!1};i=t[f];e=i.values.length===0&&i.value!==null&&i.value!==undefined&&i.value.toString()==="false";u=i.values.length||i.value!==null&&i.value!==undefined?this.sectionsMatchOnRule(n,i):n.get("sectionIds").length;!e&&r?r=u>0:e&&(r=u===n.get("sectionIds").length);r&&u<n.get("sectionIds").length&&(o=!0)}return{anyMatch:r,nonMatchingIncluded:o}},sectionsMatchOnRule:function(n,t){var s=this.sections,e,i,r,f,u,o=0;return _.each(n.get("sectionIds"),function(n){u=!1;e=s.get(n);i=[];r=e.get(t.type);switch(t.type){case"instructor":i.push("name");break;case"sectionAttributes":i.push("attr");i.push("value")}i.length?(f=_.map(t.values,function(n){return JSON.parse(n)}),u=t.type==="sectionAttributes"&&Scheduler.Config.courseSettings.applyAndOperatorToAttributeFilterRule?_.all(f,function(n){return _.any(r,function(t){return _.all(i,function(i){return!t[i]||n[i]===t[i]})})}):_.any(r,function(n){return _.any(f,function(t){return _.all(i,function(i){return!t[i]||n[i]===t[i]})})})):u=t.values.length?_.contains(t.values,r):t.value===r.toString();u&&o++}),o},assignDisabledByRuleReason:function(n){var u=this.sections,r="This section has been disabled by your Advanced Filters selection",t,i;n.set("disabledByRule",!0);_.each(n.get("sectionIds"),function(n){i=u.get(n);t=i.get("clientDisabledReasons")||[];_.contains(t,r)||(t.push(r),i.set("clientDisabledReasons",t))})}});Scheduler.Collections.RegistrationWarnings=Scheduler.Collections.BaseCollection.extend({model:Scheduler.Models.RegistrationWarning,url:function(){var n=Scheduler.Data.CurrentTerm;return"/api/terms/"+SchedulerHelpers.safeUrlSegment(n.id)+"/registrationwarnings"}});Scheduler.Collections.RequiredCourses=Scheduler.Collections.BaseCollection.extend({model:Scheduler.Models.BaseModel,initialize:function(n,t){t=t||{};t.term&&(this.term=t.term)},url:function(){var n=SchedulerHelpers.safeUrlSegment;return this.term?"/api/terms/"+n(this.term.id)+"/courses/required":"/api/courses/required"}});Scheduler.Collections.ScheduleFavoriteGenerations=Scheduler.Collections.BaseCollection.extend({model:Scheduler.Models.ScheduleGeneration,url:function(){return"/api/terms/"+SchedulerHelpers.safeUrlSegment(this.term.id)+"/schedule-favorites/generate"},parse:function(n){var t=this.term.id;return _.map(n,function(n,i){return n.otherData={favoriteId:parseInt(i,10)},n.term=t,n})},findByFavorite:function(n){var t=this.find(function(t){return t.otherData.favoriteId===n.id});return t||new Scheduler.Models.ScheduleGeneration},prepareRegBlocks:function(){var n={},t=0;this.each(function(i){i.schedules.each(function(r){i.setRegBlocksForSchedule(r);r.getRegistrationBlocks().each(function(i){var r=i.id.replace(/@.*$/,"");n[r]||(n[r]=++t);i.bgColor=n[r]})})})}});Scheduler.Collections.ScheduleFavorites=Scheduler.Collections.BaseCollection.extend({model:Scheduler.Models.ScheduleFavorite,initialize:function(n,t){t=t||{};this.setTerm(t.term)},url:function(){return"/api/terms/"+SchedulerHelpers.safeUrlSegment(this.term.id)+"/schedule-favorites/mine"},setTerm:function(n){this.term=n;this.getScheduleGenerator().term=n;this.term&&this.fetch()},findMatching:function(n){return this.find(function(t){return _.isEqual(n,t.get("sections"))})},addFavorite:function(n,t){var r=this,u=_.extend({sections:n,term:this.term.id},t||{}),i=new Scheduler.Models.ScheduleFavorite(u);return i.save().done(function(){r.add(i)})},fetch:function(){return Scheduler.Config.scheduleSettings.showFavorites?Scheduler.Collections.BaseCollection.prototype.fetch.apply(this,arguments):$.Deferred().resolve({})},getScheduleGenerator:function(){return this.scheduleGenerator||(this.scheduleGenerator=new Scheduler.Collections.ScheduleFavoriteGenerations,this.scheduleGenerator.term=this.term,this.listenTo(this.scheduleGenerator,"sync",this.attachGenerations)),this.scheduleGenerator},toTemplate:function(){var n=this.getScheduleGenerator();return this.map(function(t){var i=_.isFunction(t.toTemplate)?t.toTemplate():t.toJSON(),r=n.findByFavorite(t).schedules.first();return r&&(i.schedule=r.toTemplate()),i})},attachGenerations:function(){var n=this.getScheduleGenerator();n.prepareRegBlocks();this.each(function(t){t.setGeneration(n.findByFavorite(t))})},getAllSchedules:function(){var n=this.getScheduleGenerator(),t=1,i=this.chain().map(function(i){var u=n.findByFavorite(i),r=u.schedules.first();return r&&(r.id=t++,r.set("id",r.id),r.navigateUrl="schedules/favorites/"+i.id),r}).filter().value();return new Scheduler.Collections.Schedules(i)}});Scheduler.Collections.Schedules=Scheduler.Collections.BaseCollection.extend({model:Scheduler.Models.Schedule,initialize:function(){this.shuffled=!1},toggleShuffle:function(){this.shuffled?(this.reset(this.sortBy(function(n){return n.id})),this.shuffled=!1):(this.reset(this.shuffle()),this.shuffled=!0)},reshuffle:function(){this.reset(this.shuffle());this.shuffled=!0}});Scheduler.Collections.SectionAttributes=Scheduler.Collections.BaseCollection.extend({model:Scheduler.Models.SectionAttribute,initialize:function(n,t){t=t||{};t.term&&(this.term=t.term);t.groupId&&(this.groupId=t.groupId)},url:function(){return this.term&&this.groupId?"/api/terms/"+SchedulerHelpers.safeUrlSegment(this.term.id)+"/sectionattributes/"+SchedulerHelpers.safeUrlSegment(this.groupId):this.term?"/api/terms/"+SchedulerHelpers.safeUrlSegment(this.term.id)+"/sectionattributes":"/api/sectionattributes"}});Scheduler.Collections.Sections=Scheduler.Collections.BaseCollection.extend({model:Scheduler.Models.Section,getEventsForWeek:function(n,t){n--;var r=[],e=n*7,f=this.getEarliestMondayDate(),i,u;return f?(i=f.clone(),i.add(e,"d"),u=i.clone(),u.add(7,"d"),this.forEach(function(n){var f=t.get(n.get("registrationBlockId")),e=n.getEventsForWeek(i,u,f);_.forEach(e,function(n){r.push(n)})})):this.forEach(function(n){var i=t.get(n.get("registrationBlockId"));_.forEach(n.getEvents(i),function(n){r.push(n)})}),r},getNumberOfWeeks:function(){var i=this.getEarliestMondayDate(),n=this.getLatestMondayDate(),r,u,f,t;return!i||!n?0:(n.add(7,"d"),r=i.valueOf(),u=n.valueOf(),f=Math.abs(u-r),t=Math.floor(f/6048e5),t>Scheduler.Constants.MAX_WEEKS)?52:t},hasLargeStartAndEndGap:function(){var f=6048e5,n=!1,t,i,r,u;return this.each(function(e){_.each(e.get("meetings"),function(e){e.startDate&&e.endDate&&(t=moment(e.startDate).valueOf(),i=moment(e.endDate).valueOf(),r=Math.abs(i-t),u=Math.floor(r/f),u>Scheduler.Constants.MAX_WEEKS&&(n=!0))})}),n},getEarliestMondayDate:function(){var n=this.getSortedDates("firstMonday");return n.length?_.first(n):null},getLatestMondayDate:function(){var n=this.getSortedDates("lastMonday");return n.length?_.last(n):null},getSortedDates:function(n){var t=[],i=function(n,t){return n.isAfter(t)?1:n.isBefore(t)?-1:0};return this.each(function(i){_.each(i.get("meetings"),function(i){if(i[n]){var r=moment.utc(i[n]).startOf("day");t.push(r)}})}),t.sort(i)},hasWeekVariance:function(){var r=0,n,e,t,i,u,f;for(r;r<this.length;r++)for(e=this.models[r],t=e.get("meetings"),n=0,!t.length||u||f||(u=t[0].firstMonday,f=t[0].lastMonday,n=1),n;n<t.length;n++)if((i=t[n],i.firstMonday&&i.lastMonday)&&(u!==i.firstMonday||f!==i.lastMonday))return!0;return!1},getCoreqs:function(){var n=this.filter(function(n){return n.get("corequisiteSections")&&n.get("corequisiteSections").length}),t=[],i;return!n||!n.length?[]:(_.each(n,function(n){_.each(n.get("corequisiteSections"),function(r){i="<strong>"+n.get("subject")+" "+n.get("course")+"-"+n.get("sectionNumber")+"<\/strong> is missing section co-requisites. Please include the following course: <strong>"+r.subject+" "+r.course+"<\/strong>";t.push(i)})}),t)},getCreditTotal:function(){var n,t;try{return n=this.getCreditMinTotal(),t=this.getCreditMaxTotal(),n===t?n:n+" - "+t}catch(i){return 0}},getCreditMinTotal:function(){return this.getCreditFieldTotal("creditsMin")},getCreditMaxTotal:function(){return this.getCreditFieldTotal("creditsMax")},getCreditFieldTotal:function(n){var i=this.getCreditQueryableSections(),t;try{return t=_.reduce(i.pluck(n),function(n,t){return parseFloat(n)+parseFloat(t)},0),parseFloat(t.toFixed(3))}catch(r){return 0}},getCreditQueryableSections:function(){var n=this,t;return Scheduler.Config.scheduleSettings.onlyERegistrationTypeInCreditCalculation&&(t=n.where({registrationType:"E"}),n=new Scheduler.Collections.Sections(t)),n},getUniqueFieldData:function(n,t){var i=[];return this.each(function(t){i=i.concat(t.get(n))}),i=_.chain(i).uniq(function(n){return t?n[t]:n}).filter(function(n){return t?n[t]!=" ":n!=" "}).sortBy(i,function(n){return t?n[t]:n}).value()}});Scheduler.Collections.Sessions=Scheduler.Collections.FilterCollection.extend({model:Scheduler.Models.Session,url:function(){var n=Scheduler.Data.CurrentTerm;return"/api/terms/"+SchedulerHelpers.safeUrlSegment(n.id)+"/sessions"}});Scheduler.Collections.Subjects=Scheduler.Collections.BaseCollection.extend({model:Scheduler.Models.Subject,initialize:function(n,t){t=t||{};t.term&&(this.term=t.term);t.groupId&&(this.groupId=t.groupId)},url:function(){var n=SchedulerHelpers.safeUrlSegment,t=this.attributeValues||[];return this.term&&(this.attribute||t.length)?SchedulerUrlHelper.getAttrRoute({term:this.term,attribute:this.attribute,attributeValues:t,groupId:this.groupId}):this.term?"/api/terms/"+n(this.term.id)+"/subjects":this.attribute?"/api/courseattributes/"+n(this.attribute.id)+"/subjects":"/api/subjects"},getAttrRoute:function(){var n=SchedulerHelpers.safeUrlSegment,u=this.attribute||this.attributeValue,i=u instanceof Scheduler.Models.SectionAttribute?"/sectionattribute":"/courseattribute",r=i+"s/",f=i+"values/",t="/api/terms/"+n(this.term.id);return t+=this.attribute&&this.attributeValue?r+n(this.attribute.get("attr"))+"/value/"+n(this.attributeValue.get("value")):this.attribute?r+n(this.attribute.get("attr")):f+n(this.attributeValue.get("value")),t+="/subjects",this.groupId&&(t+="/"+n(this.groupId)),t}});Scheduler.Collections.Terms=Scheduler.Collections.SelectionCollection.extend({model:Scheduler.Models.Term,url:"/api/terms",setSelected:function(n){var t;Scheduler.Data.CurrentTerm!==n&&(t=!0);Scheduler.Data.CurrentTerm=n;this.forEach(function(t){t.set("selected",t===n)});t?this.trigger("update:filters",this):this.trigger("updated:selected",this)}});Scheduler.Collections.Topics=Scheduler.Collections.BaseCollection.extend({model:Scheduler.Models.Topic,initialize:function(n,t){t=t||{};t.term&&(this.term=t.term);t.course&&(this.course=t.course);t.subject&&(this.subject=t.subject)},setSubject:function(n){this.subject=n},setCourseNumber:function(n){this.course=n},url:function(){var n=SchedulerHelpers.safeUrlSegment,t=this.attributeValues||[];return this.term&&this.subject&&(this.attribute||t.length)&&this.course?SchedulerUrlHelper.getAttrRoute({term:this.term,attribute:this.attribute,attributeValues:t,subject:this.subject,course:this.course,groupId:this.groupId}):"/api/terms/"+n(this.term.id)+"/subjects/"+n(this.subject.id)+"/courses/"+n(this.course.get("number"))+"/topics"},getAttrRoute:function(){var n=SchedulerHelpers.safeUrlSegment,u=this.attribute||this.attributeValue,i=u instanceof Scheduler.Models.SectionAttribute?"/sectionattribute":"/courseattribute",r=i+"s/",f=i+"values/",t="/api/terms/"+n(this.term.id);return t+=this.attribute&&this.attributeValue?r+n(this.attribute.get("attr"))+"/value/"+n(this.attributeValue.get("value")):this.attribute?r+n(this.attribute.get("attr")):f+n(this.attributeValue.get("value")),t+="/subjects/"+n(this.subject.id)+"/courses/"+n(this.course.get("number"))+"/topics",this.groupId&&(t+="/"+n(this.groupId)),t}});Scheduler.Views.BaseModal=Backbone.View.extend({template:JST["layout/base-modal"],id:"base-modal",className:"modal fade",attributes:{tabindex:"-1",role:"dialog","aria-hidden":"true"},titlePath:"layout/base-modal-title",bodyPath:"layout/base-modal-body",events:{"shown.bs.modal":"shown","hidden.bs.modal":"teardown"},initialize:function(n){n=n||{};this.title=n.title;this.content=n.content;this.size=n.size;this.hideTitle=n.hideTitle;this.templateOptions=n.templateOptions;this.size==="lg"?this.$el.addClass("center-lg"):this.size==="md"&&this.$el.addClass("center-md");_.bindAll(this,"render","renderTemplate");this.render()},show:function(){this.$el.modal("show");$(document.body).addClass("modal-open")},shown:function(){},teardown:function(){this.$el.data("modal",null);$(document.body).removeClass("modal-open");this.remove()},render:function(){return this.renderTemplate(),Modernizr.touch||this.$('[data-toggle="tooltip"]').tooltip(),this},renderTemplate:function(){var n;this.model&&(n=this.model.toTemplate());this.$el.html(this.template({titlePath:this.titlePath,bodyPath:this.bodyPath,model:n,size:this.size,hideTitle:this.hideTitle,title:this.title,content:this.content,options:this.templateOptions}))}});Scheduler.Views.BasePopover=Backbone.View.extend({template:JST["layout/base-popover"],id:"base-modal",className:"popover fade",attributes:{tabindex:0,role:"tooltip"},titlePath:"layout/base-popover-title",bodyPath:"layout/base-popover-body",initialize:function(){_.bindAll(this,"render","renderTemplate");this.render()},render:function(){return this.renderTemplate(),this.$title=this.$(".popover-title"),this.$content=this.$(".popover-content"),this},renderTemplate:function(){this.$el.html(this.template({titlePath:this.titlePath,bodyPath:this.bodyPath,model:this.model.toTemplate()}))}});Scheduler.Views.BreakIndex=Backbone.View.extend({template:JST["break/index"],a11yTemplate:JST["accessibility/break/index"],className:"breaks-page hidden-xs hidden-sm col-md-6",breaksEmptyMessage:"Add times during the day you do not wish to take classes.",events:{"click button.remove":"confirmRemoveBreak","click .btn-remove-all":"confirmRemoveAllBreaks","click button.add-break":"breakNew","click button.btn-break-show":"breakEdit",'click input[type="checkbox"].select-all':"selectAll",'click input[type="checkbox"].select':"selectOrUnselect"},initialize:function(){_.bindAll(this,"render","renderTemplate","removeBreak","onError","onSuccess","onRemoveAllSuccess","breakRemoved");this.SelectedBreaks=new Scheduler.Collections.Breaks(this.collection.where({selected:!0}));this.listenTo(this.collection,"add",this.breakAdded);this.listenTo(this.collection,"remove",this.breakRemoved);this.listenTo(this.collection,"change",this.render);this.listenTo(this.SelectedBreaks,"add",function(n){n.set("selected",!0)});this.listenTo(this.SelectedBreaks,"remove",function(n){n.set("selected",!1)});this.render()},render:function(){return this.renderTemplate(),Modernizr.touch||this.$('[data-toggle="tooltip"]').tooltip(),this},renderTemplate:function(){this.collection.each(_.bind(function(n){n.set("selected",this.SelectedBreaks.contains(n))},this));this.$el.html(this.template({breaks:this.collection.toTemplate(),allSelected:this.allBreaksSelected(),breaksEmptyMessage:this.breaksEmptyMessage,showSelectAllLabel:Scheduler.Config.courseSettings.showMyPlannerSelectAllLabel}))},confirmRemoveBreak:function(n){SchedulerHelpers.confirmBox("Remove this break?",_.bind(function(t){t&&this.removeBreak(n)},this))},confirmRemoveAllBreaks:function(n){SchedulerHelpers.confirmBox("Remove all breaks?",_.bind(function(t){t&&this.removeAll(n)},this))},removeBreak:function(n){var t=$(n.currentTarget).closest(".break-item"),i=parseInt(t.data("id"),10),r=this.collection.get(i);r.destroy({wait:!0,error:this.onError,success:this.onSuccess})},removeAll:function(){this.collection.destroy({wait:!0,error:this.onError,success:this.onRemoveAllSuccess})},onError:function(n,t){Scheduler.AppView.showError(t)},onRemoveAllSuccess:function(){this.collection.reset();this.render();Scheduler.AppView.showSuccessAlert("Removed all the Breaks")},onSuccess:function(){Scheduler.AppView.showSuccessAlert("Removed Break")},breakEdit:function(n){var i=$(n.currentTarget).closest(".break-item"),t=parseInt(i.data("id"),10),r=this.collection.get(t),u=new Scheduler.Views.BreakShow({model:r,collection:this.collection});Scheduler.AppRouter.navigateWithTerm("breaks/"+t);Scheduler.AppView.showViewWithTransition(u,"slide-from-right")},breakNew:function(){var n=new Scheduler.Views.BreakShow({collection:this.collection});Scheduler.AppRouter.navigateWithTerm("breaks/new");Scheduler.AppView.showViewWithTransition(n,"slide-from-right")},breakRemoved:function(n,t){var r=this.$el.find(".break-item[data-id="+n.id+"]"),i;i=this;r.tableRowRemove(function(){t.isEmpty()?i.render():i.$(this).closest(".break-item").remove()});this.allBreaksSelected()&&this.$(".break-grid input.select-all:checkbox").prop("checked",!0)},breakAdded:function(n){this.SelectedBreaks.add(n);this.render()},selectAll:function(n){this.$(".break-grid input.select:checkbox").prop("checked",n.currentTarget.checked);var t=[];this.$(".break-grid input.select:checkbox").each(_.bind(function(n,i){t[n]=this.getBreakFromRow(i)},this));n.currentTarget.checked?this.SelectedBreaks.add(t):this.SelectedBreaks.remove(t)},selectOrUnselect:function(n){var t=this.getBreakFromRow(n);this.SelectedBreaks.contains(t)?this.SelectedBreaks.remove(t):this.SelectedBreaks.add(t);this.$(".break-grid .select-all").prop("checked",this.allBreaksSelected())},getBreakFromRow:function(n){var t=this.getBreakIdFromRow(n);return this.collection.get(t)},getBreakIdFromRow:function(n){var t=this.$(n.currentTarget||n).closest(".break-item");return t.data("id").toString()},allBreaksSelected:function(){return this.SelectedBreaks.length===this.collection.length}});Scheduler.Views.BreakModal=Scheduler.Views.BaseModal.extend({attributes:{tabindex:"-1",role:"dialog","aria-hidden":"true","aria-labelledby":"event"},titlePath:"break/modal-title",bodyPath:"break/modal-body"});Scheduler.Views.BreakPopover=Scheduler.Views.BasePopover.extend({initialize:function(n){Scheduler.Views.BaseModal.prototype.initialize.apply(this,[n])},titlePath:"break/popover-title",bodyPath:"break/popover-body"});Scheduler.Views.BreakShow=Backbone.View.extend({template:JST["break/show"],className:"break-show",infoMessage:"Breaks are times during the day that you do not wish to take classes.",initialize:function(){if(_.bindAll(this,"render","renderTemplate","onError","onSuccess","changedTime","saveTimeState","incrTime","decrTime"),this.model=this.model||new Scheduler.Models.Break,this.render(),Modernizr.touch){this.$("button").on("touchstart",function(){$(this).addClass("mobile-hover-fix")});this.$("button").on("touchend",function(){$(this).addClass("mobile-hover-fix")})}setTimeout(_.bind(function(){this.$("#break-name").focus()},this),0)},render:function(){return this.renderTemplate(),this.renderTime("start"),this.renderTime("end"),Modernizr.touch||this.$(".tgl-chk").addClass("hov"),this},renderTemplate:function(){this.$el.html(this.template({model:this.model.toTemplate(),breakSettings:Scheduler.Config.breakSettings,infoMessage:this.infoMessage}))},renderTime:function(n){var t=this.model.get(n+"Time"),u=this.$el.find("#"+n+"-hour-selector"),f=this.$el.find("#"+n+"-minute-selector"),e=this.$el.find("#"+n+"-meridiem-selector"),i,r;return t?(i=this.model.getDisplayHours(t.hours),r=this.model.getDisplayMinutes(t.minutes),u.val(i),f.val(r),e.val(t.amOrPm.toLowerCase()),this):this},events:{"click .btn-save":"saveBreak","click .btn-cancel":"backBreak","change .all-weekdays input":"selectAllWeekdays","change .all-weekend input":"selectAllWeekend","change .day-of-weekend input":"selectedWeekendDay","change .day-of-week input":"selectedWeekday","click .tgl-chk":"onCheckClick","keydown .tgl-chk":"onCheckKeydown","mousedown .tgl-meridiem":"onMeridiemMouseDown","click .tgl-meridiem":"onMeridiemClick","keydown .tgl-meridiem":"onMeridiemKeydown","click .btn-open-time":"toggleTimeSelection","change #start-hour-selector":"changedTime","change #start-minute-selector":"changedTime","change #end-hour-selector":"changedTime","change #end-minute-selector":"changedTime","click .btn-time-ok":"saveTimeState","click .btn-incr":"incrTime","click .btn-decr":"decrTime"},backBreak:function(){Scheduler.AppView.backToMain(Scheduler.AppView.BreaksView,"breaks","slide-from-right",this)},saveBreak:_.debounce(function(){var n=$("#break-name").val(),r=this.$el.find("#start-hour-selector").val(),u=this.$el.find("#start-minute-selector").val(),t=this.$el.find("#start-meridiem-selector").val(),f=this.$el.find("#end-hour-selector").val(),e=this.$el.find("#end-minute-selector").val(),i=this.$el.find("#end-meridiem-selector").val(),o=this.$el.find("#chk-monday").prop("checked"),s=this.$el.find("#chk-tuesday").prop("checked"),h=this.$el.find("#chk-wednesday").prop("checked"),c=this.$el.find("#chk-thursday").prop("checked"),l=this.$el.find("#chk-friday").prop("checked"),a=this.$el.find("#chk-saturday").prop("checked"),v=this.$el.find("#chk-sunday").prop("checked"),y=Scheduler.Models.Break.convertToMilitaryHour(r,t),p=Scheduler.Models.Break.convertToMilitaryHour(f,i),w=this.model.id,b=this.collection.filter(function(t){return t.attributes.title===n&&t.id!==w});if(!_.isEmpty(b)){Scheduler.AppView.showDangerAlert("The break "+n+" already exists.");return}this.showSpinner();this.model.store();this.model.set({title:n,startTime:{hours:y,minutes:u,amOrPm:t},endTime:{hours:p,minutes:e,amOrPm:i},selectedDays:{monday:o,tuesday:s,wednesday:h,thursday:c,friday:l,saturday:a,sunday:v}});this.model.isValid()?this.model.save({},{wait:!0,error:this.onError,success:this.onSuccess}):(Scheduler.AppView.showDangerAlert("Please see the following errors",this.model.validationError),this.model.restore(),this.hideSpinner())},500,!0),onSuccess:function(n){var t=this.collection.get(n.id)?"Saved Break ":"Created Break ";t+=n.get("title");Scheduler.AppView.showSuccessAlert(t);this.collection.add(n);this.hideSpinner();Scheduler.AppView.backToMain(Scheduler.AppView.BreaksView,"breaks","slide-from-right",this)},onError:function(n,t){this.model.restore();Scheduler.AppView.showError(t);this.hideSpinner()},selectAllWeekdays:function(n){var t=this.$el.find(".day-of-week"),i=this.$(n.currentTarget).prop("checked");this.toggle(t,i)},selectAllWeekend:function(n){var t=this.$el.find(".day-of-weekend"),i=this.$(n.currentTarget).prop("checked");this.toggle(t,i)},selectedWeekday:function(){var n=this.$el.find(".all-weekdays"),t=this.$el.find(".day-of-week input:checked");n.length&&this.toggle(n,t.length===5)},selectedWeekendDay:function(){var n=this.$el.find(".all-weekend"),t=this.$el.find(".day-of-weekend input:checked");n.length&&this.toggle(n,t.length===2)},onCheckClick:function(n){var t=this.$(n.currentTarget),i=t.find("input"),r=i.prop("checked");this.toggle(t,!r);i.trigger("change")},toggle:function(n,t){var i=n.find("input");i.prop("checked",t);t?n.addClass("selected"):n.removeClass("selected")},onCheckKeydown:function(n){var t=n.keyCode||n.which;if(t===32)this.onCheckClick(n)},onMeridiemMouseDown:function(n){n.preventDefault()},onMeridiemClick:function(n){var t=this.$(n.currentTarget),i=t.find("select"),r=i.val(),u=r==="am"?"pm":"am";this.changeMeridiem(t,u);this.changedTime()},onMeridiemKeydown:function(n){var t=n.keyCode||n.which;if(t===32||t===38||t===40)this.onMeridiemClick(n)},changeMeridiem:function(n,t){var i=n.find("select");i.find('option[value="'+t+'"]').prop("selected",!0);n.find(".selected").removeClass("selected");n.find('[data-value="'+t+'"]').addClass("selected")},toggleTimeSelection:function(n){var r=this.$(n.currentTarget),u=r.parent(),t=u.data("type"),i=u.find("i"),f=u.next(),e=this.$("#"+t+"-hour-selector").val(),o=this.$("#"+t+"-minute-selector").val(),s=this.$("#"+t+"-meridiem-selector").val();return f.hasClass("hidden")?(f.removeClass("hidden"),i.removeClass("fa-chevron-down"),i.addClass("fa-chevron-up"),this.$("#"+t+"-xs-hour-selector").val(e),this.$("#"+t+"-xs-minute-selector").val(o),this.$("#"+t+"-xs-meridiem-selector").val(s),r.find("span").html("Cancel")):(f.addClass("hidden"),i.addClass("fa-chevron-down"),i.removeClass("fa-chevron-up"),r.find("span").html("Change")),!1},changedTime:function(){var n=this.$("#start-hour-selector").val(),t=this.$("#start-minute-selector").val(),i=this.$("#start-meridiem-selector").val(),r=this.$("#end-hour-selector").val(),u=this.$("#end-minute-selector").val(),f=this.$("#end-meridiem-selector").val();this.$(".start-time-xs .time-display").html(n+":"+t+i);this.$(".end-time-xs .time-display").html(r+":"+u+f)},saveTimeState:function(n){var i=this.$(n.currentTarget),t=i.data("type"),u=this.$('.btn-time-toggle[data-type="'+t+'"]'),f=this.$('.tgl-meridiem[data-type="'+t+'"]'),r=u.find("i"),e=this.$("#"+t+"-xs-hour-selector").val(),o=this.$("#"+t+"-xs-minute-selector").val(),s=this.$("#"+t+"-xs-meridiem-selector").val();return this.$("#"+t+"-hour-selector").val(e),this.$("#"+t+"-minute-selector").val(o),i.parent().addClass("hidden"),r.addClass("fa-chevron-down"),r.removeClass("fa-chevron-up"),this.changeMeridiem(f,s),this.changedTime(),!1},incrTime:function(n){var r=this.$(n.currentTarget),u=r.prev(),t=u.find(":selected"),i=t.prev();return i.length&&(t.prop("selected",!1),i.prop("selected",!0)),!1},decrTime:function(n){var r=this.$(n.currentTarget),u=r.nextAll("select"),t=u.find(":selected"),i=t.next();return i.length&&(t.prop("selected",!1),i.prop("selected",!0)),!1},showSpinner:function(){this.$(".btn-save i").removeClass("fa-check").addClass("fa-spinner fa-spin")},hideSpinner:function(){this.$(".btn-save i").addClass("fa-check").removeClass("fa-spinner fa-spin")}});Scheduler.Views.CalendarIndex=Backbone.View.extend({template:JST["calendar/index"],className:"calendar-index combo striped",initialize:function(n){n.displaySmall&&this.$el.addClass("cal-sm");this.generation=n.generation;this.displaySmall=n.displaySmall;this.showPopover=n.showPopover;this.startTime=this.collection.startTime=n.startTime;this.endTime=this.collection.endTime=n.endTime;this.listenTo(this.model.registrationBlocks,"change:locked",this.changeLockButtons);this.mondayEvents=new Scheduler.Collections.Events(this.collection.where({day:"M"}));this.tuesdayEvents=new Scheduler.Collections.Events(this.collection.where({day:"T"}));this.wednesdayEvents=new Scheduler.Collections.Events(this.collection.where({day:"W"}));this.thursdayEvents=new Scheduler.Collections.Events(this.collection.where({day:"R"}));this.fridayEvents=new Scheduler.Collections.Events(this.collection.where({day:"F"}));this.saturdayEvents=new Scheduler.Collections.Events(this.collection.where({day:"S"}));this.sundayEvents=new Scheduler.Collections.Events(this.collection.where({day:"U"}));_.bindAll(this,"render","renderTemplate","showEventModal","toggleLock","changeLockButtons","onToggleLockSuccess","onToggleLockError","showSpinner","hideSpinner");this.render()},events:function(){var n={"click .btn-lock-reg-block":"toggleLock","click .btn-toggle":"toggleCalendar"};return this.showPopover?n["mouseover .chip"]="showEventPopover":n["click .chip.open-info"]="showEventModal",n},render:function(){return this.mondayEvents.reset(this.collection.where({day:"M"})),this.tuesdayEvents.reset(this.collection.where({day:"T"})),this.wednesdayEvents.reset(this.collection.where({day:"W"})),this.thursdayEvents.reset(this.collection.where({day:"R"})),this.fridayEvents.reset(this.collection.where({day:"F"})),this.saturdayEvents.reset(this.collection.where({day:"S"})),this.sundayEvents.reset(this.collection.where({day:"U"})),this.renderTemplate(),Modernizr.touch||this.$('[data-toggle="tooltip"]').tooltip({container:"body"}),this},renderTemplate:function(){var t=Scheduler.Config.text,f={name:"saturday",title:"Saturday",shortTitle:t.saturdayAbbr,events:this.saturdayEvents.toTemplate()},u={name:"sunday",title:"Sunday",shortTitle:t.sundayAbbr,events:this.sundayEvents.toTemplate()},o=this.startTime||this.collection.getMinStartTime(),s=this.endTime||this.collection.getMaxEndTime(),h=Math.floor(o/100),e=Math.ceil(s/100),n,i,r;for(this.days=[{name:"monday",title:"Monday",shortTitle:t.mondayAbbr,events:this.mondayEvents.toTemplate()},{name:"tuesday",title:"Tuesday",shortTitle:t.tuesdayAbbr,events:this.tuesdayEvents.toTemplate()},{name:"wednesday",title:"Wednesday",shortTitle:t.wednesdayAbbr,events:this.wednesdayEvents.toTemplate()},{name:"thursday",title:"Thursday",shortTitle:t.thursdayAbbr,events:this.thursdayEvents.toTemplate()},{name:"friday",title:"Friday",shortTitle:t.fridayAbbr,events:this.fridayEvents.toTemplate()}],(f.events.length||u.events.length)&&this.days.push(f),u.events.length&&this.days.push(u),this.hours=[],n=h;n<=e;n++)n>=24||this.displaySmall&&n===e||(n>12?(i=n-12,r="pm"):n===0?(i=12,r="am"):n===12?(i=n,r="pm"):(i=n,r="am"),this.hours.push({hour:i,meridiem:r}));this.$el.html(this.template({days:this.days,hours:this.hours,displaySmall:this.displaySmall}))},showEventPopover:function(n){var i=this.$(n.currentTarget),u=i.data("id").toString(),r=this.collection.get(u),t;switch(r.get("type")){case"Break":t=new Scheduler.Views.BreakPopover({model:r});break;case"Section":t=new Scheduler.Views.SectionPopover({model:r})}i.popover({trigger:"manual hover",html:!0,template:t.$el.prop("outerHTML"),title:t.$title.html(),content:t.$content.html(),placement:"right",container:"body"});i.popover("show");i.on("hidden.bs.tooltip",t.remove)},showEventModal:function(n){var u=$(n.currentTarget).closest(".chip").data("id").toString(),t=this.collection.get(u),i,r;switch(t.get("type")){case"Break":i=new Scheduler.Views.BreakModal({model:t});break;case"Section":r=this.model.getSections().get(t.get("sectionId"));i=new Scheduler.Views.SectionModal({model:r,generation:this.generation})}i.show()},toggleLock:_.debounce(function(n){var i=this.$(n.currentTarget),r=i.data("registrationblockid"),t=this.model.registrationBlocks.get(r),u=!t.get("locked");return i.tooltip("destroy"),this.showSpinner(t.id),t.save({locked:u,term:this.generation.get("term")},{success:this.onToggleLockSuccess,error:this.onToggleLockError,wait:!0}),n.stopPropagation(),!1},500,!0),onToggleLockSuccess:function(n){this.hideSpinner(n.id)},onToggleLockError:function(n,t){Scheduler.AppView.showError(t);this.hideSpinner(n.id)},changeLockButtons:function(n){var e=this.$('.btn-lock-reg-block[data-registrationBlockId="'+n.id+'"]'),o=this.collection.where({registrationBlockId:n.id}),s=this.model.registrationBlocks.sections,u=n.get("locked"),h=this,t,f,i,r;e.each(function(){var n=h.$(this);f=n.data("sectionid");t=s.get(f);u?(n.find("i").removeClass("unlock").addClass("lock"),i="unlock"):(n.find("i").removeClass("lock").addClass("unlock"),i="lock");r="Click to "+i+" this class for "+t.get("subject")+" "+t.get("course");n.prop("title",r);n.attr("data-original-title",r)});_.invoke(o,"set","locked",u)},showSpinner:function(n){this.$('.btn-lock-reg-block[data-registrationBlockId="'+n+'"] i').removeClass("glyphicons").addClass("fa fa-spinner fa-spin")},hideSpinner:function(n){this.$('.btn-lock-reg-block[data-registrationBlockId="'+n+'"] i').addClass("glyphicons").removeClass("fa fa-spinner fa-spin")},toggleCalendar:function(n){var t=this.$(n.currentTarget),i=this.$(".events");i.hasClass("hide")?(i.removeClass("hide"),t.find("i").addClass("fa-minus-square-o").removeClass("fa-plus-square-o"),t.prop("title","Hide"),t.attr("data-original-title","Hide")):(i.addClass("hide"),t.find("i").addClass("fa-plus-square-o").removeClass("fa-minus-square-o"),t.prop("title","Show"),t.attr("data-original-title","Show"))}});Scheduler.Views.CalendarTooltip=Backbone.View.extend({template:JST["calendar/tooltip"],className:"calendar-tooltip tooltip fade",attributes:{role:"tooltip"},initialize:function(n){this.weekIndex=n.weekIndex||2;this.generation=n.generation;this.calendarView=new Scheduler.Views.CalendarIndex({collection:this.getEvents(),model:this.model,displaySmall:!0});_.bindAll(this,"render","renderTemplate","remove");this.render()},render:function(){return this.renderTemplate(),this},renderTemplate:function(){this.$el.html(this.template())},getEvents:function(){var t=this.model.getSections(),i=this.generation.getBreaks(),n=new Scheduler.Collections.Events;return n.add(t.getEventsForWeek(this.weekIndex,this.model.registrationBlocks)),n.add(i.getEvents()),n},remove:function(){this.calendarView.remove();Backbone.View.prototype.remove.apply(this,arguments)}});Scheduler.Views.CourseAddTab=Backbone.View.extend({dataLoaded:!1,loadData:function(){this.dataLoaded||(this.dataLoaded=!0,this._loadData())},_loadData:function(){}});Scheduler.Views.CourseAdd=Backbone.View.extend({template:JST["course/add"],a11yTemplate:JST["accessibility/course/add"],className:"course-add row",events:{"click .more-add-options a":"showMoreTab","shown.bs.tab a":"tabShown"},initialize:function(){_.bindAll(this,"render","renderTemplate");this.subViews=[];this.subViewsById={};this.render()},render:function(){this.renderTemplate();var t=Scheduler.Data.CurrentTerm,n;return _.each(Scheduler.Config.courseAddOptions,_.bind(function(n){var i=null;switch(n.viewId){case"by-subject":i=new Scheduler.Views.CourseBySubject;break;case"search-by-course-attribute":i=new Scheduler.Views.CourseByAttribute({groupId:n.groupId,viewId:n.id});break;case"by-section-attribute":i=new Scheduler.Views.CourseBySectionAttribute({groupId:n.groupId,viewId:n.id});break;case"search-by-course-number":i=new Scheduler.Views.CourseByCourseNumber;break;case"learning-communities":i=new Scheduler.Views.LearningCommunities;break;case"degree-works":i=new Scheduler.Views.DegreeWorksIndex({collection:new Scheduler.Collections.DegreeWorksPlans({},{term:t})});break;case"my-planner":i=new Scheduler.Views.MyPlannerIndex({model:new Scheduler.Models.MyPlannerPlan({},{term:t.id})});break;case"degree-planner":i=new Scheduler.Views.DegreeplannerCourseAddTab({model:Scheduler.Data.Degreeplanner.DegreePlan});break;case"degreeplan":i=new Scheduler.Views.DegreeplanIndex({collection:new Scheduler.Collections.DegreePlans({},{term:t}),tabSettings:n})}i&&(this.$el.find("#"+n.id).html(i.el),this.subViews.push(i),this.subViewsById[n.id]=i)},this)),this.sideList=new Scheduler.Views.CourseSideList,this.$el.find(".side-list-row").html(this.sideList.el),n=_.first(this.subViews),n&&n.loadData&&n.loadData(),this},renderTemplate:function(){var n=Scheduler.Config.courseAddOptions,t=_.filter(n,function(n){return n.primary}),i=_.filter(n,function(n){return!n.primary});this.$el.html(this.template({tabViews:t,dropdownViews:i,showMore:n.length>1,courseBackLink:"#courses"}))},remove:function(){_.each(this.subViews,_.bind(function(n){n.remove()}));this.sideList.remove();Backbone.View.prototype.remove.apply(this,arguments)},showMoreTab:function(n){n.preventDefault();var r=this.$(n.currentTarget),u=r.data("view"),f=this.$(".course-add-tabs li.tab a[data-view="+u+"]"),t=f.parent(),e=this.$(".course-add-tabs li.tab.active a"),o=e.parent(),s=e.data("view"),i=this.$(".course-add-tabs li.tab.visible-tab").last(),h=i.find("a").data("view"),c=this.$(".more-add-options li a[data-view="+h+"]");u!==s&&((o.hasClass("secondary")&&(t.hasClass("primary last")||t.hasClass("secondary"))&&(i.hasClass("secondary")||i.hasClass("primary last"))||o.hasClass("primary")&&(t.hasClass("secondary")||t.hasClass("primary")&&i.hasClass("secondary")))&&(i.removeClass("visible-tab"),c.parent().removeClass("visible-xs")),t.addClass("visible-tab"),r.parent().addClass("visible-xs"),f.tab("show"))},tabShown:function(n){var i=$(n.target).data("viewId"),t=this.subViewsById[i];t&&t.loadData&&t.loadData()}});Scheduler.Views.CourseByAttribute=Scheduler.Views.CourseAddTab.extend({template:JST["course/by-attribute"],className:"course-by-attribute col-xs-12",collectionType:"CourseAttributes",events:{"click .btn-add":"add","click .btn-cancel":"back"},initialize:function(n){_.bindAll(this,"render","renderTemplate","onAttributeChange","fetchError","fetchSubjects","fetchCourses","fetchTopics","fetchCourse","onFetchAttributesSuccess","onFetchSubjectsSuccess","onFetchTopicsSuccess","onFetchCourseSuccess","onFetchCoursesSuccess","hideTopicSelector","renderSelect2","onSuccess");this.opts=_.defaults(n||{},{targetCourseModelType:Scheduler.Models.DesiredCourse,coursesCollection:Scheduler.Data.Courses,term:Scheduler.Data.CurrentTerm,filterTerm:Scheduler.Data.CurrentTerm,collectionsNamespace:Scheduler.Collections,viewId:_.uniqueId("c-by-a-")});var t=this.opts.filterTerm,i=this.opts.groupId||null;this.viewId=this.opts.viewId;this.mode=Scheduler.Config.courseSettings.attributeMode;this.subjects=new this.opts.collectionsNamespace.Subjects([],{term:t,groupId:i});this.courses=new this.opts.collectionsNamespace.Courses([],{term:t,groupId:i});this.topics=new this.opts.collectionsNamespace.Topics([],{term:t,groupId:i});this.collection=new this.opts.collectionsNamespace[this.collectionType]({},{term:t,groupId:i});this.attributeCollection=new Scheduler.Collections.BaseCollection;this.attributeValueCollection=new Scheduler.Collections.BaseCollection;this.additionalCollection=new Scheduler.Collections.BaseCollection;this.render()},_loadData:function(){this.collection.fetch({success:this.onFetchAttributesSuccess,error:this.fetchError})},render:function(){return this.renderTemplate(),this.$(".topic-group").hide(),setTimeout(_.bind(function(){this.renderSelect2();this.setSelectListeners()},this),0),this},renderTemplate:function(){this.$el.html(this.template({subjectLabel:Scheduler.Config.text.subject,courseLabel:Scheduler.Config.text.course,additionalAttributeLabel:Scheduler.Config.text.additionalAttribute,attributeLabel:Scheduler.Config.text.courseAttribute,attributeValueLabel:Scheduler.Config.text.courseAttributeValue,topicsLabel:Scheduler.Config.text.topics,showValue:this.mode===SchedulerLib.AttributeModes.Dual,showAdditional:Scheduler.Config.courseSettings.additionalAttributes.length,viewId:this.viewId}))},renderSelect2:function(){if(this.topicSelector=new Scheduler.Views.Select({id:this.viewId+"-topic-attrib-selector",placeholder:"Select Topic",dataText:"title",collection:this.topics,startDisabled:!0,elementToFocus:this.$el.find(".btn-add")}),this.$(".topic-selector-container").html(this.topicSelector.el),this.courseSelector=new Scheduler.Views.Select({id:this.viewId+"-course-attrib-selector",placeholder:"Select "+Scheduler.Config.text.course,dataText:"displayTitle",collection:this.courses,startDisabled:!0,elementToFocus:this.$el.find(".btn-add")}),this.$(".course-selector-container").html(this.courseSelector.el),this.subjectSelector=new Scheduler.Views.Select({id:this.viewId+"-subject-attrib-selector",placeholder:"Select "+Scheduler.Config.text.subject,dataText:"title",collection:this.subjects,startDisabled:!0,elementToFocus:this.courseSelector.inputEl()}),this.$(".subject-selector-container").html(this.subjectSelector.el),this.attrSelector=new Scheduler.Views.Select({id:this.viewId+"-attribute-attrib-selector",placeholder:"Select "+Scheduler.Config.text.courseAttribute,dataText:"attrTitle",collection:this.attributeCollection,uniqueByDataText:!0,elementToFocus:this.subjectSelector.inputEl(),multiple:this.mode!==SchedulerLib.AttributeModes.Dual&&Scheduler.Config.courseSettings.enableAttributeMultiSelect}),this.mode===SchedulerLib.AttributeModes.Dual&&(this.attrValueSelector=new Scheduler.Views.Select({id:this.viewId+"-attribute-attrib-value-selector",placeholder:"Select "+Scheduler.Config.text.courseAttribute+" "+Scheduler.Config.text.courseAttributeValue,dataText:"valueTitle",collection:this.attributeValueCollection,allowClear:!0,elementToFocus:this.subjectSelector.inputEl(),multiple:Scheduler.Config.courseSettings.enableAttributeMultiSelect}),this.$(".attr-value-selector-container").html(this.attrValueSelector.el)),Scheduler.Config.courseSettings.additionalAttributes.length){var n=Scheduler.Config.courseSettings.additionalAttributeFormat==="value"?"valueTitle":"attrTitle";this.additionalSelector=new Scheduler.Views.Select({id:this.viewId+"-additional-selector",placeholder:"Select "+Scheduler.Config.text.additionalAttribute,dataText:n,collection:this.additionalCollection,allowClear:!0,elementToFocus:this.subjectSelector.inputEl(),multiple:Scheduler.Config.courseSettings.enableAttributeMultiSelect});this.$(".additional-selector-container").html(this.additionalSelector.el)}this.attrSelector.startSpinner();this.$(".attr-selector-container").html(this.attrSelector.el)},setSelectListeners:function(){this.listenTo(this.courseSelector,"selection:change",this.fetchCourse);this.listenTo(this.subjectSelector,"selection:change",this.fetchCourses);this.listenTo(this.attrSelector,"selection:change",this.onAttributeChange);this.additionalSelector&&this.listenTo(this.additionalSelector,"selection:change",this.fetchSubjects);this.attrValueSelector&&this.listenTo(this.attrValueSelector,"selection:change",this.fetchSubjects)},add:_.debounce(function(){var n=this.courseSelector.getSelected(),t=this.topicSelector.getSelected()||null;return!n||!this.courseInfo||!this.courseInfo.model?(Scheduler.AppView.showDangerAlert("Please select a Course."),!1):this.courseInfo.model&&this.courseInfo.model.hasTopics()&&!t?(Scheduler.AppView.showDangerAlert("You must select a subject, course and topic."),!1):(this.addByCourse(n,t),!1)},250,!0),addByCourse:function(n,t){var r,i,u;if(n){if(r=this.courses.get(n),i=_.clone(r.attributes),i.id=null,i.term=Scheduler.Data.CurrentTerm.id,i.topic=t,Scheduler.Data.Courses.doesCourseExist(i.subjectId,i.number,i.topic)){this.invalidAlert(["The course "+i.title+" is already in your list."]);return}u=new Scheduler.Models.DesiredCourse;u.save(i,{wait:!0,success:this.onSuccess,error:this.onError})}else Scheduler.AppView.showDangerAlert("Please select a Course.")},onAttributeChange:function(n){this.mode===SchedulerLib.AttributeModes.Dual&&(this.attrValueSelector.clearSelected(),this.fillAttrValues());this.fetchSubjects(n)},fillAttrValues:function(){var n=this.collection.get(this.attrSelector.getSelected());n&&this.attributeValueCollection.reset(_.where(this.collection.toTemplate(),{attr:n.get("attr")}))},back:function(){return Scheduler.AppView.backToMain(Scheduler.AppView.CoursesView,"courses","slide-from-right",this),!1},fetchSubjects:function(){this.subjectSelector.clearSelected();this.subjectSelector.enable();this.subjectSelector.startSpinner();this.courseSelector.clearSelected();this.courseSelector.disable();this.hideTopicSelector(!0);var n=this.getAttrPair();this.subjects.attribute=n.attribute;this.subjects.attributeValues=n.attributeValues;this.subjects.fetch({success:this.onFetchSubjectsSuccess,error:this.fetchError})},fetchCourses:function(){this.courseSelector.clearSelected();this.courseSelector.enable();this.courseSelector.startSpinner();this.hideTopicSelector(!0);this.courseInfo=new Scheduler.Views.CourseInfo;this.$el.find(".course-info-row").html(this.courseInfo.el);var t=this.subjects.get(this.subjectSelector.getSelected()),n=this.getAttrPair();this.courses.attribute=n.attribute;this.courses.attributeValues=n.attributeValues;this.courses.setSubject(t);this.courses.fetch({success:this.onFetchCoursesSuccess,error:this.fetchError})},fetchCourse:function(){var n=this.courses.get(this.courseSelector.getSelected());this.courses.term&&n.set("term",this.courses.term.id);n.fetch({success:this.onFetchCourseSuccess,error:this.fetchError})},fetchTopics:function(n){var i=this.courses.get(n.id),r=n.get("subjectId"),u=this.subjects.find(function(n){return n.id===r}),t=this.getAttrPair();this.topics.attribute=t.attribute;this.topics.attributeValues=t.attributeValues;this.topicSelector.startSpinner();this.topics.setSubject(u);this.topics.setCourseNumber(i);this.topics.fetch({success:this.onFetchTopicsSuccess,error:this.fetchError})},onFetchAttributesSuccess:function(n){var t,i;Scheduler.Config.courseSettings.additionalAttributes.length?(t=_.filter(n.toTemplate(),function(n){return!_.contains(Scheduler.Config.courseSettings.additionalAttributes,n.value)}),i=_.filter(this.collection.toTemplate(),function(n){return _.contains(Scheduler.Config.courseSettings.additionalAttributes,n.value)}),this.attributeCollection.reset(t),this.additionalCollection.reset(i)):this.attributeCollection.reset(this.collection.models);this.attrSelector.stopSpinner()},onFetchSubjectsSuccess:function(){this.subjectSelector.stopSpinner()},onFetchCoursesSuccess:function(){this.courseSelector.stopSpinner()},onFetchCourseSuccess:function(n){this.courseInfo.model=n;this.courseInfo.render();n.hasTopics()?this.fetchTopics(n):this.hideTopicSelector(!0)},onFetchTopicsSuccess:function(){this.topicSelector.stopSpinner();this.topics.models.length?(this.$(".topic-group").show(),this.topicSelector.enable()):this.hideTopicSelector(!1)},fetchError:function(n,t){this.attrSelector.stopSpinner();this.subjectSelector.stopSpinner();this.courseSelector.stopSpinner();this.topicSelector.stopSpinner();Scheduler.AppView.showError(t);Scheduler.AppView.stopSpinner()},hideTopicSelector:function(n){this.topicSelector.disable();this.topicSelector.clearSelected();this.$(".topic-group").hide();n&&(this.topics.reset([]),this.topics.setSubject(null),this.topics.setCourseNumber(null),this.topics.attribute=null,this.topics.attributevalues=null)},onSuccess:function(n){var t="Added "+n.displayName();n.get("addedMessage")&&(t+=" <br />"+n.get("addedMessage"));Scheduler.AppView.showSuccessAlert(t);this.opts.coursesCollection.add(n)},onError:function(n,t){Scheduler.AppView.showError(t)},invalidAlert:function(n){Scheduler.AppView.showDangerAlert("Please see the following errors",n)},getAttrPair:function(){var t=[],n=[],i;switch(Scheduler.Config.courseSettings.attributeMode){case SchedulerLib.AttributeModes.Combined:t=n=this.getSelectedAttributes(this.attrSelector);break;case SchedulerLib.AttributeModes.Dual:t=this.getSelectedAttributes(this.attrSelector);n=this.getSelectedAttributes(this.attrValueSelector);break;case SchedulerLib.AttributeModes.Single:n=this.getSelectedAttributes(this.attrSelector)}return this.additionalSelector&&this.additionalSelector.getSelected()&&(i=this.getSelectedAttributes(this.additionalSelector),_.each(i,function(t){n.push(t)})),{attribute:t.length===1?t[0]:null,attributeValues:n}},getSelectedAttributes:function(n){var r=this.collection,t=n.getSelected(),i=[];return t&&(_.isArray(t)?_.each(t,function(n){i.push(r.get(n))}):i.push(r.get(t))),i},remove:function(){this.courseInfo&&this.courseInfo.remove();Backbone.View.prototype.remove.apply(this,arguments)}});Scheduler.Views.ByCourseNumberGrid=Backbone.View.extend({template:JST["course/by-course-number-grid"],tagName:"table",className:"by-course-number-grid table fixed",events:{"click .btn-add":"add","click .btn-view-topics":"showTopics","click .btn-course-info":"showCourseInfo"},initialize:function(){_.bindAll(this,"render","renderTemplate","showTopics");this.courseInfoItems=[];this.render()},render:function(){return this.renderTemplate(),this},renderTemplate:function(){this.$el.html(this.template({resultCourses:this.collection.toTemplate()}))},add:_.debounce(function(n){var i=this.getCourseFromRow(n),t,r;if(i){if(t=_.clone(i.attributes),t.id=null,t.term=Scheduler.Data.CurrentTerm.id,t.title=i.get("title"),Scheduler.Data.Courses.doesCourseExist(t.subjectId,t.number,t.topic))return this.invalidAlert(["The course "+t.title+" is already in your list."]),!1;r=new Scheduler.Models.DesiredCourse;r.save(t,{wait:!0,success:this.onSuccess,error:this.onError})}else Scheduler.AppView.showDangerAlert("Please select a Course");return!1},250,!0),showTopics:function(n){var i=this.getCourseFromRow(n),t=new Scheduler.Collections.Courses;return t.push(i),this.topicModal=new Scheduler.Views.CourseByCourseNumberTopicModal({collection:t,term:Scheduler.Data.CurrentTerm.id}),this.topicModal.show(),!1},invalidAlert:function(n){Scheduler.AppView.showDangerAlert("Please see the following errors",n)},onSuccess:function(n){Scheduler.AppView.showSuccessAlert("Added "+n.displayName());Scheduler.Data.Courses.add(n)},onError:function(n,t){Scheduler.AppView.showError(t)},getCourseFromRow:function(n){var t=this.getCourseIdFromRow(n);return this.collection.get(t)},getCourseIdFromRow:function(n){var t=this.$(n.currentTarget||n).closest(".course-by-course-number-item");return t.data("id").toString()},showCourseInfo:function(n){var t=this.getCourseFromRow(n),i=this.findCourseInfoItem(t);return i?this.removeCourseInfoItem(i):this.addCourseInfoItem(n,t),!1},addCourseInfoItem:function(n,t){var r=$(n.currentTarget).closest(".course-by-course-number-item"),i=new Scheduler.Views.CourseByNumberInfoItem({model:t});i.$el.children("td, th").wrapInner('<div style="display: none;" />').parent().insertAfter(r).find("td > div").slideDown(function(){$(this).replaceWith($(this).contents())});this.courseInfoItems.push(i)},removeCourseInfoItem:function(n){this.courseInfoItems=_.without(this.courseInfoItems,n);n.$el.tableRowRemove(function(){n.remove()})},findCourseInfoItem:function(n){return _.find(this.courseInfoItems,function(t){return t.model.cid===n.cid})}});Scheduler.Views.CourseByCourseNumberTopicModal=Scheduler.Views.BaseModal.extend({id:"my-planner-topics-modal",attributes:{tabindex:"-1",role:"dialog","aria-hidden":"true","aria-labelledby":"event","data-keyboard":"false","data-backdrop":"static"},titlePath:"course/by-course-number-modal-title",bodyPath:"course/by-course-number-modal-body",events:function(){return _.extend({},Scheduler.Views.BaseModal.prototype.events,{"click .btn-mp-save-topics":"saveCoursesWithTopics"})},initialize:function(n){_.bindAll(this,"render","renderTemplate","renderDropDowns","renderDropDown");n.term&&(this.term=n.term);n.size="lg";this.topics=new Scheduler.Collections.Topics;Scheduler.Views.BaseModal.prototype.initialize.apply(this,[n]);this.render()},render:function(){return this.renderTemplate(),setTimeout(this.renderDropDowns,500),this},renderTemplate:function(){this.$el.html(this.template({titlePath:this.titlePath,bodyPath:this.bodyPath,courses:this.collection.toTemplate()}))},renderDropDowns:function(){this.collection.each(this.renderDropDown)},renderDropDown:function(n){var i=n.cid,t=new Scheduler.Collections.Topics({},{term:{id:this.term},subject:{id:n.get("subjectId")},course:n});t.fetch({success:_.bind(function(n){this.$("#ddltopics"+i).select2({placeholder:"Select Topic",data:{results:t.toTemplate(),text:"title"},formatSelection:function(n){return n.title},formatResult:function(n){return n.title}}).on("select2-open",this.applyMobileHeaderAbsolute).on("select2-close",this.applyMobileHeaderFixed);this.topics.add(n.models)},this)})},saveCoursesWithTopics:function(){var s=this.$("input.topic-ddls"),r=[],u=[],f=[],n=[],t=0,i,e,o=this.invalidAlert,h=_.bind(function(i){Scheduler.Data.Courses.add(i);r.push(i.get("subjectShort")+" "+i.get("number"));t++;t===n.length&&this.showFeedback(r,f)},this),c=_.bind(function(i,u){f.push(u);t++;t===n.length&&this.showFeedback(r,f)},this);return($.each(s,_.bind(function(t,r){var c=this.$(r),s=c.select2("val"),l=c.data("course"),f=this.collection.get(l),h;s||(i="Please select a topic for each course.",o([i]),e=!0);h=this.topics.get(s);Scheduler.Data.Courses.doesCourseExist(f.get("subjectId"),f.get("number"),s)||h&&h.get("alreadyDesire")?u.push(f.get("subjectShort")+" "+f.get("number")):n.push({course:f,topicId:s})},this)),e)?!1:(_.each(n,function(n){var i=new Scheduler.Models.DesiredCourse,t=_.clone(n.course.attributes);t.id=null;t.term=Scheduler.Data.CurrentTerm.id;t.topic=n.topicId;i.save(t,{success:h,error:c,wait:!0})}),u.length&&(i="The following courses have been added already: "+u.join(", "),o([i])),!1)},showFeedback:function(n,t){if(n.length){var i="Added the following courses: "+n.join(", ");Scheduler.AppView.showSuccessAlert(i)}t.length&&Scheduler.AppView.showErrorList(t)},invalidAlert:function(n){Scheduler.AppView.showDangerAlert("Please see the following errors",n)},applyMobileHeaderAbsolute:function(){Modernizr.touch&&$("#header .navbar-fixed-top").addClass("fixfixed")},applyMobileHeaderFixed:function(){Modernizr.touch&&$("#header .navbar-fixed-top").removeClass("fixfixed")},remove:function(){this.$("input.topic-ddls").select2("destroy");Backbone.View.prototype.remove.call(this)}});Scheduler.Views.CourseByCourseNumber=Scheduler.Views.CourseAddTab.extend({template:JST["course/by-course-number"],className:"course-by-course-number form-horizontal col-md-12",events:{"click .btn-search":"search","click .btn-cancel":"back","click .page":"showPage","click .previous":"prevPage","click .next":"nextPage"},initialize:function(){_.bindAll(this,"render","renderTemplate","renderPager","search","fetchCourses","onFetchCoursesSuccess","togglePagerVisibility","fetchError","showCourseSelector","hideCourseSelector");this.currentPage=1;this.pageSize=10;var n=Scheduler.Data.CurrentTerm;this.courses=new Scheduler.Collections.Courses([],{term:n});this.render()},render:function(){return this.renderTemplate(),setTimeout(this.renderSelect2,0),this},renderTemplate:function(){this.$el.html(this.template());this.togglePagerVisibility(!1)},renderSelect2:function(){this.$("#filter-selector").select2({data:[{id:"con",text:"contains"},{id:"gte",text:"greater than or equal to"},{id:"ie",text:"is exactly"},{id:"ltg",text:"less than or equal to"}]}).on("select2-open",this.applyMobileHeaderAbsolute).on("select2-close",this.applyMobileHeaderFixed);this.$("#filter-selector").select2("val","con")},search:function(){return this.currentPage=1,this.fetchCourses(),!1},renderGrid:function(){var n=(this.currentPage-1)*this.pageSize,t=this.courses.slice(n,n+this.pageSize),i=new Scheduler.Collections.Courses(t),r=new Scheduler.Collections.Courses(this.courses);this.byCourseNumberGrid=new Scheduler.Views.ByCourseNumberGrid({collection:i,allCollection:r,pageSize:this.pageSize});this.$el.find(".by-course-number-result").html(this.byCourseNumberGrid.el)},renderPager:function(){var n=this.getPages(),t=JST["course/by-course-number-pager"]({pages:n,isFirstPage:this.currentPage===1,isLastPage:this.currentPage===this.getTotalPages()});this.$(".pager-container").html(t);this.togglePagerVisibility(n.length>1)},getPages:function(){var n=this.getTotalPages(),i=n>=5?5:n,t=Math.ceil(i/2)-1,o=i-t-1,r,e=[],u,f=0;for(this.currentPage+o>n&&(t=i-(n-this.currentPage)-1),this.currentPage-t<1&&(t=this.currentPage-1),r=this.currentPage-t;f<i&&f<n;)u={number:r},r===this.currentPage&&(u.active=!0),e.push(u),r++,f++;return e},getTotalPages:function(){return Math.ceil(this.courses.length/this.pageSize)},showPage:function(n){var t=this.$(n.currentTarget).data("page");return this.currentPage===t?!1:(this.currentPage=t,this.changePage(),!1)},prevPage:function(){return this.currentPage-1<1?!1:(this.currentPage--,this.changePage(),!1)},nextPage:function(){return this.currentPage+1>this.getTotalPages()?!1:(this.currentPage++,this.changePage(),!1)},changePage:function(){this.renderGrid();this.renderPager()},fetchCourses:function(){var n=this.$("#filter-selector").select2("val"),t=this.$("#course-number-selector").val();return this.doSearch(n,t)},doSearch:function(n,t){if(_.isEmpty(n)||_.isEmpty(t))return this.invalidAlert(["Please select a filter and course number"]),!1;if(!/^[a-zA-Z0-9\s'.]{1,40}$/.test(t))return this.invalidAlert(["Course number can only be letters & numbers."]),!1;this.courses=new Scheduler.Collections.Courses([],{term:Scheduler.Data.CurrentTerm});this.courses.setFilterType(n);this.courses.setCourseNoSearch(t);this.courses.fetch({success:this.onFetchCoursesSuccess,error:this.fetchError})},onFetchCoursesSuccess:function(){this.showCourseSelector();this.renderGrid();this.renderPager()},fetchError:function(n,t){this.$("#course-number-selector").stopSelect2Spinner();Scheduler.AppView.showError(t)},togglePagerVisibility:function(n){var t=this.$(".pager-container");n?t.show():t.hide()},showCourseSelector:function(){this.$("#course-number-selector-grid").show()},hideCourseSelector:function(){this.$("#course-number-selector-grid").hide()},applyMobileHeaderAbsolute:function(){Modernizr.touch&&$("#header .navbar-fixed-top").addClass("fixfixed")},applyMobileHeaderFixed:function(){Modernizr.touch&&$("#header .navbar-fixed-top").removeClass("fixfixed")},invalidAlert:function(n){Scheduler.AppView.showDangerAlert("Please see the following errors",n)},back:function(){return Scheduler.AppView.backToMain(Scheduler.AppView.CoursesView,"courses","slide-from-right",this),!1},remove:function(){Backbone.View.prototype.remove.apply(this,arguments)}});Scheduler.Views.CourseBySectionAttribute=Scheduler.Views.CourseByAttribute.extend({collectionType:"SectionAttributes",initialize:function(n){n=n||{};Scheduler.Views.CourseByAttribute.prototype.initialize.apply(this,[n])},addByCourse:function(n,t){if(n){var u=this.courses.get(n),s=this.getFilterValues(),o=[{type:"sectionAttributes",values:s,excluded:!1}],r,i,e,f;e=Scheduler.Data.Courses.doesCourseExist(u.get("subjectId"),u.get("number"),u.get("topic"));e?(i=e,r={isLocked:!1,filterRules:o},i.get("isLocked")&&(f=i.fullSubject()+" is locked. Adding "+i.fullSubject()+" will remove the locked class and pre-select selected sections."),i.get("filterRules")&&i.get("filterRules").length&&(f=i.fullSubject()+" already exists in your course list. Adding "+i.fullSubject()+" will clear any options you have previously selected.")):(r=_.clone(u.attributes),r.id=null,r.term=Scheduler.Data.CurrentTerm.id,r.topic=t,r.filterRules=o,i=new Scheduler.Models.DesiredCourse);f?SchedulerHelpers.confirmBox(f,_.bind(function(n){n&&i.save(r,{wait:!0,success:this.onSuccess,error:this.onError})},this)):i.save(r,{wait:!0,success:this.onSuccess,error:this.onError})}else Scheduler.AppView.showDangerAlert("Please select a Course.")},getFilterValues:function(){var n=this.getSelectedAttributes(this.attrSelector),t=[],i;switch(Scheduler.Config.courseSettings.attributeMode){case SchedulerLib.AttributeModes.Dual:n=this.getSelectedAttributes(this.attrValueSelector);n.length?_.each(n,function(n){t.push(JSON.stringify({attr:n.get("attr"),value:n.get("value")}))}):t=this.getAllAttrValues();break;case SchedulerLib.AttributeModes.Combined:_.each(n,function(n){t.push(JSON.stringify({attr:n.get("attr"),value:n.get("value")}))});break;case SchedulerLib.AttributeModes.Single:_.each(n,function(n){t.push(JSON.stringify({attr:null,value:n.get("value")}))})}return this.additionalSelector&&this.additionalSelector.getSelected()&&(n=this.getSelectedAttributes(this.additionalSelector),_.each(n,function(n){i=Scheduler.Config.courseSettings.attributeMode===SchedulerLib.AttributeModes.Single?"":n.get("attr");t.push(JSON.stringify({attr:i,value:n.get("value")}))})),t},getAllAttrValues:function(){var n=[],t;return this.attributeValueCollection.each(function(i){t={attr:i.get("attr"),value:i.get("value")};n.push(JSON.stringify(t))}),n}});Scheduler.Views.CourseBySubject=Scheduler.Views.CourseAddTab.extend({template:JST["course/by-subject"],className:"course-by-subject col-xs-12",events:{"click .btn-add":"add","click .btn-cancel":"back"},initialize:function(n){_.bindAll(this,"render","renderTemplate","fetchCourses","fetchCourse","onFetchSubjectsSuccess","onFetchCoursesSuccess","onFetchCourseSuccess","onFetchTopicsSuccess","fetchError","subjectResults","courseResults","topicResults","renderSelect2","onAddAllSuccess","onSuccess","onError","hideTopicSelector");this.opts=_.defaults(n||{},{targetCourseModelType:Scheduler.Models.DesiredCourse,coursesCollection:Scheduler.Data.Courses,term:Scheduler.Data.CurrentTerm,filterTerm:Scheduler.Data.CurrentTerm,collectionsNamespace:Scheduler.Collections});var t=this.opts.filterTerm;this.subjects=new this.opts.collectionsNamespace.Subjects([],{term:t});this.courses=new this.opts.collectionsNamespace.Courses([],{term:t});this.topics=new this.opts.collectionsNamespace.Topics([],{term:t});this.render()},_loadData:function(){this.subjects.fetch({success:this.onFetchSubjectsSuccess,error:this.fetchError})},render:function(){return this.renderTemplate(),this.courseInfo=new Scheduler.Views.CourseInfo,this.$el.find(".course-info-row").html(this.courseInfo.el),this.$(".topic-group").hide(),setTimeout(this.renderSelect2,0),this},renderTemplate:function(){this.$el.html(this.template({subjectLabel:Scheduler.Config.text.subject,courseLabel:Scheduler.Config.text.course,topicsLabel:Scheduler.Config.text.topics}))},renderSelect2:function(){this.$("#subject-selector").select2({placeholder:"Select "+Scheduler.Config.text.subject,data:this.subjectResults,formatSelection:function(n){return n.title},formatResult:function(n){return n.title},minimumResultsForSearch:15}).on("change",this.fetchCourses).on("select2-open",this.applyMobileHeaderAbsolute).on("select2-close",this.applyMobileHeaderFixed).on("select2-selecting",_.bind(function(){setTimeout(_.bind(function(){this.$el.find("#course-selector").select2("focus")},this),0)},this));this.$("#subject-selector").startSelect2Spinner();this.$("#course-selector").select2({placeholder:"Select "+Scheduler.Config.text.course,data:this.courseResults,formatSelection:function(n){return n.displayTitle},formatResult:function(n){return n.displayTitle},minimumResultsForSearch:15}).on("change",this.fetchCourse).on("select2-open",this.applyMobileHeaderAbsolute).on("select2-close",this.applyMobileHeaderFixed).on("select2-selecting",_.bind(function(){setTimeout(_.bind(function(){this.$el.find(".btn-add").focus()},this),0)},this));this.$("#topic-selector").select2({placeholder:"Select Topic",data:this.topicResults,formatSelection:function(n){return n.title},formatResult:function(n){return n.title},minimumResultsForSearch:15}).on("select2-open",this.applyMobileHeaderAbsolute).on("select2-close",this.applyMobileHeaderFixed).on("select2-selecting",_.bind(function(){setTimeout(_.bind(function(){this.$el.find(".btn-add").focus()},this),0)},this));this.$("#course-selector").select2("enable",!1);this.$("#topic-selector").select2("enable",!1)},fetchCourses:function(n){this.$("#course-selector").select2("val","");this.$("#course-selector").select2("enable",!0);this.hideTopicSelector(!0);this.courseInfo=new Scheduler.Views.CourseInfo;this.$el.find(".course-info-row").html(this.courseInfo.el);var t=this.subjects.get(n.val);this.courses.setSubject(t);this.$("#course-selector").startSelect2Spinner();this.courses.fetch({success:this.onFetchCoursesSuccess,error:this.fetchError})},fetchCourse:function(n){var t=this.courses.get(n.val);t.id==="ALL"?(this.courseInfo.clear(),this.hideTopicSelector(!0)):(this.courses.term&&t.set("term",this.courses.term.id),t.fetch({success:this.onFetchCourseSuccess,error:this.fetchError}))},onFetchSubjectsSuccess:function(){this.$("#subject-selector").stopSelect2Spinner()},onFetchCoursesSuccess:function(n){if(Scheduler.Config.courseSettings.showAddAllBySubject){var t=this.$("#subject-selector").select2("val"),i=this.subjects.get(t),r=new Scheduler.Models.Course({id:"ALL",number:"ALL",displayTitle:"Select All Courses",subjectId:t,subjectShort:i.get("short")});n.add(r,{at:0})}this.$("#course-selector").stopSelect2Spinner()},onFetchCourseSuccess:function(n){this.$("#course-selector").stopSelect2Spinner();this.courseInfo.model=n;this.courseInfo.render();n.hasTopics()?this.fetchTopics(n):this.hideTopicSelector(!0)},fetchTopics:function(n){var t=this.courses.get(n.id),i=n.get("subjectId"),r=this.subjects.find(function(n){return n.id===i});this.topics.setSubject(r);this.topics.setCourseNumber(t);this.$("#topic-selector").startSelect2Spinner();this.topics.fetch({success:this.onFetchTopicsSuccess,error:this.fetchError})},onFetchTopicsSuccess:function(){this.$("#topic-selector").stopSelect2Spinner();this.topics.models.length?(this.$(".topic-group").show(),this.$("#topic-selector").select2("enable",!0)):this.hideTopicSelector(!1)},fetchError:function(n,t){this.$("#subject-selector").stopSelect2Spinner();this.$("#course-selector").stopSelect2Spinner();this.$("#topic-selector").stopSelect2Spinner();Scheduler.AppView.showError(t)},hideTopicSelector:function(n){this.$("#topic-selector").select2("enable",!1);this.$("#topic-selector").select2("val","");this.$(".topic-group").hide();n&&(this.topics=new Scheduler.Collections.Topics([],{term:this.opts.term}))},applyMobileHeaderAbsolute:function(){Modernizr.touch&&$("#header .navbar-fixed-top").addClass("fixfixed")},applyMobileHeaderFixed:function(){Modernizr.touch&&$("#header .navbar-fixed-top").removeClass("fixfixed")},subjectResults:function(){return{results:this.subjects.toTemplate(),text:"title"}},courseResults:function(){return{results:this.courses.toTemplate(),text:"displayTitle"}},topicResults:function(){return{results:this.topics.toTemplate(),text:"title"}},add:_.debounce(function(){var t=this.$("#course-selector").select2("val"),n=this.$("#topic-selector").select2("val")||null;if(this.courseInfo.model&&this.courseInfo.model.hasTopics()&&!n){Scheduler.AppView.showDangerAlert("You must select a subject, course and topic.");return}return this.addByCourseAndTopic(t,n)},250,!0),addByCourseAndTopic:function(n,t){var u,i,r;if(n)if(u=this.courses.get(n),i=_.clone(u.attributes),i.id=null,i.term=Scheduler.Data.CurrentTerm.id,i.topic=t,r=new Scheduler.Models.DesiredCourse,n==="ALL")r.addBySubject(i,{wait:!0,success:this.onAddAllSuccess,error:this.onError});else{if(Scheduler.Data.Courses.doesCourseExist(i.subjectId,i.number,i.topic))return this.invalidAlert(["The course "+i.title+" is already in your list."]),!1;r.save(i,{wait:!0,success:this.onSuccess,error:this.onError})}else Scheduler.AppView.showDangerAlert("Please select a Course");return!1},onAddAllSuccess:function(n,t){var u=this.$("#subject-selector").select2("val"),i=this.subjects.get(u),r;t.message?(r="All possible courses in subject "+i.get("title")+" have "+(t.added.length?"":"already")+" been added. "+t.message,Scheduler.AppView.showSuccessAlert(r)):t.added.length===0?Scheduler.AppView.showSuccessAlert("All courses in subject "+i.get("title")+" have already been added."):Scheduler.AppView.showSuccessAlert("Added all courses in subject "+i.get("title"));Scheduler.Data.Courses.add(t.added)},onSuccess:function(n){var t="Added "+n.displayName();n.get("addedMessage")&&(t+=" <br />"+n.get("addedMessage"));Scheduler.AppView.showSuccessAlert(t);this.opts.coursesCollection.add(n)},onError:function(n,t){Scheduler.AppView.showError(t)},invalidAlert:function(n){Scheduler.AppView.showDangerAlert("Please see the following errors",n)},back:function(){return Scheduler.AppView.backToMain(Scheduler.AppView.CoursesView,"courses","slide-from-right",this),!1},remove:function(){this.courseInfo.remove();Backbone.View.prototype.remove.apply(this,arguments)}});Scheduler.Views.CourseDetailAdvancedFilter=Backbone.View.extend({template:JST["course/detail-advanced-filter"],className:"advanced-filter panel panel-primary top10 bottom0 hidden-options visible-acc",events:{"click .btn-save":"save","click .btn-close-advance-filters":"closeAndCancel"},initialize:function(){_.bindAll(this,"onFilterChange","save","saveSuccess","saveError");this.selectors=[];this.filterRules=_.reject(JSON.parse(JSON.stringify(this.model.get("filterRules"))),function(n){return n.type==="registrationNumber"||n.type==="optionalRegistrationNumber"});this.render()},render:function(){return this.renderTemplate(),this.selectors=[],_.each(Scheduler.Config.courseSettings.advancedFilterOptions,_.bind(function(n){var a=_.findWhere(this.filterRules,{type:n})||[],o="All "+Scheduler.Config.sectionFieldText[n]+" Selected",s=!0,h=!1,t,i,r,c,u,l,f,e;switch(n){case"hasCorequisites":e=Scheduler.Config.sectionFieldText.corequisitesPlural;o="All Selected";i=[{id:"true",text:"With "+e,value:!0},{id:"false",text:"Without "+e,value:!1}];s=!1;h=!0;r="text";break;case"instructor":r="name";u="name";f="name";break;case"sectionAttributes":u="id";f=function(n){return Scheduler.Config.courseSettings.attributeMode===SchedulerLib.AttributeModes.Single?n.value:n.attr+"-"+n.value};c=function(n){return n.attrTitle?n.attrTitle+"-"+n.valueTitle:n.valueTitle}}i=i||this.collection.getUniqueFieldData(n,u);l=this.getFieldIds(a,f);t=new Scheduler.Views.Select({id:n+"-selector",placeholder:o,dataText:r,format:c,collection:i,multiple:s,allowClear:h,data:{type:n},preselectedIds:l});this.listenTo(t,"selection:change",this.onFilterChange);this.$el.find("."+n+"-selector-container").html(t.el);this.selectors.push(t)},this)),this},renderTemplate:function(){this.$el.html(this.template({}))},renderDisabledCountAlert:function(n){var t,i,r;t=Scheduler.Config.courseSettings.enableFilterRules?n===1?"class":"classes":n===1?"option":"options";i=n?"Your advanced filters have disabled "+n+" "+t:"Your advanced filters have not disabled any "+t;r=SchedulerHelpers.createAlert("warning",{hash:{icon:"info",text:i}});this.$el.find(".disabled-count-alert").html(r.string)},getFieldIds:function(n,t){if(t){var i=_.map(n.values,function(n){var i=JSON.parse(n);return _.isFunction(t)?t(i):i[t]});return _.flatten(i)}return n.values&&n.values.length?n.values:n.value!==null&&n.value!==undefined?[n.value]:[]},onFilterChange:function(n,t){var u=this.findFilterByType(t.data.type),i=[],f=n.added||n.removed,r,e=!1;switch(t.data.type){case"hasCorequisites":e=!0;i.push("value");break;case"instructor":i.push("name");break;case"sectionAttributes":i.push("attr");i.push("value")}e?(r=i.length?f[i[0]]:f,u.value=n.added?r.toString():null):(r=i.length?JSON.stringify(_.pick(f,i)):f,n.added?u.values.push(r):u.values=_.reject(u.values,function(n){return n===r}));this.trigger("change:filters",this.filterRules)},remove:function(){_.each(this.selectors,function(n){n.remove()});Backbone.View.prototype.remove.apply(this,arguments)},findFilterByType:function(n){var t=_.findWhere(this.filterRules,{type:n});return t||(t={type:n,values:[],excluded:!1},this.filterRules.push(t)),t},save:function(){this.showSpinner();this.model.setFilter(this.filterRules);this.model.save({},{success:this.saveSuccess,error:this.saveError})},saveSuccess:function(){this.hideSpinner();Scheduler.AppView.showSuccessAlert("Filters saved.");this.close()},saveError:function(n,t){this.hideSpinner();Scheduler.AppView.showError(t)},showSpinner:function(){this.$(".btn-save i").removeClass("glyphicons").addClass("fa fa-spinner fa-spin")},hideSpinner:function(){this.$(".btn-save i").addClass("glyphicons").removeClass("fa fa-spinner fa-spin")},show:function(){this.$el.slideDown(_.bind(function(){this.$el.removeClass("hidden-options")},this))},closeAndCancel:function(){this.close();this.trigger("cancel")},close:function(){this.trigger("close");this.$el.slideUp(_.bind(function(){this.$el.addClass("hidden-options")},this))},getActiveFilterCount:function(){var t=0,n;return _.each(this.selectors,function(i){n=i.getSelected();n&&n.length&&t++}),t}});Scheduler.Views.CourseDetailFilter=Backbone.View.extend({template:JST["course/detail-filter"],className:"course-detail-filter row",events:{"click .nav-pills li a":"selectGridMode","keyup .input-search":"applyTextFilter"},initialize:function(n){this.options=_.defaults(n,{includeSearch:!0,supportSections:!0,defaultGridMode:"regblocks"});this.regBlocks=n.regBlocks;this.listenTo(this.model,"filtered",this.updateFilteredCount)},render:function(){return this.renderTemplate(),this.selectGridMode(),this},renderTemplate:function(){var n=this.calculateComponents();this.$el.html(this.template({includeSearch:this.options.includeSearch,supportSections:this.options.supportSections&&n.length>1,regblocksText:"Linked",sectionsText:"Unlinked"}))},selectGridMode:function(n){var t=this.options.defaultGridMode;n&&n.target&&(t=$(n.target).closest("li").data("mode"));this.$(".nav-pills li").removeClass("active");this.$('.nav-pills li[data-mode="'+t+'"]').addClass("active");this.model.set("gridMode",t)},applyTextFilter:_.debounce(function(n){var t=$(n.target).val();this.model.get("query")!=t&&(this.$(".search-filter-results").html('<i class="fa fa-spinner fa-spin"><\/i>'),this.model.set("query",t))},300),updateFilteredCount:function(n){var t="";n.original!=n.current&&(t="Found "+n.current+" of "+n.original);this.$(".search-filter-results").text(t)},calculateComponents:function(){return _.chain(this.regBlocks.sections.pluck("component")).unique().sort().map(function(n){return{type:n,name:n}}).value()}});Scheduler.Views.CourseDetail=Backbone.View.extend({template:JST["course/detail"],id:"course-detail",className:"row",events:{"click .btn-cancel":"backToCourses","click a.enabled-sections-tab":"enabledTabClick","click a.disabled-sections-tab":"disabledTabClick","click .btn-course-save":"saveSettings","click .page":"showPage","click .previous":"prevPage","click .next":"nextPage","click .btn-advanced-filters":"showAdvancedFilters"},initialize:function(n){var t=[],i=Scheduler.Config.courseSettings.enableFilterRules;this.options=_.defaults(n,{supportSections:!0,defaultGridMode:i?"sections":"regblocks",showDisabled:!1,regBlockPageSize:10,sectionPageSize:100});this.showEnabled=!n.showDisabled;_.bindAll(this,"render","renderTemplate","renderGrid","renderPager","refreshRegBlocks","fetchError","saveSettings","selectedSectionsSuccess","selectedSectionsError","enabledTabClick","disabledTabClick","updateSelectedSections","sectionsUpdated","showAdvancedFiltersButton","onSectionCheckChanged","setFilterIndicator","applyFilterRules");this.currentPage=1;this.showSectionsGrid=this.options.defaultGridMode==="sections";this.pageSize=this.options[this.showSectionsGrid?"sectionPageSize":"regBlockPageSize"];this.regBlocks=new Scheduler.Collections.RegistrationBlocks(null,{term:Scheduler.Data.CurrentTerm,subjectId:this.model.get("subjectId"),course:this.model});this.filterRules=_.reject(JSON.parse(JSON.stringify(this.model.get("filterRules")||"[]")),function(n){return n.type==="registrationNumber"||n.type==="optionalRegistrationNumber"});this.listenTo(this.regBlocks,"change:selected",this.renderTabs);Scheduler.AppView.startSpinner();i&&this.listenTo(this.regBlocks.sections,"change:selected",this.renderTabs);t.push(this.regBlocks.fetch({error:this.fetchError}));$.when.apply($,t).then(this.render)},render:function(){if(Scheduler.AppView.stopSpinner(),this.options.sectionId){var n=this.options.sectionId,t,i=new Scheduler.Collections.RegistrationBlocks(this.getFilteredRegBlocks()),r=i.filter(function(t){return _.contains(t.get("sectionIds"),n)||_.contains(t.get("optionalSectionIds"),n)});r.length&&(t=i.indexOf(r[0])+1,this.currentPage=Math.ceil(t/this.pageSize))}return this.updateSelectedSections(),this.renderTemplate(),Scheduler.Config.courseSettings.advancedFilterOptions.length&&(this.renderAdvancedFilters(),this.applyFilterIndicator(),this.advancedFilterPane.renderDisabledCountAlert(this.calculateDisabledByRulesCount())),this.renderGrid(),this},renderTemplate:function(){var i=this.getFilteredGridSource().length,r=this.getPages(this.getTotalPages()),n="courses/"+this.model.id,t=this.getFilteredGridSource(!0);this.$el.html(this.template({course:this.model.toTemplate(),term:Scheduler.Data.CurrentTerm.toTemplate(),enabledSelectedCount:_.filter(t,function(n){return n.get("selected")}).length,enabledTotalCount:t.length,disableBlocksCount:this.getDisabledBlockCount(),optionsInstructions:Scheduler.Config.courseSettings.optionsInstructions,title:this.getTitle(this.model),subTitle:this.getSubTitle(this.model),showEnabled:this.getShowEnabled(),pages:r,isFirstPage:this.currentPage===1,isLastPage:this.currentPage===this.getTotalPages(),showPager:i&&this.getTotalPages()>1,enabledLabel:Scheduler.Config.courseSettings.enabledLabel,disabledLabel:Scheduler.Config.courseSettings.disabledLabel,enabledUrl:n,disableUrl:n+"/disabled",optionalMessages:this.model.get("optionMessages")}))},renderGrid:function(){this.showSectionsGrid?(this.renderSectionGrid(),this.renderMatchingRegBlockCounts()):this.renderRegBlockGrid()},renderAdvancedFilters:function(){this.advancedFilterPane?this.advancedFilterPane.render():(this.advancedFilterPane=new Scheduler.Views.CourseDetailAdvancedFilter({collection:this.regBlocks.sections,model:this.model}),this.$el.find(".advanced-filtering-row").html(this.advancedFilterPane.el),this.listenTo(this.advancedFilterPane,"close",this.showAdvancedFiltersButton),this.listenTo(this.advancedFilterPane,"cancel",this.rollbackFiltersAndRender),this.listenTo(this.advancedFilterPane,"change:filters",this.updateFilters),Scheduler.Config.courseSettings.forceAdvancedFilterRefresh&&this.listenTo(this.advancedFilterPane,"close",this.refreshRegBlocks))},refreshRegBlocks:function(){var n=this;this.regBlocks.fetch({error:this.fetchError}).done(function(){n.renderTabs();n.renderGrid()})},renderSectionGrid:function(){var n=this.getShowEnabled(),t=(this.currentPage-1)*this.pageSize,i=this.getFilteredSections(),f=i.slice(t,t+this.pageSize),r=new Scheduler.Collections.Sections(f),e=new Scheduler.Collections.Sections(i),u;u=this.getDisabledBlockCount()?Scheduler.Config.courseSettings.allOptionsDisabledText:"There are no courses available with the options selected.";this.$el.find(".detail-regblock-grid-container").hide();this.$el.find(".detail-section-grid-container").show();this.sectionGrid?(this.sectionGrid.collection=r,this.sectionGrid.showSelectCol=n,this.sectionGrid.showEmptyMessage=n,this.sectionGrid.render()):(this.sectionGrid=new Scheduler.Views.SectionGrid({collection:r,model:this.model,sectionId:this.options.sectionId,fieldSettings:Scheduler.Config.courseSectionFieldSettings,showSelectCol:n,showEmptyMessage:n,emptyMessage:u,allCollection:e,pageSize:this.pageSize}),this.$el.find(".detail-section-grid-container").append(this.sectionGrid.el),this.listenTo(this.sectionGrid,"section-changed",this.changeUrl),this.listenTo(this.sectionGrid,"section-check-changed",this.onSectionCheckChanged))},renderRegBlockGrid:function(){var n=this.getShowEnabled(),t=(this.currentPage-1)*this.pageSize,i=this.getFilteredRegBlocks(),f=i.slice(t,t+this.pageSize),r=new Scheduler.Collections.RegistrationBlocks(f,{sections:this.regBlocks.sections}),e=new Scheduler.Collections.RegistrationBlocks(i,{sections:this.regBlocks.sections}),u;u=this.getDisabledBlockCount()?Scheduler.Config.courseSettings.allOptionsDisabledText:"There are no courses available with the options selected.";this.$el.find(".detail-regblock-grid-container").show();this.$el.find(".detail-section-grid-container").hide();this.regBlockGrid?(this.regBlockGrid.collection=r,this.regBlockGrid.showSelectCol=n,this.regBlockGrid.showEmptyMessage=n,this.regBlockGrid.render()):(this.regBlockGrid=new Scheduler.Views.SectionDetailGrid({collection:r,model:this.model,sectionId:this.options.sectionId,fieldSettings:Scheduler.Config.courseSectionFieldSettings,showSelectCol:n,showEmptyMessage:n,emptyMessage:u,allCollection:e,pageSize:this.pageSize}),this.$el.find(".detail-regblock-grid-container").append(this.regBlockGrid.el),this.listenTo(this.regBlockGrid,"section-changed",this.changeUrl))},renderTabs:function(){var n=this.getFilteredGridSource(!0),i=this.template({enabledSelectedCount:_.filter(n,function(n){return n.get("selected")}).length,enabledTotalCount:n.length,disableBlocksCount:this.getDisabledBlockCount(),showEnabled:this.getShowEnabled(),enabledLabel:Scheduler.Config.courseSettings.enabledLabel,disabledLabel:Scheduler.Config.courseSettings.disabledLabel}),t=".course-detail-tabs";this.$el.find(t).replaceWith($(i).find(t))},renderPager:function(){var n=this.getPages(),t=this.getFilteredGridSource().length,i=JST["section/grid-pager"]({showPager:t&&this.getTotalPages()>1,pages:n,isFirstPage:this.currentPage===1,isLastPage:this.currentPage===this.getTotalPages()});this.$(".pager-container").html(i)},showAdvancedFiltersButton:function(){this.$el.find(".btn-advanced-filters").show()},fetchError:function(n,t){Scheduler.AppView.stopSpinner();Scheduler.AppView.showError(t)},getDisabledBlockCount:function(){return this.getFilteredGridSource(!1).length},getShowEnabled:function(){return this.showEnabled||!this.getDisabledBlockCount()},getTitle:function(n){return n.isLearningCommunity()?n.get("title"):Scheduler.Config.sectionSettings.useSubjectFormatOnOptions?n.fullSubject():n.get("subjectLong")+" "+n.get("number")},getSubTitle:function(n){return n.isLearningCommunity()?"":n.get("topicTitle")?n.get("topicTitle"):n.get("title")},getPages:function(){var n=this.getTotalPages(),i=n>=5?5:n,t=Math.ceil(i/2)-1,o=i-t-1,r,e=[],u,f=0;for(this.currentPage+o>n&&(t=i-(n-this.currentPage)-1),this.currentPage-t<1&&(t=this.currentPage-1),r=this.currentPage-t;f<i&&f<n;)u={number:r},r===this.currentPage&&(u.active=!0),e.push(u),r++,f++;return e},getTotalPages:function(){return Math.ceil(this.getFilteredGridSource().length/this.pageSize)},showPage:function(n){var t=this.$(n.currentTarget).data("page");return this.currentPage===t?!1:(this.currentPage=t,this.changePage(),!1)},prevPage:function(){return this.currentPage-1<1?!1:(this.currentPage--,this.changePage(),!1)},nextPage:function(){return this.currentPage+1>this.getTotalPages()?!1:(this.currentPage++,this.changePage(),!1)},changePage:function(){this.renderGrid();this.renderPager()},backToCourses:function(){Scheduler.AppView.backToMain(Scheduler.AppView.CoursesView,"courses","slide-from-right",this)},enabledTabClick:function(n){return this.showEnabled?!1:(this.showEnabled=!0,this.showTabAndRenderGrid(n),!1)},disabledTabClick:function(n){return this.showEnabled?(this.showEnabled=!1,this.showTabAndRenderGrid(n),!1):!1},showTabAndRenderGrid:function(n){this.currentPage=1;this.options.sectionId=null;Scheduler.AppRouter.navigateWithTerm(this.getUrl(),{replace:!0});this.$(n.currentTarget).tab("show");this.$(".detail-grid-container").fadeOut("fast",_.bind(function(){this.renderGrid();this.renderPager();this.$(".detail-grid-container").fadeIn("fast")},this))},getUrl:function(){var n="courses/"+this.model.id;return this.options.sectionId&&(n+="/section/"+this.options.sectionId),this.showEnabled||(n+="/disabled"),n},changeUrl:function(n){this.options.sectionId=n;Scheduler.AppRouter.navigateWithTerm(this.getUrl(),{replace:!0})},saveSettings:function(){return this.showSectionsGrid?this.saveSections():this.saveRegBlocks()},saveSections:function(){var n=this.regBlocks.sections.models,t=_.filter(n,function(n){return!n.get("optional")&&!n.get("selected")}),i=_.filter(n,function(n){return n.get("optional")&&n.get("selected")});this.model.setFilter([{type:"registrationNumber",values:_.pluck(t,"id"),excluded:!0},{type:"optionalRegistrationNumber",values:_.pluck(i,"id"),excluded:!1}]);this.showSpinner();this.model.save({},{success:this.selectedSectionsSuccess,error:this.selectedSectionsError})},saveRegBlocks:function(){var t=this.regBlocks.where({selected:!1,enabled:!0}),i=_.pluck(t,"id"),n=[];_.each(this.regBlocks.where({enabled:!0}),function(t){var i=_.uniq(t.get("optionalSectionIds"));_.each(i,function(i){n.push(t.get("id")+"^"+i)})});this.showSpinner();this.model.saveSelectedSections({filteredRegBlockIds:i,selectedOptionalSectionIds:n},{success:this.selectedSectionsSuccess,error:this.selectedSectionsError})},selectedSectionsSuccess:function(){this.hideSpinner();Scheduler.AppView.clearDirty();Scheduler.AppView.showSuccessAlert("Options saved.");this.model.trigger("update:options");this.backToCourses()},selectedSectionsError:function(n,t){this.hideSpinner();Scheduler.AppView.showError(t)},showSpinner:function(){this.$(".btn-course-save i").removeClass("glyphicons").addClass("fa fa-spinner fa-spin")},hideSpinner:function(){this.$(".btn-course-save i").addClass("glyphicons").removeClass("fa fa-spinner fa-spin")},remove:function(){this.sectionGrid&&this.sectionGrid.remove();this.regBlockGrid&&this.regBlockGrid.remove();this.advancedFilterPane&&this.advancedFilterPane.remove();Backbone.View.prototype.remove.apply(this,arguments)},rollbackFiltersAndRender:function(){var n=_.reject(JSON.parse(JSON.stringify(this.model.get("filterRules"))),function(n){return n.type==="registrationNumber"||n.type==="optionalRegistrationNumber"});this.advancedFilterPane.filterRules=n;this.advancedFilterPane.render();this.updateFilters(n)},updateFilters:function(n){this.showEnabled||(this.showEnabled=!this.getDisabledBlockCount());Scheduler.AppRouter.navigateWithTerm(this.getUrl(),{replace:!0});this.filterRules=n;this.renderTabs();this.currentPage=1;this.listenToOnce(this.regBlocks,"filter:non-matching-included",this.displayNonMatchingAlert);this.listenToOnce(this.regBlocks,"filter:only-matching-included",this.removeNonMatchingAlert);this.changePage();this.advancedFilterPane.renderDisabledCountAlert(this.calculateDisabledByRulesCount());this.applyFilterIndicator()},getFilteredGridSource:function(n){return this.showSectionsGrid?this.getFilteredSections(n):this.getFilteredRegBlocks(n)},getFilteredRegBlocks:function(n){var r=_.isUndefined(n)?this.getShowEnabled():n,t,i;return this.applyFilterRules()?(i=_.map(this.regBlocks.filterRegBlocksByRules(this.filterRules),function(n){return n.get("id")}),t=r?_.filter(this.regBlocks.models,function(n){return _.contains(i,n.get("id"))}):_.filter(this.regBlocks.models,function(n){return!_.contains(i,n.get("id"))})):(t=this.regBlocks.where({enabled:r}),this.removeNonMatchingAlert()),t},getFilteredSections:function(n){var i=_.isUndefined(n)?this.getShowEnabled():n,t=this.regBlocks.sections.models,r,u=function(n){return _.any(r,function(t){return _.contains(t.get("sectionIds"),n.id)})};return r=this.applyFilterRules()?this.regBlocks.filterRegBlocksByRules(this.filterRules):this.regBlocks.where({enabled:!0}),this.applyFilterRules()||this.removeNonMatchingAlert(),t=_.filter(t,function(n){return i?u(n):!u(n)}),t=_.sortBy(t,function(n){return n.get("sectionNumber")}),i||(this.model.get("isLocked")&&_.each(t,function(n){var t=n.get("disabledReasons")||[];_.contains(t,"Course is locked")||(t.push("Course is locked"),n.set("disabledReasons",t))}),_.each(t,function(n){var t=n.get("disabledReasons")||[],i=n.get("clientDisabledReasons")||[];t.length||i.length||(t.push("This section is disabled because all associated sections are also disabled."),n.set("disabledReasons",t))})),t},applyFilterRules:function(){return Scheduler.Config.courseSettings.advancedFilterOptions.length&&this.filterRules&&this.filterRules.length&&_.any(this.filterRules,function(n){return n.values&&n.values.length||n.value!==null&&n.value!==undefined})},updateSelectedSections:function(){if(Scheduler.Config.courseSettings.enableFilterRules){var n=this.regBlocks.sections.models,t=this.model.findFilterByType("registrationNumber").values,i=this.model.findFilterByType("optionalRegistrationNumber").values;_.each(n,function(n){n.get("optional")?n.set("selected",_.contains(i,n.id),{silent:!0}):n.set("selected",!_.contains(t,n.id),{silent:!0})})}},displayNonMatchingAlert:function(){if(!this.$(".non-matching-included").length){var n=SchedulerHelpers.createAlert("warning",{hash:{text:"Additional classes are displayed that may not meet your advanced filters because they are linked to classes that meet advanced filters."}}),t=$("<div />",{"class":"non-matching-included"}).html(n.string);t.insertAfter(".options-instructions")}},removeNonMatchingAlert:function(){this.$(".non-matching-included").remove()},showAdvancedFilters:function(){this.advancedFilterPane.show();this.$el.find(".btn-advanced-filters").hide()},sectionsUpdated:function(){this.renderTabs();this.renderMatchingRegBlockCounts()},onSectionCheckChanged:function(n){var i,r,u,e=this.regBlocks.sections,t,o=this.applyFilterRules(),s=this.regBlocks.filter(function(n){return n.get("enabled")&&(!o||!n.get("disabledByRule"))}),f=_.all(s,function(n){var i=n.get("sectionIds");return i.length===1?!1:_.any(i,function(n){return t=e.get(n),!t.get("selected")&&!t.get("optional")})});n&&!f?this.$(".incompatible-selection").remove():n||!f||this.$(".incompatible-selection").length||(u="All your selected classes are linked to classes that are unselected. Please select additional classes.",i=SchedulerHelpers.createAlert("danger",{hash:{text:u}}),r=$("<div />",{"class":"incompatible-selection"}).html(i.string),r.insertAfter(".options-instructions"))},calculateDisabledByRulesCount:function(){var n=this.getFilteredGridSource(!1),t;return Scheduler.Config.courseSettings.enableFilterRules?(t=this.regBlocks.where({enabled:!1}),_.filter(n,function(n){return!_.any(t,function(t){return _.contains(t.get("sectionIds"),n.get("id"))})}).length):_.filter(n,function(n){return n.get("disabledByRule")}).length},applyFilterIndicator:function(){setTimeout(this.setFilterIndicator,0)},setFilterIndicator:function(){var t=0,n=this.$(".btn-advanced-filters .badge-holder"),i=this.$(".btn-advanced-filters.btn-mobile");this.applyFilterRules()&&this.advancedFilterPane&&(t=this.advancedFilterPane.getActiveFilterCount());t?(n.addClass("badge"),n.html(t),i.find("i.fa").hide()):(n.addClass("badge"),n.empty(),i.find("i.fa").show())},renderMatchingRegBlockCounts:function(){var n=this.calculateMatchingSelectedRegBlocks();this.$(".matching-regblocks-count").text(n.length+" Matching Options Found")},calculateMatchingSelectedRegBlocks:function(){var i=this.regBlocks.where({enabled:!0}),r=this.regBlocks.sections.where({selected:!0}),n=this.regBlocks.sections.where({optional:!0,selected:!0}),t=_.pluck(r,"id");return n.length===0&&(n=this.regBlocks.sections.where({optional:!0}),t=_.union(t,_.pluck(n,"id"))),_.filter(i,function(n){return _.difference(n.get("sectionIds"),t).length===0})}});Scheduler.Views.CourseIndex=Backbone.View.extend({template:JST["course/index"],indexRowTemplate:JST["course/index-row"],className:"courses-page hidden-xs hidden-sm col-md-6",events:{"click .btn-course-add":"showCourseAdd","click .btn-course-info":"showCourseInfo","click .btn-course-remove":"confirmRemoveCourse","click .btn-remove-all":"confirmRemoveAllCourses",'click input[type="checkbox"].select-all':"selectAll",'click input[type="checkbox"].select':"selectOrDeselect","click .btn-course-options":"showCourseDetails","click .btn-locked-course":"confirmUnlock"},initialize:function(){_.bindAll(this,"render","renderTemplate","removeCourse","getCourseFromRow","onRemoveSuccess","onRemoveAllSuccess","onError","unlock","changeLockButton","updateCourseRow");this.render();this.listenTo(this.collection,"add",this.courseAdded);this.listenTo(this.collection,"remove",this.courseRemoved);this.listenTo(this.collection,"change:isLocked",this.changeLockButton);this.listenTo(this.collection,"updated:all",this.render);this.courseInfoItems=[]},render:function(){return this.renderTemplate(),Modernizr.touch||Scheduler.Accessibility||this.$('[data-toggle="tooltip"]').tooltip(),this},renderTemplate:function(){this.$el.html(this.template({courses:this.collection.toTemplate(),allSelected:this.allCoursesSelected(),coursesEmptyMessage:Scheduler.Config.courseSettings.emptyInstructions,configFlags:_.filter(Scheduler.Config.courseSettings.flags,function(n){return!n.hideOnCourse}),showSelectAllLabel:Scheduler.Config.courseSettings.showMyPlannerSelectAllLabel}))},showCourseAdd:function(){var n=new Scheduler.Views.CourseAdd({collection:this.collection});Scheduler.AppRouter.navigateWithTerm("courses/add");Scheduler.AppView.showViewWithTransition(n,"slide-from-right")},showCourseInfo:function(n){var t=this.getCourseFromRow(n),i=this.findCourseInfoItem(t);i?this.removeCourseInfoItem(i):this.addCourseInfoItem(n,t)},findCourseInfoItem:function(n){return _.find(this.courseInfoItems,function(t){return t.model.id===n.id})},addCourseInfoItem:function(n,t){var r=$(n.currentTarget).closest(".course-item"),i=new Scheduler.Views.CourseInfoItem({model:t});i.$el.children("td, th").wrapInner('<div style="display: none;" />').parent().insertAfter(r).find("td > div").slideDown(function(){$(this).replaceWith($(this).contents())});this.courseInfoItems.push(i)},confirmRemoveCourse:function(n){SchedulerHelpers.confirmBox("Remove this course?",_.bind(function(t){t&&this.removeCourse(n)},this))},confirmRemoveAllCourses:function(n){SchedulerHelpers.confirmBox("Remove all the courses?",_.bind(function(t){t&&this.removeAll(n)},this))},removeCourse:function(n){var t=this.getCourseFromRow(n);t.destroy({wait:!0,error:this.onError,success:this.onRemoveSuccess})},removeAll:function(){this.collection.destroy({error:this.onError,success:this.onRemoveAllSuccess})},onRemoveAllSuccess:function(){this.collection.reset();_.each(this.courseInfoItems,function(n){n.remove()});_.clear(this.courseInfoItems);this.render();Scheduler.AppView.showSuccessAlert("Removed all the courses")},onRemoveSuccess:function(n){Scheduler.AppView.showSuccessAlert("Removed "+n.displayName())},onError:function(n,t){Scheduler.AppView.showError(t)},invalidAlert:function(n){Scheduler.AppView.showDangerAlert("Please see the following errors",n)},selectAll:function(n){this.$(".courses-grid input.select:checkbox").prop("checked",n.currentTarget.checked);var t=[];this.$(".courses-grid input.select:checkbox").each(_.bind(function(n,i){t[n]=this.getCourseFromRow(i)},this));_.invoke(t,"set",{selected:n.currentTarget.checked})},selectOrDeselect:function(n){var t=this.getCourseFromRow(n);t.set("selected",n.currentTarget.checked);this.$(".courses-grid .select-all").prop("checked",this.allCoursesSelected())},allCoursesSelected:function(){return this.collection.selected().length===this.collection.length},showCourseDetails:function(n){var t=this.getCourseFromRow(n),i=new Scheduler.Views.CourseDetail({model:t});Scheduler.AppRouter.navigateWithTerm("courses/"+t.id);Scheduler.AppView.showViewWithTransition(i,"slide-from-right")},getCourseFromRow:function(n){var t=this.getCourseIdFromRow(n);return this.collection.get(t)},getCourseIdFromRow:function(n){var t=this.$(n.currentTarget||n).closest(".course-item");return t.data("id").toString()},courseRemoved:function(n,t){var r=this.findCourseInfoItem(n),u,i;r&&this.removeCourseInfoItem(r);i=this;u=this.$el.find(".course-item[data-id="+n.id+"]");u.tableRowRemove(function(){t.isEmpty()?i.render():i.$el.find("[data-id="+n.id+"]").remove()});this.allCoursesSelected()&&this.$(".courses-grid input.select-all:checkbox").prop("checked",!0)},courseAdded:function(n){n.set("selected",!0);this.render()},removeCourseInfoItem:function(n){this.courseInfoItems=_.without(this.courseInfoItems,n);n.$el.tableRowRemove(function(){n.remove()})},confirmUnlock:function(n){SchedulerHelpers.confirmBox("Unlock this course?",_.bind(function(t){t&&this.unlock(n)},this))},unlock:function(n){var t=this.getCourseFromRow(n);this.showLockedSpinner(t);t.unlock({error:this.onError,wait:!0})},changeLockButton:function(n){this.updateCourseRow(n)},updateCourseRow:function(n){var t=this.$('.course-item[data-id="'+n.id+'"]'),r=this.indexRowTemplate,i=$(r(n.toTemplate())),u=t.find(".select").is(":checked");i.find(".select").prop("checked",u);t.replaceWith(i);Modernizr.touch||Scheduler.Accessibility||this.$('[data-toggle="tooltip"]').tooltip()},showLockedSpinner:function(n){this.$('.course-item[data-id="'+n.id+'"] .btn-locked-course i').removeClass("glyphicons").addClass("fa fa-spinner fa-spin")}});Scheduler.Views.CourseInfoItem=Backbone.View.extend({template:JST["course/info-item"],tagName:"tr",className:"course-info-item",initialize:function(){_.bindAll(this,"render","renderTemplate");this.render()},render:function(){return this.renderTemplate(),this},renderTemplate:function(){var n=_.map(Scheduler.Config.courseSettings.desiredCourseFields,_.bind(function(n){return{key:n,val:this.model.get(n),text:Scheduler.Config.courseSettings.text[n]||Scheduler.Config.sectionFieldText[n]}},this));this.$el.html(this.template({fields:n}))}});Scheduler.Views.CourseInfo=Backbone.View.extend({template:JST["course/info"],className:"course-info col-xs-12",initialize:function(){_.bindAll(this,"render","renderTemplate");this.render()},render:function(){return this.model&&Scheduler.Config.courseSettings.showInformation&&this.renderTemplate(),this},renderTemplate:function(){this.$el.html(this.template(this.model.toTemplate()))},clear:function(){this.$el.empty()}});Scheduler.Views.CourseSideList=Backbone.View.extend({template:JST["course/side-list"],a11yTemplate:JST["accessibility/course/side-list"],className:"course-side-list",initialize:function(){_.bindAll(this,"render","renderTemplate");this.render()},render:function(){return this.showCurrentSchedule=!Scheduler.Data.CurrentSections.isEmpty(),this.showShoppingCart=!Scheduler.Data.CartSections.isEmpty(),this.renderTemplate(),this.tagList=new Scheduler.Views.CourseTagList({collection:Scheduler.Data.Courses}),this.$el.find(".tag-list").html(this.tagList.el),this.showCurrentSchedule&&(this.currentScheduleList=new Scheduler.Views.SectionList({collection:Scheduler.Data.CurrentSections}),this.$el.find(".current-schedule-list").html(this.currentScheduleList.el)),this.showShoppingCart&&(this.shoppingCartList=new Scheduler.Views.SectionList({collection:Scheduler.Data.CartSections}),this.$el.find(".shopping-cart-list").html(this.shoppingCartList.el)),this},renderTemplate:function(){this.$el.html(this.template({showTabs:Scheduler.Config.courseSettings.alwaysShowDesiredCourseTabs||this.showShoppingCart||this.showCurrentSchedule,showCurrentSchedule:this.showCurrentSchedule,showShoppingCart:this.showShoppingCart,scheduleLabel:Scheduler.Config.text.schedule,cartLabel:Scheduler.Config.cartSettings.cartLabel}))},remove:function(){this.tagList.remove();this.currentScheduleList&&this.currentScheduleList.remove();this.shoppingCartList&&this.shoppingCartList.remove();Backbone.View.prototype.remove.apply(this,arguments)}});Scheduler.Views.CourseTagList=Backbone.View.extend({template:JST["course/tag-list"],a11yTemplate:JST["accessibility/course/tag-list"],className:"course-tag-container",coursesEmptyMessage:"Choose a course and click <strong>Add Course<\/strong>",initialize:function(n){n=n||{};this.clientOnly=n.clientOnly;_.bindAll(this,"render","renderTemplate","onRemovingCourseTag","onSuccess","onError");this.render();this.listenTo(this.collection,"add",this.render);this.listenTo(this.collection,"remove",this.courseRemoved);this.courseInfoItems=[]},render:function(){return this.renderTemplate(),Modernizr.touch||this.$('[data-toggle="tooltip"]').tooltip(),this.collection.isEmpty()?this.$(".course-tag-list").addClass("hide"):this.$(".course-tag-list").hasClass("hide")&&this.$(".course-tag-list").removeClass("hide"),this},renderTemplate:function(){this.$el.html(this.template({courses:this.collection.toTemplate(),coursesEmptyMessage:this.coursesEmptyMessage}))},events:{"click .remove":"onRemovingCourseTag","click .btn-course-info":"showCourseInfo"},onRemovingCourseTag:function(n){return SchedulerHelpers.confirmBox("Remove this course?",_.bind(function(t){t&&this.removeCourse(n)},this)),!1},removeCourse:function(n){var t=this.getCourseFromRow(n);if(this.clientOnly){t.trigger("destroy",t,t.collection,{});this.onSuccess(t)}else t.destroy({wait:!0,error:this.onError,success:this.onSuccess})},getCourseFromRow:function(n){var t=this.getCourseIdFromRow(n);return this.collection.get(t)},getCourseIdFromRow:function(n){var t=this.$(n.currentTarget).closest(".course-row");return t.data("id").toString()},onSuccess:function(n){Scheduler.AppView.showSuccessAlert("Removed "+n.displayName());this.collection.remove(n)},onError:function(n,t){Scheduler.AppView.showError(t)},courseRemoved:function(n,t){var u=this.$el.find(".course-row[data-id="+n.id+"]"),i=this,r=this.findCourseInfoItem(n);r&&this.removeCourseInfoItem(r);u.tableRowRemove(function(){t.isEmpty()?i.render():i.$(this).closest(".course-row").remove();i.postRemoved()});t.isEmpty()&&setTimeout(function(){i.$(".course-tag-list").addClass("hide")},150)},postRemoved:function(){},showCourseInfo:function(n){var t=this.getCourseFromRow(n),i=this.findCourseInfoItem(t);i?this.removeCourseInfoItem(i):this.addCourseInfoItem(n,t)},findCourseInfoItem:function(n){return _.find(this.courseInfoItems,function(t){return t.model.id===n.id})},addCourseInfoItem:function(n,t){var r=this.$(n.currentTarget).closest(".course-row"),i=new Scheduler.Views.CourseInfoItem({model:t});i.$el.children().wrapInner('<div style="display: none;" />').parent().insertAfter(r).find("td > div").slideDown(function(){$(this).replaceWith($(this).contents())});this.courseInfoItems.push(i)},removeCourseInfoItem:function(n){this.courseInfoItems=_.without(this.courseInfoItems,n);n.$el.tableRowRemove(function(){n.remove()})},remove:function(){_.each(this.courseInfoItems,function(n){n.remove()});Backbone.View.prototype.remove.apply(this,arguments)}});Scheduler.Views.LearningCommunities=Scheduler.Views.CourseAddTab.extend({template:JST["course/learning-communities"],cssName:"learning-communities",events:{"click .btn-add":"add","click .btn-cancel":"back"},initialize:function(){_.bindAll(this,"render","renderTemplate","renderSelect2","onFetchSuccess","onFetchError","learningCommunityResults","onSecondaryChange","onLrncomSelected","renderLrncomCalendarAndGrid","secondaryLearningCommunityResults","onError","onSuccess");this.collection=new Scheduler.Collections.LearningCommunities([],{term:Scheduler.Data.CurrentTerm});this.mode=Scheduler.Config.courseSettings.learningCommunityMode;this.learningCommunityLabel=Scheduler.Config.text.learningCommunity;this.learningCommunitySelectorId="#learning-community-selector";this.learningCommunitySecondarySelectorId="#secondary-learning-community-selector";this.render()},_loadData:function(){this.collection.fetch({success:this.onFetchSuccess,error:this.onFetchError})},render:function(){return this.renderTemplate(),setTimeout(this.renderSelect2,0),this},renderTemplate:function(){this.$el.html(this.template({backLabel:Scheduler.Config.courseSettings.addBackLabel,addLabel:"Add "+this.learningCommunityLabel,learningCommunityLabel:this.learningCommunityLabel,showSecondarySelector:this.mode===SchedulerLib.LearningCommunityModes.Dual}))},renderSelect2:function(){if(this.mode===SchedulerLib.LearningCommunityModes.Dual)this.$(this.learningCommunitySecondarySelectorId).select2({placeholder:"Select "+Scheduler.Config.text.learningCommunityProgram+"...",dropdownAutoWidth:"true",data:this.secondaryLearningCommunityResults,formatSelection:function(n){return n.secondaryTitle},formatResult:function(n){return n.secondaryTitle},minimumResultsForSearch:15}).on("change",this.onSecondaryChange).on("select2-open",this.applyMobileHeaderAbsolute).on("select2-close",this.applyMobileHeaderFixed);this.$(this.learningCommunitySelectorId).select2({placeholder:"Select "+this.learningCommunityLabel+"...",dropdownAutoWidth:"true",data:this.learningCommunityResults,formatSelection:function(n){return n.title},formatResult:function(n){return n.title},minimumResultsForSearch:15}).on("change",this.onLrncomSelected).on("select2-open",this.applyMobileHeaderAbsolute).on("select2-close",this.applyMobileHeaderFixed);this.$(this.learningCommunitySelectorId).startSelect2Spinner()},onFetchSuccess:function(){this.$(this.learningCommunitySelectorId).stopSelect2Spinner()},onFetchError:function(n,t){this.$(this.learningCommunitySelectorId).stopSelect2Spinner();Scheduler.AppView.showError(t)},secondaryLearningCommunityResults:function(){return{results:_.unique(this.collection.toTemplate(),function(n){return n.secondaryTitle})}},learningCommunityResults:function(){if(this.mode==SchedulerLib.LearningCommunityModes.Dual){var n=this.collection.get(this.$(this.learningCommunitySecondarySelectorId).select2("val"));return n?{results:_.where(this.collection.toTemplate(),{secondaryTitle:n.get("secondaryId")}),text:"title"}:{results:(new Scheduler.Collections.LearningCommunities).toTemplate()}}return{results:this.collection.toTemplate(),text:"title"}},add:_.debounce(function(){var n=this.getLrncomId();return this.addByLearningCommunityId(n)},250,!0),addByLearningCommunityId:function(n){var i,t,r;if(n){if(i=this.collection.get(n),t=_.clone(i.attributes),Scheduler.Data.Courses.doesCourseExist(Scheduler.Constants.learningCommunityLabel,n,null))return Scheduler.AppView.showDangerAlert("The "+this.learningCommunityLabel.toLowerCase()+" "+t.title+" is already in your list."),!1;r=new Scheduler.Models.LearningCommunity({term:Scheduler.Data.CurrentTerm.id});r.save(t,{wait:!0,success:this.onSuccess,error:this.onError})}else Scheduler.AppView.showDangerAlert("Please select a "+this.learningCommunityLabel.toLowerCase());return!1},onSecondaryChange:function(){this.mode==SchedulerLib.LearningCommunityModes.Dual&&this.$(this.learningCommunitySelectorId).select2("val","")},onLrncomSelected:function(){if(Scheduler.Config.courseSettings.showLearningCommunityCalendar){var n=this.getLrncomId(),t=this.collection.get(n),i;t.set("number",n);i=new Scheduler.Collections.RegistrationBlocks(null,{term:Scheduler.Data.CurrentTerm,subjectId:"LRNCOM",course:t});Scheduler.AppView.startSpinner(this.$el);i.fetch({success:this.renderLrncomCalendarAndGrid,error:this.onError})}},onSuccess:function(n){if(!n.id.length)return Scheduler.AppView.showDangerAlert("Unable to add "+this.learningCommunityLabel.toLowerCase()),!1;var t=new Scheduler.Models.DesiredCourse(n.attributes);Scheduler.Data.Courses.add(t);Scheduler.AppView.showSuccessAlert("Added "+t.get("title"))},renderLrncomCalendarAndGrid:function(n){var t=new Scheduler.Collections.RegistrationBlocks,r,i;t.sections=new Scheduler.Collections.Sections;n.sections.each(function(n){var i=new Scheduler.Models.RegistrationBlock;i.sections=new Scheduler.Collections.Sections([n]);i.set("sectionIds",[n.id]);t.add(i);t.sections.add(n)});r=t.getSectionsForCalendar().getEventsForWeek(2,n);i=new Scheduler.Collections.Events(r);this.lrncomGrid?(this.lrncomGrid.collection=t,this.lrncomGrid.render()):(this.lrncomGrid=new Scheduler.Views.SectionDetailGrid({collection:t,fieldSettings:Scheduler.Config.learningCommunitySectionFieldSettings,showColorCol:!0}),this.$el.find(".lrncom-grid").append(this.lrncomGrid.el));Scheduler.Accessibility||(this.lrncomCalendar?(this.lrncomCalendar.collection=i,this.lrncomCalendar.render()):(this.lrncomCalendar=new Scheduler.Views.CalendarIndex({collection:i,model:new Scheduler.Models.ScheduleGeneration,displaySmall:!0,showPopover:!0}),this.$el.find(".lrncom-calendar").html(this.lrncomCalendar.$el)));Scheduler.AppView.stopSpinner()},onError:function(n,t){Scheduler.AppView.stopSpinner(this.$el);Scheduler.AppView.showError(t)},back:function(){return Scheduler.AppView.backToMain(Scheduler.AppView.CoursesView,"courses","slide-from-right",this),!1},getLrncomId:function(){return this.$(this.learningCommunitySelectorId).select2("val")}});Scheduler.Views.DegreeWorksGrid=Backbone.View.extend({template:JST["degree-works/grid"],events:{"change .dw-select-all":"selectAll","click .dw-select":"select","click .btn-dw-info":"showCourseInfo"},initialize:function(){_.bindAll(this,"render","renderTemplate","selectAll","select");this.courseInfoItems=[];this.render()},render:function(){return this.renderTemplate(),Modernizr.touch||this.$('[data-toggle="tooltip"]').tooltip(),this},renderTemplate:function(){this.$el.html(this.template({degreeWorksCourses:this.collection.toTemplate(),anyAvailable:this.collection.where({isAvailable:!0}).length}))},selectAll:function(n){this.$("input.dw-select").prop("checked",n.currentTarget.checked)},select:function(){var n=this.$(".dw-select").length,t=this.$(".dw-select:checkbox:checked").length===n;this.$(".dw-select-all").prop("checked",t)},showCourseInfo:function(n){var t=this.getCourseFromRow(n),i=this.findCourseInfoItem(t);return i?this.removeCourseInfoItem(i):this.addCourseInfoItem(n,t),!1},addCourseInfoItem:function(n,t){var r=$(n.currentTarget).closest(".degree-works-item"),i=new Scheduler.Views.DegreeWorksInfoItem({model:t});i.$el.children("td, th").wrapInner('<div style="display: none;" />').parent().insertAfter(r).find("td > div").slideDown(function(){$(this).replaceWith($(this).contents())});this.courseInfoItems.push(i)},removeCourseInfoItem:function(n){this.courseInfoItems=_.without(this.courseInfoItems,n);n.$el.tableRowRemove(function(){n.remove()})},findCourseInfoItem:function(n){return _.find(this.courseInfoItems,function(t){return t.model.cid===n.cid})},getCourseFromRow:function(n){var t=this.getCourseIdFromRow(n);return this.collection.get(t)},getCourseIdFromRow:function(n){var t=this.$(n.currentTarget||n).closest(".degree-works-item");return t.data("id").toString()}});Scheduler.Views.DegreeWorksIndex=Scheduler.Views.CourseAddTab.extend({template:JST["degree-works/index"],className:"course-degree-works form-horizontal col-md-12",events:{"click .btn-dw-add-all":"addSelected","click .btn-cancel":"back"},initialize:function(){_.bindAll(this,"render","renderTemplate","renderSelect2","renderGrid","onPlanSelected","onTermSelected","getDegreeWorksCoursesByTermFromPlan","addSelected");this.currentCourses={}},_loadData:function(){this.collection.fetch({success:this.render})},render:function(){if(this.collection.length){this.planData||(this.planData=this.collection.first());this.terms=this.planData.get("terms");this.courses=this.planData.get("courses");this.degreeId=this.planData.get("id");var n=this.getPreselectedTerm();this.currentCourses=this.getDegreeWorksCoursesByTermFromPlan(this.planData,n.id);this.plans=this.collection.toTemplate();Scheduler.Config.courseSettings.lockDegreeWorksByTerm&&(this.terms=n.id?[n]:[])}else this.planData=new Scheduler.Models.DegreeWorksPlan;return this.renderTemplate(),this.collection.length&&(setTimeout(this.renderSelect2,0),this.renderGrid()),this},renderTemplate:function(){this.$el.html(this.template({degreePlanLabel:Scheduler.Config.text.degreeworksPlanLabel,planTermLabel:Scheduler.Config.text.degreeworksPlanTermLabel,plans:this.plans,currentPlan:this.planData.toTemplate(),backLabel:Scheduler.Config.courseSettings.addBackLabel,terms:this.terms,emptyPlanCountWarning:"You currently have no active plans in "+Scheduler.Config.courseSettings.degreeWorksLabel+"."}))},renderSelect2:function(){this.planSelector&&this.planSelector.remove();this.termSelector&&this.termSelector.remove();this.collection.length>1&&(this.planSelector=new Scheduler.Views.Select({id:"dw-degree-selector",placeholder:"Select a degree plan",dataText:"degree",collection:this.collection.toTemplate(),preselectedIds:[this.degreeId]}),this.listenTo(this.planSelector,"selection:change",this.onPlanSelected),this.$(".dw-degree-selector-container").html(this.planSelector.el));this.terms.length&&(this.termSelector=new Scheduler.Views.Select({id:"dw-term-selector",placeholder:"Select a plan term",dataText:"title",collection:this.terms,preselectedIds:[this.getPreselectedTerm().id]}),this.listenTo(this.termSelector,"selection:change",this.onTermSelected),this.$(".dw-term-selector-container").html(this.termSelector.el))},renderGrid:function(){this.degreeWorksGrid&&this.degreeWorksGrid.remove();this.degreeWorksGrid=new Scheduler.Views.DegreeWorksGrid({collection:this.currentCourses});this.$el.find(".my-degree-works").html(this.degreeWorksGrid.el)},onPlanSelected:function(n){this.planData=this.collection.get(n.val);this.render()},onTermSelected:function(n){var t=n.val,i=this.collection.get(this.degreeId);this.currentCourses=this.getDegreeWorksCoursesByTermFromPlan(i,t);this.renderGrid();this.clearCheckboxes()},getDegreeWorksCoursesByTermFromPlan:function(n,t){return new Scheduler.Collections.DegreeWorksCourses(_.where(n.get("courses"),{term:t}))},getPreselectedTerm:function(){if(this.terms.length){var t=Scheduler.Data.CurrentTerm,n;return(t&&(n=_.findWhere(this.terms,{id:t.id})),n)?n:Scheduler.Config.courseSettings.lockDegreeWorksByTerm?{}:this.terms[0]}return{}},addSelected:_.debounce(function(){var f=this.$(".dw-select:checkbox:checked"),i=[],r=[],u=[],n=[],t=0,o=_.bind(function(u){Scheduler.Data.Courses.add(u);i.push(u.get("subjectShort")+" "+u.get("number"));t++;t===n.length&&this.showFeedback(i,r)},this),s=_.bind(function(u,f){r.push(f);t++;t===n.length&&this.showFeedback(i,r)},this),e;return f.length||Scheduler.AppView.showDangerAlert("Please select a Course"),$.each(f,_.bind(function(t,i){var f=i.value,r=this.currentCourses.get(f);Scheduler.Data.Courses.doesCourseExist(r.get("subjectId"),r.get("number"),null)?u.push(r.get("subjectShort")+" "+r.get("number")):n.push(r)},this)),_.each(n,function(n){var t=_.clone(n.attributes),i=new Scheduler.Models.DesiredCourse;t.id=null;t.term=Scheduler.Data.CurrentTerm.id;i.save(t,{success:o,error:s,wait:!0})}),u.length&&(e="The following courses have been added already: "+u.join(", "),Scheduler.AppView.showDangerAlert(e)),this.clearCheckboxes(),!1},250,!0),showFeedback:function(n,t){if(n.length){var i="Added the following courses: "+n.join(", ");Scheduler.AppView.showSuccessAlert(i)}t.length&&Scheduler.AppView.showErrorList(t)},clearCheckboxes:function(){this.$("input.dw-select:checkbox").prop("checked",!1);this.$("input.dw-select-all:checkbox").prop("checked",!1)},back:function(){Scheduler.AppView.backToMain(Scheduler.AppView.CoursesView,"courses","slide-from-right",this)},remove:function(){this.planSelector&&this.planSelector.remove();this.termSelector&&this.termSelector.remove();this.degreeWorksGrid&&this.degreeWorksGrid.remove();Backbone.View.prototype.remove.apply(this,arguments)}});Scheduler.Views.DegreeWorksInfoItem=Backbone.View.extend({template:JST["degree-works/info-item"],tagName:"tr",className:"course-info-item",initialize:function(){_.bindAll(this,"render","renderTemplate");this.render()},render:function(){return this.renderTemplate(),this},renderTemplate:function(){var n=Scheduler.Data.CurrentTerm.id;this.$el.html(this.template({course:this.model.toTemplate(),unavailableMsg:"This course is not available for the term of "+n}))}});Scheduler.Views.CourseByNumberInfoItem=Backbone.View.extend({template:JST["course/by-course-number-info-item"],tagName:"tr",className:"course-info-item",initialize:function(){_.bindAll(this,"render","renderTemplate");this.render()},render:function(){return this.renderTemplate(),this},renderTemplate:function(){this.$el.html(this.template({course:this.model.toTemplate()}))}});Scheduler.Views.DegreeplanGrid=Backbone.View.extend({template:JST["degreeplan/grid"],events:{"change .dp-select-all":"selectAll","click .dp-select":"select","click .btn-dp-info":"showCourseInfo"},initialize:function(){_.bindAll(this,"render","renderTemplate","selectAll","select");this.courseInfoItems=[];this.render()},render:function(){return this.renderTemplate(),Modernizr.touch||this.$('[data-toggle="tooltip"]').tooltip(),this},renderTemplate:function(){this.$el.html(this.template({courses:this.collection.toTemplate(),anyAvailable:this.collection.where({exists:!0}).length}))},selectAll:function(n){this.$("input.dp-select").prop("checked",n.currentTarget.checked)},select:function(){var n=this.$(".dp-select").length,t=this.$(".dp-select:checkbox:checked").length===n;this.$(".dp-select-all").prop("checked",t)},showCourseInfo:function(n){var t=this.getCourseFromRow(n),i=this.findCourseInfoItem(t);return i?this.removeCourseInfoItem(i):this.addCourseInfoItem(n,t),!1},addCourseInfoItem:function(n,t){var r=$(n.currentTarget).closest(".degreeplan-item"),i=new Scheduler.Views.DegreeplanInfoItem({model:t});i.$el.children("td, th").wrapInner('<div style="display: none;" />').parent().insertAfter(r).find("td > div").slideDown(function(){$(this).replaceWith($(this).contents())});this.courseInfoItems.push(i)},removeCourseInfoItem:function(n){this.courseInfoItems=_.without(this.courseInfoItems,n);n.$el.tableRowRemove(function(){n.remove()})},findCourseInfoItem:function(n){return _.find(this.courseInfoItems,function(t){return t.model.cid===n.cid})},getCourseFromRow:function(n){var t=this.getCourseIdFromRow(n);return this.collection.get(t)},getCourseIdFromRow:function(n){var t=this.$(n.currentTarget||n).closest(".degreeplan-item");return t.data("id").toString()}});Scheduler.Views.DegreeplanIndex=Scheduler.Views.CourseAddTab.extend({template:JST["degreeplan/index"],preTemplate:JST["degreeplan/index-preload"],className:"course-degreeplan form-horizontal col-md-12",events:{"click .btn-dp-add-all":"addSelected","click .btn-cancel":"back"},initialize:function(n){_.bindAll(this,"render","renderTemplate","renderSelect2","renderGrid","onPlanSelected","onTermSelected","addSelected");this.currentCourses={};this.tabSettings=n.tabSettings;this.preRender()},_loadData:function(){this.collection.fetch({success:this.render})},preRender:function(){this.$el.html(this.preTemplate({tabTitle:this.tabSettings.title}))},render:function(){if(this.collection.length){this.planData||(this.planData=this.collection.first());this.terms=this.planData.get("terms");this.degreeId=this.planData.get("planId");var n=this.getPreselectedTerm();this.currentCourses=n.get("courses");this.plans=this.collection.toTemplate()}else this.planData=new Scheduler.Models.DegreePlan,this.terms=new Scheduler.Collections.DegreePlanTerms;return this.renderTemplate(),this.collection.length&&(setTimeout(this.renderSelect2,0),this.renderGrid()),this},renderTemplate:function(){this.$el.html(this.template({degreePlanLabel:Scheduler.Config.text.degreePlanLabel,planTermLabel:Scheduler.Config.text.degreePlanTermLabel,plans:this.plans,currentPlan:this.planData.toTemplate(),backLabel:Scheduler.Config.courseSettings.addBackLabel,terms:this.terms.toTemplate(),emptyPlanCountWarning:"You currently have no active plans in "+Scheduler.Config.courseSettings.degreePlanLabel+"."}))},renderSelect2:function(){this.planSelector&&this.planSelector.remove();this.termSelector&&this.termSelector.remove();this.collection.length>1&&(this.planSelector=new Scheduler.Views.Select({id:"dp-plan-selector",placeholder:"Select a degree plan",dataText:"name",collection:this.collection.toTemplate(),preselectedIds:[this.degreeId]}),this.listenTo(this.planSelector,"selection:change",this.onPlanSelected),this.$(".dp-plan-selector-container").html(this.planSelector.el));this.terms.length&&(this.termSelector=new Scheduler.Views.Select({id:"dp-term-selector",placeholder:"Select a plan term",dataText:"term",collection:this.terms,preselectedIds:[this.getPreselectedTerm().id]}),this.listenTo(this.termSelector,"selection:change",this.onTermSelected),this.$(".dp-term-selector-container").html(this.termSelector.el))},renderGrid:function(){this.degreePlanGrid&&this.degreePlanGrid.remove();this.degreePlanGrid=new Scheduler.Views.DegreeplanGrid({collection:this.currentCourses});this.$el.find(".degreeplan-grid").html(this.degreePlanGrid.el)},onPlanSelected:function(n){this.planData=this.collection.get(n.val);this.render()},onTermSelected:function(n){var t=n.val,i=this.collection.get(this.degreeId);this.currentCourses=this.terms.findWhere({termCode:t}).get("courses");this.renderGrid();this.clearCheckboxes()},getPreselectedTerm:function(){if(this.terms.length){var n=Scheduler.Data.CurrentTerm,t;return n&&(t=this.terms.findWhere({term:n.id})),t||this.terms.first()}return{}},addSelected:_.debounce(function(){var f=this.$(".dp-select:checkbox:checked"),i=[],r=[],u=[],n=[],t=0,o=_.bind(function(u){Scheduler.Data.Courses.add(u);i.push(u.get("subjectShort")+" "+u.get("number"));t++;t===n.length&&this.showFeedback(i,r)},this),s=_.bind(function(u,f){r.push(f);t++;t===n.length&&this.showFeedback(i,r)},this),e;return f.length||Scheduler.AppView.showDangerAlert("Please select a Course"),$.each(f,_.bind(function(t,i){var f=i.value,r=this.currentCourses.get(f);Scheduler.Data.Courses.doesCourseExist(r.get("subjectId"),r.get("number"),null)?u.push(r.get("subjectShort")+" "+r.get("number")):n.push(r)},this)),_.each(n,function(n){var t=_.clone(n.attributes),i=new Scheduler.Models.DesiredCourse;t.id=null;t.term=Scheduler.Data.CurrentTerm.id;i.save(t,{success:o,error:s,wait:!0})}),u.length&&(e="The following courses have been added already: "+u.join(", "),Scheduler.AppView.showDangerAlert(e)),this.clearCheckboxes(),!1},250,!0),showFeedback:function(n,t){if(n.length){var i="Added the following courses: "+n.join(", ");Scheduler.AppView.showSuccessAlert(i)}t.length&&Scheduler.AppView.showErrorList(t)},clearCheckboxes:function(){this.$("input.dp-select:checkbox").prop("checked",!1);this.$("input.dp-select-all:checkbox").prop("checked",!1)},back:function(){Scheduler.AppView.backToMain(Scheduler.AppView.CoursesView,"courses","slide-from-right",this)},remove:function(){this.planSelector&&this.planSelector.remove();this.termSelector&&this.termSelector.remove();this.degreeplanGrid&&this.degreeplanGrid.remove();Backbone.View.prototype.remove.apply(this,arguments)}});Scheduler.Views.DegreeplanInfoItem=Backbone.View.extend({template:JST["degreeplan/info-item"],tagName:"tr",className:"course-info-item",initialize:function(){_.bindAll(this,"render","renderTemplate");this.render()},render:function(){return this.renderTemplate(),this},renderTemplate:function(){var n=Scheduler.Data.CurrentTerm.id;this.$el.html(this.template({course:this.model.toTemplate(),unavailableMsg:"This course is not available for the term of "+n}))}});Scheduler.Views.DegreeplannerCourseAddPlaceholder=Backbone.View.extend({template:JST["degreeplanner/course-add-placeholder"],className:"course-add-placeholder col-xs-12",initialize:function(n){_.bindAll(this,"render","renderTemplate","onSuccess","onError");this.opts=_.defaults(n||{},{targetCourseModelType:Scheduler.Models.DesiredCourse,term:Scheduler.Data.CurrentTerm,filterTerm:Scheduler.Data.CurrentTerm,collectionsNamespace:Scheduler.Collections});this.render()},events:{"click .btn-add":"add","click .btn-cancel":"back"},render:function(){return this.renderTemplate(),this},renderTemplate:function(){this.$el.html(this.template({}))},add:function(){var i=this.$("#placeholder-title").val(),r=this.$("#placeholder-description").val(),n,t;if(i){n={type:"placeholder",title:i,description:r,term:this.opts.term.id,id:SchedulerHelpers.makeUniversallyUniqueId()};t=new this.opts.targetCourseModelType;this.opts.modelCreatorCallback&&(n=this.opts.modelCreatorCallback(n));t.set(n);this.onSuccess(t)}else Scheduler.AppView.showDangerAlert("Please identify a title.");return!1},back:function(){return this.opts.coursesCollection.trigger("degreeplan:courseadd:done",this.opts.term.id),!1},invalidAlert:function(n){Scheduler.AppView.showDangerAlert("Please see the following errors",n)},onSuccess:function(n){Scheduler.AppView.showSuccessAlert("Added "+n.fullSubject());this.opts.coursesCollection.add(n);this.$("input,textarea").val("")},onError:function(n,t){Scheduler.AppView.showError(t)}});Scheduler.Views.DegreeplannerCourseAddTab=Scheduler.Views.CourseAddTab.extend({template:JST["degreeplanner/course-add-tab"],className:"degreeplanner-course-add-tab form-horizontal col-md-12",events:{"change #sdp-term-selector":"renderGrid","click .btn-sdp-add-all":"addSelected","click .btn-cancel":"back"},initialize:function(){_.bindAll(this,"render","renderTemplate","renderGrid","addSelected");this.collection=this.model.get("courses");this.currentCourses={};this.render();this.listenTo(this.model,"sync",this.render)},_loadData:function(){this.populateTermSelector()},render:function(){return this.renderTemplate(),this},renderTemplate:function(){this.$el.html(this.template({planTermLabel:Scheduler.Config.degreePlannerSettings.termLabel||"Term",courseCount:this.collection.length,backLabel:Scheduler.Config.courseSettings.addBackLabel}));this.$termSelector=this.$("#sdp-term-selector")},populateTermSelector:function(){var t=this.collection.chain().reduce(function(n,t){return n.push(t.get("term")),n},[]).unique().sortBy().value(),i=_.groupBy(t,function(n){return n==="_bookmarks"?"Bookmarks":n.match(/[0-9]+$/)[0]}),n=this.$termSelector;n.empty();_.each(i,function(t,i){var r=$("<optgroup>").attr("label",i);_.each(t,function(n,t){var u=$("<option>").val(n),e,f;n==="_bookmarks"?u.text("Bookmarks"):(e=$.trim(n.replace(/[0-9]+$/g,"")),f=_.findWhere(Scheduler.Config.degreePlannerSettings.terms,{id:e}),f?(f.firstTermCalendarYear&&t>0&&i++,u.text(f.name+" "+i)):u.text(n));r.append(u)});n.append(r)});n.find('option[value="'+Scheduler.Data.CurrentTerm.id+'"]').length&&n.val(Scheduler.Data.CurrentTerm.id);this.renderGrid()},renderGrid:function(){var i=this,n=this.$(".course-grid"),t;this.term=this.$termSelector.val();this.currentCourses=this.collection.getCollectionForTerm({id:this.term},!0);this.grid&&this.grid.remove();this.term&&this.currentCourses?(t=new Scheduler.Collections.Courses([],{degreePlanTerm:this.term,term:Scheduler.Data.CurrentTerm}),n.html('Loading... <i class="fa fa-spin fa-spinner"><\/i>'),t.fetch().done(function(){i.grid=new Scheduler.Views.DegreeplannerGrid({collection:t});n.html(i.grid.el)}).fail(function(n){Scheduler.AppView.showError(n)})):n.empty()},getPreselectedTerm:function(){if(this.terms.length){var t=Scheduler.Data.CurrentTerm,n;return(t&&(n=_.findWhere(this.terms,{id:t.id})),n)?n:this.terms[0]}return{}},addSelected:function(){var e=this.$(".sdp-select:checkbox:checked"),r=[],u=[],f=[],n=[],t=0,i=new Scheduler.Collections.Courses,s=_.bind(function(i){Scheduler.Data.Courses.add(i);r.push(i.get("subjectShort")+" "+i.get("number"));t++;t===n.length&&this.showFeedback(r,u)},this),h=_.bind(function(i,f){u.push(f);t++;t===n.length&&this.showFeedback(r,u)},this),o;return e.length||Scheduler.AppView.showDangerAlert("Please select a Course"),$.each(e,_.bind(function(t,r){var e=r.value,u=this.grid.collection.get(e);Scheduler.Data.Courses.doesCourseExist(u.get("subjectId"),u.get("number"),null)?f.push(u.get("subjectShort")+" "+u.get("number")):u.get("hasTopics")?i.add(u):n.push(u)},this)),_.each(n,function(n){var t=_.clone(n.attributes),i=new Scheduler.Models.DesiredCourse;t.id=null;t.term=Scheduler.Data.CurrentTerm.id;i.save(t,{success:s,error:h,wait:!0})}),i.length&&(this.topicModal?(this.topicModal.collection=i,this.topicModal.delegateEvents(),this.topicModal.render()):this.topicModal=new Scheduler.Views.TopicSelectionListModal({collection:i,term:Scheduler.Data.CurrentTerm.id}),this.topicModal.show()),f.length&&(o="The following courses have been added already: "+f.join(", "),Scheduler.AppView.showDangerAlert(o)),this.clearCheckboxes(),!1},showFeedback:function(n,t){if(n.length){var i="Added the following courses: "+n.join(", ");Scheduler.AppView.showSuccessAlert(i)}t.length&&Scheduler.AppView.showErrorList(t)},clearCheckboxes:function(){this.$("input.sdp-select:checkbox").prop("checked",!1);this.$("input.sdp-select-all:checkbox").prop("checked",!1)},back:function(){return Scheduler.AppView.backToMain(Scheduler.AppView.CoursesView,"courses","slide-from-right",this),!1},applyMobileHeaderAbsolute:function(){Modernizr.touch&&$("#header .navbar-fixed-top").addClass("fixfixed")},applyMobileHeaderFixed:function(){Modernizr.touch&&$("#header .navbar-fixed-top").removeClass("fixfixed")}});Scheduler.Views.DegreeplannerCourseAdd=Backbone.View.extend({template:JST["course/add"],a11yTemplate:JST["accessibility/course/add"],className:"course-add row",events:{"click .btn-course-done-add":"back","click .more-add-options a":"showMoreTab","shown.bs.tab a":"tabShown"},initialize:function(n){_.bindAll(this,"render","renderTemplate");this.opts=_.defaults(n||{},{headerTitle:"Course Add",term:Scheduler.Data.CurrentTerm,filterTerm:Scheduler.Data.CurrentTerm,targetCourseModelType:Scheduler.Models.DesiredCourse,courseAddOptions:Scheduler.Config.courseAddOptions,collectionsNamespace:Scheduler.Collections,modelCreatorCallback:function(n){return n}});this.loadedViews=[];this.subViewsById={}},render:function(){this.renderTemplate();var t={coursesCollection:this.collection,targetCourseModelType:this.opts.targetCourseModelType,term:this.opts.term,filterTerm:this.opts.filterTerm,collectionsNamespace:this.opts.collectionsNamespace,modelCreatorCallback:this.opts.modelCreatorCallback},n;return _.findWhere(this.opts.courseAddOptions,{id:"by-subject"})&&(this.bySubjectView=new Scheduler.Views.DegreeplannerCourseBySubject(t),this.$el.find("#by-subject").html(this.bySubjectView.el),this.loadedViews.push(this.bySubjectView),this.subViewsById["by-subject"]=this.bySubjectView),_.findWhere(this.opts.courseAddOptions,{id:"search-by-course-attribute"})&&(this.byAttributeView=new Scheduler.Views.DegreeplannerCourseByAttribute(t),this.$el.find("#search-by-course-attribute").html(this.byAttributeView.el),this.loadedViews.push(this.byAttributeView),this.subViewsById["search-by-course-attribute"]=this.byAttributeView),_.findWhere(this.opts.courseAddOptions,{id:"placeholder"})&&(this.placeholderView=new Scheduler.Views.DegreeplannerCourseAddPlaceholder(t),this.$el.find("#placeholder").html(this.placeholderView.el),this.loadedViews.push(this.placeholderView)),this.sideList=new Scheduler.Views.DegreeplannerCourseSideList({coursesCollection:this.collection,showCurrentSchedule:!1,showShoppingCart:!1,term:this.opts.term}),this.$el.find(".side-list-row").html(this.sideList.el),n=_.first(this.loadedViews),n&&n.loadData&&n.loadData(),this},renderTemplate:function(){var n=this.opts.courseAddOptions,t=_.filter(n,function(n){return n.primary}),i=_.filter(n,function(n){return!n.primary});this.$el.html(this.template({tabViews:t,dropdownViews:i,showMore:n.length>1,headerTitle:this.opts.headerTitle,courseBackLink:"#"}))},remove:function(){_.each(this.loadedViews,function(n){n.remove()});this.sideList.remove();Backbone.View.prototype.remove.apply(this,arguments)},showMoreTab:function(n){var r=this.$(n.currentTarget),u=r.data("view"),f=this.$(".course-add-tabs li.tab a[data-view="+u+"]"),t=f.parent(),e=this.$(".course-add-tabs li.tab.active a"),o=e.parent(),s=e.data("view"),i=this.$(".course-add-tabs li.tab.visible-tab").last(),h=i.find("a").data("view"),c=this.$(".more-add-options li a[data-view="+h+"]");u!==s&&((o.hasClass("secondary")&&(t.hasClass("primary last")||t.hasClass("secondary"))&&(i.hasClass("secondary")||i.hasClass("primary last"))||o.hasClass("primary")&&(t.hasClass("secondary")||t.hasClass("primary")&&i.hasClass("secondary")))&&(i.removeClass("visible-tab"),c.parent().removeClass("visible-xs")),t.addClass("visible-tab"),r.parent().addClass("visible-xs"),f.tab("show"))},tabShown:function(n){var i=$(n.target).data("viewId"),t=this.subViewsById[i];t&&t.loadData&&t.loadData()},back:function(){return this.collection.trigger("degreeplan:courseadd:done",this.opts.term.id),!1}});Scheduler.Views.DegreeplannerCourseByAttribute=Scheduler.Views.CourseByAttribute.extend({addByCourseId:function(n){var r,t,u,i;if(n){if(r=this.courses.get(n),t=_.clone(r.attributes),delete t.id,t.id=SchedulerHelpers.makeUniversallyUniqueId(),t.term=this.opts.term.id,u=this.opts.coursesCollection.getAllCoursesCollection().findWhere({number:t.number,subject:t.subject,topic:t.topic}),u)return this.invalidAlert(["The course "+t.title+" is already in your degree planner."]),!1;i=new this.opts.targetCourseModelType;this.opts.modelCreatorCallback&&(t=this.opts.modelCreatorCallback(t));i.set(t);this.onSuccess(i)}else Scheduler.AppView.showDangerAlert("Please select a Course.");return!1},back:function(){return this.opts.coursesCollection.trigger("degreeplan:courseadd:done",this.opts.term.id),!1}});Scheduler.Views.DegreeplannerCourseBySubject=Scheduler.Views.CourseBySubject.extend({addByCourseAndTopic:function(n,t){var u,i,f,r;if(n){if(u=this.courses.get(n),i=_.clone(u.attributes),delete i.id,i.id=SchedulerHelpers.makeUniversallyUniqueId(),i.term=this.opts.term.id,i.topic=t,f=this.opts.coursesCollection.getAllCoursesCollection().findWhere({number:i.number,subject:i.subject,topic:i.topic}),f)return this.invalidAlert(["The course "+i.title+" is already in your degree planner"]),!1;r=new this.opts.targetCourseModelType;this.opts.modelCreatorCallback&&(i=this.opts.modelCreatorCallback(i));r.set(i);this.onSuccess(r)}else Scheduler.AppView.showDangerAlert("Please select a Course");return!1},back:function(){return this.opts.coursesCollection.trigger("degreeplan:courseadd:done",this.opts.term.id),!1}});Scheduler.Views.DegreeplannerCourseSideList=Backbone.View.extend({template:JST["course/side-list"],className:"course-side-list",initialize:function(n){_.bindAll(this,"render","renderTemplate");this.opts=_.defaults(n||{},{coursesCollection:Scheduler.Data.Courses,showCurrentSchedule:!1,showShoppingCart:!1,term:Scheduler.Data.CurrentTerm});this.render()},render:function(){return this.renderTemplate(),this.tagList=new Scheduler.Views.CourseTagList({collection:this.opts.coursesCollection,clientOnly:!0}),this.$el.find(".tag-list").html(this.tagList.el),this},renderTemplate:function(){this.$el.html(this.template({showTabs:!1,showCurrentSchedule:!1,showShoppingCart:!1,headerTitle:this.opts.term.get("title")+" Courses"}))},remove:function(){this.tagList.remove();Backbone.View.prototype.remove.apply(this,arguments)}});Scheduler.Views.DegreeplannerInfoItem=Backbone.View.extend({template:JST["degreeplanner/info-item"],tagName:"tr",className:"course-info-item",initialize:function(){_.bindAll(this,"render","renderTemplate");this.render()},render:function(){return this.renderTemplate(),this},renderTemplate:function(){var n=Scheduler.Data.CurrentTerm.id;this.$el.html(this.template({course:this.model.toTemplate(),unavailableMsg:"This course is not available for the term of "+n}))}});Scheduler.Views.DegreeplannerGridCourseList=Scheduler.Views.CourseTagList.extend({template:JST["degreeplanner/grid-course-list"],a11yTemplate:JST["accessibility/degreeplanner/grid-course-list"],coursesEmptyMessage:function(){var n=Scheduler.Config.text.term.toLowerCase();return"There are no courses in this "+n+"."},className:"degreeplanner-courses-list clearfix",events:{"click .menu-course-info":"showCourseInfo","click .btn-course-info":"showCourseInfo","click a.previous":"prevPage","click a.next":"nextPage","click a.page":"selectPage"},initialize:function(n){this.opts=_.defaults(n||{},{term:Scheduler.Data.CurrentTerm,perPage:100,separatePlaceholders:!0});this.currentPage=1;Scheduler.Accessibility&&(this.opts.perPage=1e9);Scheduler.Views.DegreeplannerGridCourseList.__super__.initialize.apply(this,arguments)},renderTemplate:function(){this.validatePage();var n=this.getTotalPages();this.$el.html(this.template({courses:this.getPaginatedCourses().toTemplate(),placeholders:this.getPaginatedPlaceholders().toTemplate(),coursesEmptyMessage:_.result(this,"coursesEmptyMessage"),term:this.opts.term.toTemplate(),showPager:n>1,isFirstPage:this.currentPage===1,isLastPage:this.currentPage===n,currentPage:this.currentPage,pages:_.range(1,n+1)}));this.$el.toggleClass("degreeplanner-courses-list-empty",!this.collection.length)},validatePage:function(){var n=this.getTotalPages();return this.currentPage<=0?(this.currentPage=1,!1):this.currentPage>n?(this.currentPage=n,!1):!0},getTotalPages:function(){return Math.ceil(this.collection.length/this.opts.perPage)},getCourses:function(){return this.opts.separatePlaceholders?new this.collection.constructor(this.collection.filter(function(n){return n.get("subjectShort")&&n.get("number")})):this.collection},getPlaceholders:function(){return this.opts.separatePlaceholders?new this.collection.constructor(this.collection.filter(function(n){return n.get("type")==="placeholder"})):new this.collection.constructor([])},getPaginatedCourses:function(){return this.getCourses().paginate(this.currentPage,this.opts.perPage)},getPaginatedPlaceholders:function(){return this.getPlaceholders().paginate(this.currentPage,this.opts.perPage)},nextPage:function(n){this.currentPage++;this.render();n.preventDefault()},prevPage:function(n){this.currentPage--;this.render();n.preventDefault()},selectPage:function(n){this.currentPage=parseInt($(n.target).closest("a").data("page"),10);this.render();n.preventDefault()},showCourseInfo:function(n){var t=this.getCourseFromRow(n);n.preventDefault()}});Scheduler.Views.DegreeplannerGrid=Backbone.View.extend({template:JST["degreeplanner/grid"],tagName:"table",className:"degreeplanner-grid table",events:{"change .sdp-select-all":"selectAll","click .sdp-select":"select","click .btn-sdp-info":"showInfo"},initialize:function(){_.bindAll(this,"render","renderTemplate","selectAll","select");this.courseInfoItems=[];Modernizr.touch||this.$('[data-toggle="tooltip"]').tooltip();this.render()},render:function(){return this.renderTemplate(),this},renderTemplate:function(){this.$el.html(this.template({courses:this.collection.toTemplate(),anyAvailable:this.collection.where({exists:!0}).length}))},selectAll:function(n){this.$("input.sdp-select").prop("checked",n.currentTarget.checked)},select:function(){var n=this.$(".sdp-select").length,t=this.$(".sdp-select:checkbox:checked").length===n;this.$(".sdp-select-all").prop("checked",t)},showInfo:function(n){var t=this.getCourseFromRow(n),i=this.findCourseInfoItem(t);return i?this.removeCourseInfoItem(i):this.addCourseInfoItem(n,t),!1},addCourseInfoItem:function(n,t){var r=$(n.currentTarget).closest(".sdp-course"),i=new Scheduler.Views.DegreeplannerInfoItem({model:t});i.$el.children("td, th").wrapInner('<div style="display: none;" />').parent().insertAfter(r).find("td > div").slideDown(function(){$(this).replaceWith($(this).contents())});this.courseInfoItems.push(i)},removeCourseInfoItem:function(n){this.courseInfoItems=_.without(this.courseInfoItems,n);n.$el.tableRowRemove(function(){n.remove()})},findCourseInfoItem:function(n){return _.find(this.courseInfoItems,function(t){return t.model.cid===n.cid})},getCourseFromRow:function(n){var t=this.getCourseIdFromRow(n);return this.collection.get(t)},getCourseIdFromRow:function(n){var t=this.$(n.currentTarget||n).closest(".sdp-course");return t.data("id").toString()}});Scheduler.Views.DegreeplannerOptions=Backbone.View.extend({template:JST["degreeplanner/options"],events:{change:"updatePlannerSettings"},initialize:function(){this.listenTo(this.model,"change:settings",this.populateValues)},render:function(){return this.renderTemplate(),this.populateValues(),this},renderTemplate:function(){var n=_.chain(Scheduler.Config.degreePlannerSettings.terms).where({optional:!0}).pluck("name").value().join(", ");this.$el.html(this.template({optionalTerms:n}))},populateValues:function(){var n=this.model.get("settings").attributes;this.$("input,select,textarea").each(function(){var t=$(this),r=t.attr("name"),i=n[r];_.isUndefined(i)||t.val(i.toString())})},updatePlannerSettings:function(n){var i=$(n.target),r=i.attr("name"),t=i.val(),e=i.data("datatype"),u,f;e==="boolean"?t=t==="true":e==="int"&&(t=parseInt(t,10));u=this._evaluateNewSetting(r,t);u.ok?(this.model.get("settings").set(r,t),this.model.trigger("change:settings",!0)):(bootbox.alert(u.message),f=this.model.get("settings").get(r),_.isUndefined(f)||i.val(f.toString()))},_evaluateNewSetting:function(n,t){var i={ok:!0,message:""},u=this.model.get("settings").clone(),o,r;if(u.set(n,t),n==="startYear"||n==="numYears"){var e=u.get("startYear"),s=u.get("numYears"),h=_.range(e,e+s),f=this.model.get("courses").filter(function(n){var t=n.get("term");return t==="_bookmarks"?!1:!_.some(h,function(n){return t.substring(t.length-n.toString().length)===n.toString()})});f.length&&(i.ok=!1,i.message="<strong>We found "+f.length+" courses that fall outside of the provided year range.  You must move or remove these courses before changing this setting:<\/strong>",_.each(f,function(n){i.message+="<br>"+n.displayName()}))}else n==="showOptionalTerms"&&t===!1&&(o=_.where(Scheduler.Config.degreePlannerSettings.terms,{optional:!0}),r=this.model.get("courses").filter(function(n){var t=n.get("term");return _.some(o,function(n){return t.substring(0,n.id.length)===n.id})}),r.length&&(i.ok=!1,i.message="<strong>We found "+r.length+" courses currently in optional terms.  You must move or remove these courses before hiding optional terms:<\/strong>",_.each(r,function(n){i.message+="<br>"+n.displayName()})));return i}});Scheduler.Views.DegreeplannerOverview=Backbone.View.extend({template:JST["degreeplanner/overview"],events:{"hide.bs.tab .dp-overview-tabs > li > a":"tabClicked","click .btn-leave-a11y":"confirmLeaveAccessibility"},initialize:function(){Backbone.Subviews.add(this)},subviewCreators:{grid:function(){return new Scheduler.Views.DegreeplannerTermsGridEditor({model:this.model})},options:function(){return new Scheduler.Views.DegreeplannerOptions({model:this.model})}},render:function(){this.renderTemplate();this.delegateEvents()},renderTemplate:function(){this.$el.html(this.template({showSettings:!Scheduler.Accessibility}))},setRouterOptions:function(n){this.subviews.grid.setRouterOptions(n)},tabClicked:function(n){var i=$(n.relatedTarget).closest("a").attr("href"),t=this.$('.dp-overview-tabs a[href="'+i+'"]');t.closest(".nav").find("li").removeClass("active");t.closest("li").addClass("active")},confirmLeaveAccessibility:function(){SchedulerHelpers.confirmBox("Exit text only mode and return to non-accessibility mode?",function(n){if(n){var t="/spa",i=window.location.pathname.substring(1).split("/");i.length===2&&(t+="/"+i[1]);window.location=t+"#degreeplanner"}})}});Scheduler.Views.DegreeplannerTermsGrid=Backbone.View.extend({template:JST["degreeplanner/terms-grid"],className:"degreeplanner-terms-grid",events:{"click .btn-print":"openPrintDialog"},initialize:function(n){this.opts=_.defaults(n||{},{urlPrefix:"degreeplanner/",appRouter:Scheduler.AppRouter,useBookmarks:!0,useBookmarksSidebar:!0,hideOptionalTerms:!1,useSettingsTab:Scheduler.Accessibility});Backbone.Subviews.add(this);_.bindAll(this,"render","renderTemplate");this.model&&(this.collection=this.model.get("courses"),this.listenTo(this.model,"change:settings",this.updateSettings));this.defaultTerm=Scheduler.Data.CurrentTerm;this.urlPrefix=this.opts.urlPrefix;this.availableTerms=new Scheduler.Collections.Terms;this.listenTo(this.availableTerms,"add remove reset",this.render);this.updateSettings(!1);this.setRouterOptions(this.opts);this.listenTo(this.collection,"sdp:request_move",this.showMoveCourseDialog)},_setup:function(){},_getTermSettings:function(){return _.clone(Scheduler.Config.degreePlannerSettings.terms)},_subviewCreators:function(){var n=this,i=this.courseListView||Scheduler.Views.DegreeplannerGridCourseList,t=this.availableTerms.reduce(function(t,r){var u=n.collection.getCollectionForTerm(r);return t["term-"+r.id]=function(){var t=_.extend({model:n.model,collection:u,term:r},n.opts.courseListOptions||{});return new i(t)},t},{}),u,f;if(this.opts.useBookmarks){var r=new Scheduler.Models.Term({id:"_bookmarks",title:"Bookmarks"}),e=n.collection.getCollectionForTerm(r),o=_.extend({model:n.model,collection:e,term:r,separatePlaceholders:!1,perPage:10},n.opts.courseListOptions||{});t.bookmarks=t["bookmarks-tab"]=function(){return new i(o)}}return this.opts.useSettingsTab&&(u=this.settingsView||Scheduler.Views.DegreeplannerOptions,f=_.extend({model:n.model}),t.settings=t["settings-tab"]=function(){return new u(f)}),t},render:function(){return this.subviewCreators=this._subviewCreators,this.renderTemplate(),this.delegateEvents(),this.onRender(),this},renderTemplate:function(){this.$el.html(this.template({availableTerms:this.availableTerms.toJSON(),desiredCourses:this.collection.toTemplate(),termYears:this._yearRange(),column:Math.floor(12/this.availableTermsByYear.size()),urlPrefix:this.urlPrefix,useBookmarks:this.opts.useBookmarks,useBookmarksSidebar:this.opts.useBookmarksSidebar,useSettingsTab:this.opts.useSettingsTab}))},onRender:function(){},setRouterOptions:function(n){var t=this.model.getLastViewedYear();if(n=_.defaults(n||{},{year:null,term:null}),n.year)this.setYear(n.year);else if(n.term)this.setTerm(n.term);else{if(this.setYear(t))return;if(this.setTerm(this.defaultTerm))return;this.setYear(this.startYear)}},_yearRange:function(){var n=this.availableTermsByYear.first().get("firstTermCalendarYear");return _.map(_.range(this.startYear,this.startYear+this.numYears),function(t){var i=t;return n||(i=t+"/"+(t+1)),{year:t,displayName:i}})},_isValidYear:function(n){return n==="bookmarks"&&this.$("li[data-value=bookmarks]").is(":visible")&&this.opts.useBookmarks?!0:n==="settings"&&this.opts.useSettingsTab&&this.$("li[data-value=settings]").is(":visible")?!0:(_.isNaN(n)||(n=parseInt(n,10)),_.contains(_.range(this.startYear,this.startYear+this.numYears),n))},_populateAvailableTerms:function(){var t=this,i=this.availableTermsByYear,n=[],r=this._yearRange();_.each(r,function(r){var u=r.year;n=n.concat(i.map(function(n,i){return n.get("firstTermCalendarYear")&&i>0&&u++,r?new Scheduler.Models.Term({id:n.id+" "+r.year,title:t._makeTermTitle(n,r,u),term_year:r.year}):void 0}))});this.availableTerms.reset(_.filter(n))},_makeTermTitle:function(n,t,i){return n.get("name")+" "+i},setYear:function(n,t){return n&&this._isValidYear(n)?(this.$(".tab-pane").removeClass("active"),this.$("#dp-tab-pane-"+n).addClass("active"),this.$("ul.nav-pills li").removeClass("active"),this.$('ul.nav-pills li[data-value="'+n+'"]').addClass("active"),this.model.setLastViewedYear(n),!0):(t?this.setYear(this.startYear):this.setTerm(this.defaultTerm),!1)},setTerm:function(n){var e=this.model.getLastViewedYear(),i,r,u;if(n||(n=this.defaultTerm),i=_.isObject(n)?n.id:n,i==="_bookmarks"&&this.opts.useBookmarks){if(this.setYear("bookmarks",!0))return;this.setYear(e);return}if(i==="settings"&&this.opts.useSettingsTab){if(this.setYear("settings",!0))return;this.setYear(e);return}if(r=this.availableTerms.findWhere({id:n}),r&&r.get("term_year")){this.setYear(r.get("term_year"));return}if(u=this.availableTerms.findWhere({title:n}),u&&u.get("term_year")){this.setYear(u.get("term_year"));return}var o=$.trim(i.replace(/[0-9]+$/g,"")),f=this.availableTermsByYear.get(o),t=i.match(/\b\d+/);t=t&&t.length?$.trim(t[0]):null;f&&f!==this.availableTermsByYear.first()&&this.availableTermsByYear.indexOf(this.changeYearOnTerm)>=this.availableTermsByYear.indexOf(f)&&t--;this.setYear(t,!0)},openPrintDialog:function(){window.print()},updateSettings:function(n){var i=this.model.get("settings"),t;for(this.startYear=i.get("startYear"),this.numYears=i.get("numYears"),this.opts.hideOptionalTerms=!i.get("showOptionalTerms"),t=this._getTermSettings(),this.opts.hideOptionalTerms&&(t=_.where(t,{optional:!1})),this.startTerm=_.first(t).id;this.startTerm!==t[0].id;)t.push(t.shift());this.availableTermsByYear=new Backbone.Collection(t);this.changeYearOnTerm=this.availableTermsByYear.findWhere({firstTermCalendarYear:!0});this._setup();this._populateAvailableTerms();n&&(this.render(),this.setYear(this.model.getLastViewedYear(),!0))}});Scheduler.Views.DegreeplannerTermsGridCompare=Scheduler.Views.DegreeplannerTermsGrid.extend({template:JST["degreeplanner/terms-grid-compare"],className:"degreeplanner-terms-grid",events:{"click .btn-print":"openPrintDialog","click .btn-save":"saveDegreePlan"},initialize:function(n){this.opts=_.defaults(n||{},{urlPrefix:"degreeplanner/",appRouter:Scheduler.AppRouter,useBookmarks:!0});Backbone.Subviews.add(this);_.bindAll(this,"render","renderTemplate");var t=this._getTermSettings();for(this.model&&(this.collection=this.model.get("courses")),this.startTerm=_.first(t).id,this.startYear=2014,this.defaultTerm=Scheduler.Data.CurrentTerm,this.urlPrefix=this.opts.urlPrefix;this.startTerm!==t[0].id;)t.push(t.shift());this.availableTermsByYear=new Backbone.Collection(t);this.changeYearOnTerm=this.availableTermsByYear.findWhere({firstTermCalendarYear:!0});this.availableTerms=new Scheduler.Collections.Terms;this._setup();this.listenTo(this.availableTerms,"add remove reset",this.render);this._populateAvailableTerms();this.setRouterOptions(this.opts);this.listenTo(this.collection,"sdp:request_move",this.showMoveCourseDialog)},_setup:function(){},_getTermSettings:function(){return _.clone(Scheduler.Config.degreePlannerSettings.terms)},_subviewCreators:function(){var n=this,r=this.courseListView||Scheduler.Views.DegreeplannerCourseList,t=this.availableTerms.reduce(function(t,i){var u=n.collection.getCollectionForTerm(i);return t["term-"+i.id]=function(){var t=_.extend({collection:u,term:i},n.opts.courseListOptions||{});return new r(t)},t},{}),i;return this.opts.useBookmarks&&(i=new Scheduler.Models.Term({id:"_bookmarks",title:"Bookmarks"}),bookmarkCollection=n.collection.getCollectionForTerm(i),bookmarkOpts=_.extend({collection:bookmarkCollection,term:i},n.opts.courseListOptions||{}),t.bookmarks=t["bookmarks-tab"]=function(){return new r(bookmarkOpts)}),t},render:function(){return this.subviewCreators=this._subviewCreators,this.renderTemplate(),this.delegateEvents(),this.configureDragDrop(),this},renderTemplate:function(){this.$el.html(this.template({availableTerms:this.availableTerms.toJSON(),desiredCourses:this.collection.toTemplate(),termYears:this._yearRange(),column:Math.floor(12/this.availableTermsByYear.size()),urlPrefix:this.urlPrefix,useBookmarks:this.opts.useBookmarks}))},configureDragDrop:function(){var n=this;this.$("li.year-tab").droppable({tolerance:"pointer",over:function(){var t=$(this),i=setTimeout(function(){var i=t.data("value");n.opts.appRouter.navigate(n.urlPrefix+i,{trigger:!1});n.setYear(i)},750);t.data("sdp-drag-timeout",i);$(this).addClass("highlight")},out:function(){clearTimeout($(this).data("sdp-drag-timeout"));$(this).removeClass("highlight")},deactivate:function(){$(this).removeClass("highlight")}})},setRouterOptions:function(n){n=_.defaults(n||{},{year:null,term:null});n.year?this.setYear(n.year):this.setTerm(n.term||this.defaultTerm)},_yearRange:function(){var n=this.availableTermsByYear.first().get("firstTermCalendarYear");return _.map(_.range(this.startYear,this.startYear+5),function(t){var i=t;return n||(displayname=t+"/"+(t+1)),{year:t,displayName:i}})},_isValidYear:function(n){return n==="bookmarks"&&this.$("li[data-value=bookmarks]").is(":visible")&&this.opts.useBookmarks?!0:(_.isNaN(n)||(n=parseInt(n,10)),_.contains(_.range(this.startYear,this.startYear+5),n))},_populateAvailableTerms:function(){var t=this,i=this.availableTermsByYear,n=[],r=this._yearRange();_.each(r,function(r){var u=r.year;n=n.concat(i.map(function(n,i){return n.get("firstTermCalendarYear")&&i>0&&u++,r?new Scheduler.Models.Term({id:n.id+" "+r.year,title:t._makeTermTitle(n,r,u),term_year:r.year}):void 0}))});this.availableTerms.reset(_.filter(n))},_makeTermTitle:function(n,t,i){return n.get("name")+" "+i},setYear:function(n,t){return n&&this._isValidYear(n)?(this.$(".tab-pane").removeClass("active"),this.$("#dp-tab-"+n).addClass("active"),this.$("ul.nav-pills li").removeClass("active"),this.$('ul.nav-pills li[data-value="'+n+'"]').addClass("active"),this.previousYear=n,!0):(t||this.setTerm(this.defaultTerm),!1)},setTerm:function(n){if(n||(n=this.defaultTerm),termId=_.isObject(n)?n.id:n,termId==="_bookmarks"&&this.opts.useBookmarks){if(this.setYear("bookmarks",!0))return;this.setYear(this.previousYear);return}var r=$.trim(termId.replace(/[0-9]+$/g,"")),i=this.availableTermsByYear.get(r),t=termId.match(/[0-9]+$/,"");t=t&&t.length?$.trim(t[0]):null;i&&i!==this.availableTermsByYear.first()&&this.availableTermsByYear.indexOf(this.changeYearOnTerm)>=this.availableTermsByYear.indexOf(i)&&t--;this.setYear(t)},showMoveCourseDialog:function(n,t){var r=this.collection,i=this.availableTerms,u=i.map(function(n){return{value:n.id,text:n.get("title")}});bootbox.prompt({title:"Move Course - "+n.fullSubject(),message:"Select the term to move this course into",inputType:"select",inputOptions:u,value:t.term.id,callback:function(t){if(t!==null){var u=r.getCollectionForTerm(i.get(t));u&&u.trigger("sdp:transfer",n.id,u)}}})},openPrintDialog:function(){window.print()},saveDegreePlan:function(){var n=this.$(".btn-save"),t=n.html();n.html('<i class="fa fa-spinner fa-spin"><\/i> Saving...');this.model.save().done(function(){Scheduler.AppView.showSuccessAlert("Degree Plan Saved!")}).fail(function(n){Scheduler.AppView.showError(n)}).always(function(){n.html(t)})}});Scheduler.Views.DegreeplannerTermsGridEditor=Scheduler.Views.DegreeplannerTermsGrid.extend({template:JST["degreeplanner/terms-grid-editor"],className:"degreeplanner-terms-grid",events:{"click .btn-print":"openPrintDialog","click .btn-save":"saveDegreePlan"},_setup:function(){this.courseListView=Scheduler.Views.DegreeplannerGridEditorCourseList},onRender:function(){this.configureDragDrop()},configureDragDrop:function(){var n=this;Scheduler.Accessibility||this.$("li.year-tab").droppable({tolerance:"pointer",over:function(t,i){var r=$(this),u=setTimeout(function(){var u=r.data("value");n.opts.appRouter.navigate(n.urlPrefix+u,{trigger:!1});n.setYear(u);$.ui.ddmanager.prepareOffsets(i.draggable.data("ui-draggable"),t)},750);r.data("sdp-drag-timeout",u);$(this).addClass("highlight")},out:function(){clearTimeout($(this).data("sdp-drag-timeout"));$(this).removeClass("highlight")},deactivate:function(){$(this).removeClass("highlight")}})},showMoveCourseDialog:function(n,t){var r=this.collection,i=this.availableTerms,u=i.map(function(n){return{value:n.id,text:n.get("title")}});bootbox.prompt({title:"Move Course - "+n.fullSubject(),message:"Select the term to move this course into",inputType:"select",inputOptions:u,value:t.term.id,callback:function(t){if(t!==null){var u=r.getCollectionForTerm(i.get(t));u&&u.trigger("sdp:transfer",n.id,u)}}})},saveDegreePlan:function(){var n=this.$(".btn-save"),t=n.html();n.html('<i class="fa fa-spinner fa-spin"><\/i> Saving...');this.model.save().done(function(){Scheduler.AppView.showSuccessAlert("Degree Plan Saved!")}).fail(function(n){Scheduler.AppView.showError(n)}).always(function(){n.html(t)})}});Scheduler.Views.DegreeplannerGridEditorCourseList=Scheduler.Views.DegreeplannerGridCourseList.extend({template:JST["degreeplanner/grid-editor-course-list"],a11yTemplate:JST["accessibility/degreeplanner/grid-editor-course-list"],coursesEmptyMessage:"Add the courses you wish to take for this term.",className:"degreeplanner-courses-list clearfix",events:{"click .menu-remove":"onRemovingCourseTag","click .menu-course-info":"showCourseInfo","click .menu-notes":"showEditNotesDialog","click .menu-move":"showMoveDialog","click .menu-placeholder-info":"showPlaceholderInfoDialog","click .btn-course-info":"showCourseInfo","click .btn-course-add":"showCourseAdd","click a.previous":"prevPage","click a.next":"nextPage","click a.page":"selectPage"},initialize:function(){Scheduler.Views.DegreeplannerGridEditorCourseList.__super__.initialize.apply(this,arguments);this.listenTo(this.collection,"sdp:transfer_complete",this.transferCompleted)},render:function(){return Scheduler.Views.DegreeplannerGridEditorCourseList.__super__.render.apply(this,arguments),this.configureDragDrop(),this},configureDragDrop:function(){var n=this;Scheduler.Accessibility||(this.$el.addClass("support-drag-drop drop-target").droppable({tolerance:"pointer",drop:function(t,i){$(this).addClass("highlight");n.collection.trigger("sdp:transfer",i.draggable.data("id"),n.collection)},over:function(){$(this).addClass("highlight")},out:function(){$(this).removeClass("highlight")},deactivate:function(){$(this).removeClass("highlight")}}),this.$("tr[data-id]").draggable({helper:function(){var n=$(this).find(".course-subject").text(),t=$(this).find(".course-title").text();return $("<div />").addClass("drag-course").html(n+"<br />"+t)},cursorAt:{top:35,left:35},appendTo:"body",handle:".dnd-handle",scroll:!0,scrollSensitivity:45}))},transferCompleted:function(){Scheduler.AppView.showSuccessAlert("Course moved to "+this.opts.term.get("title"));this.currentPage=this.getTotalPages();this.render()},showCourseAdd:function(){var n=_.map(Scheduler.Config.courseAddOptions,_.clone),t,i=_.findWhere(n,{id:"by-subject"});i&&!_.where(n,{showInDegreePlanner:!0}).length&&(i.showInDegreePlanner=!0);n.push({id:"placeholder",primary:!0,title:"Placeholder",showInDegreePlanner:!0});t=new Scheduler.Views.DegreeplannerCourseAdd({collection:this.collection,term:this.opts.term,filterTerm:null,targetCourseModelType:Scheduler.Models.DegreeplannerCourse,courseAddOptions:_.where(n,{showInDegreePlanner:!0}),headerTitle:"Add Course - "+this.opts.term.get("title")});t.render();Scheduler.AppRouter.navigate("degreeplanner/courses/add/"+this.opts.term.id);Scheduler.AppView.showViewWithTransition(t,"slide-from-right");this.collection.once("degreeplan:courseadd:done",this.endCourseAdd)},endCourseAdd:function(n){Scheduler.AppRouter.navigate("degreeplanner/term/"+n,{trigger:!0,replace:!0})},removeCourse:function(n){var t=this.getCourseFromRow(n);t.trigger("destroy",t,t.collection,{});this.onSuccess(t)},postRemoved:function(){this.render()},showEditNotesDialog:function(n){var i=this,t=this.getCourseFromRow(n);bootbox.prompt({title:"Course Notes",value:t.get("note"),inputType:"textarea",callback:function(n){n!==null&&(t.set("note",n),i.render())}});n.preventDefault()},showMoveDialog:function(n){var t=this.getCourseFromRow(n);n.preventDefault();this.collection.trigger("sdp:request_move",t,this.collection)},showPlaceholderInfoDialog:function(n){n.preventDefault();var r=this,i=this.getCourseFromRow(n),t=$(JST["degreeplanner/placeholder-edit"](i.toTemplate()));bootbox.dialog({title:"Edit Course Placeholder Info",message:t,buttons:{success:{label:"Save",className:"btn-primary",callback:function(){var n=t.find("#placeholder-title").val(),u=t.find("#placeholder-description").val();i.set({title:n,description:u});r.render()}},cancel:{label:"Cancel",className:"btn-cancel"}}})},showCourseInfo:function(n){n.preventDefault();var t=this.getCourseFromRow(n),i=t.get("description");bootbox.dialog({title:t.displayName(),message:i||Scheduler.Config.courseSettings.descrUnavailableText,buttons:{cancel:{label:"Close",className:"btn-default"}}})}});Scheduler.Views.FilterIndex=Backbone.View.extend({template:JST["filter/index"],a11yTemplate:JST["accessibility/filter/index"],className:"filter-index",events:{"click .btn-cancel":"backToOptions","click .btn-save":"save","click .filter-grid .select":"selected","click .filter-grid tbody tr":"selectRow","click .filter-grid .select-all":"selectAll"},initialize:function(n){n=n||{};this.options=n;this.label=Scheduler.Config.text[this.options.type]||Scheduler.Config.text[this.options.typePlural];this.labelPlural=Scheduler.Config.text[this.options.type+"Plural"]||Scheduler.Config.text[this.options.typePlural+"Plural"];_.bindAll(this,"onSuccess","onError");this.render()},render:function(){return this.renderTemplate(),this.collection.selected().length===this.collection.length&&this.$el.find(".filter-grid .select-all").prop("checked",!0),this},renderTemplate:function(){var i=this.options.typePlural,n,t,r=this.collection.map(function(r){return n=r.toJSON(),t=_.find(Scheduler.Config.filterSettings.items,function(n){return n.type===i&&(n.matchByCode&&n.key===r.get("code")||!n.matchByCode&&n.key===r.get("title"))}),n.settings=t||{},n});this.$el.html(this.template({label:this.label,labelPlural:this.labelPlural,models:r,isEntryFilter:this.options.isEntryFilter,message:this.getMessage()}))},getMessage:function(){var t=this.options.typePlural,n=_.find(Scheduler.Config.filterSettings.data,function(n){return n.type===t});return n===undefined?"":n.entryMessage},backToOptions:function(){Scheduler.AppView.backToMain(Scheduler.AppView.OptionsView,"","slide-from-right",this)},save:_.debounce(function(){var t=this.collection,n,i;if(!t.length){this.onSuccess();return}n=new Scheduler.Collections[_.capitalizeFirst(this.options.typePlural)];this.$(".filter-grid input.select:checkbox:checked").each(function(){var i=$(this).closest(".filter-item").data("id"),r=t.get(i);n.push(r)});i=new Scheduler.Collections[_.capitalizeFirst(this.options.typePlural)];this.$(".filter-grid input.select:checkbox:not(:checked)").each(function(){var n=$(this).closest(".filter-item").data("id"),r=t.get(n);i.push(r)});n.size()?this.updateSelected(n,i):Scheduler.AppView.showDangerAlert("Select at least one "+this.label+".")},500,!0),updateSelected:function(n,t){n.forEach(function(n){n.set("selected",!0)});t.forEach(function(n){n.set("selected",!1)});this.showSpinner();this.collection.update({error:this.onError,success:this.onSuccess})},onError:function(n,t){Scheduler.AppView.showError(t);this.hideSpinner()},onSuccess:function(){this.options.isEntryFilter||Scheduler.AppView.showSuccessAlert("Saved selected "+this.labelPlural+".");this.collection.trigger("updated:selected");Scheduler.AppView.backToMain(Scheduler.AppView.OptionsView,"","slide-from-right",this);this.hideSpinner()},selectAll:function(n){this.$(".filter-grid input.select:checkbox").prop("checked",n.currentTarget.checked)},selected:function(){var n=this.$(".filter-grid input.select:checkbox:checked").length===this.collection.length;this.$(".filter-grid .select-all").prop("checked",n)},selectRow:function(n){if(n.target.type!=="checkbox"){var r=this.$(n.currentTarget),t,i=r.find("input[type=checkbox]");i.prop("checked",!i.prop("checked"));t=this.$(".filter-grid input.select:checkbox:checked").length===this.collection.length;this.$(".filter-grid .select-all").prop("checked",t)}},showSpinner:function(){this.$(".btn-save i").removeClass("fa-check").addClass("fa-spinner fa-spin")},hideSpinner:function(){this.$(".btn-save i").addClass("fa-check").removeClass("fa-spinner fa-spin")}});Scheduler.Views.FilterRadioIndex=Backbone.View.extend({template:JST["filter/radio-index"],a11yTemplate:JST["accessibility/filter/radio-index"],className:"filter-radio-index",events:{"click .btn-cancel":"backToOptions","click .btn-save":"continueOn","click .filter-grid tbody tr":"selectRow"},initialize:function(n){n=n||{};this.options=n;this.label=Scheduler.Config.text[this.options.type]||Scheduler.Config.text[this.options.typePlural];this.labelPlural=Scheduler.Config.text[this.options.type+"Plural"]||Scheduler.Config.text[this.options.typePlural+"Plural"];_.bindAll(this,"render","renderTemplate","backToOptions","continueOn","save","onSuccess","onError");this.options.isEntryFilter?this.listenTo(this.collection,"updated:next",this.updatedSelected):this.listenTo(this.collection,"updated:selected",this.updatedSelected);this.collection.selected().length||this.collection.setSelected(this.collection.first());this.render()},render:function(){return this.renderTemplate(),this},renderTemplate:function(){this.$el.html(this.template({label:this.label,models:this.collection.toJSON(),isEntryFilter:this.options.isEntryFilter,message:this.getMessage()}))},getMessage:function(){var t=this.options.typePlural,n=_.find(Scheduler.Config.filterSettings.data,function(n){return n.type===t});return n===undefined?"":n.entryMessage},backToOptions:function(){Scheduler.AppView.backToMain(Scheduler.AppView.OptionsView,"","slide-from-right",this)},continueOn:function(){var n=this.$("input[type=radio].option-select:checked").val();return this.save(n),!1},selectRow:function(n){if(n.target.type!=="radio"){var i=this.$(n.currentTarget),t=i.find("input[type=radio]");t.prop("checked",!t.prop("checked"))}},save:function(n){if(!this.collection.length){this.onSuccess();return}var t=this.collection.get(n);t?(this.showSpinner(),this.options.type==="term"?this.collection.setSelected(t):t.save({},{wait:!0,error:this.onError,success:this.onSuccess})):Scheduler.AppView.showDangerAlert("Please select a "+this.label+".")},onError:function(n,t){Scheduler.AppView.showError(t);this.hideSpinner()},onSuccess:function(n){this.collection.setSelected(n);this.collection.trigger("updated:selected");Scheduler.AppView.backToMain(Scheduler.AppView.OptionsView,"","slide-from-right",this);this.hideSpinner()},updatedSelected:function(){this.isEntryFilter||Scheduler.AppView.showSuccessAlert(this.label+" changed to "+this.collection.selected()[0].get("title"));this.hideSpinner();Scheduler.AppView.backToMain(Scheduler.AppView.OptionsView,"","slide-from-right",this)},showSpinner:function(){this.$(".btn-save i").removeClass("fa-check").addClass("fa-spinner fa-spin")},hideSpinner:function(){this.$(".btn-save i").addClass("fa-check").removeClass("fa-spinner fa-spin")}});Scheduler.Views.HelpIndex=Backbone.View.extend({template:JST["help/index"],a11yTemplate:JST["accessibility/help/index"],className:"help-section",initialize:function(){_.bindAll(this,"render","renderTemplate");var n=this;$.when($.getJSON("/api/help/links",function(t){n.links=t}),$.getJSON("/api/help/videos",function(t){n.videos=t})).done(this.render)},render:function(){return this.renderTemplate(),this},renderTemplate:function(){this.$el.html(this.template({videos:this.videos,links:this.links}))},events:{"click .btn-cancel":"backToOptions"},backToOptions:function(){window.history.back()}});Scheduler.Views.Alert=Backbone.View.extend({template:JST["layout/alert"],className:"alert alert-hover alert-success alert-global fade in",initialize:function(n){n=n||{};this.alertType=n.alertType;this.msg=n.msg;this.msgArray=n.msgArray;this.alertType==="danger"?this.icon="glyphicons circle_exclamation_mark":this.alertType==="success"&&(this.icon="fa fa-check");_.bindAll(this,"render","renderTemplate","closeAlert");this.render();$(".alert.alert-hover").alert("close");$("body").prepend(this.el);setTimeout(_.bind(function(){this.$el.alert("close");setTimeout(_.bind(function(){this.remove()},this),100)},this),4e3)},render:function(){return this.renderTemplate(),this.alertType&&(this.$el.removeClass("alert-success"),this.$el.addClass("alert-"+this.alertType)),this},renderTemplate:function(){this.$el.html(this.template({icon:this.icon,msg:this.msg,msgArray:this.msgArray}))},events:{"click .close":"closeAlert"},closeAlert:function(){setTimeout(_.bind(function(){this.remove()},this),100)}});Scheduler.Views.AppView=Backbone.View.extend({el:"#scheduler-app",initialize:function(n){_.bindAll(this,"render","showView","showMobileViewWithTransition","updateFilters","dataUpdateSuccess","dataUdateError");this.academicCareers=n.academicCareers;this.academicGroups=n.academicGroups;this.breaks=n.breaks;this.campuses=n.campuses;this.cartSections=n.cartSections;this.courses=n.courses;this.currentSections=n.currentSections;this.instructionModes=n.instructionModes;this.courseStatuses=n.courseStatuses;this.locations=n.locations;this.partsOfTerm=n.partsOfTerm;this.registrationWarnings=n.registrationWarnings;this.sessions=n.sessions;this.terms=n.terms;this.degreeplannerDegreePlan=n.degreeplannerDegreePlan;this.favoriteSchedules=n.favoriteSchedules;this.terms.length&&!this.terms.selected().length&&this.terms.setSelected(Scheduler.Data.CurrentTerm);this.courseStatuses.length&&(this.courseStatuses.selected().length?this.courseStatuses.setSelected(this.courseStatuses.findWhere({selected:!0})):this.courseStatuses.setSelected(this.courseStatuses.first()));this.$content=this.$("#content");this.$frontPage=$("<div>",{id:"front-page"});this.$frontPageContent=$("<div>",{id:"front-page-content",role:"region","aria-live":"polite"});this.$frontPage.html(this.$frontPageContent);this.$content.html(this.$frontPage);this.listenTo(this.terms,"update:filters",this.updateFilters);this.render()},render:function(){this.BreaksView=new Scheduler.Views.BreakIndex({collection:this.breaks});this.CoursesView=new Scheduler.Views.CourseIndex({collection:this.courses});Scheduler.Config.degreePlannerSettings.enabled&&(this.degreeplannerDegreePlan.fetch(),this.DegreeplannerView=new Scheduler.Views.DegreeplannerOverview({model:this.degreeplannerDegreePlan,currentYear:null}));this.ShoppingCart=new Scheduler.Views.SectionShoppingCart({collection:this.cartSections});this.CurrentSchedule=new Scheduler.Views.SectionCurrentSchedule({collection:this.currentSections});Scheduler.Accessibility&&(this.CourseAccessibilityControls=new Scheduler.Views.CourseAccessibilityControls);this.OptionsView=new Scheduler.Views.OptionIndex({academicCareers:this.academicCareers,academicGroups:this.academicGroups,campuses:this.campuses,instructionModes:this.instructionModes,locations:this.locations,courseStatuses:this.courseStatuses,partsOfTerm:this.partsOfTerm,sessions:this.sessions,terms:this.terms});this.TipsDesktopView=new Scheduler.Views.TipsDesktop;this.SchedulesView=new Scheduler.Views.ScheduleIndex({favoriteSchedules:this.favoriteSchedules});this.$frontPageContent.append(this.OptionsView.el);this.$frontPageContent.append(this.TipsDesktopView.el);var n=$("<div>",{"class":"row"});return this.$frontPageContent.append(n),n.append(this.CoursesView.el),n.append(this.BreaksView.el),n.append(this.CurrentSchedule.el),n.append(this.ShoppingCart.el),this.CourseAccessibilityControls&&n.append(this.CourseAccessibilityControls.el),this.$frontPageContent.append(this.SchedulesView.el),this.currentView=this.mobileView=this.OptionsView,this.Header=new Scheduler.Views.Header,this.Footer=new Scheduler.Views.Footer({selectedBreaks:this.BreaksView.SelectedBreaks,courses:this.courses}),this.$frontPage.append(this.Footer.el),this},showSuccessAlert:function(n){var t=new Scheduler.Views.Alert({alertType:"success",msg:n})},showDangerAlert:function(n,t){var i=new Scheduler.Views.Alert({alertType:"danger",msg:n,msgArray:t})},showWarningAlert:function(n,t){var i=new Scheduler.Views.Alert({alertType:"warning",msg:n,msgArray:t})},showError:function(n){var i,t;if(n.status===401){i=new Scheduler.Views.SignedOut;Scheduler.AppView.signOut(i);return}t="<p>An invalid request occurred in the scheduler.<\/p><p>The contents of the request have been e-mailed to the appropriate person(s) and will be taken care of as soon as possible.<\/p>";n.status===429?t=n.responseJSON:n.responseJSON?t=n.responseJSON.message:n.responseText&&n.responseText.substring(0,9)!=="<!DOCTYPE"&&(t=n.responseText);this.showDangerAlert(t)},showErrorList:function(n){var r=_.map(n,function(n){return n.status}),t,i;if(_.contains(r,401)){i=new Scheduler.Views.SignedOut;Scheduler.AppView.signOut(i);return}t=_.map(n,function(n){return n.ResponseJSON?n.ResponseJSON.message:n.responseText||"Something went wrong."});Scheduler.AppView.showDangerAlert("Please see the following errors",t)},showViewWithTransition:function(n,t){n.$el.addClass(t);$.support.transition&&n.$el.one($.support.transition.end,function(){n.$el.removeClass(t).removeClass("in")}).emulateTransitionEnd(150);this.showView(n);n.$el[0].offsetWidth;n.$el.addClass("in")},showView:function(n){this.hideMain();this.canRemoveCurrentView()&&this.currentView.remove();this.overlayView&&this.overlayView.remove();this.currentView=n;this.$content.append(this.currentView.el)},showOverlayViewWithTransition:function(n,t){n.$el.addClass(t);$.support.transition&&n.$el.one($.support.transition.end,function(){n.$el.removeClass(t).removeClass("in")}).emulateTransitionEnd(150);this.showOverlayView(n);n.$el[0].offsetWidth;n.$el.addClass("in")},showOverlayView:function(n){this.$frontPage.hide();this.currentView.$el.hide();this.overlayView=n;this.$content.append(this.overlayView.el)},removeOverlayView:function(){this.overlayView.$el.fadeOut("fast",_.bind(function(){this.currentView===this.mobileView&&this.$frontPage.show();this.overlayView.remove();this.overlayView=null;this.currentView.$el.fadeIn("fast")},this))},backToMain:function(n,t,i,r){if(this.isDirty){SchedulerHelpers.confirmBox("You have unsaved changes. Are you sure you want to leave this page?",_.bind(function(u){u&&(this.clearDirty(),this.showMainWithTransition(n,t,i,r))},this));return}this.showMainWithTransition(n,t,i,r)},showMainWithTransition:function(n,t,i){if(this.canRemoveCurrentView()&&Backbone.history.fragment!=="entry"){Scheduler.AppRouter.navigateWithTerm(t);var r=this.currentView;n&&$.support.transition&&i?n.$el.one($.support.transition.end,_.bind(function(){this.showMain();this.showMobileView(n)},this)).emulateTransitionEnd(150):(this.showMain(),this.showMobileView(n));i&&r.$el.addClass(i)}},hideMain:function(){this.$frontPage.hide()},showMain:function(){this.canRemoveCurrentView()&&(this.currentView.remove(),this.currentView=null);this.overlayView&&this.overlayView.remove();this.$frontPage.show()},showMobileViewWithTransition:function(n,t){this.$frontPageContent.fadeOut("fast",_.bind(function(){this.showMobileView(n);this.$frontPageContent.fadeIn("fast")},this));this.Footer.setSelectedTab(t)},showMobileView:function(n){this.canRemoveCurrentView()&&(this.currentView.remove(),this.showMain());this.overlayView&&(this.overlayView.remove(),this.showMain());this.mobileView&&(this.mobileView.$el.show(),this.mobileView.$el.addClass("hidden-xs"),this.mobileView.$el.addClass("hidden-sm"),this.CurrentSchedule&&this.mobileView===this.CoursesView&&(this.CurrentSchedule.$el.addClass("hidden-xs"),this.CurrentSchedule.$el.addClass("hidden-sm")),this.ShoppingCart&&this.mobileView===this.CoursesView&&(this.ShoppingCart.$el.addClass("hidden-xs"),this.ShoppingCart.$el.addClass("hidden-sm")),this.CourseAccessibilityControls&&this.mobileView===this.CoursesView&&(this.CourseAccessibilityControls.$el.addClass("hidden-xs"),this.CourseAccessibilityControls.$el.addClass("hidden-sm")));this.currentView=this.mobileView=n;this.mobileView.$el.removeClass("hidden-xs");this.mobileView.$el.removeClass("hidden-sm");this.CurrentSchedule&&this.mobileView===this.CoursesView&&(this.CurrentSchedule.$el.removeClass("hidden-xs"),this.CurrentSchedule.$el.removeClass("hidden-sm"));this.ShoppingCart&&this.mobileView===this.CoursesView&&(this.ShoppingCart.$el.removeClass("hidden-xs"),this.ShoppingCart.$el.removeClass("hidden-sm"));this.CourseAccessibilityControls&&this.mobileView===this.CoursesView&&(this.CourseAccessibilityControls.$el.removeClass("hidden-xs"),this.CourseAccessibilityControls.$el.removeClass("hidden-sm"))},startSpinner:function(n){n=n||this.$el;n.append('<i class="main-spinner fa fa-spinner fa-spin"><\/i>')},stopSpinner:function(n){n=n||this.$el;n.find(".main-spinner").remove()},isCurrentView:function(n){return n===this.currentView},canRemoveCurrentView:function(){return this.currentView?this.currentView===this.OptionsView||this.currentView===this.CoursesView||this.currentView===this.BreaksView||this.currentView===this.SchedulesView?!1:!0:!1},signOut:function(n){this.BreaksView.remove();this.CoursesView.remove();this.ShoppingCart.remove();this.CurrentSchedule.remove();this.OptionsView.remove();this.Footer.remove();this.currentView&&this.currentView.remove();this.CourseAccessibilityControls&&this.CourseAccessibilityControls.remove();this.$frontPage.remove();this.Header.signOut();this.currentView=n;this.$content.append(n.el);setTimeout(function(){$.post("/api/authentication/signout",function(){Scheduler.Config.homeSettings.skipSignOutScreen&&(window.location.href=Scheduler.Config.sisSettings.logOutUrl)})},250)},makeDirty:function(){this.isDirty=!0;window.onbeforeunload=function(){return"You have unsaved changes. Are you sure you want to leave this page?"}},clearDirty:function(){this.isDirty=!1;window.onbeforeunload=null},updateFilters:function(){var n=new Scheduler.Models.AppData({id:Scheduler.Data.CurrentTerm.id});n.fetch({success:this.dataUpdateSuccess,error:this.dataUdateError})},afterFilterUpdate:function(){Scheduler.Data.Terms.trigger("updated:selected");Scheduler.Data.CourseStatuses.trigger("updated:all")},dataUpdateSuccess:function(n){this.academicCareers&&(this.academicCareers.set(n.get("academicCareers")),this.academicCareers.trigger("updated:all"));this.academicGroups&&(this.academicGroups.set(n.get("academicGroups")),this.academicGroups.trigger("updated:all"));this.campuses&&(this.campuses.set(n.get("campuses")),this.campuses.trigger("updated:all"));this.instructionModes&&(this.instructionModes.set(n.get("instructionModes")),this.instructionModes.trigger("updated:all"));this.locations&&(this.locations.set(n.get("locations")),this.locations.trigger("updated:all"));this.partsOfTerm&&(this.partsOfTerm.set(n.get("partsOfTerm")),this.partsOfTerm.trigger("updated:all"));this.registrationWarnings&&(this.registrationWarnings.set(n.get("registrationWarnings")),this.registrationWarnings.trigger("updated:all"));this.sessions&&(this.sessions.set(n.get("sessions")),this.sessions.trigger("updated:all"));this.cartSections&&(this.cartSections.term=Scheduler.Data.CurrentTerm,this.cartSections.set(n.get("cartSections")),this.cartSections.trigger("updated:all"));this.courses&&(this.courses.term=Scheduler.Data.CurrentTerm,this.courses.set(n.get("courses")),this.courses.trigger("updated:all"));this.currentSections&&(this.currentSections.term=Scheduler.Data.CurrentTerm,this.currentSections.set(n.get("currentSections")),this.currentSections.trigger("updated:all"));this.favoriteSchedules&&this.favoriteSchedules.setTerm(Scheduler.Data.CurrentTerm);this.afterFilterUpdate()},dataUdateError:function(n,t){Scheduler.AppView.showError(t);this.afterFilterUpdate()}});Scheduler.Views.BreakLink=Backbone.View.extend({template:JST["layout/break-link"],initialize:function(){_.bindAll(this,"render","renderTemplate");this.render();this.listenTo(this.collection,"add",this.render);this.listenTo(this.collection,"remove",this.render)},render:function(){return this.renderTemplate(),this},renderTemplate:function(){this.$el.html(this.template({text:"Breaks",count:this.collection.length}))}});Scheduler.Views.CourseLink=Backbone.View.extend({template:JST["layout/course-link"],initialize:function(){_.bindAll(this,"render","renderTemplate");this.render();this.listenTo(this.collection,"add",this.render);this.listenTo(this.collection,"remove",this.render);this.listenTo(this.collection,"change:selected",this.render);this.listenTo(this.collection,"reset",this.render)},render:function(){return this.renderTemplate(),this},renderTemplate:function(){this.$el.html(this.template({text:"Courses",count:this.collection.selected().length}))}});Scheduler.Views.Footer=Backbone.View.extend({id:"#footer",template:JST["layout/footer"],a11yTemplate:JST["accessibility/layout/footer"],initialize:function(n){n=n||{};this.selectedBreaks=n.selectedBreaks;this.courses=n.courses;_.bindAll(this,"render","renderTemplate","setSelectedTab");this.render();this.setSelectedTab("options")},render:function(){return this.renderTemplate(),this.breakLink=new Scheduler.Views.BreakLink({el:this.$el.find("#break-footer-link"),collection:this.selectedBreaks}),this.courseLink=new Scheduler.Views.CourseLink({el:this.$el.find("#course-footer-link"),collection:this.courses}),this},renderTemplate:function(){this.$el.html(this.template())},events:{"click #options-link":"showOptions","click #breaks-link":"showBreaks","click #course-footer-link":"showCourses","click #schedules-link":"showSchedules","click .btn-leave-a11y":"confirmLeaveAccessibility","click #degreeplanner-link":"showDegreeplanner"},showOptions:function(){return Backbone.history.fragment==="options"?!1:(Scheduler.AppView.showMobileViewWithTransition(Scheduler.AppView.OptionsView),Scheduler.AppRouter.navigateWithTerm("options"),this.setSelectedTab("options"),!1)},showBreaks:function(){return Backbone.history.fragment==="breaks"?!1:(Scheduler.AppView.showMobileViewWithTransition(Scheduler.AppView.BreaksView),Scheduler.AppRouter.navigateWithTerm("breaks"),this.setSelectedTab("breaks"),!1)},showDegreeplanner:function(){return Backbone.history.fragment==="degreeplanner"?!1:(Scheduler.AppView.showMobileViewWithTransition(Scheduler.AppView.DegreeplannerView),Scheduler.AppRouter.navigateWithTerm("degreeplanner"),this.setSelectedTab("degreeplanner"),!1)},showCourses:function(){return Backbone.history.fragment==="courses"?!1:(Scheduler.AppView.showMobileViewWithTransition(Scheduler.AppView.CoursesView),Scheduler.AppRouter.navigateWithTerm("courses"),this.setSelectedTab("courses"),!1)},showSchedules:function(){return Backbone.history.fragment==="schedules"?!1:(Scheduler.AppView.showMobileViewWithTransition(Scheduler.AppView.SchedulesView),Scheduler.AppRouter.navigateWithTerm("schedules"),this.setSelectedTab("schedules"),!1)},setSelectedTab:function(n){this.selectedTab&&this.$el.find("."+this.selectedTab+"-tab").removeClass("active");this.selectedTab=n;this.$el.find("."+this.selectedTab+"-tab").addClass("active")},confirmLeaveAccessibility:function(){SchedulerHelpers.confirmBox("Exit "+Scheduler.Config.text.plannerTitle+" text only mode and return to non-accessibility mode?",function(n){if(n){var t="/spa",i=window.location.pathname.substring(1).split("/");i.length===2&&(t+="/"+i[1]);window.location=t+"#entry"}})}});Scheduler.Views.Header=Backbone.View.extend({el:"#header",template:JST["layout/header"],a11yTemplate:JST["accessibility/layout/header"],events:{"click .btn-header-back":"goBack","click .navbar-toggle":"onMenuClick","click .signout":"onSignoutClick"},initialize:function(){_.bindAll(this,"render","renderTemplate","onRouteExecute","onNavigate","setHeaderVisibility");this.$el.addClass("scheduler-nav");this.render();this.listenTo(Scheduler.AppRouter,"execute",this.onRouteExecute);this.listenTo(Scheduler.AppRouter,"navigate",this.onNavigate);this.listenTo(Scheduler.Data.Terms,"updated:selected",this.render)},render:function(){return this.renderTemplate(),this},renderTemplate:function(){var n=Scheduler.Config.degreePlannerSettings;this.$el.html(this.template({title:Scheduler.Config.text.plannerTitle,accRoute:Scheduler.Config.homeSettings.accessibilityRoute,accText:Scheduler.Config.homeSettings.accessibilityText,helpText:Scheduler.Config.homeSettings.helpText,helpUrl:Scheduler.Config.homeSettings.helpUrl,signoutText:Scheduler.Config.homeSettings.signoutText,showAccessibleIcon:Scheduler.Config.homeSettings.showAccessibleIcon,accessibleIconUrl:Scheduler.Config.homeSettings.accessibleIconUrl,showCustomLink:Scheduler.Config.homeSettings.customLinkText&&Scheduler.Config.homeSettings.customLinkUrl,customLinkText:Scheduler.Config.homeSettings.customLinkText,customLinkUrl:Scheduler.Config.homeSettings.customLinkUrl,degreePlannerInMenu:n.enabled&&n.showInDropdownMenu,degreePlannerInNav:n.enabled&&!n.showInDropdownMenu}))},onRouteExecute:function(n){this.isFrontPageRoute(n)?this.$el.removeClass("has-back-button"):this.$el.addClass("has-back-button");this.setHeaderVisibility(n);Scheduler.Config.degreePlannerSettings.enabled&&(/^degreePlanner/.test(n)?this.loadDegreePlannerMenu():this.loadSchedulerMenu())},loadDegreePlannerMenu:function(){this.$el.is(".scheduler-nav")&&(this.$(".primary-title").text(Scheduler.Config.degreePlannerSettings.title).attr("href","#degreeplanner"),this.$(".secondary-title").text(Scheduler.Config.text.plannerTitle).attr("href","#"),this.$el.addClass("degreeplanner-nav").removeClass("scheduler-nav"),this.$(".acc-link").attr("href","/accessible#degreeplanner"))},loadSchedulerMenu:function(){this.$el.is(".degreeplanner-nav")&&(this.$(".primary-title").text(Scheduler.Config.text.plannerTitle).attr("href","#"),this.$(".secondary-title").text(Scheduler.Config.degreePlannerSettings.title).attr("href","#degreeplanner"),this.$el.addClass("scheduler-nav").removeClass("degreeplanner-nav"),this.$(".acc-link").attr("href",Scheduler.Config.homeSettings.accessibilityRoute))},isFrontPageRoute:function(n){return _.contains(["options","breaks","courses","entry","schedules","optionsWithTerm","breaksWithTerm","coursesWithTerm","schedulesWithTerm","degreePlannerMain"],n)},onNavigate:function(n){var t="",i=n.lastIndexOf("/");i!==-1&&(t=n.substring(i+1));t===""||t==="options"||t==="breaks"||t==="courses"||t==="entry"||t==="schedules"?this.$el.removeClass("has-back-button"):this.$el.addClass("has-back-button");this.setHeaderVisibility(t)},setHeaderVisibility:function(n){Scheduler.Accessibility&&(n==="entry"?this.$el.hide():this.$el.show())},goBack:function(n){var t=this.$(n.currentTarget);t.blur();Scheduler.AppView.overlayView?Scheduler.AppView.removeOverlayView():window.history.back()},openHelpWindow:function(){if(Scheduler.Config.homeSettings.helpUrl)return window.open(Scheduler.Config.homeSettings.helpUrl),!1},onMenuClick:function(n){var t=this.$(n.currentTarget);t.blur()},onSignoutClick:function(){return SchedulerHelpers.confirmBox("Are you sure you would like to exit "+Scheduler.Config.text.plannerTitle+"?",_.bind(function(n){n&&this.confirmSignout()},this)),!1},confirmSignout:function(){var n=new Scheduler.Views.SignedOut;return Scheduler.AppView.signOut(n),Scheduler.Config.homeSettings.closeOnSignOut&&$.post("/api/authentication/signout").then(function(){window.open("","_self","");window.close()}),!1},signOut:function(){this.$el.find(".btn-header-back").remove();this.$el.find(".help-link").remove();this.$el.find(".signout-link").remove();this.$el.find(".acc-link").remove();this.$el.find(".brand-dropdown").remove();this.$el.find(".dp-mobile-brand").remove();this.$el.find(".navbar-brand").replaceWith('<span class="navbar-brand">'+Scheduler.Config.text.plannerTitle+"<\/span>");this.$el.find(".acc-nav").remove();this.$el.find(".acc-header").text(Scheduler.Config.text.plannerTitle)}});Scheduler.Views.SignedOut=Backbone.View.extend({template:JST["layout/signed-out"],initialize:function(){_.bindAll(this,"render","renderTemplate");this.render()},events:{"click .btn-close-window":"closeWindow"},render:function(){return this.renderTemplate(),this},renderTemplate:function(){this.$el.html(this.template({signedOutMsg:"You have been logged out due to inactivity or by clicking 'Sign Out'.",cookieMsg:"You must have cookies enabled in your browser to use the "+Scheduler.Config.text.plannerTitle+".",signInUrlMsg:"Click here to login again",signInUrl:Scheduler.Config.sisSettings.logOutUrl,closeWindowMsg:"Click here to close this window",closeOnSignOut:Scheduler.Config.homeSettings.closeOnSignOut}))},closeWindow:function(){window.open("","_self","");window.close()}});Scheduler.Views.MessageModal=Scheduler.Views.BaseModal.extend({initialize:function(n){n=n||{};_.bindAll(this,"sendMessage","onMessageSuccess","onMessageError");n.size="md";this.generation=n.generation;Scheduler.Views.BaseModal.prototype.initialize.apply(this,[n])},attributes:{tabindex:"-1",role:"dialog","aria-hidden":"true","aria-labelledby":"event"},events:function(){return _.extend({},Scheduler.Views.BaseModal.prototype.events,{"click .btn-send-message":"sendMessage"})},titlePath:"message/modal-title",bodyPath:"message/modal-body",renderTemplate:function(){var n=Scheduler.Config.text.schedule;this.$el.html(this.template({titlePath:this.titlePath,bodyPath:this.bodyPath,instructions:'Enter a recipient email address and click "Email '+n+'"',scheduleLabel:n,showFrom:Scheduler.Config.get("emailSettings.showFromField"),size:this.size,hideTitle:this.hideTitle}))},sendMessage:_.debounce(function(){var t=this.model.registrationBlocks,i=this.$(".input-to").val(),r=this.$(".input-cc").val(),u=this.$(".input-message-body").val(),f=this.$(".input-from").val(),e=this.$(".input-from-name").val(),n=new Scheduler.Models.Message;return this.showSpinner(),n.store(),n.set({to:i,cc:r,body:u,from:f,fromName:e,registrationBlocks:t.toJSON(),sections:t.getSections().toJSON(),term:Scheduler.Data.CurrentTerm.id,showStatus:this.generation.get("currentSections").length>0}),n.isValid()?n.save({},{success:this.onMessageSuccess,error:this.onMessageError}):(Scheduler.AppView.showDangerAlert("Please see the following errors",n.validationError),this.hideSpinner()),!1},500,!0),onMessageSuccess:function(n){this.hideSpinner();Scheduler.AppView.showSuccessAlert("Email sent to "+n.get("to"));this.$el.modal("hide")},onMessageError:function(n,t){Scheduler.AppView.showError(t);this.hideSpinner()},shown:function(){var n=this;setTimeout(function(){n.$(".input-to").focus()},100)},showSpinner:function(){this.$(".send-message i").removeClass("fa-envelope-o").addClass("fa-spinner fa-spin")},hideSpinner:function(){this.$(".send-message i").addClass("fa-envelope-o").removeClass("fa-spinner fa-spin")}});Scheduler.Views.MyPlannerGrid=Backbone.View.extend({template:JST["my-planner/planner-grid"],tagName:"table",className:"my-planner-grid table",events:{"click .btn-mp-add-all":"addSelected","click .mp-select-all":"selectAll","click .mp-select":"select","click .btn-cancel":"back","click .btn-mp-info":"showCourseInfo"},initialize:function(){_.bindAll(this,"render","renderTemplate","select","back","selectAll","showCourseInfo","addSelected","findCourseInfoItem","formatCourseTitle");this.topicModal=null;this.courseInfoItems=[];this.render()},render:function(){return this.renderTemplate(),Modernizr.touch||this.$('[data-toggle="tooltip"]').tooltip(),this},renderTemplate:function(){var n=Scheduler.Data.CurrentTerm.id;this.$el.html(this.template({myPlannerCourses:this.collection.toTemplate(),anyAvailable:this.collection.where({isAvailable:!0}).length,backLabel:Scheduler.Config.courseSettings.addBackLabel,showSelectAllLabel:Scheduler.Config.courseSettings.showMyPlannerSelectAllLabel,currentTerm:n}))},addSelected:_.debounce(function(){var e=Scheduler.Data.CurrentTerm,o=this.$(".mp-select:checkbox:checked"),r=[],u=[],f=[],h=this.invalidAlert,n=[],t=new Scheduler.Collections.MyPlannerCourses,i=0,c=_.bind(function(t){Scheduler.Data.Courses.add(t);r.push(this.formatCourseTitle(t));i++;i===n.length&&this.showFeedback(r,u)},this),l=_.bind(function(t,f){u.push(f);i++;i===n.length&&this.showFeedback(r,u)},this),s;return o.length||Scheduler.AppView.showDangerAlert("Please select a Course"),$.each(o,_.bind(function(i,r){var e=r.value,u=this.collection.get(e);Scheduler.Data.Courses.doesCourseExist(u.get("subjectId"),u.get("number"),u.get("topicId"))?f.push(this.formatCourseTitle(u)):u.get("hasTopics")&&!u.get("topicId")?t.add(u):n.push(u)},this)),_.each(n,function(n){var t=_.clone(n.attributes),i=new Scheduler.Models.DesiredCourse;t.id=null;t.term=e.id;t.topic=n.get("topicId");i.save(t,{success:c,error:l,wait:!0})}),t.length&&(this.topicModal?(this.topicModal.collection=t,this.topicModal.delegateEvents(),this.topicModal.render()):this.topicModal=new Scheduler.Views.TopicSelectionListModal({collection:t,term:e.id}),this.topicModal.show()),f.length&&(s="The following courses have been added already: "+f.join(", "),h([s])),this.clearCheckboxes(),!1},250,!0),formatCourseTitle:function(n){return n.get("topicId")&&n.get("topicTitle")?n.get("subjectShort")+" "+n.get("number")+" - Topic: "+n.get("topicTitle"):n.get("subjectShort")+" "+n.get("number")},showFeedback:function(n,t){if(n.length){var i="Added the following courses: "+_.sortBy(n).join(", ");Scheduler.AppView.showSuccessAlert(i)}t.length&&Scheduler.AppView.showErrorList(_.uniq(t))},back:function(){return Scheduler.AppView.backToMain(Scheduler.AppView.CoursesView,"courses","slide-from-right",this),!1},selectAll:function(n){this.$("input.mp-select:checkbox").prop("checked",n.currentTarget.checked)},select:function(){var n=this.$(".mp-select").length,t=this.$(".mp-select:checkbox:checked").length===n;this.$(".mp-select-all").prop("checked",t)},showCourseInfo:function(n){var t=this.getCourseFromRow(n),i=this.findCourseInfoItem(t);return i?this.removeCourseInfoItem(i):this.addCourseInfoItem(n,t),!1},addCourseInfoItem:function(n,t){var r=$(n.currentTarget).closest(".my-planner-item"),i=new Scheduler.Views.MyPlannerInfoItem({model:t});i.$el.children("td, th").wrapInner('<div style="display: none;" />').parent().insertAfter(r).find("td > div").slideDown(function(){$(this).replaceWith($(this).contents())});this.courseInfoItems.push(i)},removeCourseInfoItem:function(n){this.courseInfoItems=_.without(this.courseInfoItems,n);n.$el.tableRowRemove(function(){n.remove()})},findCourseInfoItem:function(n){return _.find(this.courseInfoItems,function(t){return t.model.cid===n.cid})},getCourseFromRow:function(n){var t=this.getCourseIdFromRow(n);return this.collection.get(t)},getCourseIdFromRow:function(n){var t=this.$(n.currentTarget||n).closest(".my-planner-item");return t.data("id").toString()},clearCheckboxes:function(){this.$("input.mp-select:checkbox").prop("checked",!1);this.$("input.mp-select-all:checkbox").prop("checked",!1)},onError:function(n,t){Scheduler.AppView.showError(t)},invalidAlert:function(n){Scheduler.AppView.showDangerAlert("Please see the following errors",_.uniq(n))}});Scheduler.Views.MyPlannerIndex=Scheduler.Views.CourseAddTab.extend({template:JST["my-planner/index"],tagName:"form",className:"course-my-planner form-horizontal col-md-12",events:{"click .btn-cancel":"back"},initialize:function(){_.bindAll(this,"render","renderTemplate","renderTermsDropDown","renderGrid","termsResults","getCoursesByTerm","onTermSelected","getPreselectedTerm");this.courses={};this.terms=[];this.termPlaceholder="Select a "+Scheduler.Config.text.term.toLowerCase()},_loadData:function(){this.model.fetch({success:this.render,error:this.render})},render:function(){return this.model.get("terms")&&this.model.get("terms").length&&(this.terms=this.model.get("terms"),this.courses=this.getCoursesByTerm(this.getPreselectedTerm().id)),this.renderTemplate(),setTimeout(this.renderTermsDropDown,0),this.renderGrid(),this},renderTemplate:function(){var n="My Planner",t=_.find(Scheduler.Config.courseAddOptions,function(n){return n.id==="my-planner"});t&&(n=t.title);this.$el.html(this.template({plannerTermLabel:Scheduler.Config.text.degreeworksPlanTermLabel,hasData:this.model.get("terms")&&this.model.get("terms").length,backLabel:Scheduler.Config.courseSettings.addBackLabel,terms:this.terms,myPlannerWarning:"You currently have no active plans in "+n+"."}))},renderTermsDropDown:function(){this.$el.find("#mp-term-selector").select2({placeholder:this.termPlaceholder,selectOnBlur:!0,data:this.termsResults,formatSelection:function(n){return n.title},formatResult:function(n){return n.title}}).select2("data",this.getPreselectedTerm()).on("select2-open",this.applyMobileHeaderAbsolute).on("select2-close",this.applyMobileHeaderFixed).on("change",this.onTermSelected).on("select2-selecting",this.onTermSelected)},renderGrid:function(){this.MyPlannerGrid=new Scheduler.Views.MyPlannerGrid({collection:new Scheduler.Collections.MyPlannerCourses(this.courses)});this.$el.find(".my-planner").html(this.MyPlannerGrid.el)},termsResults:function(){return{results:this.terms,text:"title"}},getPreselectedTerm:function(){if(this.terms.length){var t=Scheduler.Data.CurrentTerm,n=_.findWhere(this.terms,{id:t.id});return n?n:this.terms[0]}return{}},onTermSelected:function(n){this.courses=this.getCoursesByTerm(n.val);this.renderGrid()},getCoursesByTerm:function(n){var t=this.model.get("courses");return _.where(t,{term:n})},applyMobileHeaderAbsolute:function(){Modernizr.touch&&$("#header .navbar-fixed-top").addClass("fixfixed")},applyMobileHeaderFixed:function(){Modernizr.touch&&$("#header .navbar-fixed-top").removeClass("fixfixed")},back:function(){return Scheduler.AppView.backToMain(Scheduler.AppView.CoursesView,"courses","slide-from-right",this),!1}});Scheduler.Views.MyPlannerInfoItem=Backbone.View.extend({template:JST["my-planner/info-item"],tagName:"tr",className:"course-info-item",initialize:function(){_.bindAll(this,"render","renderTemplate");this.render()},render:function(){return this.renderTemplate(),this},renderTemplate:function(){var n=Scheduler.Data.CurrentTerm.id,t=Scheduler.Config.courseSettings.text.title||Scheduler.Config.sectionFieldText.title,i=Scheduler.Config.courseSettings.text.description||Scheduler.Config.sectionFieldText.description;this.$el.html(this.template({course:this.model.toTemplate(),unavailableMsg:"This course is not available for the term of "+n,titleLabel:t,descrLabel:i}))}});Scheduler.Views.DisplayLabel=Backbone.View.extend({template:JST["option/display-label"],initialize:function(){_.bindAll(this,"render","renderTemplate");this.render();this.collection&&(this.listenTo(this.collection,"updated:all",this.render),this.listenTo(this.collection,"updated:selected",this.render))},render:function(){return this.renderTemplate(),this},renderTemplate:function(){var n;n=this.model.labelText?this.model.labelText:Scheduler.Config.text[this.model.type]||Scheduler.Config.text[this.model.typePlural];this.$el.html(this.template({label:n,model:this.model}))}});Scheduler.Views.EntryFilter=Backbone.View.extend({template:JST["option/entry-filter"],id:"entry-filter",initialize:function(n){n=n||{};this.setEntryFilterCollection(n.entryFilterData||[]);this.render()},render:function(){return this.renderTemplate(),this.showNextEntryFilter(),this},renderTemplate:function(){this.$el.html(this.template())},showNextEntryFilter:function(){if(this.entryFilters.length!==0){this.subView&&this.subView.remove();var i=this.entryFilters.first(),n=Scheduler.FilterMap[i.get("filter")],r=Scheduler.Data[_.capitalizeFirst(n.typePlural)],t=new Scheduler.Views[n.viewIndex]({collection:r||null,isEntryFilter:!0,type:n.type,typePlural:n.typePlural});this.listenTo(t.collection,"updated:selected",this.popEntryFilter);this.subView=t;this.$el.find("#entry-view").html(t!==null?t.el:"")}},popEntryFilter:function(){var n=this.entryFilters.first().get("filter"),t;n==="Terms"&&Scheduler.Data.CartSections.length&&!Scheduler.Config.filterSettings.skipShoppingCart?(this.entryFilters.shift(),t=new Backbone.Model({filter:"ShoppingCart"}),this.entryFilters.unshift(t)):this.entryFilters.shift();this.entryFilters.length===0?(Scheduler.AppRouter.navigateWithTerm(""),(n==="Terms"||n==="CourseStatuses")&&this.subView.collection.trigger("updated:next")):this.showNextEntryFilter()},setEntryFilterCollection:function(n){var t=new Backbone.Collection;_.each(n,function(n){var i=new Backbone.Model({filter:n});t.push(i)});this.entryFilters=t},remove:function(){this.subView&&this.subView.remove();Backbone.View.prototype.remove.apply(this,arguments)}});Scheduler.Views.OptionIndex=Backbone.View.extend({template:JST["option/index"],a11yTemplate:JST["accessibility/option/index"],className:"options-page",initialize:function(n){_.bindAll(this,"render","renderTemplate","renderLabels","setFilterLabel","render","getOptionFilters");this.options=n;this.render()},renderLabels:function(){this.filterLabels=[];var n=Scheduler.Config.homeFilters;_.each(n,_.bind(function(n){this.setFilterLabel(n)},this))},setFilterLabel:function(n){var t=Scheduler.FilterMap[n],i,r,u;t&&(i=this.options[t.typePlural],r=_.isFunction(t.viewLabel)?t.viewLabel():t.viewLabel,(!i||i.length)&&(u=new Scheduler.Views[r]({model:t,el:this.$("."+t.selectedFilterClass),collection:this.options[t.typePlural]}),this.filterLabels.push(u)))},render:function(){return this.renderTemplate(),this.renderLabels(),this.tipsMobile?(this.tipsMobile.render(),this.tipsMobile.delegateEvents()):this.tipsMobile=new Scheduler.Views.TipsMobile,this.$(".tips-mobile").append(this.tipsMobile.el),this},renderTemplate:function(){var n=Scheduler.Config.homeFilters,t=Math.ceil(n.length/2),i=this.getOptionFilters(n.slice(0,t)),r=this.getOptionFilters(n.slice(t,n.length));this.$el.html(this.template({leftOptionFilters:i,rightOptionFilters:r}))},getOptionFilters:function(n){var t=[];return _.each(n,_.bind(function(n){t.push(Scheduler.FilterMap[n])},this)),t}});Scheduler.Views.RequiredCoursesEntry=Backbone.View.extend({template:JST["option/required-courses-entry"],className:"required-courses",initialize:function(){_.bindAll(this,"render","renderTemplate","renderSelector","saveAndContinue");this.selectors=[];this.collection=new Scheduler.Collections.RequiredCourses({},{term:Scheduler.Data.CurrentTerm});this.coursesCollection=new Scheduler.Collections.Courses({},{term:Scheduler.Data.CurrentTerm});Scheduler.AppView.startSpinner();var n=[];n.push(this.collection.fetch({error:this.fetchError}));$.when.apply($,n).then(this.render)},events:{"click .btn-save":"saveAndContinue"},render:function(){if(Scheduler.AppView.stopSpinner(),this.collection.length===0)return Scheduler.Data.Courses.fetch(),this.collection.trigger("updated:selected"),this;this.renderTemplate();var n=this.renderSelector;return this.collection.each(function(t){n(t)}),this},renderSelector:function(n){var t=new Scheduler.Collections.Courses(n.get("courses")),i,r;this.coursesCollection.add(t.models);t.length===1&&(r=t.first().id);i=new Scheduler.Views.Select({id:n.get("requirementId")+"-selector",placeholder:"Select "+Scheduler.Config.text.course,dataText:"displayTitle",collection:t,defaultSelection:r});this.$('.select-container[data-id="'+n.get("requirementId")+'"]').html(i.el);this.selectors.push(i)},renderTemplate:function(){this.$el.html(this.template({models:this.collection.toTemplate()}))},saveAndContinue:_.debounce(function(){var i=this.coursesCollection,n=[],t;if(_.each(this.selectors,function(r){t=i.get(r.getSelected());t&&n.push(t)}),n.length!==this.selectors.length){Scheduler.AppView.showDangerAlert("Please select "+Scheduler.Config.text.requiredCourses.toLowerCase()+".");return}this.addSelected(n);this.collection.trigger("updated:selected");Scheduler.AppView.backToMain(Scheduler.AppView.OptionsView,"","slide-from-right",this)},250,!0),addSelected:function(n){var o=Scheduler.Data.CurrentTerm,u=[],f=[],e=[],h=this.invalidAlert,t=[],i=new Scheduler.Collections.MyPlannerCourses,r=0,c=_.bind(function(n){Scheduler.Data.Courses.add(n);u.push(this.formatCourseTitle(n));r++;r===t.length&&this.showFeedback(u,f)},this),l=_.bind(function(n,i){f.push(i);r++;r===t.length&&this.showFeedback(u,f)},this),s;_.each(n,_.bind(function(n){Scheduler.Data.Courses.doesCourseExist(n.get("subjectId"),n.get("number"),n.get("topicId"))?e.push(this.formatCourseTitle(n)):n.get("hasTopics")&&!n.get("topicId")?i.add(n):t.push(n)},this));_.each(t,function(n){var t=_.clone(n.attributes),i=new Scheduler.Models.DesiredCourse;t.id=null;t.term=o.id;t.topic=n.get("topicId");i.save(t,{success:c,error:l,wait:!0})});i.length&&(this.topicModal?(this.topicModal.collection=i,this.topicModal.delegateEvents(),this.topicModal.render()):this.topicModal=new Scheduler.Views.TopicSelectionListModal({collection:i,term:o.id}),this.topicModal.show());e.length&&(s="The following courses have been added already: "+e.join(", "),h([s]))},formatCourseTitle:function(n){return n.get("topicId")&&n.get("topicTitle")?n.get("subjectShort")+" "+n.get("number")+" - Topic: "+n.get("topicTitle"):n.get("subjectShort")+" "+n.get("number")},showFeedback:function(n,t){if(n.length){var i="Added the following courses: "+_.sortBy(n).join(", ");Scheduler.AppView.showSuccessAlert(i)}t.length&&Scheduler.AppView.showErrorList(_.uniq(t))},invalidAlert:function(n){Scheduler.AppView.showDangerAlert("Please see the following errors",_.uniq(n))},fetchError:function(n,t){Scheduler.AppView.stopSpinner();Scheduler.AppView.showError(t)},remove:function(){_.each(this.selectors,function(n){n.remove()});Backbone.View.prototype.remove.apply(this,arguments)}});Scheduler.Views.SelectedLabel=Backbone.View.extend({template:JST["option/selected-label"],a11yTemplate:JST["accessibility/option/selected-label"],initialize:function(){_.bindAll(this,"render","renderTemplate","goToFilter");this.label=Scheduler.Config.text[this.model.type]||Scheduler.Config.text[this.model.typePlural];this.labelPlural=Scheduler.Config.text[this.model.type+"Plural"]||Scheduler.Config.text[this.model.typePlural+"Plural"];this.render();this.listenTo(this.collection,"updated:all",this.render);this.listenTo(this.collection,"updated:selected",this.render)},render:function(){return this.renderTemplate(),this},events:{"click .btn-filter-link":"goToFilter"},renderOneToManyLabel:function(){var n=_.find(Scheduler.Config.filterSettings.data,_.bind(function(n){return n.type===this.model.typePlural},this)),i=[],r=this.collection.selected().length,u=this.collection.length,f="All "+this.labelPlural+" Selected",t=r===u,e=r+" of "+u+" Selected";if(n&&n.showSelected){if(!n.collapseAll||n.collapseAll&&!t)return _.each(this.collection.selected(),function(n){i.push(n.get("title"))}),i.join("<br>");if(n.collapseAll&&t)return f}return t?f:e},renderDropDownLabel:function(){var n=this.collection.selected()[0],t=n.toTemplate();return t.title},renderTemplate:function(){this.$el.html(this.template({model:this.model,labelText:this.model.isDropDown?this.label:this.labelPlural,selectedLabelText:this.model.isDropDown?this.renderDropDownLabel():this.renderOneToManyLabel()}))},goToFilter:function(){var n=new Scheduler.Views[this.model.viewIndex]({collection:this.collection,type:this.model.type,typePlural:this.model.typePlural});return Scheduler.AppRouter.navigateWithTerm(this.model.typePlural.toLowerCase()),Scheduler.AppView.showViewWithTransition(n,"slide-from-right"),!1}});Scheduler.Views.ShoppingCartEntry=Backbone.View.extend({template:JST["option/shopping-cart-entry"],className:"shopping-cart",initialize:function(){_.bindAll(this,"render","renderTemplate","continueOn");this.listenTo(this.collection,"reset",this.render);this.render()},events:{"click .btn-save":"continueOn"},render:function(){return this.renderTemplate(),this.currentSectionsGrid?(this.currentSectionsGrid.render(),this.currentSectionsGrid.delegateEvents()):this.currentSectionsGrid=new Scheduler.Views.SectionProvidedGrid({collection:this.collection,fieldSettings:Scheduler.Config.cartSectionFieldSettings}),this.$(".section-grid-container").append(this.currentSectionsGrid.el),this},renderTemplate:function(){this.$el.html(this.template({title:Scheduler.Config.cartSettings.cartLabel,plannerTitle:Scheduler.Config.text.plannerTitle,collection:this.collection.toTemplate(),link:"/registration_signout/"+Scheduler.Data.CurrentTerm.id,cancelText:Scheduler.Config.cartSettings.cartEntryCancelText,continueText:Scheduler.Config.cartSettings.cartEntryContinueText}))},continueOn:function(){this.collection.trigger("updated:selected");Scheduler.AppView.backToMain(Scheduler.AppView.OptionsView,"","slide-from-right",this)}});Scheduler.Views.RegistrationError=Backbone.View.extend({template:JST["registration/error"],className:"registration-error",initialize:function(n){this.showStatusCol=n.showStatusCol;this.sectionId=n.sectionId;_.bindAll(this,"render","renderTemplate");this.render()},render:function(){return this.renderTemplate(),this.sectionGrid=new Scheduler.Views.SectionDetailGrid({collection:this.model.registrationBlocks,model:this.model,fieldSettings:Scheduler.Config.scheduleSectionFieldSettings,showColorCol:!1,showSelectCol:!1,showStatusCol:this.showStatusCol,sectionId:this.sectionId}),this.$el.find(".section-grid-row").append(this.sectionGrid.el),this.listenTo(this.sectionGrid,"section-changed",this.changeUrl),this},renderTemplate:function(){var n=this.model.registrationBlocks.sections.filter(function(n){return!n.get("enrollmentStatus")});this.$el.html(this.template({alertTitle:"Send To "+Scheduler.Config.cartSettings.cartLabel+" Unsuccessful:",errorMessages:Scheduler.Config.cartSettings.errorMessages,portalTitle:Scheduler.Config.text.portalTitle,registrationUrl:Scheduler.Config.sisSettings.registrationUrl,attributeText:Scheduler.Config.sectionFieldText,alternateInstructions:Scheduler.Config.scheduleSettings.alternateRegistrationInstructions,sections:_.map(n,function(n){return n.toTemplate()})}))},changeUrl:function(n){this.sectionId=n;var t="registration/"+this.model.id;n&&(t+="/section/"+n);Scheduler.AppRouter.navigateWithTerm(t,{replace:!0})}});Scheduler.Views.RegistrationSuccess=Backbone.View.extend({template:JST["registration/success"],className:"registration-success",initialize:function(){_.bindAll(this,"render","renderTemplate");this.render()},render:function(){return this.renderTemplate(),this},renderTemplate:function(){this.$el.html(this.template({alertBody:"Thank you. Your schedule is now ready to be imported. Please follow the instructions below.",instructions:Scheduler.Config.cartSettings.successInstructions,showCartImage:Scheduler.Config.scheduleSettings.showCartImage,showCloseButton:Scheduler.Config.cartSettings.showSuccessCloseButton&&!!window.opener,plannerTitle:Scheduler.Config.text.plannerTitle}))}});Scheduler.Views.ScheduleCompareActions=Backbone.View.extend({template:JST["schedule/compare-actions"],className:"compare-actions",initialize:function(){_.bindAll(this,"render","renderTemplate","showCalendarTooltip","unselect");this.listenTo(this.collection,"change:selected",this.render);this.render()},render:function(){return this.renderTemplate(),this},renderTemplate:function(){var n=_.sortBy(this.collection.where({selected:!0}),function(n){return n.id});this.$el.html(this.template({selectedSchedules:_.map(n,function(n){return n.toTemplate()}),schedulePlural:Scheduler.Config.text.schedulePlural,showPanel:n.length||Scheduler.Config.scheduleSettings.alwaysShowComparePanel&&this.collection.length>1}))},events:{"click .btn-compare":"compare","mouseover .selected-schedule":"showCalendarTooltip","click .selected-schedule .close":"unselect"},compare:function(){return this.scheduleModal=new Scheduler.Views.ScheduleModal({generation:this.model,collection:this.collection,weekIndex:Scheduler.Config.scheduleSettings.defaultWeek}),this.scheduleModal.show(),!1},showCalendarTooltip:function(n){var t=this.$(n.currentTarget),r=t.data("id").toString(),u=this.collection.get(r),i=new Scheduler.Views.CalendarTooltip({model:u,collection:this.collection,generation:this.model,weekIndex:Scheduler.Config.scheduleSettings.defaultWeek});t.tooltip({trigger:"manual hover",html:!0,title:i.calendarView.$el.prop("outerHTML"),template:i.$el.prop("outerHTML"),placement:"left"});t.tooltip("show");t.on("hidden.bs.tooltip",i.remove)},unselect:function(n){var t=this.$(n.currentTarget).parent(),i=t.data("id").toString(),r=this.collection.get(i);r.set("selected",!1);t.remove()}});Scheduler.Views.ScheduleFavoritesCompare=Backbone.View.extend({template:JST["schedule/compare-actions"],className:"compare-actions",initialize:function(){_.bindAll(this,"render","renderTemplate","showCalendarTooltip","unselect");this.listenTo(this.collection,"change:selected",this.render);this.listenTo(this.collection,"remove",this.render);this.render()},render:function(){return this.renderTemplate(),this},renderTemplate:function(){var n=_.sortBy(this.collection.where({selected:!0}),function(n){return n.id});this.$el.html(this.template({selectedSchedules:_.map(n,function(n){return n.toTemplate()}),schedulePlural:Scheduler.Config.text.schedulePlural,showPanel:n.length||Scheduler.Config.scheduleSettings.alwaysShowComparePanel&&this.collection.length>1}))},events:{"click .btn-compare":"compare","mouseover .selected-schedule":"showCalendarTooltip","click .selected-schedule .close":"unselect"},compare:function(){return this.scheduleModal=new Scheduler.Views.ScheduleFavoritesModal({collection:this.collection,weekIndex:Scheduler.Config.scheduleSettings.defaultWeek}),this.scheduleModal.show(),!1},showCalendarTooltip:function(n){var t=this.$(n.currentTarget),u=t.data("id").toString(),r=this.collection.get(u),f=r.getGeneration(),e=r.getSchedule(),i=new Scheduler.Views.CalendarTooltip({model:e,collection:this.collection,generation:f,weekIndex:Scheduler.Config.scheduleSettings.defaultWeek});t.tooltip({trigger:"manual hover",html:!0,title:i.calendarView.$el.prop("outerHTML"),template:i.$el.prop("outerHTML"),placement:"left"});t.tooltip("show");t.on("hidden.bs.tooltip",i.remove)},unselect:function(n){var t=this.$(n.currentTarget).parent(),i=t.data("id").toString(),r=this.collection.get(i);r.set("selected",!1);t.remove()}});Scheduler.Views.ScheduleFavoritesList=Backbone.View.extend({template:JST["schedule/favorites-list"],a11yTemplate:JST["accessibility/schedule/favorites-list"],className:"schedule-favorites-list",events:{"click .col-open > a":"showSchedule","mouseover .btn-preview-schedule":"showCalendarTooltip","keydown .btn-preview-schedule":"keydownCalendarTooltip",'click input[type="checkbox"].select':"selectOrDeselect","shown.bs.tab":"showList","click .btn-unfavorite":"promptDeleteFavorite","click .btn-edit-name":"editFavoriteName"},initialize:function(n){this.collection=n.collection;_.bindAll(this,"render","renderTemplate","onError");this.listenTo(this.collection,"reset",this.refresh);this.listenTo(this.collection,"add",this.favoriteAdded);this.listenTo(this.collection,"remove",this.favoriteRemoved);this.listenTo(this.collection,"change:selected",this.onSelectChange);this.listenTo(this.collection,"change:name",this.render);this.listenTo(this.model,"tab:shown:favorites",this.showList);this.listenTo(this.model,"tab:hidden:favorites",this.hideList);this.generatedSchedules=this.collection.getScheduleGenerator()},showList:function(){this.loaded||this.refresh();this.shown=!0},hideList:function(){this.shown=!1},favoriteAdded:function(){this.shown?this.refresh():(this.loaded=!1,this.render())},favoriteRemoved:function(n){var i=this.$(".favorite-item[data-id="+n.id+"]"),t=this;i.tableRowRemove(function(){t.collection.length||t.render()})},refresh:function(){var n=this;this.collection?this.generatedSchedules.fetch({error:this.onError}).done(function(){n.loaded=!0;n.render()}):(n.loaded=!0,n.render())},render:function(){return this.renderTemplate(),this},renderTemplate:function(){var n=Scheduler.Config.text.schedulePlural.toLocaleLowerCase();this.loaded?this.$el.html(this.template({viewLink:Scheduler.Config.scheduleSettings.resultLinkText,favorites:this.collection.toTemplate(),resultFormat:Scheduler.Config.scheduleSettings.resultFormat,emptyMessage:"You do not have any favorite "+n+". You can add favorite any "+n+" that you find"})):this.$el.html('Loading <i class="fa fa-spin fa-spinner"><\/i>')},showSchedule:function(n){var u=this.getFavoriteFromRow(n),f=this.generatedSchedules,t=f.findByFavorite(u),i=t.schedules.first(),e=this.collection.getAllSchedules(),r;return $("html, body").animate({scrollTop:-70},500),Scheduler.AppRouter.navigateWithTerm(i.navigateUrl),r=new Scheduler.Views.ScheduleShow({model:i,collection:e,generation:t,favoriteSchedules:this.collection}),Scheduler.AppView.showViewWithTransition(r,"slide-from-right"),!1},showCalendarTooltip:function(n){var t=this.assignCalendarTooltip(n);t.tooltip("show")},keydownCalendarTooltip:function(n){var i=n.keyCode||n.which,t;if(i===13){t=this.assignCalendarTooltip(n);t.tooltip("toggle");t.one("blur",function(){t.tooltip("destroy")})}},assignCalendarTooltip:function(n){var u=this.getFavoriteFromRow(n),r=this.generatedSchedules.findByFavorite(u),f=r.schedules.first(),t=this.$(n.currentTarget),i=new Scheduler.Views.CalendarTooltip({model:f,collection:this.collection,generation:r,weekIndex:Scheduler.Config.scheduleSettings.defaultWeek});t.attr("data-original-title")||t.tooltip({trigger:"manual hover",html:!0,title:i.calendarView.$el.prop("outerHTML"),template:i.$el.prop("outerHTML"),placement:"right"});t.on("hidden.bs.tooltip",i.remove);return t},selectOrDeselect:function(n){var t=this.getFavoriteFromRow(n);t.set("selected",n.currentTarget.checked)},onSelectChange:function(n,t){var i=this.$("input.select:checkbox:not(:checked)");this.collection.where({selected:!0}).length>3?i.attr("disabled",!0):i.attr("disabled",!1);t||this.$('.favorite-item[data-id="'+n.id+'"] input.select:checkbox').prop("checked",!1)},getFavoriteFromRow:function(n){var t=this.getFavoriteIdFromRow(n);return this.collection.get(t)},getFavoriteIdFromRow:function(n){var t=this.$(n.target||n).closest(".favorite-item");return t.data("id").toString()},promptDeleteFavorite:function(n){var t=this.getFavoriteFromRow(n),i=this.collection;bootbox.confirm('Are you sure you want to un-favorite <strong>"'+t.getName()+'"<\/strong>?',function(n){n&&t.destroy().done(function(){i.remove(t)})})},editFavoriteName:function(n){var t=this.getFavoriteFromRow(n),i=this;bootbox.prompt({title:"What name would you like to give this "+Scheduler.Config.text.schedule+"?",value:t.getName(),callback:function(n){n&&t.save({name:n}).done(function(){i.render()})}})},onError:function(){Scheduler.AppView.showDangerAlert("There was a problem generating your Favorites List.");this.$el.empty()}});Scheduler.Views.ScheduleFavoritesModal=Scheduler.Views.BaseModal.extend({initialize:function(n){this.weekIndex=n.weekIndex||2;_.bindAll(this,"getEvents","showSchedule","close");n.size="md";n.hideTitle=!0;Scheduler.Views.BaseModal.prototype.initialize.apply(this,[n]);this.$el.addClass("center-lg");this.$el.addClass("compare-modal")},attributes:{tabindex:"-1",role:"dialog","aria-hidden":"true","aria-labelledby":"event"},events:function(){return _.extend({},Scheduler.Views.BaseModal.prototype.events,{"click .schedule-link":"showSchedule","click .btn-close":"close"})},renderTemplate:function(){var f=this.collection.chain().filter(function(n){return n.get("selected")}).sortBy(function(n){return n.id}).value(),e=[],i,o,r,u,n,t;this.$el.html(this.template({titlePath:this.titlePath,bodyPath:this.bodyPath,schedules:_(f).map(function(n){return n.toTemplate()}),size:this.size,hideTitle:this.hideTitle,hideScheduleNumber:!0}));_.each(f,_.bind(function(f){i=this.getEvents(f);e.push({collection:i,generation:f.getGeneration(),model:f});r=i.getMinStartTime();u=i.getMaxEndTime();(n&&n>r||!n)&&(n=r);(t&&t<u||!t)&&(t=u)},this));this.calendars=[];_.each(e,_.bind(function(i){o=this.calendarView=new Scheduler.Views.CalendarIndex({collection:i.collection,model:i.generation,displaySmall:!0,showPopover:!0,startTime:n,endTime:t});this.$(".schedule-container-"+i.model.id).html(o.$el)},this))},getEvents:function(n){var t=n.getSchedule(),r=t.getSections(),i=new Scheduler.Collections.Events;return i.add(r.getEventsForWeek(this.weekIndex,t.registrationBlocks)),i},showSchedule:function(){this.$el.modal("hide");setTimeout(function(){$("html, body").animate({scrollTop:-70},500)},0)},close:function(){this.$el.modal("hide")},bodyPath:"schedule/modal-body",remove:function(){_.each(this.calendars,function(n){n.remove()});Backbone.View.prototype.remove.call(this)}});Scheduler.Views.ScheduleGrid=Backbone.View.extend({template:JST["schedule/grid"],tagName:"table",className:"schedules-grid table",initialize:function(n){_.bindAll(this,"render","renderTemplate","showSchedule","showCalendarTooltip","onSelectChange");this.listenTo(this.collection,"change:selected",this.onSelectChange);this.currentPage=n.currentPage;this.favoriteSchedules=n.favoriteSchedules;this.render()},render:function(){return this.renderTemplate(),this},renderTemplate:function(){var n=20,t=(this.currentPage-1)*n,i=new Scheduler.Collections.Schedules(this.collection.models.slice(t,t+n));i.each(_.bind(function(n){this.model.setRegBlocksForSchedule(n)},this));this.$el.html(this.template({viewLink:Scheduler.Config.scheduleSettings.resultLinkText,schedules:i.toTemplate(),breaks:this.model.getBreaks().toTemplate(),selectedCount:this.collection.where({selected:!0}).length,resultFormat:Scheduler.Config.scheduleSettings.resultFormat}))},events:{"click .col-open > a":"showSchedule","mouseover .btn-preview-schedule":"showCalendarTooltip","keydown .btn-preview-schedule":"keydownCalendarTooltip",'click input[type="checkbox"].select':"selectOrDeselect"},showSchedule:function(n){var t=this.getScheduleFromRow(n),i;return $("html, body").animate({scrollTop:-70},500),Scheduler.AppRouter.navigateWithTerm("schedules/"+t.id),i=new Scheduler.Views.ScheduleShow({model:t,collection:this.collection,generation:this.model,favoriteSchedules:this.favoriteSchedules}),Scheduler.AppView.showViewWithTransition(i,"slide-from-right"),!1},showCalendarTooltip:function(n){var t=this.assignCalendarTooltip(n);t.tooltip("show")},keydownCalendarTooltip:function(n){var i=n.keyCode||n.which,t;if(i===13){t=this.assignCalendarTooltip(n);t.tooltip("toggle");t.one("blur",function(){t.tooltip("destroy")})}},assignCalendarTooltip:function(n){var r=this.getScheduleFromRow(n),t=this.$(n.currentTarget),i=new Scheduler.Views.CalendarTooltip({model:r,collection:this.collection,generation:this.model,weekIndex:Scheduler.Config.scheduleSettings.defaultWeek});t.attr("data-original-title")||t.tooltip({trigger:"manual hover",html:!0,title:i.calendarView.$el.prop("outerHTML"),template:i.$el.prop("outerHTML"),placement:"right"});t.on("hidden.bs.tooltip",i.remove);return t},selectOrDeselect:function(n){var t=this.getScheduleFromRow(n);t.set("selected",n.currentTarget.checked)},onSelectChange:function(n,t){var i=this.$("input.select:checkbox:not(:checked)");this.collection.where({selected:!0}).length>3?i.attr("disabled",!0):i.attr("disabled",!1);t||this.$('.schedule-item[data-id="'+n.id+'"] input.select:checkbox').prop("checked",!1)},getScheduleFromRow:function(n){var t=this.getScheduleIdFromRow(n);return this.model.getSchedule(t)},getScheduleIdFromRow:function(n){var t=this.$(n.currentTarget||n).closest(".schedule-item");return t.data("id").toString()}});Scheduler.Views.ScheduleIndexActions=Backbone.View.extend({template:JST["schedule/index-actions"],tabsTemplate:JST["schedule/index-actions-tabs"],a11yTabsTemplate:JST["accessibility/schedule/index-actions-tabs"],className:"schedule-index-actions",events:{"click .btn-generate":"generateSchedules","click .btn-shuffle":"shuffle","click .btn-advanced-options":"showAdvancedOptions","shown.bs.tab li":"tabShown","hidden.bs.tab li":"tabHidden"},initialize:function(n){_.bindAll(this,"render","generateSchedules","onGenerate","onError","renderTemplate");this.hideOptionsButton=Scheduler.Config.scheduleSettings.autoOpenOptions;this.simpleActionsOnly=n.simpleActionsOnly;this.favoriteSchedules=n.favoriteSchedules;this.hideShuffle=!!n.hideShuffle;this.simpleActionsOnly&&this.$el.addClass("clearfix");this.favoriteSchedules&&this.listenTo(this.favoriteSchedules,"reset add remove",this.updateFavoriteCount);Scheduler.Accessibility&&(this.tabsTemplate=this.a11yTabsTemplate);this.render()},render:function(){return this.renderTemplate(),this},renderTemplate:function(){var t=this.simpleActionsOnly,n=!t&&Scheduler.Config.scheduleSettings.showFavorites,i=!t&&n,r=i?this.tabsTemplate:this.template;this.$el.html(r({totalSchedules:this.collection.length,shuffled:this.collection.shuffled,showShuffle:Scheduler.Config.scheduleSettings.showShuffle&&!this.hideShuffle,textSchedulePlural:Scheduler.Config.text.schedulePlural,renderAdvancedActions:this.renderAdvancedActions(),optionsIndicator:this.getOptionsIndicator(),showFavorites:n,favoritesCount:n?this.favoriteSchedules.length:0,favoritesLabelPlural:Scheduler.Config.text.favoritesPlural}));this.updateFavoriteCount();i&&(this.$el.addClass("schedule-index-actions-tabs"),this.currentTab&&(this.$("li").removeClass("active"),this.$("li[data-type="+this.currentTab+"]").addClass("active")))},generateSchedules:_.debounce(function(){var n=Scheduler.Data.Courses.chain().filter(function(n){return n.get("selected")}).pluck("id").value(),r=Scheduler.AppView.BreaksView.SelectedBreaks.pluck("id"),t=Scheduler.Data.CurrentSections.where({selected:!0}),i=Scheduler.Data.CartSections.where({selected:!0});if(!n.length&&!t.length&&!i.length){Scheduler.AppView.showDangerAlert("You must select at least one course before generating "+Scheduler.Config.text.schedulePlural.toLowerCase()+".");return}this.model.set("term",Scheduler.Data.CurrentTerm.id);this.showSpinner();this.model.save({courses:n,breaks:r,currentSections:_.map(t,function(n){return n.pick("id","subject","subjectId","course","topicId","registrationNumber","enrollmentStatus")}),cartSections:_.map(i,function(n){return n.pick("id","subject","subjectId","course","topicId","registrationNumber")}),padding:this.getPadding()},{wait:!0,success:this.onGenerate,error:this.onError})},500,!0),onGenerate:function(){this.trigger("generate");this.hideSpinner()},onError:function(n,t){Scheduler.AppView.showError(t);this.hideSpinner()},showAdvancedOptions:function(){this.hideOptionsButton=!0;this.render();this.trigger("show-options")},closeAdvancedOptions:function(){this.hideOptionsButton=!1;this.render()},shuffle:function(){this.collection.toggleShuffle();this.trigger("shuffle")},getOptionsIndicator:function(){var t=_.filter(Scheduler.Data.UserSettings.keys(),function(n){return n!=="customSettings"}),n=0;return _.each(t,function(t){Scheduler.Data.UserSettings.attributes[t]!==Scheduler.Data.UserSettings.defaults[t]&&n++}),_.each(Scheduler.Config.scheduleSettings.customUserSettings,function(t){var i=Scheduler.Data.UserSettings.get("customSettings."+_.lowerFirst(t.key));i&&t.type==="bool"?i.toLowerCase()==="true"&&n++:i&&n++}),n},showSpinner:function(){this.$(".btn-generate i").addClass("fa-spin")},hideSpinner:function(){this.$(".btn-generate i").removeClass("fa-spin")},getPadding:function(){return Scheduler.Config.scheduleSettings.showPaddingOption?Scheduler.Data.UserSettings.get("padding"):0},renderAdvancedActions:function(){return!this.simpleActionsOnly&&(Scheduler.Config.scheduleSettings.showPaddingOption||Scheduler.Config.scheduleSettings.customUserSettings.length)&&!this.hideOptionsButton},tabShown:function(n){var t=$(n.target).closest("li").data("type");this.model.trigger("tab:shown:"+t);this.model.trigger("tab:shown",t);this.currentTab=t},tabHidden:function(n){var t=$(n.target).closest("li").data("type");this.model.trigger("tab:hidden:"+t);this.model.trigger("tab:hidden",t)},setCurrentTab:function(n){this.currentTab=n},switchTab:function(n){this.$("li[data-type="+n+"] a").click()},updateFavoriteCount:function(){var n,t;this.favoriteSchedules&&(n=this.favoriteSchedules.length,this.$(".favorite-count").text(n).closest("li").toggle(n>0),this.currentTab==="favorites"&&n===0&&this.switchTab("schedules"),t=!!n||this.renderAdvancedActions(),this.model.trigger(t?"tab:show-all":"tab:hide-all"))}});Scheduler.Views.ScheduleIndexOptions=Backbone.View.extend({template:JST["schedule/index-options"],className:"panel panel-primary advanced-options top10 bottom0",events:{"click .btn-close-advance-options":"close","click .btn-restore-defaults":"restoreDefaults","change input[type=checkbox]":"saveToggle"},initialize:function(n){n=n||{};_.bindAll(this,"render","renderTemplate","onSuccess","onError","restoreDefaults");Scheduler.Config.scheduleSettings.autoOpenOptions||this.$el.addClass("hidden-options");this.hidePanel=n.hidePanel||!1;this.render()},render:function(){return this.renderTemplate(),Scheduler.Config.scheduleSettings.showPaddingOption&&(this.paddingSelector?(this.paddingSelector.render(),this.paddingSelector.delegateEvents()):(this.paddingSelector=new Scheduler.Views.Select({id:"input-padding",dataText:"descr",minimumResultsForSearch:-1,collection:[{id:0,descr:"0 minutes"},{id:5,descr:"5 minutes"},{id:10,descr:"10 minutes"},{id:15,descr:"15 minutes"},{id:20,descr:"20 minutes"},{id:25,descr:"25 minutes"},{id:30,descr:"30 minutes"},{id:35,descr:"35 minutes"},{id:40,descr:"40 minutes"},{id:45,descr:"45 minutes"},{id:50,descr:"50 minutes"},{id:55,descr:"55 minutes"},{id:60,descr:"60 minutes"},{id:65,descr:"65 minutes"},{id:70,descr:"70 minutes"},{id:75,descr:"75 minutes"},{id:80,descr:"80 minutes"},{id:85,descr:"85 minutes"},{id:90,descr:"90 minutes"}]}),this.listenTo(this.paddingSelector,"selection:change",this.setPadding)),this.$(".padding-select-row").html(this.paddingSelector.el)),this.renderSettings(),Modernizr.touch?this.$(".options-help").tooltip():this.$('[data-toggle="tooltip"]').tooltip(),this.hidePanel&&(this.$el.removeClass("panel panel-primary hidden-options"),this.$(".panel-heading").remove(),this.$(".panel-body").removeClass(".panel-body")),this},renderTemplate:function(){this.$el.html(this.template({}))},renderSettings:function(){if(_.each(Scheduler.Config.scheduleSettings.customUserSettings,_.bind(function(n){var t=this.model.get("customSettings."+_.lowerFirst(n.key)),i;n.type==="bool"&&(i=!_.isUndefined(t)&&t&&t.toLowerCase()==="true",this.$("#input-custom-setting-"+n.key).prop("checked",i))},this)),Scheduler.Config.scheduleSettings.showPaddingOption){var n=this.paddingSelector,t=this.model.get("padding");setTimeout(function(){n.setSelected(t)},0)}},show:function(){this.$el.slideDown(_.bind(function(){this.$el.removeClass("hidden-options")},this))},close:function(){this.trigger("close");this.$el.slideUp(_.bind(function(){this.$el.addClass("hidden-options")},this))},setPadding:function(n){this.model.set("padding",n.val);this.saveUserSettings(".padding-help","fa-question-circle")},saveToggle:function(n){var t=this.$(n.target);this.model.set(t.attr("name"),t.is(":checked"));this.saveUserSettings("."+t.attr("id")+"-help","fa-question-circle")},saveUserSettings:function(n,t){var i=this.$(n);i.removeClass(t).addClass("fa-spinner fa-spin");i.attr("data-removed-class",t);this.model.save({},{success:this.onSuccess,error:this.onError})},onSuccess:function(){var n=this.$(".fa-spinner"),t=this;setTimeout(function(){n.addClass("fa-check").removeClass("fa-spinner fa-spin");setTimeout(function(){var i=n.attr("data-removed-class");n.removeClass("fa-check").addClass(i);t.renderSettings();t.$('[data-toggle="tooltip"]').tooltip("destroy");t.trigger("regenerate")},500)},100)},onError:function(n,t){Scheduler.AppView.showError(t);this.$(".fa-spinner").addClass("fa-question-circle").removeClass("fa-spinner fa-spin")},restoreDefaults:function(){this.model.clear().set(this.model.defaults);this.model.set("customSettings",{});this.saveUserSettings(".btn-restore-defaults i","fa-refresh")}});Scheduler.Views.ScheduleIndex=Backbone.View.extend({template:JST["schedule/index"],className:"schedules-page hidden-xs hidden-sm row xs-half-pad",events:{"click .btn-regenerate":"regenerate","click .page":"showPage","click .previous":"prevPage","click .next":"nextPage","click .alert .close":"closeAlert"},initialize:function(n){n=n||{};_.bindAll(this,"render","renderTemplate","renderRegenerateMsg","renderRegenerateAfterCourseUnlock","clearWarnings","onSynced","showPage","prevPage","nextPage","resetAndRender");this.model=new Scheduler.Models.ScheduleGeneration;this.collection=new Scheduler.Collections.Schedules;this.warnings=[];this.coreqs=[];this.currentPage=1;this.favoriteSchedules=n.favoriteSchedules;this.listenTo(this.collection,"toggle:shuffled",this.resetAndRender);this.listenTo(this.model,"sync",this.onSynced);this.listenTo(Scheduler.Data.AcademicCareers,"change:selected",this.renderRegenerateMsg);this.listenTo(Scheduler.Data.AcademicGroups,"change:selected",this.renderRegenerateMsg);this.listenTo(Scheduler.Data.Breaks,"add remove change",this.renderRegenerateMsg);this.listenTo(Scheduler.Data.Campuses,"change:selected",this.renderRegenerateMsg);this.listenTo(Scheduler.Data.Courses,"add change:isLocked update:options",this.renderRegenerateMsg);this.listenTo(Scheduler.Data.Courses,"remove",this.renderRegenerateOnCourseRemove);this.listenTo(Scheduler.Data.CourseStatuses,"change:selected",this.renderRegenerateMsg);this.listenTo(Scheduler.Data.Locations,"change:selected",this.renderRegenerateMsg);this.listenTo(Scheduler.Data.InstructionModes,"change:selected",this.renderRegenerateMsg);this.listenTo(Scheduler.Data.PartsOfTerm,"change:selected",this.renderRegenerateMsg);this.listenTo(Scheduler.Data.Sessions,"change:selected",this.renderRegenerateMsg);this.listenTo(Scheduler.Data.Terms,"change:selected",this.clearWarnings);this.listenTo(this.model,"tab:shown",this.setCurrentTab);this.listenTo(this.model,"tab:hide-all",this.hideTabs);this.listenTo(this.model,"tab:show-all",this.showTabs);this.render()},clearWarnings:function(){this.model.courseCoReqs=[];this.warnings.warnings=[];_.clear(this.warningPanel.warnings);this.renderRegenerateMsg()},render:function(){var t=this.useTabs(),n,i;return this.renderTemplate(),this.indexActions?(this.indexActions.setCurrentTab(this.currentTab),this.indexActions.render(),this.indexActions.delegateEvents()):(this.indexActions=new Scheduler.Views.ScheduleIndexActions({model:this.model,collection:this.collection,favoriteSchedules:this.favoriteSchedules}),this.listenTo(this.indexActions,"show-options",this.showAdvancedOptions),this.listenTo(this.indexActions,"shuffle",this.resetAndRender)),this.compareActions?(this.compareActions.render(),this.compareActions.delegateEvents()):this.compareActions=new Scheduler.Views.ScheduleCompareActions({model:this.model,collection:this.collection}),this.scheduleGrid?(this.scheduleGrid.currentPage=this.currentPage,this.scheduleGrid.render(),this.scheduleGrid.delegateEvents()):this.scheduleGrid=new Scheduler.Views.ScheduleGrid({currentPage:this.currentPage,model:this.model,collection:this.collection,favoriteSchedules:this.favoriteSchedules}),this.warningPanel?(this.warningPanel.warnings=this.warnings,this.warningPanel.render(),this.warningPanel.delegateEvents()):this.warningPanel=new Scheduler.Views.ScheduleWarning({warnings:this.warnings}),this.$(".actions-container").append(this.indexActions.el),this.$(".compare-row").append(this.compareActions.el),this.$(".grid-row").append(this.scheduleGrid.el),this.$(".schedule-warnings").append(this.warningPanel.el),(Scheduler.Config.scheduleSettings.showPaddingOption||Scheduler.Config.scheduleSettings.customUserSettings.length)&&(this.optionsView?(this.optionsView.render(),this.optionsView.delegateEvents()):(this.optionsView=new Scheduler.Views.ScheduleIndexOptions({model:Scheduler.Data.UserSettings,hidePanel:t}),this.listenTo(this.optionsView,"close",this.closeAdvancedOptions),this.listenTo(this.optionsView,"regenerate",this.regenerate)),this.$(".advanced-options-container").append(this.optionsView.el)),Scheduler.Config.scheduleSettings.showFavorites&&(this.favoritesListView?(this.favoritesListView.render(),this.favoritesListView.delegateEvents()):this.favoritesListView=new Scheduler.Views.ScheduleFavoritesList({model:this.model,collection:this.favoriteSchedules}),this.favoritesCompare?(this.favoritesCompare.render(),this.favoritesCompare.delegateEvents()):this.favoritesCompare=new Scheduler.Views.ScheduleFavoritesCompare({model:this.model,collection:this.favoriteSchedules}),this.$(".favorites-container").append(this.favoritesListView.el),this.$(".favorites-compare-container").append(this.favoritesCompare.el)),t&&(this.$(".schedule-tabs > *").addClass("tab-pane"),this.$el.addClass("right-tabs"),this.$(".schedule-tabs > [data-type="+(this.currentTab||"schedules")+"]").addClass("active"),this.$("h2.front-page-title").first().remove(),this.simpleIndexActionsView?(this.simpleIndexActionsView.render(),this.simpleIndexActionsView.delegateEvents()):(this.simpleIndexActionsView=new Scheduler.Views.ScheduleIndexActions({model:this.model,collection:this.collection,simpleActionsOnly:!0}),this.listenTo(this.simpleIndexActionsView,"shuffle",this.resetAndRender)),Scheduler.Config.scheduleSettings.autoOpenOptions&&this.$(".schedules-container").prepend(this.$(".advanced-options-container")),this.$(".schedules-container").prepend(this.simpleIndexActionsView.el),this.favoritesIndexActionsView?(this.favoritesIndexActionsView.render(),this.favoritesIndexActionsView.delegateEvents()):(this.favoritesIndexActionsView=new Scheduler.Views.ScheduleIndexActions({model:this.model,collection:this.collection,simpleActionsOnly:!0,hideShuffle:!0}),this.listenTo(this.favoritesIndexActionsView,"generate",this.showViewTabAndReset),this.listenTo(this.favoritesIndexActionsView,"shuffle",this.showViewTabAndReset)),this.$(".favorites-actions-container").append(this.favoritesIndexActionsView.el),this.currentTab==="options"&&this.$(".generate-alert-row").length&&(n=$('<div class="top10 alert-row generate-alert-row">').html(this.$(".generate-alert-row").html()),i=this,this.$(".advanced-options-container").prepend(n),n.find("span.generated-schedules").wrap('<a href="javascript:void(0)" data-toggle="tab"><\/a>').click(function(){i.showViewTabAndReset()}))),Modernizr.touch||this.$('[data-toggle="tooltip"]').tooltip(),this},renderTemplate:function(){var n=Math.ceil(this.collection.length/20),t=this.getPages(n),i=this.$(".alert-row").length||this.generated;this.$el.html(this.template({totalSchedules:this.collection.length,pages:t,isFirstPage:this.currentPage===1,isLastPage:this.currentPage===n,showPager:this.collection.length&&n>1,generated:i,coreqs:this.model.getCoreqs(),textSchedule:Scheduler.Config.text.schedule,textSchedulePlural:Scheduler.Config.text.schedulePlural,optionalGenerationMessage:Scheduler.Config.scheduleSettings.optionalGenerationMessage}));this.generated=!1},renderPager:function(){var n=this.getPages(),t=JST["schedule/pager"]({pages:n,isFirstPage:this.currentPage===1,isLastPage:this.currentPage===this.getTotalPages()});this.$(".pager-container").html(t)},renderRegenerateMsg:function(){var n=JST["schedule/regenerate-alert"]({textSchedulePlural:Scheduler.Config.text.schedulePlural});this.$(".generate-alert-row").html(n)},renderRegenerateOnCourseRemove:function(n){_.contains(this.model.get("courses"),n.id)&&(this.collection.reset(),this.render(),this.$el.find(":first").append('<div class="top10 alert-row generate-alert-row"><\/div>'));this.renderRegenerateMsg()},renderRegenerateAfterCourseUnlock:function(n){n.get("isLocked")||this.renderRegenerateMsg()},getPages:function(){var n=this.getTotalPages(),i=n>=5?5:n,t=Math.ceil(i/2)-1,o=i-t-1,r,e=[],u,f=0;for(this.currentPage+o>n&&(t=i-(n-this.currentPage)-1),this.currentPage-t<1&&(t=this.currentPage-1),r=this.currentPage-t;f<i&&f<n;)u={number:r},r===this.currentPage&&(u.active=!0),e.push(u),r++,f++;return e},getTotalPages:function(){return Math.ceil(this.collection.length/20)},regenerate:function(){(this.model.schedules&&this.model.schedules.length||this.model.warnings&&this.model.warnings.length)&&this.indexActions.generateSchedules()},showPage:function(n){var t=this.$(n.currentTarget).data("page");return this.currentPage===t?!1:(this.currentPage=t,this.changePage(),!1)},prevPage:function(){return this.currentPage-1<1?!1:(this.currentPage--,this.changePage(),!1)},nextPage:function(){return this.currentPage+1>this.getTotalPages()?!1:(this.currentPage++,this.changePage(),!1)},changePage:function(){this.scheduleGrid.currentPage=this.currentPage;this.scheduleGrid.render();this.renderPager()},resetAndRender:function(){this.scheduleGrid.currentPage=this.currentPage=1;this.render()},showViewTabAndReset:function(){this.currentTab=null;this.resetAndRender()},onSynced:function(){this.currentPage=1;this.collection.reset(this.model.schedules.models);this.warnings=this.model.warnings;this.coreqs=this.model.courseCoReqs;this.generated=!0;Scheduler.Config.scheduleSettings.startShuffled&&Scheduler.Config.scheduleSettings.showShuffle&&!this.collection.shuffled?this.collection.reshuffle():this.collection.shuffled=!1;this.render()},showAdvancedOptions:function(){this.optionsView.show()},closeAdvancedOptions:function(){this.indexActions.closeAdvancedOptions()},closeAlert:function(){this.$(".alert-row").remove()},useTabs:function(){return Scheduler.Config.scheduleSettings.showFavorites},setCurrentTab:function(n){this.currentTab=n},hideTabs:function(){this.$el.addClass("hide-tabs")},showTabs:function(){this.$el.removeClass("hide-tabs")}});Scheduler.Views.ScheduleModal=Scheduler.Views.BaseModal.extend({initialize:function(n){this.weekIndex=n.weekIndex||2;this.generation=n.generation;_.bindAll(this,"getEvents","showSchedule","close");n.size="md";n.hideTitle=!0;Scheduler.Views.BaseModal.prototype.initialize.apply(this,[n]);this.$el.addClass("center-lg");this.$el.addClass("compare-modal")},attributes:{tabindex:"-1",role:"dialog","aria-hidden":"true","aria-labelledby":"event"},events:function(){return _.extend({},Scheduler.Views.BaseModal.prototype.events,{"click .schedule-link":"showSchedule","click .btn-close":"close"})},renderTemplate:function(){var f=this.collection.chain().filter(function(n){return n.get("selected")}).sortBy(function(n){return n.id}).value(),e=[],i,o,r,u,n,t;this.$el.html(this.template({titlePath:this.titlePath,bodyPath:this.bodyPath,schedules:_(f).map(function(n){return n.toTemplate()}),size:this.size,hideTitle:this.hideTitle}));_.each(f,_.bind(function(f){i=this.getEvents(f);e.push({collection:i,model:f});r=i.getMinStartTime();u=i.getMaxEndTime();(n&&n>r||!n)&&(n=r);(t&&t<u||!t)&&(t=u)},this));this.calendars=[];_.each(e,_.bind(function(i){o=this.calendarView=new Scheduler.Views.CalendarIndex({collection:i.collection,model:this.generation,displaySmall:!0,showPopover:!0,startTime:n,endTime:t});this.$(".schedule-container-"+i.model.id).html(o.$el)},this))},getEvents:function(n){var i=n.getSections(),r=this.generation.getBreaks(),t=new Scheduler.Collections.Events;return t.add(i.getEventsForWeek(this.weekIndex,n.registrationBlocks)),t.add(r.getEvents()),t},showSchedule:function(){this.$el.modal("hide");setTimeout(function(){$("html, body").animate({scrollTop:-70},500)},0)},close:function(){this.$el.modal("hide")},bodyPath:"schedule/modal-body",remove:function(){_.each(this.calendars,function(n){n.remove()});Backbone.View.prototype.remove.call(this)}});Scheduler.Views.ScheduleShowActions=Backbone.View.extend({template:JST["schedule/show-actions"],a11yTemplate:JST["accessibility/schedule/show-actions"],className:"schedule-actions",events:{"click .btn-cancel":"back","click .page-left":"pageLeft","click .page-right":"pageRight","click .btn-view-toggle":"toggleView","click .btn-print":"printView","click .btn-send-to-cart":"confirmSendToCart","click .btn-enhanced-send-to-cart":"enhancedSendToCartClicked","click .btn-return-to-sis":"returnToSis","click .btn-registration-instructions":"showRegistrationInstructions","click .btn-message":"sendMessage","click .btn-shuffle":"shuffle","click .btn-registration-worksheet":"registrationWorkSheet","click .btn-registration-worksheet-generate-All":"getRegistrationWorkSheetFilteredAll","click .btn-registration-worksheet-generate-filtered":"getRegistrationWorkSheetFiltered","click .toggle-favorite":"toggleFavorite","click .edit-favorite-name":"editFavoriteName"},initialize:function(n){this.generation=n.generation;this.career=n.career;this.favoriteSchedules=n.favoriteSchedules;_.bindAll(this,"render","renderTemplate","keydown","toggleView","confirmSendToCart","enhancedSendToCartClicked","sendMessage","sendToCartSuccess","sendToCartError","changeCareer","pageLeft","pageRight","registrationWorkSheet","registrationWorkSheetSuccess","registrationWorkSheetError","getRegistrationWorkSheet","getRegistrationWorkSheetFiltered","getRegistrationWorkSheetFilteredAll","showRegistrationInstructions","enhancedSendToCart");$(document).on("keydown",this.keydown);if(this.render(),Modernizr.touch){$(document.body).hammer({cssProps:{userSelect:!0}});$(document.body).on("swipeleft",this.pageRight);$(document.body).on("swiperight",this.pageLeft);this.$("button").on("touchstart",function(){$(this).addClass("mobile-hover-fix")});this.$("button").on("touchend",function(){$(this).addClass("mobile-hover-fix")})}},render:function(){var n=this.generation.get("cartSections"),t=this.generation.get("currentSections"),i=this.model.registrationBlocks.getSelectedSections(n,t),r=function(n){return JSON.stringify(n)};return this.careers=_.uniq(_.map(i,function(n){return{id:n.get("academicCareer"),descr:n.get("academicCareerDescr")}}),r),this.renderTemplate(),this.career&&(this.careerSelector=new Scheduler.Views.Select({id:"input-careers",placeholder:"Select Career",dataText:"descr",collection:this.careers,defaultSelection:this.career}),this.$(".career-select-row").html(this.careerSelector.el),this.listenTo(this.careerSelector,"selection:change",this.changeCareer)),this},renderTemplate:function(){var n=Scheduler.Config.cartSettings,t=this.findFavorite();this.$el.html(this.template({totalSchedules:this.collection.length,model:this.model.toTemplate(),shuffled:this.collection.shuffled,opened:this.opened||Scheduler.Accessibility,cartText:n.cartText,registrationInstrLabel:n.registrationInstrLabel,showPrimarySendToCart:n.showSendToCart&&!this.career,showSendToCart:n.showSendToCart,showEnhancedSendToCart:n.showEnhancedSendToCart,showReturnToSis:n.showReturnToSis,returnToSisText:n.returnToSisText,showRegistrationInstr:n.showRegistrationInstr,multiCareersMessage:n.multiCareersMessage,showRegistrationSheet:n.showRegistrationWorkSheet,enhancedCartText:n.enhancedCartText,showEmail:Scheduler.Config.get("emailSettings.enabled"),careers:this.careers,showPagination:this.collection.length>1&&!this.career,showCareerSelection:this.career,scheduleText:Scheduler.Config.text.schedule,showShuffle:Scheduler.Config.scheduleSettings.showShuffle,showPrint:Scheduler.Config.scheduleSettings.showPrint,showFavorites:Scheduler.Config.scheduleSettings.showFavorites,favorite:t?t.toTemplate():null,disableLeftArrow:this.model.id===1&&!this.collection.shuffled,disableRightArrow:this.model.id===this.collection.length&&!this.collection.shuffled,userId:Scheduler.Data.UserId,favoritesLabel:Scheduler.Config.text.favorites}))},back:function(){return Scheduler.AppView.backToMain(Scheduler.AppView.SchedulesView,"schedules","slide-from-right",this),!1},changeCareer:function(n){var t=n.val;return this.trigger("render:career_selection",{career:t}),!1},showRegistrationInstructions:function(){if(Scheduler.Config.cartSettings.advancedRegistrationInstructions){var n=new Scheduler.Collections.EnrollmentGroups([],{term:Scheduler.Data.CurrentTerm.id}),t=this.generation.get("cartSections"),i=this.generation.get("currentSections"),r=this.model.registrationBlocks.getSelectedSections(t,i);this.startInstrSpinner();n.fetch({data:JSON.stringify({sections:_.map(r,function(n){return n.toJSON()}),registrationBlocks:this.model.registrationBlocks.toJSON()}),type:"POST",contentType:"application/json",success:_.bind(function(){this.stopInstrSpinner();this.trigger("toggle:registration_instructions",n)},this),error:_.bind(function(n,t){this.stopInstrSpinner();Scheduler.AppView.showError(t)},this)})}else this.trigger("toggle:registration_instructions");return!1},pageLeft:function(){if(this.collection.length<=1)return!1;var t=$(".section-detail-grid > tbody").attr("class")==="hide",n=this.collection.indexOf(this.model),i=n===0?this.collection.length-1:n-1,r=this.collection.at(i);return this.model.set("showEwsInput",!1),this.trigger("render:newModel",r,t),!1},pageRight:function(){if(this.collection.length<=1)return!1;var t=$(".section-detail-grid > tbody").attr("class")==="hide",n=this.collection.indexOf(this.model),i=n===this.collection.length-1?0:n+1,r=this.collection.at(i);return this.model.set("showEwsInput",!1),this.trigger("render:newModel",r,t),!1},enhancedSendToCartClicked:function(){var t=this.collection.indexOf(this.model),n=this.collection.at(t);return n.set("showEwsInput",!0),this.trigger("render:newModel",n),!1},keydown:function(n){var t=n.keyCode||n.which;t===37?this.pageLeft():t===39&&this.pageRight()},printView:function(){window.print()},shuffle:function(){this.collection.toggleShuffle();this.collection.trigger("toggle:shuffled");this.render()},sendMessage:function(){var n=new Scheduler.Views.MessageModal({model:this.model,generation:this.generation});n.show()},confirmSendToCart:function(){if(Scheduler.Config.cartSettings.showCareerSelection&&this.careers.length&&this.careers.length>1&&!this.career)return this.trigger("render:career_selection",{career:this.careers[0].id}),!1;var n=Scheduler.Config.cartSettings.cartConfirmPrompt,i=Scheduler.Data.CurrentSections.where({selected:!0}),t=Scheduler.Config.cartSettings;return i.length<Scheduler.Data.CurrentSections.length&&t.unselectedCurrentSchedulePrompt&&(n=t.unselectedCurrentSchedulePrompt+"<br>"+n),SchedulerHelpers.confirmBox(n,_.bind(function(n){n&&this.sendToCart()},this)),!1},sendToCart:function(){this.startSpinner();var n=new Scheduler.Models.SendToCart,i=this.generation.get("cartSections"),r=this.generation.get("currentSections"),t=this.model.registrationBlocks.getSelectedSections(i,r),u=new Scheduler.Collections.Sections(i),f=new Scheduler.Collections.Sections(r);if(this.model.get("showEwsInput"))return this.enhancedSendToCart(),!0;this.career&&(t=_.filter(t,_.bind(function(n){return n.get("academicCareer")===this.career},this)));n.set("term",this.generation.get("term"));this.confirmed&&n.set("confirmed",!0);n.save({sections:_.map(t,function(n){return n.toJSON()}),registrationBlocks:this.model.registrationBlocks.toJSON(),cartSections:u.toJSON(),currentSections:f.toJSON()},{success:this.sendToCartSuccess,error:this.sendToCartError})},sendToCartSuccess:function(n,t,i){var r,u;if(this.stopSpinner(),this.stopEnhancedSpinner(),r=i.xhr.getResponseHeader("FORCE_REDIRECT"),r!==null){window.top.location.href=r;window.location.href=r;return}Scheduler.AppRouter.navigate("");u=new Scheduler.Views.RegistrationSuccess;Scheduler.AppView.signOut(u)},sendToCartError:function(n,t,i){var r,u,f;if(this.stopSpinner(),this.stopEnhancedSpinner(),t.responseJSON.message==="ALREADY_ENROLLED"){Scheduler.AppView.showDangerAlert("You are already enrolled in all of the classes in this schedule.");this.$(".btn-send-to-cart").hide();return}if(t.responseJSON.message==="CLASS_RESULTS"){i.xhr.getResponseHeader("CLASS_RESULTS")!==null&&(r=i.xhr.getResponseHeader("CLASS_RESULTS"));u=SchedulerHelpers.createAlert("success",{hash:{icon:"info",text:r}});this.$(".schedule-response").html(u.string);return}if(t.responseJSON.message==="CAREER_UNAVAILABLE"){i.xhr.getResponseHeader("CART_MESSAGE")!==null&&(r=i.xhr.getResponseHeader("CART_MESSAGE"));u=SchedulerHelpers.createAlert("warning",{hash:{icon:"info",text:r}});this.$(".schedule-response").html(u.string);this.confirmed=!0;return}if(t.responseJSON.message==="MULTI_CAREERS"){Scheduler.AppView.showDangerAlert("You must select one career to send.");this.$(".btn-send-to-cart").hide();return}f=new Scheduler.Views.RegistrationError({model:this.model,showStatusCol:this.generation.get("currentSections").length>0});Scheduler.AppRouter.navigateWithTerm("/registration/"+this.model.id);Scheduler.AppView.signOut(f)},toggleView:function(n){var t=this.$(n.currentTarget);this.trigger("toggle",t)},enhancedSendToCart:function(){this.startEnhancedSpinner();var n=new Scheduler.Models.SendToCart,i=this.generation.get("cartSections"),r=this.generation.get("currentSections"),u=this.model.registrationBlocks.getSelectedSections(i,r),o=new Scheduler.Collections.Sections(i),s=new Scheduler.Collections.Sections(r),f=new Scheduler.Collections.EwsValues,e,t;_.each(u,function(n){e=this.$('.enhanced-values[data-id="'+n.id+'"]');t=new Scheduler.Models.EwsValue;_.each(e.find("input"),function(n){var i=$(n),r=i.val(),u=i.attr("data-key");t.set(u,r)});f.add(t)});n.set("term",this.generation.get("term"));this.confirmed&&n.set("confirmed",!0);n.save({sections:_.map(u,function(n){return n.toJSON()}),registrationBlocks:this.model.registrationBlocks.toJSON(),cartSections:o.toJSON(),currentSections:s.toJSON(),ewsCartSections:f.toJSON()},{success:this.sendToCartSuccess,error:this.sendToCartError})},returnToSis:function(){$.post("/api/authentication/signout");Scheduler.AppView.signOut(new Backbone.View);var n=new Scheduler.Views.BaseModal({title:"Signed Out",content:"You may now close "+Scheduler.Config.text.plannerTitle});n.show();window.open("","_self","");window.close()},registrationWorkSheet:function(){var t,r,i,u;try{var o=this.model.registrationBlocks.getSections().chain().pluck("attributes").pluck("openSeats").min().value(),f=parseInt(o,10),e=parseInt(Scheduler.Config.cartSettings.registrationWorkSheetIdCount,10),n;if(e<=f)return this.getRegistrationWorkSheet(),!1;if(this.$(".registration-worksheet").removeClass("hidden"),t=_.min([f,e]),t>0){for(n="You can fit a maximum of <strong>"+t+"<\/strong> students in your registration worksheet.",this.$(".worksheet-instructions").html(n),r=[],i=0;i<t;i++)u=(i+1).toString(),r.push({id:u,text:u});this.$("#ddlStudentIds").select2({placeholder:"Select a number",data:r}).on("select2-open",this.applyMobileHeaderAbsolute).on("select2-close",this.applyMobileHeaderFixed)}else n="Zero seats are available for this schedule. Click 'Generate For All Students' if you wish to proceed.",this.$(".worksheet-instructions").html(n),this.$(".generate-with-rows").hide()}catch(s){Scheduler.AppView.showError("There was an issue requesting a registration work sheet. Please try again.")}return!1},getRegistrationWorkSheetFiltered:function(){var n=this.$("#ddlStudentIds").select2("val");if(!n){Scheduler.AppView.showDangerAlert("Please select a number of rows to generate.");return}return this.getRegistrationWorkSheet(n),!1},getRegistrationWorkSheetFilteredAll:function(){return this.getRegistrationWorkSheet(0),!1},getRegistrationWorkSheet:function(n){var t=new Scheduler.Models.RegistrationWorkSheet;t.set("registrationNumbers",this.model.registrationBlocks.getSections());t.set("term",this.generation.get("term"));n&&t.set("numberOfStudentsToGenerate",n);t.save({},{success:this.registrationWorkSheetSuccess,error:this.registrationWorkSheetError})},registrationWorkSheetSuccess:function(n){$.fileDownload("/file/"+n.get("fileToken"))},registrationWorkSheetError:function(){Scheduler.AppView.showError("There was an issue requesting a registration work sheet. Please try again.")},startSpinner:function(){this.$(".btn-send-to-cart i").removeClass("fa-shopping-cart").addClass("fa-spinner fa-spin");this.$(".btn-send-to-cart").prop("disabled",!0)},stopSpinner:function(){this.$(".btn-send-to-cart i").addClass("fa-shopping-cart").removeClass("fa-spinner fa-spin");this.$(".btn-send-to-cart").prop("disabled",!1)},startEnhancedSpinner:function(){this.$(".btn-enhanced-send-to-cart i").removeClass("fa-shopping-cart").addClass("fa-spinner fa-spin");this.$(".btn-enhanced-send-to-cart").prop("disabled",!0)},stopEnhancedSpinner:function(){this.$(".btn-enhanced-send-to-cart i").addClass("fa-shopping-cart").removeClass("fa-spinner fa-spin");this.$(".btn-enhanced-send-to-cart").prop("disabled",!1)},startInstrSpinner:function(){this.$(".btn-registration-instructions i").removeClass("fa-list").addClass("fa-spinner fa-spin");this.$(".btn-registration-instructions").prop("disabled",!0)},stopInstrSpinner:function(){this.$(".btn-registration-instructions i").addClass("fa-list").removeClass("fa-spinner fa-spin");this.$(".btn-registration-instructions").prop("disabled",!1)},applyMobileHeaderAbsolute:function(){Modernizr.touch&&$("#header .navbar-fixed-top").addClass("fixfixed")},applyMobileHeaderFixed:function(){Modernizr.touch&&$("#header .navbar-fixed-top").removeClass("fixfixed")},remove:function(){$(document).off("keydown",this.keydown);Modernizr.touch&&($(document.body).off("swipeleft",this.pageRight),$(document.body).off("swiperight",this.pageLeft),$(document.body).data("hammer").destroy());this.careerSelector&&this.careerSelector.remove();Backbone.View.prototype.remove.call(this)},findFavorite:function(){return this.favoriteSchedules.findMatching(this.model.get("combination"))},toggleFavorite:function(){var n=this,r=this.model.get("combination"),t=this.findFavorite(),u=this.favoriteSchedules,i=this.$("i.fav-icon");this.processingFavorite||(t?bootbox.confirm('Are you sure you want to un-favorite <strong>"'+t.getName()+'"<\/strong>?',function(r){r&&(n.processingFavorite=!0,i.removeClass("fa-heart").addClass("fa-spin fa-spinner"),t.destroy().always(function(){n.processingFavorite=!1;i.addClass("fa-heart").removeClass("fa-spin fa-spinner")}).done(function(){u.remove(t);n.render()}))}):this.openFavoriteEditDialog(null,function(t){t!==null&&(n.processingFavorite=!0,i.removeClass("fa-heart").addClass("fa-spin fa-spinner"),n.favoriteSchedules.addFavorite(r,{name:t}).always(function(){n.processingFavorite=!1;i.addClass("fa-heart").removeClass("fa-spin fa-spinner")}).done(function(){n.render()}))}))},editFavoriteName:function(){var n=this.findFavorite(),t=this;n&&this.openFavoriteEditDialog(n,function(i){i!==null&&n.save({name:i}).done(function(){t.render()})})},openFavoriteEditDialog:function(n,t){var i=(new Scheduler.Models.ScheduleFavorite).getName();return bootbox.prompt({title:"What name would you like to give this "+Scheduler.Config.text.schedule+"?",value:n?n.get("name"):"",placeholder:i,callback:t})}});Scheduler.Views.ScheduleShow=Backbone.View.extend({template:JST["schedule/show"],a11yTemplate:JST["accessibility/schedule/show"],className:"schedule-show",initialize:function(n){this.weekIndex=Scheduler.Config.scheduleSettings.defaultWeek||2;this.generation=n.generation;this.sectionId=n.sectionId;this.favoriteSchedules=n.favoriteSchedules;_.bindAll(this,"render","renderTemplate","renderWithNewModel","renderWithNewModelAndReset","changeWeek","getEvents","getScheduleWarnings","getCustomWarnings","showRegistrationInstr");this.render()},render:function(n){n=n||{};this.generation.setRegBlocksForSchedule(this.model);var t=this.model.getSections(),i=t.getNumberOfWeeks(),l=t.getEarliestMondayDate(),s=this.generation.get("currentSections").length>0,h=this.model.registrationBlocks,c,r,u,f,e,o;return this.hasLargeGap=t.hasLargeStartAndEndGap(),this.renderTemplate(),Modernizr.touch||Scheduler.Accessibility||this.$('[data-toggle="tooltip"]').tooltip(),this.weekIndex>i&&(this.weekIndex=i),this.scheduleActions&&(r=this.scheduleActions),this.sectionGrid&&(u=this.sectionGrid),this.altSectionGrid&&(f=this.altSectionGrid),this.timelineView&&(e=this.timelineView),this.calendarView&&(o=this.calendarView),this.scheduleActions=this.renderActions(n),n.career&&(h=this.filterRegBlocksBySectionAttribute(function(t){return t.get("academicCareer")===n.career}),c=this.filterRegBlocksBySectionAttribute(function(t){return t.get("academicCareer")!==n.career}),this.altSectionGrid=this.renderAltGrid(c,s)),this.sectionGrid=this.renderGrid(h,s),(Scheduler.Config.scheduleSettings.alwaysShowTimeline||t.hasWeekVariance())&&(this.timelineView=this.renderTimeline(i,l)),this.calendarView=new Scheduler.Views.CalendarIndex({collection:this.getEvents(),model:this.model,generation:this.generation}),this.$(".calendar-row").append(this.calendarView.el),r&&r.remove(),u&&u.remove(),f&&f.remove(),e&&e.remove(),o&&o.remove(),this},renderTemplate:function(){var n=this.getScheduleWarnings(),t=this.getCustomWarnings();$.merge(n,t);this.$el.html(this.template({opened:this.opened||Scheduler.Accessibility,potentialScheduleWarning:Scheduler.Config.scheduleSettings.potentialScheduleWarning,showPrintFormTop:Scheduler.Config.scheduleSettings.showPrintForm&&Scheduler.Config.scheduleSettings.printFormPosition=="top",showPrintFormBottom:Scheduler.Config.scheduleSettings.showPrintForm&&Scheduler.Config.scheduleSettings.printFormPosition=="bottom",cartMessage:Scheduler.Config.cartSettings.cartMessage,warnings:n,hasLargeGap:this.hasLargeGap}))},renderActions:function(n){var t=new Scheduler.Views.ScheduleShowActions({model:this.model,collection:this.collection,generation:this.generation,career:n.career,favoriteSchedules:this.favoriteSchedules});return this.$el.find(".schedule-actions-container").append(t.el),this.listenTo(t,"render:newModel",this.renderWithNewModel),this.listenTo(t,"render:career_selection",this.render),this.listenTo(t,"toggle:registration_instructions",this.showRegistrationInstr),this.listenTo(t,"toggle",this.toggleView),t},renderAltGrid:function(n,t){var i=new Scheduler.Views.SectionDetailGrid({collection:n,model:this.model,generation:this.generation,fieldSettings:Scheduler.Config.scheduleSectionFieldSettings,showColorCol:!0,showSelectCol:!1,sectionId:this.sectionId,showStatusCol:t,showLockCol:!0});return this.$el.find(".section-grid-row").append("<h3>Career Sections<\/h3>"),this.$el.find(".alt-section-grid-row").append("<h3>Other Sections<\/h3>"),this.$el.find(".alt-section-grid-row").append(i.el),this.listenTo(i,"section-changed",this.changeUrl),this.listenTo(i,"render:newModelAndReset",this.renderWithNewModelAndReset),i},renderGrid:function(n,t){var i=new Scheduler.Views.SectionDetailGrid({collection:n,model:this.model,generation:this.generation,fieldSettings:Scheduler.Config.scheduleSectionFieldSettings,showColorCol:!0,showSelectCol:!1,sectionId:this.sectionId,showStatusCol:t,showLockCol:!0,showFooter:Scheduler.Config.scheduleSettings.showTotalCredits,showTotalCreditsLabel:Scheduler.Config.scheduleSettings.showTotalCreditsLabel,showEwsInput:this.model.get("showEwsInput"),minimize:this.minimizeGrid});return this.$el.find(".section-grid-row").append(i.el),this.listenTo(i,"section-changed",this.changeUrl),this.listenTo(i,"render:newModelAndReset",this.renderWithNewModelAndReset),i},renderTimeline:function(n,t){var i=new Scheduler.Views.ScheduleTimeline({collection:this.model.registrationBlocks,weekIndex:this.weekIndex,totalWeeks:n,firstMonday:t});return this.$(".timeline-row").append(i.el),this.listenTo(i,"change:week",this.changeWeek),i},filterRegBlocksBySectionAttribute:function(n){var t=this.generation.get("cartSections"),i=this.generation.get("currentSections"),r=this.model.registrationBlocks.getSelectedSections(t,i),u=_.filter(r,n),f=this.model.registrationBlocks.filter(function(n){for(var i=n.get("sectionIds"),r,t=0;t<i.length;t++)if(r=_.where(u,{id:i[t]}),r.length)return!0;return!1});return new Scheduler.Collections.RegistrationBlocks(f,{sections:this.model.registrationBlocks.sections})},getScheduleWarnings:function(){var i=this.model.getSections(),o=this.generation,n=[],t=Scheduler.Config.scheduleSettings,r,u,f,e,s=Scheduler.Config.scheduleSettings.multipleCampusesWarningExcluded||[],h=Scheduler.Config.scheduleSettings.multipleLocationsWarningExcluded||[];return _.each(t.warnings,function(c){switch(c){case"MultipleCampuses":r=i.chain().filter(function(n){return!_.contains(s,n.get("campus"))}).pluck("attributes").pluck("campus").uniq().value();r.length>1&&n.push(t.multipleCampusesWarning);break;case"MultipleLocations":u=i.chain().filter(function(n){return!_.contains(h,n.get("location"))}).pluck("attributes").pluck("location").uniq().value();u.length>1&&n.push(t.multipleLocationsWarning);break;case"MultiplePartsOfTerm":f=_.uniq(i.pluck("partsOfTerm"));f.length>1&&n.push(t.multiplePartsOfTermWarning);break;case"RegistrationPeriodHasEnded":e=_.some(i.pluck("registrationClosed"),function(n){return n});e&&n.push(t.registrationWindowClosedWarning);break;case"CourseCoRequisites":_.each(o.getCoreqs(),function(t){n.push(t)});break;case"SectionCorequisites":_.each(i.getCoreqs(),function(t){n.push(t)});break;case"MaxCredits":i.getCreditMaxTotal()>t.maxCredits&&n.push(t.maxCreditsWarning);break;case"MinCredits":i.getCreditMinTotal()<t.minCredits&&n.push(t.minCreditsWarning)}}),n},getCustomWarnings:function(){var n=[],e=this.model.getSections(),r,u,t,f,i;return _.each(Scheduler.Config.scheduleSettings.customWarnings,function(o){r=[{type:o.type,key:o.key,set:""}];u=_.union(r,o.otherMatchers);t=_.groupBy(u,function(n){return n.set||1});i=0;_.each(t,function(n){var t=!1;e.each(function(r){t||(f=_.every(n,function(n){return r.get(n.type)===n.key}),f&&(i++,t=!0))})});i===_.keys(t).length&&$.inArray(o.message,n)<=-1&&n.push(o.message)}),n},renderWithNewModelAndReset:function(n){this.collection.reset(this.generation.schedules.models);this.renderWithNewModel(n)},renderWithNewModel:function(n,t){var i=n.navigateUrl||"schedules/"+n.id;this.minimizeGrid=t;this.model=n;Scheduler.AppRouter.navigateWithTerm(i,{replace:!0});this.sectionId=null;this.weekIndex=Scheduler.Config.scheduleSettings.defaultWeek||2;this.render()},changeWeek:function(n){this.weekIndex=n;this.calendarView.collection=this.getEvents();this.calendarView.render()},getEvents:function(){var t=this.model.getSections(),i=this.generation.getBreaks(),n=new Scheduler.Collections.Events;return n.add(t.getEventsForWeek(this.weekIndex,this.model.registrationBlocks)),n.add(i.getEvents()),n},toggleView:function(n){var t=Scheduler.Config.text.schedule;n.attr("data-state")==="Open"?(n.attr("data-state","Close"),n.find(".text").html('<span class="text">Close <span class="hidden-xs">'+t+"<\/span><\/span>"),n.find("i").removeClass("circle_plus").addClass("remove"),this.$(".row.buttons").removeClass("hidden-sm hidden-xs"),this.$(".row.section-grid-row").removeClass("hidden-sm hidden-xs"),this.$(".row.alt-section-grid-row").removeClass("hidden-sm hidden-xs"),this.$(".row.timeline-row").removeClass("hidden-sm hidden-xs"),this.$(".career-selection").removeClass("hidden-sm hidden-xs"),this.$(".schedule-response").removeClass("hidden-sm hidden-xs"),this.$(".user-id-row").removeClass("hidden-sm hidden-xs"),this.opened=!0):(n.attr("data-state","Open"),n.find(".text").html('<span class="text">Open <span class="hidden-xs">'+t+"<\/span><\/span>"),n.find("i").removeClass("remove").addClass("circle_plus"),this.$(".row.buttons").addClass("hidden-sm hidden-xs"),this.$(".row.section-grid-row").addClass("hidden-sm hidden-xs"),this.$(".row.alt-section-grid-row").addClass("hidden-sm hidden-xs"),this.$(".row.timeline-row").addClass("hidden-sm hidden-xs"),this.$(".career-selection").addClass("hidden-sm hidden-xs"),this.$(".schedule-response").addClass("hidden-sm hidden-xs"),this.$(".user-id-row").addClass("hidden-sm hidden-xs"),this.opened=!1);this.scheduleActions.opened=this.opened;n.blur()},showRegistrationInstr:function(n){var f=this.model.getSections(),t,r=Scheduler.Config.scheduleSettings.alternateRegistrationInstructions,i,e=this.model.registrationBlocks,u;Scheduler.Config.cartSettings.advancedRegistrationInstructions?(n.each(function(n){u=e.get(n.get("regblockId"));i=Scheduler.Data.Courses.get(u.get("desiredCourseId"));i&&n.set("title",i.displayName())}),t=JST["schedule/adv-registration-instrs"]({term:this.generation.get("term"),groups:n.toTemplate(),portalTitle:Scheduler.Config.text.portalTitle,registrationUrl:Scheduler.Config.sisSettings.registrationUrl,alternateInstructions:r,registrationInstrLabel:Scheduler.Config.cartSettings.registrationInstrLabel})):t=JST["schedule/registration-instrs"]({sections:f.toTemplate(),portalTitle:Scheduler.Config.text.portalTitle,registrationUrl:Scheduler.Config.sisSettings.registrationUrl,attributeText:Scheduler.Config.sectionFieldText,alternateInstructions:r,registrationInstrLabel:Scheduler.Config.cartSettings.registrationInstrLabel});this.$(".registration-instrs").html(t)},changeUrl:function(n){this.sectionId=n;var t="schedules/"+this.model.id;n&&(t+="/section/"+n);Scheduler.AppRouter.navigateWithTerm(t,{replace:!0})},remove:function(){this.scheduleActions&&this.scheduleActions.remove();this.sectionGrid&&this.sectionGrid.remove();this.altSectionGrid&&this.altSectionGrid.remove();this.calendarView&&this.calendarView.remove();this.timelineView&&this.timelineView.remove();Backbone.View.prototype.remove.call(this)}});Scheduler.Views.ScheduleTimeline=Backbone.View.extend({template:JST["schedule/timeline"],className:"timeline",initialize:function(n){_.bindAll(this,"render","renderTemplate","changeWeek","prevWeek","nextWeek","setWeekIndexAndRender");this.weekIndex=n.weekIndex;this.totalWeeks=n.totalWeeks;this.firstMonday=n.firstMonday;this.render()},render:function(){return this.renderTemplate(),this},renderTemplate:function(){var e=this.getWeeks(),o=(this.weekIndex-1)*7,n=this.firstMonday.clone(),t,i=this.collection.getRegBlocksForTemplate(),f=Math.ceil(i.length/2),r=this.getPadArr(i.length-f),u=this.getPadArr(f);n.add(o,"d");t=n.clone();t.add(6,"d");this.totalWeeks>20&&this.$el.addClass("grt-max-weeks");this.$el.html(this.template({weekIndex:this.weekIndex,beginningOfWeek:n.utc().format("L"),endOfWeek:t.utc().format("L"),totalWeeks:this.totalWeeks,weeks:e,registrationBlocks:i,firstMonday:this.firstMonday,topPads:r.length===0?u:r,bottomPads:r.length===0&&u.length===1?[]:u,first:this.weekIndex===1,last:this.weekIndex===this.totalWeeks}))},events:{"mouseenter td.week":"toggleColHover","mouseleave td.week":"toggleColHover","mouseenter th.week":"toggleColHover","mouseleave th.week":"toggleColHover","click td.week":"changeWeek","click th.week":"changeWeek","click .prev":"prevWeek","click .next":"nextWeek"},toggleColHover:function(n){var t=$(n.currentTarget),i=t.index();t.parents("table").find("col:eq("+i+")").toggleClass("hover");t.parents("table").find("th:eq("+i+")").toggleClass("hover");t.parents("table").find("td:nth-child("+(i+1)+")").toggleClass("hover")},changeWeek:function(n){var t=$(n.currentTarget),i=t.index(),r=t.parents("table").find("col:eq("+i+")").data("week");this.setWeekIndexAndRender(r)},prevWeek:function(){if(this.weekIndex-1<1)return!1;this.setWeekIndexAndRender(this.weekIndex-1)},nextWeek:function(){if(this.weekIndex+1>this.totalWeeks)return!1;this.setWeekIndexAndRender(this.weekIndex+1)},setWeekIndexAndRender:function(n){this.weekIndex=n;this.render();this.trigger("change:week",this.weekIndex)},getWeeks:function(){var i=[],n,t=0;for(t;t<this.totalWeeks;t++)n={index:t+1},n.index===this.weekIndex&&(n.selected=!0),i.push(n);return i},getPadArr:function(n){var i=[],r={},t=0;for(t;t<n;t++)i.push(r);return i}});Scheduler.Views.ScheduleWarning=Backbone.View.extend({template:JST["schedule/warnings"],className:"schedule-warnings",initialize:function(n){this.warnings=n.warnings;_.bindAll(this,"render","renderTemplate");this.render()},render:function(){return this.renderTemplate(),this},renderTemplate:function(){this.$el.html(this.template({warnings:this.warnings}))}});Scheduler.Views.BookModal=Scheduler.Views.BaseModal.extend({titlePath:"section/book-modal-title",bodyPath:"section/book-modal-body",attributes:{tabindex:"-1",role:"dialog","aria-hidden":"true","aria-labelledby":"event"}});Scheduler.Views.Books=Backbone.View.extend({template:JST["section/books"],tagName:"ul",className:"section-item-books",events:{"click a.book-link":"clickedBookLink"},initialize:function(){_.bindAll(this,"render","renderTemplate");this.listenTo(this.collection,"sync",this.render);this.render()},render:function(){return this.renderTemplate(),this},renderTemplate:function(){this.$el.html(this.template({collection:this.collection.toTemplate()}))},clickedBookLink:function(n){var t=$(n.currentTarget).data("id"),i=new Scheduler.Views.BookModal({model:this.collection.get(t)});i.show()}});Scheduler.Views.SectionCurrentSchedule=Backbone.View.extend({template:JST["section/current-schedule"],className:"current-schedule hidden-xs hidden-sm col-md-12",initialize:function(){_.bindAll(this,"render","renderTemplate","onFetch");this.listenTo(this.collection,"updated:all",this.onFetch);this.collection.invoke("set","selected",!0);this.render()},render:function(){return this.renderTemplate(),this.currentSectionsGrid?(this.currentSectionsGrid.render(),this.currentSectionsGrid.delegateEvents()):this.currentSectionsGrid=new Scheduler.Views.SectionProvidedGrid({collection:this.collection,fieldSettings:Scheduler.Config.currentSectionFieldSettings,showSelectCol:!0,showSelectWarning:!0,selectWarningMsg:Scheduler.Config.cartSettings.currentScheduleSelectionWarning}),this.$(".section-grid-container").append(this.currentSectionsGrid.el),this},renderTemplate:function(){this.$el.html(this.template({title:"Current "+Scheduler.Config.text.schedule,collection:this.collection.toTemplate()}))},onFetch:function(){this.collection.invoke("set","selected",!0);this.render()}});Scheduler.Views.SectionDetailGrid=Backbone.View.extend({template:JST["section/detail-grid"],events:{"click a.custom-data":"clickedCustomLink","click a.map-link":"clickedCustomLink","click .btn-section-details":"showSectionDetails","click .btn-has-hints":"showSectionDetails","click .btn-show-more":"showMore",'click input[type="checkbox"].select-all':"selectAllOrPage",'click input[type="checkbox"].select':"selectOrDeselect",'click input[type="checkbox"].select-opt':"selectOrDeselectOptional","click .btn-toggle":"toggleGrid","click .btn-lock-reg-block":"toggleLock","click .btn-select-all":"selectAll","click .btn-select-page":"selectPage"},initialize:function(n){if(n=n||{},this.sectionId=n.sectionId,this.showSelectCol=n.showSelectCol,this.showColorCol=n.showColorCol,this.showStatusCol=n.showStatusCol,this.showLockCol=n.showLockCol,this.showFooter=n.showFooter,this.showTotalCreditsLabel=n.showTotalCreditsLabel,this.fieldSettings=n.fieldSettings,this.showEmptyMessage=n,this.emptyMessage=n.emptyMessage,this.allCollection=n.allCollection,this.pageSize=n.pageSize,this.generation=n.generation,this.showEwsInput=n.showEwsInput,this.hideGrid=n.minimize,_.bindAll(this,"render","renderTemplate","clickedCustomLink","showSectionDetails","toggleGrid","toggleLock","onLockChange","onToggleLockError","showSpinner","hideSpinner","canShowFooter","getCreditTotal"),this.render(),this.sectionId){var t=this.$(".section-item[data-id="+this.sectionId+"] > *:first"),i=this.getSectionFromRow(t);this.addSectionDetailItem(t,i)}},render:function(){return this.renderTemplate(),Modernizr.touch||Scheduler.Accessibility||this.$('[data-toggle="tooltip"]').tooltip(),this.sectionDetailItems=[],this.listenTo(this.collection,"change:locked",this.onLockChange),this},renderTemplate:function(){var n=_.filter(this.fieldSettings,function(n){return n.showColumn}),t=_.reduce(n,function(n,t){return n[t.key]=t,n},{}),i=_.where(Scheduler.Config.courseSettings.flags,{showOnSection:!0}),r=_.filter(this.fieldSettings,function(n){return n.label=Scheduler.Config.sectionFieldText[n.key],n.noteBelow});this.$el.html(this.template({attributeText:Scheduler.Config.sectionFieldText,allSelected:this.collection.where({selected:!0}).length===this.collection.length,registrationBlocks:this.collection.getRegBlocksForTemplate(),showSelectCol:this.showSelectCol,showColorCol:this.showColorCol,showStatusCol:this.showStatusCol,showLockCol:this.showLockCol,notesBelow:r,columnsByKey:t,columns:n,colCount:this.getColumnCount(),configFlags:i,hideGrid:this.hideGrid,showFooter:this.canShowFooter(),footerCells:this.getFooterCells(),showEmptyMessage:this.showEmptyMessage&&this.emptyMessage&&!this.collection.length,emptyMessage:this.emptyMessage,showCreditsToReach:Scheduler.Config.scheduleSettings.showCreditsToReach,remainingCreditsToReach:this.getCreditTotal()<=Scheduler.Config.scheduleSettings.creditsToReach?Scheduler.Config.scheduleSettings.creditsToReach-this.getCreditTotal():0,creditsToReach:Scheduler.Config.scheduleSettings.creditsToReach,showEwsInput:this.showEwsInput}))},clickedCustomLink:function(n){return window.open(n.target.href,"_blank","toolbar=1,location=1,height= 1000, width=1000"),!1},getColumnCount:function(){var n=_.filter(this.fieldSettings,function(n){return n.showColumn}).length;return n+this.getActionColumnCount()},getActionColumnCount:function(){var n=0;return n+=this.showSelectCol?1:0,n+=this.showColorCol?1:0,n+=this.showStatusCol?1:0,n+=this.showLockCol?1:0,n+1},getFooterCells:function(){for(var u=this.getColumnCount(),r=[],t,f=this.getActionColumnCount(),e=this.hasCreditColumn(),o=this.getIndexOfColumn("credits"),i,n=0;n<u;n++)t={key:"",val:""},n===f+o&&e&&(t.key="credits",i="",this.showTotalCreditsLabel&&(i+=Scheduler.Config.scheduleSettings.totalCreditsLabel+" "),i+=this.getCreditTotal(),t.val=i),r.push(t);return r},hasCreditColumn:function(){return _.filter(this.fieldSettings,function(n){return n.showColumn&&n.key==="credits"}).length},getIndexOfColumn:function(n){var t=0,i=_.filter(this.fieldSettings,function(n){return n.showColumn});return _.find(i,function(i,r){if(i.key===n)return t=r,!0}),t},canShowFooter:function(){return this.showFooter&&this.hasCreditColumn()},getCreditTotal:function(){return this.canShowFooter()?this.collection.getSections().getCreditTotal():0},showSectionDetails:function(n){var t=this.getSectionFromRow(n),i=this.findSectionDetailItem(t);i?(this.removeSectionDetailItem(i),t.id===this.sectionId&&(this.sectionId=null)):(this.addSectionDetailItem(n,t),this.sectionId=t.id);this.trigger("section-changed",this.sectionId)},findSectionDetailItem:function(n){return _.find(this.sectionDetailItems,function(t){return t.model.id===n.id})},addSectionDetailItem:function(n,t){var r=this.$(n.currentTarget||n).closest(".section-item"),i=new Scheduler.Views.SectionDetailItem({model:t,courseId:this.model?this.model.id:null,fieldSettings:this.fieldSettings,columnCount:this.getColumnCount()===0?9:this.getColumnCount()+1});i.$el.children().wrapInner('<div style="display: none;" />').parent().insertAfter(r).find("td > div").slideDown(function(){$(this).replaceWith($(this).contents())});this.sectionDetailItems.push(i)},getSectionFromRow:function(n){var t=this.getSectionIdFromRow(n);return this.collection.sections.get(t)},getSectionIdFromRow:function(n){var t=this.$(n.currentTarget||n).closest(".section-item");return t.data("id")},removeSectionDetailItem:function(n){this.sectionDetailItems=_.without(this.sectionDetailItems,n);n.$el.tableRowRemove(function(){n.remove()})},showMore:function(n){var u=this.$(n.currentTarget).closest("tr"),f=u.find(".btn-show-more"),r,t,i;f.each(function(){t=$(this);i=t.prev(".additional");i.is(":visible")?(r=t.data("count"),t.find("small").html(r+" More"),i.slideUp()):(t.find("small").html("Hide"),i.slideDown())})},selectAllOrPage:function(n){if(this.allCollection&&this.allCollection.length>this.pageSize)return this.showSelectAllPopover(n),!1;this.$('input[type="checkbox"].select').prop("checked",n.currentTarget.checked);this.collection.invoke("set",{selected:n.currentTarget.checked});Scheduler.AppView.makeDirty()},showSelectAllPopover:function(n){var i=n.currentTarget.checked?"Check":"Uncheck",t=this.$(n.currentTarget),r=JST["section/select-all"]({checkAllText:i+" All",checkPageText:i+" This Page",checked:n.currentTarget.checked});$("body").on("click",function(n){t.each(function(){$(this).is(n.target)||$(this).has(n.target).length!==0||$(".popover").has(n.target).length!==0||$(this).popover("destroy")})});t.popover({trigger:"manual",html:!0,content:r,placement:"bottom"});t.popover("show");this.delegateEvents()},selectAll:function(n){this.selectOrDeselectMany(n,this.allCollection)},selectPage:function(n){this.selectOrDeselectMany(n,this.collection)},selectOrDeselectMany:function(n,t){var i=this.$(n.currentTarget).data("checked"),r=this.$('input[type="checkbox"].select-all');t.invoke("set",{selected:i});this.$('input[type="checkbox"].select').prop("checked",i);r.prop("checked",i);r.popover("destroy");Scheduler.AppView.makeDirty()},selectOrDeselect:function(n){var t=this.$(n.currentTarget).data("regblockid"),i=this.collection.get(t);i.set("selected",n.currentTarget.checked);this.$('input[type="checkbox"].select-all').prop("checked",this.allRegBlocksSelected());Scheduler.AppView.makeDirty()},selectOrDeselectOptional:function(n){var u=this.$(n.currentTarget||n).closest(".section-item"),i=u.data("id").toString(),f=this.$(n.currentTarget).data("regblockid"),r=this.collection.get(f),t=r.get("optionalSectionIds")||[];n.currentTarget.checked?t.push(i):t=_.without(t,i);r.set("optionalSectionIds",t);Scheduler.AppView.makeDirty()},allRegBlocksSelected:function(){return this.collection.where({selected:!0}).length===this.collection.length},toggleGrid:function(n){var t=this.$(n.currentTarget),i=this.$("tbody");i.hasClass("hide")?(i.removeClass("hide"),t.find("i").addClass("fa-minus-square-o").removeClass("fa-plus-square-o"),t.prop("title","Hide"),t.attr("data-original-title","Hide"),this.hideGrid=!1):(i.addClass("hide"),t.find("i").addClass("fa-plus-square-o").removeClass("fa-minus-square-o"),t.prop("title","Show"),t.attr("data-original-title","Show"),this.hideGrid=!0)},toggleLock:function(n){var i=this.$(n.currentTarget),r=i.data("registrationblockid"),t=this.collection.get(r),u=!t.get("locked");return this.showSpinner(t.id),t.save({locked:u,term:this.generation.get("term")},{error:this.onToggleLockError,wait:!0}),!1},onToggleLockError:function(n,t){Scheduler.AppView.showError(t);this.hideSpinner(n.id)},onLockChange:function(n){var i=this.$('.btn-lock-reg-block[data-registrationBlockId="'+n.id+'"]'),h=Scheduler.Data.Courses.get(n.get("desiredCourseId")),c=n.get("sectionIds").length?n.get("sectionIds")[0]:0,s=n.get("locked"),r=this.generation.schedules.length,u,f,e,o,t;(this.generation?this.generation.save({},{success:_.bind(function(i){t=i.schedules.find(_.bind(function(n){return _.isEqual(n.get("combination"),this.model.get("combination"))},this));t?i.setRegBlocksForSchedule(t):(t=this.model,t.set("id",i.schedules.length+1),i.schedules.add(t),i.registrationBlocks.add(this.model.registrationBlocks.models));u=i.schedules.length===r?"Your schedule results have changed.":i.schedules.length>r?"Your schedule results have expanded from "+r+" to "+this.generation.schedules.length:"Your schedule results have narrowed from "+r+" to "+this.generation.schedules.length;Scheduler.AppView.showSuccessAlert(u);this.hideSpinner(n.id);this.trigger("render:newModelAndReset",t)},this)}):this.hideSpinner(n.id),h.set("isLocked",s),s?(i.find("i").removeClass("unlock").addClass("lock"),e="unlock"):(i.find("i").removeClass("lock").addClass("unlock"),e="lock"),f=this.collection.sections.get(c),f)&&(o="Click to "+e+" this class for "+f.get("subject")+" "+f.get("course"),i.prop("title",o),i.attr("data-original-title",o))},showSpinner:function(n){this.$('.btn-lock-reg-block[data-registrationBlockId="'+n+'"] i').removeClass("glyphicons").addClass("fa fa-spinner fa-spin")},hideSpinner:function(n){this.$('.btn-lock-reg-block[data-registrationBlockId="'+n+'"] i').addClass("glyphicons").removeClass("fa fa-spinner fa-spin")}});Scheduler.Views.SectionDetailItem=Backbone.View.extend({template:JST["section/detail-item"],tagName:"tr",className:"section-detail-item",events:{"click a.show-section":"showSection"},initialize:function(n){this.courseId=n.courseId;this.fieldSettings=n.fieldSettings;this.columnCount=n.columnCount||9;_.bindAll(this,"render","renderTemplate");Scheduler.Config.sectionSettings.sectionBookSettings.showBooks&&(this.books=new Scheduler.Collections.Books(null,{section:this.model}),this.books.fetch());this.render()},render:function(){return this.renderTemplate(),Scheduler.Config.sectionSettings.sectionBookSettings.showBooks&&new Scheduler.Views.Books({collection:this.books,el:this.$(".section-item-books")}).render(),this},renderTemplate:function(){var n=this.model.toTemplate(),t=_.map(this.fieldSettings,_.bind(function(t){return t.val=n[t.key],t.text=t.key==="enrollmentRequirements"?Scheduler.Config.sectionFieldText:Scheduler.Config.sectionFieldText[t.key],t},this)),i=_.filter(t,function(n){return n.detailAlign!=="right"}),r=_.filter(t,function(n){return n.detailAlign==="right"});this.$el.html(this.template({section:n,leftFields:i,rightFields:r,columnCount:this.columnCount}))},showSection:function(){var n=new Scheduler.Views.SectionShow({model:this.model,fieldSettings:this.fieldSettings});return Scheduler.AppView.showOverlayViewWithTransition(n,"slide-from-right"),Scheduler.AppRouter.trigger("navigate","/section-detail"),!1}});Scheduler.Views.SectionGrid=Backbone.View.extend({template:JST["section/grid"],events:{"click a.custom-data":"clickedCustomLink","click a.map-link":"clickedCustomLink","click .btn-section-details":"showSectionDetails","click .btn-has-hints":"showSectionDetails","click .btn-show-more":"showMore",'click input[type="checkbox"].select-all':"selectAllOrPage",'click input[type="checkbox"].select':"selectOrDeselect",'click input[type="checkbox"].select-opt':"selectOrDeselectOptional","click .btn-toggle":"toggleGrid","click .btn-lock-reg-block":"toggleLock","click .btn-select-all":"selectAll","click .btn-select-page":"selectPage"},initialize:function(n){if(n=n||{},this.sectionId=n.sectionId,this.showSelectCol=n.showSelectCol,this.showColorCol=n.showColorCol,this.showStatusCol=n.showStatusCol,this.showLockCol=n.showLockCol,this.showFooter=n.showFooter,this.showTotalCreditsLabel=n.showTotalCreditsLabel,this.fieldSettings=n.fieldSettings,this.showEmptyMessage=n,this.emptyMessage=n.emptyMessage,this.allCollection=n.allCollection,this.pageSize=n.pageSize,this.generation=n.generation,this.showEwsInput=n.showEwsInput,this.hideGrid=n.minimize,_.bindAll(this,"render","renderTemplate","clickedCustomLink","showSectionDetails","toggleGrid","toggleLock","onLockChange","onToggleLockError","showSpinner","hideSpinner","canShowFooter","getCreditTotal"),this.render(),this.sectionId){var t=this.$(".section-item[data-id="+this.sectionId+"] > *:first"),i=this.getSectionFromRow(t);this.addSectionDetailItem(t,i)}},render:function(){return this.renderTemplate(),this.$("input.select.indeterminate").prop("indeterminate",!0).prop("checked",!1),Modernizr.touch||Scheduler.Accessibility||this.$('[data-toggle="tooltip"]').tooltip(),this.sectionDetailItems=[],this.listenTo(this.collection,"change:locked",this.onLockChange),this},renderTemplate:function(){var n=_.filter(this.fieldSettings,function(n){return n.showColumn}),t=_.reduce(n,function(n,t){return n[t.key]=t,n},{}),i=_.where(Scheduler.Config.courseSettings.flags,{showOnSection:!0}),r=_.filter(this.fieldSettings,function(n){return n.label=Scheduler.Config.sectionFieldText[n.key],n.noteBelow});this.$el.html(this.template({attributeText:Scheduler.Config.sectionFieldText,allSelected:this.collection.where({selected:!0}).length===this.collection.length,sections:this.collection.toTemplate(),showSelectCol:this.showSelectCol,showColorCol:this.showColorCol,showStatusCol:this.showStatusCol,showLockCol:this.showLockCol,notesBelow:r,columnsByKey:t,columns:n,colCount:this.getColumnCount(),configFlags:i,hideGrid:this.hideGrid,showFooter:this.canShowFooter(),footerCells:this.getFooterCells(),showEmptyMessage:this.showEmptyMessage&&this.emptyMessage&&!this.collection.length,emptyMessage:this.emptyMessage,showCreditsToReach:Scheduler.Config.scheduleSettings.showCreditsToReach,remainingCreditsToReach:this.getCreditTotal()<=Scheduler.Config.scheduleSettings.creditsToReach?Scheduler.Config.scheduleSettings.creditsToReach-this.getCreditTotal():0,creditsToReach:Scheduler.Config.scheduleSettings.creditsToReach,showEwsInput:this.showEwsInput}))},clickedCustomLink:function(n){return window.open(n.target.href,"_blank","toolbar=1,location=1,height= 1000, width=1000"),!1},getColumnCount:function(){var n=_.filter(this.fieldSettings,function(n){return n.showColumn}).length;return n+this.getActionColumnCount()},getActionColumnCount:function(){var n=0;return n+=this.showSelectCol?1:0,n+=this.showColorCol?1:0,n+=this.showStatusCol?1:0,n+=this.showLockCol?1:0,n+1},getFooterCells:function(){for(var u=this.getColumnCount(),r=[],t,f=this.getActionColumnCount(),e=this.hasCreditColumn(),o=this.getIndexOfColumn("credits"),i,n=0;n<u;n++)t={key:"",val:""},n===f+o&&e&&(t.key="credits",i="",this.showTotalCreditsLabel&&(i+=Scheduler.Config.scheduleSettings.totalCreditsLabel+" "),i+=this.getCreditTotal(),t.val=i),r.push(t);return r},hasCreditColumn:function(){return _.filter(this.fieldSettings,function(n){return n.showColumn&&n.key==="credits"}).length},getIndexOfColumn:function(n){var t=0,i=_.filter(this.fieldSettings,function(n){return n.showColumn});return _.find(i,function(i,r){if(i.key===n)return t=r,!0}),t},canShowFooter:function(){return this.showFooter&&this.hasCreditColumn()},getCreditTotal:function(){return this.canShowFooter()?this.collection.getSections().getCreditTotal():0},showSectionDetails:function(n){var t=this.getSectionFromRow(n),i=this.findSectionDetailItem(t);i?(this.removeSectionDetailItem(i),t.id===this.sectionId&&(this.sectionId=null)):(this.addSectionDetailItem(n,t),this.sectionId=t.id);this.trigger("section-changed",this.sectionId)},findSectionDetailItem:function(n){return _.find(this.sectionDetailItems,function(t){return t.model.id===n.id})},addSectionDetailItem:function(n,t){var r=this.$(n.currentTarget||n).closest(".section-item"),i=new Scheduler.Views.SectionDetailItem({model:t,courseId:this.model?this.model.id:null,fieldSettings:this.fieldSettings,columnCount:this.getColumnCount()===0?9:this.getColumnCount()+1});i.$el.children().wrapInner('<div style="display: none;" />').parent().insertAfter(r).find("td > div").slideDown(function(){$(this).replaceWith($(this).contents())});this.sectionDetailItems.push(i)},getSectionFromRow:function(n){var t=this.getSectionIdFromRow(n);return this.collection.get(t)},getSectionIdFromRow:function(n){var t=this.$(n.currentTarget||n).closest(".section-item");return t.data("id")},removeSectionDetailItem:function(n){this.sectionDetailItems=_.without(this.sectionDetailItems,n);n.$el.tableRowRemove(function(){n.remove()})},showMore:function(n){var t=this.$(n.currentTarget),r,i=t.prev(".additional");i.is(":visible")?(r=t.data("count"),t.find("small").html(r+" More"),i.slideUp()):(t.find("small").html("Hide"),i.slideDown())},selectAllOrPage:function(n){if(this.allCollection&&this.allCollection.length>this.pageSize)return this.showSelectAllPopover(n),!1;this.$('input[type="checkbox"].select').prop("checked",n.currentTarget.checked);this.collection.invoke("set",{selected:n.currentTarget.checked});Scheduler.AppView.makeDirty()},showSelectAllPopover:function(n){var i=n.currentTarget.checked?"Check":"Uncheck",t=this.$(n.currentTarget),r=JST["section/select-all"]({checkAllText:i+" All",checkPageText:i+" This Page",checked:n.currentTarget.checked});$("body").on("click",function(n){t.each(function(){$(this).is(n.target)||$(this).has(n.target).length!==0||$(".popover").has(n.target).length!==0||$(this).popover("destroy")})});t.popover({trigger:"manual",html:!0,content:r,placement:"bottom"});t.popover("show");this.delegateEvents()},selectAll:function(n){this.selectOrDeselectMany(n,this.allCollection)},selectPage:function(n){this.selectOrDeselectMany(n,this.collection)},selectOrDeselectMany:function(n,t){var i=this.$(n.currentTarget).data("checked"),r=this.$('input[type="checkbox"].select-all');t.invoke("set",{selected:i});this.$('input[type="checkbox"].select').prop("checked",i);r.prop("checked",i);r.popover("destroy");Scheduler.AppView.makeDirty()},selectOrDeselect:function(n){var t=this.$(n.currentTarget).data("sectionid"),i=this.collection.get(t);i.set("selected",n.currentTarget.checked);this.$('input[type="checkbox"].select-all').prop("checked",this.allSectionsSelected());Scheduler.AppView.makeDirty();this.trigger("section-check-changed",n.currentTarget.checked)},allSectionsSelected:function(){return this.collection.where({selected:!0}).length===this.collection.length},toggleGrid:function(n){var t=this.$(n.currentTarget),i=this.$("tbody");i.hasClass("hide")?(i.removeClass("hide"),t.find("i").addClass("fa-minus-square-o").removeClass("fa-plus-square-o"),t.prop("title","Hide"),t.attr("data-original-title","Hide"),this.hideGrid=!1):(i.addClass("hide"),t.find("i").addClass("fa-plus-square-o").removeClass("fa-minus-square-o"),t.prop("title","Show"),t.attr("data-original-title","Show"),this.hideGrid=!0)},toggleLock:function(n){var i=this.$(n.currentTarget),r=i.data("registrationblockid"),t=this.collection.get(r),u=!t.get("locked");return this.showSpinner(t.id),t.save({locked:u,term:this.generation.get("term")},{error:this.onToggleLockError,wait:!0}),!1},onToggleLockError:function(n,t){Scheduler.AppView.showError(t);this.hideSpinner(n.id)},onLockChange:function(n){var i=this.$('.btn-lock-reg-block[data-registrationBlockId="'+n.id+'"]'),h=Scheduler.Data.Courses.get(n.get("desiredCourseId")),c=n.get("sectionIds").length?n.get("sectionIds")[0]:0,s=n.get("locked"),r=this.generation.schedules.length,u,f,e,o,t;(this.generation?this.generation.save({},{success:_.bind(function(i){t=i.schedules.find(_.bind(function(n){return _.isEqual(n.get("combination"),this.model.get("combination"))},this));t?i.setRegBlocksForSchedule(t):(t=this.model,t.set("id",i.schedules.length+1),i.schedules.add(t),i.registrationBlocks.add(this.model.registrationBlocks.models));u=i.schedules.length===r?"Your schedule results have changed.":i.schedules.length>r?"Your schedule results have expanded from "+r+" to "+this.generation.schedules.length:"Your schedule results have narrowed from "+r+" to "+this.generation.schedules.length;Scheduler.AppView.showSuccessAlert(u);this.hideSpinner(n.id);this.trigger("render:newModelAndReset",t)},this)}):this.hideSpinner(n.id),h.set("isLocked",s),s?(i.find("i").removeClass("unlock").addClass("lock"),e="unlock"):(i.find("i").removeClass("lock").addClass("unlock"),e="lock"),f=this.collection.get(c),f)&&(o="Click to "+e+" this class for "+f.get("subject")+" "+f.get("course"),i.prop("title",o),i.attr("data-original-title",o))},showSpinner:function(n){this.$('.btn-lock-reg-block[data-registrationBlockId="'+n+'"] i').removeClass("glyphicons").addClass("fa fa-spinner fa-spin")},hideSpinner:function(n){this.$('.btn-lock-reg-block[data-registrationBlockId="'+n+'"] i').addClass("glyphicons").removeClass("fa fa-spinner fa-spin")}});Scheduler.Views.SectionList=Backbone.View.extend({template:JST["section/list"],tagName:"ul",className:"section-list col-md-12",initialize:function(){_.bindAll(this,"render","renderTemplate");this.render()},render:function(){return this.renderTemplate(),this},renderTemplate:function(){this.$el.html(this.template({collection:this.collection.toTemplate()}))}});Scheduler.Views.SectionModal=Scheduler.Views.BaseModal.extend({events:function(){return _.extend({},Scheduler.Views.BaseModal.prototype.events,{"click .btn-toggle-lock":"toggleLock","click .btn-show-more":"showMore"})},initialize:function(n){_.bindAll(this,"toggleLock","onToggleLockSuccess","onToggleLockError");n.size="lg";this.generation=n.generation;this.model.set("meetings",Scheduler.Config.scheduleSettings.collapseMeetings?this.model.getCollapsedMeetings():this.model.get("meetings")||[]);var t=this.model.get("registrationBlockId"),i=this.generation.registrationBlocks.get(t),r=i.get("locked")?"unlock":"lock";n.templateOptions={btnTitle:"Click to "+r+" this class for "+this.model.get("subject")+" "+this.model.get("course")};Scheduler.Config.sectionSettings.sectionBookSettings.showBooks&&(this.books=new Scheduler.Collections.Books(null,{section:this.model}),this.books.fetch());Scheduler.Views.BaseModal.prototype.initialize.apply(this,[n])},attributes:{tabindex:"-1",role:"dialog","aria-hidden":"true","aria-labelledby":"event"},titlePath:"section/modal-title",bodyPath:"section/modal-body",renderTemplate:function(){var n=this.model.toTemplate(),t=_.map(Scheduler.Config.modalSectionFieldSettings,_.bind(function(t){return t.val=n[t.key],t.text=t.key==="enrollmentRequirements"?Scheduler.Config.sectionFieldText:Scheduler.Config.sectionFieldText[t.key],t},this)),i=_.filter(t,function(n){return n.detailAlign!=="right"}),r=_.filter(t,function(n){return n.detailAlign==="right"}),u=this.model.get("registrationBlockId"),f=this.generation.registrationBlocks.get(u);this.$el.html(this.template({titlePath:this.titlePath,bodyPath:this.bodyPath,model:n,leftFields:i,rightFields:r,size:this.size,options:this.templateOptions,registrationBlock:f.toJSON()}));Scheduler.Config.sectionSettings.sectionBookSettings.showBooks&&new Scheduler.Views.Books({collection:this.books,el:this.$(".section-item-books")}).render()},toggleLock:_.debounce(function(){var t=this.model.get("registrationBlockId"),n=this.generation.registrationBlocks.get(t),i=!n.get("locked");return this.showSpinner(),this.listenToOnce(this.generation,"set:newSchedule",this.setNewModel),n.save({locked:i,term:this.generation.get("term")},{success:this.onToggleLockSuccess,error:this.onToggleLockError,wait:!0}),!1},500,!0),onToggleLockSuccess:function(n){this.hideSpinner();var t=this.$(".btn-toggle-lock"),u=n.get("locked"),i,r;u?(t.find("i").removeClass("unlock").addClass("lock"),t.find("span").html("Locked"),i="unlock"):(t.find("i").removeClass("lock").addClass("unlock"),t.find("span").html("Unlocked"),i="lock");r="Click to "+i+" this class for "+this.model.get("subject")+" "+this.model.get("course");t.prop("title",r);t.attr("data-original-title",r)},onToggleLockError:function(n,t){Scheduler.AppView.showError(t);this.hideSpinner()},showMore:function(n){var t=this.$(n.currentTarget),i=this.$(".section-details > li");this.moreShown?(i.removeClass("show-field"),t.find("span").html("Show More")):(i.addClass("show-field"),t.find("span").html("Show Less"));this.moreShown=!this.moreShown},showSpinner:function(){this.$(".btn-toggle-lock i").removeClass("glyphicons").addClass("fa fa-spinner fa-spin")},hideSpinner:function(){this.$(".btn-toggle-lock i").addClass("glyphicons").removeClass("fa fa-spinner fa-spin")}});Scheduler.Views.SectionPopover=Scheduler.Views.BasePopover.extend({initialize:function(n){Scheduler.Views.BaseModal.prototype.initialize.apply(this,[n])},titlePath:"section/popover-title",bodyPath:"section/popover-body"});Scheduler.Views.SectionProvidedGrid=Backbone.View.extend({template:JST["section/provided-grid"],a11yTemplate:JST["accessibility/section/provided-grid"],events:{"click .btn-section-details":"showSectionDetails","click .btn-show-more":"showMore",'click input[type="checkbox"].select-all':"selectAll",'click input[type="checkbox"].select':"selectOrDeselect"},initialize:function(n){n=n||{};this.fieldSettings=n.fieldSettings;this.showSelectWarning=n.showSelectWarning;this.selectWarningMsg=n.selectWarningMsg;this.showSelectCol=n.showSelectCol;_.bindAll(this,"render","renderTemplate","showSectionDetails");this.render()},render:function(){return this.renderTemplate(),Modernizr.touch||this.$('[data-toggle="tooltip"]').tooltip(),this.sectionDetailItems=[],this},renderTemplate:function(){var n=_.filter(this.fieldSettings,function(n){return n.showColumn}),t=_.reduce(n,function(n,t){return n[t.key]=t,n},{}),i=_.where(Scheduler.Config.courseSettings.flags,{showOnSection:!0});this.$el.html(this.template({attributeText:Scheduler.Config.sectionFieldText,allSelected:this.collection.where({selected:!0}).length===this.collection.length,sections:this.collection.toTemplate(),columns:n,columnsByKey:t,colCount:this.getColumnCount(),showSelectCol:this.showSelectCol,configFlags:i}))},getColumnCount:function(){var n=_.filter(this.fieldSettings,function(n){return n.showColumn}).length;return n+this.getActionColumnCount()},getActionColumnCount:function(){var n=0;return n+=this.showSelectCol?1:0,n+1},showSectionDetails:function(n){var t=this.getSectionFromRow(n),i=this.findSectionDetailItem(t);i?this.removeSectionDetailItem(i):this.addSectionDetailItem(n,t)},findSectionDetailItem:function(n){return _.find(this.sectionDetailItems,function(t){return t.model.id===n.id})},addSectionDetailItem:function(n,t){var r=this.$(n.currentTarget||n).closest(".section-item"),i=new Scheduler.Views.SectionDetailItem({model:t,fieldSettings:this.fieldSettings,columnCount:this.getColumnCount()===0?9:this.getColumnCount()+1});i.$el.children("td, th").wrapInner('<div style="display: none;" />').parent().insertAfter(r).find("td > div").slideDown(function(){$(this).replaceWith($(this).contents())});this.sectionDetailItems.push(i)},getSectionFromRow:function(n){var t=this.getSectionIdFromRow(n);return this.collection.get(t)},getSectionIdFromRow:function(n){var t=this.$(n.currentTarget||n).closest(".section-item");return t.data("id")},removeSectionDetailItem:function(n){this.sectionDetailItems=_.without(this.sectionDetailItems,n);n.$el.tableRowRemove(function(){n.remove()})},showMore:function(n){var u=this.$(n.currentTarget).closest("tr"),f=u.find(".btn-show-more"),r,t,i;f.each(function(){t=$(this);i=t.prev(".additional");i.is(":visible")?(r=t.data("count"),t.find("small").html(r+" More"),i.slideUp()):(t.find("small").html("Hide"),i.slideDown())})},selectAll:function(n){this.$('input[type="checkbox"].select').prop("checked",n.currentTarget.checked);this.collection.invoke("set",{selected:n.currentTarget.checked});this.showSelectWarning&&(bootbox.alert(this.selectWarningMsg),this.showSelectWarning=!1)},selectOrDeselect:function(n){var t=this.getSectionFromRow(n);t.set("selected",n.currentTarget.checked);this.$('input[type="checkbox"].select-all').prop("checked",this.allSelected());this.showSelectWarning&&(bootbox.alert(this.selectWarningMsg),this.showSelectWarning=!1)},allSelected:function(){return this.collection.where({selected:!0}).length===this.collection.length}});Scheduler.Views.SectionShoppingCart=Backbone.View.extend({template:JST["section/shopping-cart"],className:"shopping-cart hidden-xs hidden-sm col-md-12",initialize:function(){_.bindAll(this,"render","renderTemplate","onFetch");this.listenTo(this.collection,"updated:all",this.onFetch);this.collection.invoke("set","selected",!0);this.render()},render:function(){return this.renderTemplate(),this.currentSectionsGrid?(this.currentSectionsGrid.render(),this.currentSectionsGrid.delegateEvents()):this.currentSectionsGrid=new Scheduler.Views.SectionProvidedGrid({collection:this.collection,fieldSettings:Scheduler.Config.cartSectionFieldSettings,showSelectCol:!0,showSelectWarning:!0,selectWarningMsg:Scheduler.Config.cartSettings.cartSelectionWarning}),this.$(".section-grid-container").append(this.currentSectionsGrid.el),this},renderTemplate:function(){this.$el.html(this.template({title:Scheduler.Config.cartSettings.cartLabel,collection:this.collection.toTemplate()}))},onFetch:function(){this.collection.invoke("set","selected",!0);this.render()}});Scheduler.Views.SectionShow=Backbone.View.extend({template:JST["section/show"],className:"section-show row",initialize:function(n){this.fieldSettings=n.fieldSettings;_.bindAll(this,"render","renderTemplate");this.render()},render:function(){return this.renderTemplate(),Modernizr.touch||this.$('[data-toggle="tooltip"]').tooltip(),this},renderTemplate:function(){var n=_.map(this.fieldSettings,_.bind(function(n){return n.val=this.model.get(n.key),n.text=n.key==="enrollmentRequirements"?Scheduler.Config.sectionFieldText:Scheduler.Config.sectionFieldText[n.key],n},this));this.$el.html(this.template({section:this.model.toTemplate(),fields:n,configFlags:Scheduler.Config.courseSettings.flags}))}});Scheduler.Views.Select=Backbone.View.extend({template:JST["shared/select"],initialize:function(n){_.bindAll(this,"render","renderTemplate","renderSelect2","collectionResults","onChange","onSelecting","inputEl");n=_.defaults(n||{},{minimumResultsForSearch:15});this.placeholder=n.placeholder;this.dataText=n.dataText;this.defaultSelection=n.defaultSelection||n.preselectedIds;this.minimumResultsForSearch=n.minimumResultsForSearch;this.uniqueByDataText=n.uniqueByDataText;this.allowClear=n.allowClear;this.startDisabled=n.startDisabled;this.elementToFocus=n.elementToFocus;this.format=n.format;this.multiple=n.multiple;this.data=n.data;this.preselectedIds=n.preselectedIds||[];this.render()},render:function(){return this.renderTemplate(),this},renderTemplate:function(){if(this.$el.html(this.template({})),this.inputEl().hasClass("select2-container")){this.inputEl().select2("destroy");var n=this.inputEl().clone();this.$el.append(n)}else setTimeout(this.renderSelect2,0)},renderSelect2:function(){var t=this.dataText,r=this.collectionData(),u=this.preselectedIds,f=this.multiple,i,n;this.preselectedIds.length&&(i=function(t,i){n=_.filter(r,function(n){return _.contains(u,n.id||n)});!f&&n.length&&(n=n[0]);i(n)});this.inputEl().select2({placeholder:this.placeholder,data:this.collectionResults,formatSelection:this.format||function(n){return n[t]},formatResult:this.format||function(n){return n[t]},minimumResultsForSearch:this.minimumResultsForSearch,allowClear:this.allowClear,multiple:this.multiple,separator:"||",initSelection:i}).on("change",this.onChange).on("select2-open",this.applyMobileHeaderAbsolute).on("select2-close",this.applyMobileHeaderFixed).on("select2-selecting",this.onSelecting);this.defaultSelection&&this.setSelected(this.defaultSelection);this.startDisabled&&this.inputEl().select2("enable",!1)},collectionData:function(){var n=_.isFunction(this.collection)?this.collection():this.collection;return n.toTemplate&&_.isFunction(n.toTemplate)?n.toTemplate():n},collectionResults:function(){var n=this.collectionData(),t=this.dataText;return this.uniqueByDataText&&(n=_.unique(n,function(n){return n[t]})),{results:n,text:this.format||t}},onChange:function(n){n.val||(n.val=this.getSelected());this.trigger("selection:change",n,this)},onSelecting:function(n){this.elementToFocus&&setTimeout(_.bind(function(){this.elementToFocus.data("select2")?this.elementToFocus.select2("focus"):this.elementToFocus.focus()},this),0);this.trigger("selection:selecting",n)},clearSelected:function(){this.inputEl().select2("val","")},setSelected:function(n){this.inputEl().select2("val",n)},getSelected:function(){return this.inputEl().select2("val")},applyMobileHeaderAbsolute:function(){Modernizr.touch&&$("#header .navbar-fixed-top").addClass("fixfixed")},applyMobileHeaderFixed:function(){Modernizr.touch&&$("#header .navbar-fixed-top").removeClass("fixfixed")},inputEl:function(){return this.$el.find("input")},startSpinner:function(){this.inputEl().startSelect2Spinner()},stopSpinner:function(){this.inputEl().stopSelect2Spinner()},enable:function(){this.inputEl().select2("enable",!0)},disable:function(){this.inputEl().select2("enable",!1)}});Scheduler.Views.TipsDesktop=Backbone.View.extend({template:JST["tips/desktop"],className:"tips-desktop-page top15 visible-md visible-lg",initialize:function(){_.bindAll(this,"render","renderTemplate");this.render();this.listenTo(Scheduler.Data.Terms,"updated:selected",this.render)},render:function(){return this.renderTemplate(),this},renderTemplate:function(){var n=_.filter(Scheduler.Config.homeSettings.tips,function(n){return!n.term||Scheduler.Data.CurrentTerm.id.indexOf(n.term)>-1});this.$el.html(this.template({tips:n,showTips:Scheduler.Config.homeSettings.showDesktopTips,warnings:Scheduler.Data.RegistrationWarnings.toTemplate(),userId:Scheduler.Data.UserId,userIdLabel:Scheduler.Config.homeSettings.userIdLabel,studentName:Scheduler.Data.StudentName,studentNameLabel:Scheduler.Config.homeSettings.studentNameLabel,messages:_.where(Scheduler.Data.Messages.toTemplate(),{location:"home"})}))}});Scheduler.Views.TipsMobile=Backbone.View.extend({template:JST["tips/mobile"],className:"tips-mobile-page",initialize:function(){_.bindAll(this,"render","renderTemplate","toggleMore");this.render();this.listenTo(Scheduler.Data.Terms,"updated:selected",this.render)},events:{"click .tips-expand":"toggleMore"},render:function(){return this.renderTemplate(),this},renderTemplate:function(){var n=_.filter(Scheduler.Config.homeSettings.tips,function(n){return!n.term||Scheduler.Data.CurrentTerm.id.indexOf(n.term)>-1});this.$el.html(this.template({tipsMessage:"<a class='tips-expand'>View <\/a>"+Scheduler.Config.text.plannerTitle.toLowerCase()+" tips.",tips:n,showTips:Scheduler.Config.homeSettings.showMobileTips,warnings:Scheduler.Data.RegistrationWarnings.toTemplate(),userId:Scheduler.Data.UserId,userIdLabel:Scheduler.Config.homeSettings.userIdLabel,studentName:Scheduler.Data.StudentName,studentNameLabel:Scheduler.Config.homeSettings.studentNameLabel,messages:_.where(Scheduler.Data.Messages.toTemplate(),{location:"home"})}))},toggleMore:function(){var n=this.$(".tips-message-expand");n.hasClass("hidden")?n.removeClass("hidden"):n.addClass("hidden")}});Scheduler.Views.TopicSelectionListModal=Scheduler.Views.BaseModal.extend({id:"topic-selection-list-modal",attributes:{tabindex:"-1",role:"dialog","aria-hidden":"true","aria-labelledby":"event","data-keyboard":"false","data-backdrop":"static"},titlePath:"topic/topic-selection-list-modal-title",bodyPath:"topic/topic-selection-list-modal-body",events:function(){return _.extend({},Scheduler.Views.BaseModal.prototype.events,{"click .btn-mp-save-topics":"saveCoursesWithTopics"})},initialize:function(n){n=n||{};_.bindAll(this,"render","renderTemplate","renderDropDowns","renderDropDown");n.term&&(this.term=n.term);n.size="lg";this.topics=new Scheduler.Collections.Topics;Scheduler.Views.BaseModal.prototype.initialize.apply(this,[n]);this.render()},render:function(){return this.renderTemplate(),setTimeout(this.renderDropDowns,500),this},renderTemplate:function(){this.$el.html(this.template({titlePath:this.titlePath,bodyPath:this.bodyPath,courses:this.collection.toTemplate()}))},renderDropDowns:function(){this.collection.each(this.renderDropDown)},renderDropDown:function(n){var i=n.cid,t=new Scheduler.Collections.Topics({},{term:{id:this.term},subject:{id:n.get("subjectId")},course:n});t.fetch({success:_.bind(function(n){this.$("#ddltopics"+i).select2({placeholder:"Select a Topic",data:{results:t.toTemplate(),text:"title"},formatSelection:function(n){return n.title},formatResult:function(n){return n.title}}).on("select2-open",this.applyMobileHeaderAbsolute).on("select2-close",this.applyMobileHeaderFixed);this.topics.add(n.models)},this)})},saveCoursesWithTopics:function(){var s=this.$("input.topic-ddls"),r=[],u=[],f=[],n=[],t=0,i,e,o=this.invalidAlert,h=_.bind(function(i){Scheduler.Data.Courses.add(i);r.push(i.get("subjectShort")+" "+i.get("number"));t++;t===n.length&&this.showFeedback(r,f)},this),c=_.bind(function(i,u){f.push(u);t++;t===n.length&&this.showFeedback(r,f)},this);return($.each(s,_.bind(function(t,r){var c=this.$(r),s=c.select2("val"),l=c.data("course"),f=this.collection.get(l),h;s||(i="Please select a topic for each course.",o([i]),e=!0);h=this.topics.get(s);Scheduler.Data.Courses.doesCourseExist(f.get("subjectId"),f.get("number"),s)||h&&h.get("alreadyDesired")?u.push(f.get("subjectShort")+" "+f.get("number")):n.push({course:f,topicId:s})},this)),e)?!1:(_.each(n,function(n){var i=new Scheduler.Models.DesiredCourse,t=_.clone(n.course.attributes);t.id=null;t.term=Scheduler.Data.CurrentTerm.id;t.topic=n.topicId;i.save(t,{success:h,error:c,wait:!0})}),u.length&&(i="The following courses have been added already: "+u.join(", "),o([i])),!1)},showFeedback:function(n,t){if(n.length){var i="Added the following courses: "+n.join(", ");Scheduler.AppView.showSuccessAlert(i)}t.length&&Scheduler.AppView.showErrorList(t)},invalidAlert:function(n){Scheduler.AppView.showDangerAlert("Please see the following errors",n)},applyMobileHeaderAbsolute:function(){Modernizr.touch&&$("#header .navbar-fixed-top").addClass("fixfixed")},applyMobileHeaderFixed:function(){Modernizr.touch&&$("#header .navbar-fixed-top").removeClass("fixfixed")},remove:function(){this.$("input.topic-ddls").select2("destroy");Backbone.View.prototype.remove.call(this)}});Scheduler.FilterMapBase={viewIndex:"FilterIndex",viewLabel:"SelectedLabel"};Scheduler.FilterMap={AcademicCareers:_.extend({},Scheduler.FilterMapBase,{selectedFilterClass:"selected-academic-careers-label",type:"academicCareer",typePlural:"academicCareers"}),AcademicGroups:_.extend({},Scheduler.FilterMapBase,{selectedFilterClass:"selected-academic-groups-label",type:"academicGroup",typePlural:"academicGroups"},Scheduler.FilterMapBase),Campuses:_.extend({},Scheduler.FilterMapBase,{selectedFilterClass:"selected-campuses-label",type:"campus",typePlural:"campuses"}),CourseStatuses:_.extend({},Scheduler.FilterMapBase,{viewIndex:"FilterRadioIndex",selectedFilterClass:"selected-course-status-label",isDropDown:!0,type:"courseStatus",typePlural:"courseStatuses"}),InstructionModes:_.extend({},Scheduler.FilterMapBase,{selectedFilterClass:"selected-instruction-modes-label",type:"instructionMode",typePlural:"instructionModes"}),Locations:_.extend({},Scheduler.FilterMapBase,{selectedFilterClass:"selected-locations-label",type:"location",typePlural:"locations"}),PartsOfTerm:_.extend({},Scheduler.FilterMapBase,{selectedFilterClass:"selected-parts-of-term-label",type:"partOfTerm",typePlural:"partsOfTerm"}),RequiredCourses:_.extend({},Scheduler.FilterMapBase,{viewIndex:"RequiredCoursesEntry",type:"requiredCourse",typePlural:"requiredCourses",delayedCollection:!0}),Sessions:_.extend({},Scheduler.FilterMapBase,{selectedFilterClass:"selected-sessions-label",type:"session",typePlural:"sessions"}),ShoppingCart:_.extend({},Scheduler.FilterMapBase,{viewIndex:"ShoppingCartEntry",type:"cartSection",typePlural:"cartSections"}),Terms:_.extend({},Scheduler.FilterMapBase,{viewIndex:"FilterRadioIndex",viewLabel:function(){return Scheduler.Data.Terms.length>1?"SelectedLabel":"DisplayLabel"},selectedFilterClass:"selected-term-label",isDropDown:!0,title:function(){return Scheduler.Data.CurrentTerm.get("title")},type:"term",typePlural:"terms"}),UpdatedAt:_.extend({},Scheduler.FilterMapBase,{viewLabel:"DisplayLabel",title:function(){return Scheduler.Data.UpdatedAt.get("title")},labelText:"Updated",selectedFilterClass:"display-updated-label"})};Scheduler.Routers.AppRouter=Backbone.Router.extend({initialize:function(n){n=n||{};this.entryFilterData=n.entryFilterData;_.bindAll(this,"hashChange","beforeUnload")},route:function(n,t,i){_.isRegExp(n)||(n=this._routeToRegExp(n));_.isFunction(t)&&(i=t,t="");i||(i=this[t]);var r=this;return Backbone.history.route(n,function(u){var f=r._extractParameters(n,u);r.runFilters(r,r.before,u,f)&&r.execute(i,f,t)!==!1&&(r.trigger.apply(r,["route:"+t].concat(f)),r.trigger("route",t,f),Backbone.history.trigger("route",r,t,f),r.runFilters(r,r.after,u,f))}),this},execute:function(n,t,i){n&&(this.trigger("execute",i),n.apply(this,t))},routes:{academiccareers:"academicCareers","terms/:term/academiccareers":"academicCareersWithTerm",academicgroups:"academicGroups","terms/:term/academicgroups":"academicGroupsWithTerm","":"options",options:"options","terms/:term/options":"optionsWithTerm",breaks:"breaks","terms/:term/breaks":"breaksWithTerm","breaks/new":"breaksNew","terms/:term/breaks/new":"breaksNewWithTerm","breaks/:id":"breaksEdit","terms/:term/breaks/:id":"breaksEditWithTerm",campuses:"campuses","terms/:term/campuses":"campusesWithTerm","courses(/section/:sectionId)":"courses","terms/:term/courses(/section/:sectionId)":"coursesWithTerm","courses/add":"coursesAdd","terms/:term/courses/add":"coursesAddWithTerm","courses/:id(/section/:sectionId)":"courseDetail","terms/:term/courses/:id(/section/:sectionId)":"courseDetailWithTerm","courses/:id(/section/:sectionId)/disabled":"courseDetailDisabled","terms/:term/courses/:id(/section/:sectionId)/disabled":"courseDetailDisabledWithTerm",coursestatuses:"courseStatuses","terms/:term/coursestatuses":"courseStatusesWithTerm","entry(/section/:sectionId)":"entry",help:"help","terms/:term/help":"helpWithTerm",instructionmodes:"instructionModes","terms/:term/instructionmodes":"instructionModesWithTerm",locations:"locations","terms/:term/locations":"locationsWithTerm",partsofterm:"partsOfTerm","terms/:term/partsofterm":"partsOfTermWithTerm","registration/:id(/section/:sectionId)":"registration","terms/:term/registration/:id(/section/:sectionId)":"registrationWithTerm",schedules:"schedules","terms/:term/schedules":"schedulesWithTerm",sessions:"sessions","terms/:term/sessions":"sessionsWithTerm","schedules/favorites/:id":"favoritesShowNoTerm","terms/:term/schedules/favorites/:id":"favoritesShow","schedules/:id(/section/:sectionId)":"schedulesShow","terms/:term/schedules/:id(/section/:sectionId)":"schedulesShowWithTerm",terms:"terms","terms/:term":"termsWithTerm","degreeplanner(/:year)":"degreePlannerMain","degreeplanner/term/:term":"degreePlannerByTerm","degreeplanner/courses/add/:term":"degreePlannerAddCourseByTerm"},beforeHashChange:{"*any":["checkDirtyFilter","onBeforeLeaveModule"]},beforeWindowUnload:{"*any":["checkDirtyUnloadFilter","onBeforeUnloadModule"]},before:{},after:{"*any":["onChangeModule"]},modules:{degreeplanner:{name:"Degree Planner",path:["degreeplanner","degreeplanner/*path"],onBeforeLeave:"checkDegreeplanDirtyFilter",onBeforeUnload:"checkDegreeplanDirtyUnloadFilter",onEnter:"enterDegreePlan",onLeave:"leaveDegreePlan"}},academicCareers:function(){this.showAcademicCareerIndex()},academicCareersWithTerm:function(n){this.listenToOnce(Scheduler.Data.Terms,"updated:selected",function(){this.showAcademicCareerIndex()});this.updatedTerm(n)},academicGroups:function(){this.showAcademicGroupIndex()},academicGroupsWithTerm:function(n){this.listenToOnce(Scheduler.Data.Terms,"updated:selected",function(){this.showAcademicGroupIndex()});this.updatedTerm(n)},options:function(){this.showOptionIndex()},optionsWithTerm:function(n){this.updatedTerm(n);this.showOptionIndex()},breaks:function(){this.showBreakIndex()},breaksWithTerm:function(n){this.updatedTerm(n);this.showBreakIndex()},breaksEdit:function(n){this.showBreakShowWithSavedModel(n)},breaksEditWithTerm:function(n,t){this.listenToOnce(Scheduler.Data.Terms,"updated:selected",function(){this.showBreakShowWithSavedModel(t)});this.updatedTerm(n)},breaksNew:function(){this.showBreakShowWithNewModel()},breaksNewWithTerm:function(n){this.listenToOnce(Scheduler.Data.Terms,"updated:selected",function(){this.showBreakShowWithNewModel()});this.updatedTerm(n)},campuses:function(){this.showCampusIndex()},campusesWithTerm:function(n){this.listenToOnce(Scheduler.Data.Terms,"updated:selected",function(){this.showCampusIndex()});this.updatedTerm(n)},courses:function(n){this.showCourseIndex(n)},coursesWithTerm:function(n,t){this.showCourseIndex(t);this.updatedTerm(n)},coursesAdd:function(){this.showCourseAdd()},coursesAddWithTerm:function(n){this.listenToOnce(Scheduler.Data.Terms,"updated:selected",function(){this.showCourseAdd()});this.updatedTerm(n)},courseDetail:function(n,t){this.showCourseDetail(n,t,!1)},courseDetailWithTerm:function(n,t,i){this.listenToOnce(Scheduler.Data.Terms,"updated:selected",function(){this.showCourseDetail(t,i,!1)});this.updatedTerm(n)},courseDetailDisabled:function(n,t){this.showCourseDetail(n,t,!0)},courseDetailDisabledWithTerm:function(n,t,i){this.listenToOnce(Scheduler.Data.Terms,"updated:selected",function(){this.showCourseDetail(t,i,!0)});this.updatedTerm(n)},courseStatuses:function(){this.showCourseStatusIndex()},courseStatusesWithTerm:function(n){this.listenToOnce(Scheduler.Data.Terms,"updated:selected",function(){this.showCourseStatusIndex()});this.updatedTerm(n)},degreePlannerMain:function(n){this.showDegreePlanner({year:n})},degreePlannerByTerm:function(n){this.showDegreePlanner({term:n})},degreePlannerAddCourseByTerm:function(n){this.navigate("degreeplanner/"+n,{replace:!0,trigger:!0})},entry:function(n){var t=[],i,f,r,u;_.each(this.entryFilterData,function(n){r=Scheduler.FilterMap[n];u=Scheduler.Data[_.capitalizeFirst(r.typePlural)];(u&&u.length||r.delayedCollection)&&t.push(n)});!Scheduler.Data.CartSections.length||_.contains(t,"Terms")||Scheduler.Config.filterSettings.skipShoppingCart||t.splice(0,0,"ShoppingCart");t.length?(n&&this.navigate("entry",{replace:!0}),i=new Scheduler.Views.EntryFilter({entryFilterData:t}),this.showView(i),Scheduler.Accessibility&&(f=new Scheduler.Views.Footer({selectedBreaks:new Scheduler.Collections.Breaks,courses:new Scheduler.Collections.DesiredCourses}),i.$el.append(f.$el))):this.navigateWithTerm("")},help:function(){var n=new Scheduler.Views.HelpIndex;this.showView(n)},helpWithTerm:function(n){this.updatedTerm(n);var t=new Scheduler.Views.HelpIndex;this.showView(t)},instructionModes:function(){this.showInstructionModeIndex()},instructionModesWithTerm:function(n){this.listenToOnce(Scheduler.Data.Terms,"updated:selected",function(){this.showInstructionModeIndex()});this.updatedTerm(n)},locations:function(){this.showLocationIndex()},locationsWithTerm:function(n){this.listenToOnce(Scheduler.Data.Terms,"updated:selected",function(){this.showLocationIndex()});this.updatedTerm(n)},partsOfTerm:function(){this.showPartOfTermIndex()},partsOfTermWithTerm:function(n){this.listenToOnce(Scheduler.Data.Terms,"updated:selected",function(){this.showPartOfTermIndex()});this.updatedTerm(n)},registration:function(n,t){this.showRegistrationError(n,t)},registrationWithTerm:function(n,t,i){this.updatedTerm(n);this.showRegistrationError(t,i)},schedules:function(){this.showScheduleIndex()},schedulesWithTerm:function(n){this.updatedTerm(n);this.showScheduleIndex()},schedulesShow:function(n,t){this.showScheduleShow(n,t)},favoritesShow:function(n,t,i){this.showFavoritesShow(n,t,i)},favoritesShowNoTerm:function(n,t){this.showFavoritesShow(null,n,t)},schedulesShowWithTerm:function(n,t,i){this.updatedTerm(n);this.showScheduleShow(t,i)},sessions:function(){this.showSessionIndex()},sessionsWithTerm:function(n){this.listenToOnce(Scheduler.Data.Sessions,"updated:selected",function(){this.showSessionIndex()});this.updatedTerm(n)},terms:function(){this.showTermsIndex()},termsWithTerm:function(n){this.updatedTerm(n);this.showTermsIndex()},showAcademicCareerIndex:function(){var n=new Scheduler.Views.FilterIndex({collection:Scheduler.Data.AcademicCareers,type:"academicCareer",typePlural:"academicCareers"});this.showView(n)},showAcademicGroupIndex:function(){var n=new Scheduler.Views.FilterIndex({collection:Scheduler.Data.AcademicGroups,type:"academicGroup",typePlural:"academicGroups"});this.showView(n)},showOptionIndex:function(){this.showMobileView(Scheduler.AppView.OptionsView,"options")},showBreakIndex:function(){this.showMobileView(Scheduler.AppView.BreaksView,"breaks")},showBreakShowWithSavedModel:function(n){var r=Scheduler.Data.Breaks,t=Scheduler.Data.Breaks.findWhere({id:parseInt(n,10)}),i;t&&(i=new Scheduler.Views.BreakShow({model:t,collection:r}),this.showView(i))},showBreakShowWithNewModel:function(){var n=new Scheduler.Views.BreakShow({collection:Scheduler.Data.Breaks});this.showView(n)},showCampusIndex:function(){var n=new Scheduler.Views.FilterIndex({collection:Scheduler.Data.Campuses,type:"campus",typePlural:"campuses"});this.showView(n)},showCourseIndex:function(n){n&&this.navigateWithTerm("courses",{replace:!0});this.showMobileView(Scheduler.AppView.CoursesView,"courses")},showCourseAdd:function(n){var t=n||Scheduler.Data.Courses,i=new Scheduler.Views.CourseAdd({collection:t});this.showView(i)},showCourseDetail:function(n,t,i){var r=Scheduler.Data.Courses.findWhere({id:n}),u;r&&(u=new Scheduler.Views.CourseDetail({model:r,sectionId:t,showDisabled:i}),this.showView(u))},showCourseStatusIndex:function(){var n=new Scheduler.Views.FilterRadioIndex({collection:Scheduler.Data.CourseStatuses,type:"courseStatus",typePlural:"courseStatuses"});this.showView(n)},showDegreePlanner:function(n){if(!Scheduler.Config.degreePlannerSettings.enabled){this.navigateWithTerm("");return}var t=Scheduler.AppView.DegreeplannerView;n=_.defaults(n||{},{year:null,term:null});Scheduler.AppView.isCurrentView(t)||(t.render(),Scheduler.AppView.showView(t));t.setRouterOptions(n)},showInstructionModeIndex:function(){var n=new Scheduler.Views.FilterIndex({collection:Scheduler.Data.InstructionModes,type:"instructionMode",typePlural:"instructionModes"});this.showView(n)},showLocationIndex:function(){var n=new Scheduler.Views.FilterIndex({collection:Scheduler.Data.Locations,type:"location",typePlural:"locations"});this.showView(n)},showPartOfTermIndex:function(){var n=new Scheduler.Views.FilterIndex({collection:Scheduler.Data.PartsOfTerm,type:"partOfTerm",typePlural:"partsOfTerm"});this.showView(n)},showRegistrationError:function(n,t){var u=Scheduler.AppView.SchedulesView.collection,i=u.get(n),f=Scheduler.AppView.SchedulesView.model,r;if(!i){this.navigateWithTerm("");return}r=new Scheduler.Views.RegistrationError({model:i,showStatusCol:f.get("currentSections").length>0,sectionId:t});this.showView(r)},showScheduleIndex:function(){this.showMobileView(Scheduler.AppView.SchedulesView,"schedules")},showScheduleShow:function(n,t){var u=Scheduler.AppView.SchedulesView.collection,i=u.get(n),f=Scheduler.AppView.SchedulesView.model,r;if(!i){this.navigateWithTerm("");return}r=new Scheduler.Views.ScheduleShow({model:i,generation:f,sectionId:t,collection:Scheduler.AppView.SchedulesView.collection,favoriteSchedules:Scheduler.AppView.favoriteSchedules});this.showView(r)},showFavoritesShow:function(n,t,i){var r=Scheduler.AppView.favoriteSchedules,u=r.get(t),f,e,o;if(!u){this.navigateWithTerm("");return}f=u.getSchedule();e=u.getGeneration();o=new Scheduler.Views.ScheduleShow({model:f,generation:e,sectionId:i,collection:r.getAllSchedules(),favoriteSchedules:r});this.showView(o)},showSessionIndex:function(){var n=new Scheduler.Views.FilterIndex({collection:Scheduler.Data.Sessions,type:"session",typePlural:"sessions"});this.showView(n)},showTermsIndex:function(){var n=new Scheduler.Views.FilterRadioIndex({collection:Scheduler.Data.Terms,type:"term",typePlural:"terms"});this.showView(n)},showMobileView:function(n,t){Scheduler.AppView.showMobileViewWithTransition(n,t)},showView:function(n){Scheduler.AppView.showView(n)},updatedTerm:function(n){var t=Scheduler.Data.Terms.get(n);t&&Scheduler.Data.CurrentTerm.id!==t.id?Scheduler.Data.Terms.setSelected(t):Scheduler.Data.Terms.trigger("updated:selected")},navigate:function(n,t){t&&t.replace===!0&&(this.replacing=!0);this.trigger("navigate",n);arguments[0]=encodeURI(n);Backbone.Router.prototype.navigate.apply(this,arguments)},navigateWithTerm:function(n){Scheduler.Data.Terms.length>1&&(n===""&&(n="options"),n=n==="terms"?"terms/"+Scheduler.Data.CurrentTerm.id:"terms/"+Scheduler.Data.CurrentTerm.id+"/"+n);arguments[0]=n;this.navigate.apply(this,arguments)},hashChange:function(n){if(this.replacing){this.replacing=!1;return}if(this.replacing=!1,this.cancelNavigate){n.stopImmediatePropagation();this.cancelNavigate=!1;return}this.runFilters(this,this.beforeHashChange,Backbone.history.getFragment(),[])||(n.stopImmediatePropagation(),this.cancelNavigate=!0,window.location.href=n.originalEvent.oldURL)},beforeUnload:function(){if(!this.runFilters(this,this.beforeWindowUnload,"exit",[]))return"You have unsaved changes. Are you sure you want to leave this page?"},registerHashChangeListener:function(){$(window).on("hashchange",this.hashChange)},registerBeforeUnloadListener:function(){$(window).on("beforeunload",this.beforeUnload)},runFilters:function(n,t,i,r){var u=_.filter(t,function(t,r){return r=_.isRegExp(r)?r:n._routeToRegExp(r),r.test(i)});return _.every(u,function(t){return _.isArray(t)||(t=[t]),_.every(t,function(t){return _.isString(t)&&(t=n[t]),t(n,i,r)})})},checkDirtyFilter:function(){if(Scheduler.AppView.isDirty){var n=window.confirm("You have unsaved changes. Are you sure you want to leave this page?");if(n)Scheduler.AppView.clearDirty();else return!1}return!0},checkDirtyUnloadFilter:function(){return Scheduler.AppView.isDirty?!1:!0},checkDegreeplanDirtyFilter:function(){if(Scheduler.Data.Degreeplanner.DegreePlan.isDirty()){var n=window.confirm("You have unsaved changes. Are you sure you want to leave this page?");if(!n)return!1}return!0},checkDegreeplanDirtyUnloadFilter:function(){return Scheduler.Data.Degreeplanner.DegreePlan.isDirty()?!1:!0},enterDegreePlan:function(){document.title=Scheduler.Config.degreePlannerSettings.title;Scheduler.Data.Degreeplanner.DegreePlan.markAsClean()},leaveDegreePlan:function(){document.title=Scheduler.Config.text.plannerTitle;Scheduler.Data.Degreeplanner.DegreePlan.isDirty()&&(Scheduler.Data.Degreeplanner.DegreePlan.markAsClean(),Scheduler.Data.Degreeplanner.DegreePlan.fetch())},onBeforeLeaveModule:function(n,t,i){var r=n.currentApp,f=n.findModuleByFragment(n,t),u;return r&&r!==f&&r.onBeforeLeave?(u=_.isString(r.onBeforeLeave)?n[r.onBeforeLeave]:r.onBeforeLeave,u(n,t,i)):!0},onBeforeUnloadModule:function(n,t,i){var r=n.currentApp,u;return r&&r.onBeforeUnload?(u=_.isString(r.onBeforeUnload)?n[r.onBeforeUnload]:r.onBeforeUnload,u(n,t,i,r)):!0},onChangeModule:function(n,t,i){var u=n.currentApp,r=n.findModuleByFragment(n,t),f;u!==r&&(u&&u.onLeave&&(f=_.isString(u.onLeave)?n[u.onLeave]:u.onLeave,f(n,t,i)),r&&r.onEnter&&(f=_.isString(r.onEnter)?n[r.onEnter]:r.onEnter,f(n,t,i)));n.currentApp=r},findModuleByFragment:function(n,t){return _.find(n.modules,function(i){return _.any($.makeArray(i.path),function(i){var r=_.isRegExp(i)?i:n._routeToRegExp(i);return r.test(t)})})}})